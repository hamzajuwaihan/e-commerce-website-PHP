(()=>{var Bl=Object.create;var Xn=Object.defineProperty,Sl=Object.defineProperties,Pl=Object.getOwnPropertyDescriptor,Ll=Object.getOwnPropertyDescriptors,Cl=Object.getOwnPropertyNames,Dr=Object.getOwnPropertySymbols,El=Object.getPrototypeOf,jr=Object.prototype.hasOwnProperty,Al=Object.prototype.propertyIsEnumerable;var ei=(e,t,n)=>t in e?Xn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ve=(e,t)=>{for(var n in t||(t={}))jr.call(t,n)&&ei(e,n,t[n]);if(Dr)for(var n of Dr(t))Al.call(t,n)&&ei(e,n,t[n]);return e},Yt=(e,t)=>Sl(e,Ll(t)),Tl=e=>Xn(e,"__esModule",{value:!0});var Yn=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var xl=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Cl(t))!jr.call(e,o)&&o!=="default"&&Xn(e,o,{get:()=>t[o],enumerable:!(n=Pl(t,o))||n.enumerable});return e},fn=e=>xl(Tl(Xn(e!=null?Bl(El(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var J=(e,t,n)=>(ei(e,typeof t!="symbol"?t+"":t,n),n);var Ta=Yn((Ti,xi)=>{(function(e,t){typeof Ti=="object"&&typeof xi!="undefined"?xi.exports=t():typeof define=="function"&&define.amd?define(t):e.Navigo=t()})(Ti,function(){"use strict";var e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(l){return typeof l}:function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l};function t(){return!(typeof window=="undefined"||!window.history||!window.history.pushState)}function n(l,u,p){this.root=null,this._routes=[],this._useHash=u,this._hash=p===void 0?"#":p,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!u&&t(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",l?this.root=u?l.replace(/\/$/,"/"+this._hash):l.replace(/\/$/,""):u&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function o(l){return l instanceof RegExp?l:l.replace(/\/+$/,"").replace(/^\/+/,"^/")}function i(l){return l.replace(/\/$/,"").split("/").length}function r(l,u){return i(u)-i(l)}function a(l,u){return function(p){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:[]).map(function(f){var g=function(k){var v=[];return{regexp:k instanceof RegExp?k:new RegExp(k.replace(n.PARAMETER_REGEXP,function(F,T,L){return v.push(L),n.REPLACE_VARIABLE_REGEXP}).replace(n.WILDCARD_REGEXP,n.REPLACE_WILDCARD)+n.FOLLOWED_BY_SLASH_REGEXP,n.MATCH_REGEXP_FLAGS),paramNames:v}}(o(f.route)),m=g.regexp,_=g.paramNames,y=p.replace(/^\/+/,"/").match(m),h=function(k,v){return v.length===0?null:k?k.slice(1,k.length).reduce(function(F,T,L){return F===null&&(F={}),F[v[L]]=decodeURIComponent(T),F},null):null}(y,_);return!!y&&{match:y,route:f,params:h}}).filter(function(f){return f})}(l,u)[0]||!1}function c(l,u){var p=u.map(function(g){return g.route===""||g.route==="*"?l:l.split(new RegExp(g.route+"($|/)"))[0]}),f=o(l);return p.length>1?p.reduce(function(g,m){return g.length>m.length&&(g=m),g},p[0]):p.length===1?p[0]:f}function d(l,u,p){var f,g=function(m){return m.split(/\?(.*)?$/)[0]};return p===void 0&&(p="#"),t()&&!u?g(l).split(p)[0]:(f=l.split(p)).length>1?g(f[1]):g(f[0])}function s(l,u,p){if(u&&(u===void 0?"undefined":e(u))==="object"){if(u.before)return void u.before(function(){(!(arguments.length>0&&arguments[0]!==void 0)||arguments[0])&&(l(),u.after&&u.after(p))},p);if(u.after)return l(),void(u.after&&u.after(p))}l()}return n.prototype={helpers:{match:a,root:c,clean:o,getOnlyURL:d},navigate:function(l,u){var p;return l=l||"",this._usePushState?(p=(p=(u?"":this._getRoot()+"/")+l.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",p),this.resolve()):typeof window!="undefined"&&(l=l.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+l),this},on:function(){for(var l=this,u=arguments.length,p=Array(u),f=0;f<u;f++)p[f]=arguments[f];if(typeof p[0]=="function")this._defaultHandler={handler:p[0],hooks:p[1]};else if(p.length>=2)if(p[0]==="/"){var g=p[1];e(p[1])==="object"&&(g=p[1].uses),this._defaultHandler={handler:g,hooks:p[2]}}else this._add(p[0],p[1],p[2]);else e(p[0])==="object"&&Object.keys(p[0]).sort(r).forEach(function(m){l.on(m,p[0][m])});return this},off:function(l){return this._defaultHandler!==null&&l===this._defaultHandler.handler?this._defaultHandler=null:this._notFoundHandler!==null&&l===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce(function(u,p){return p.handler!==l&&u.push(p),u},[]),this},notFound:function(l,u){return this._notFoundHandler={handler:l,hooks:u},this},resolve:function(l){var u,p,f=this,g=(l||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(g=g.replace(new RegExp("^/"+this._hash),"/"));var m=function(y){return y.split(/\?(.*)?$/).slice(1).join("")}(l||this._cLoc()),_=d(g,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&_===this._lastRouteResolved.url&&m===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(p=a(_,this._routes))?(this._callLeave(),this._lastRouteResolved={url:_,query:m,hooks:p.route.hooks,params:p.params,name:p.route.name},u=p.route.handler,s(function(){s(function(){p.route.route instanceof RegExp?u.apply(void 0,p.match.slice(1,p.match.length)):u(p.params,m)},p.route.hooks,p.params,f._genericHooks)},this._genericHooks,p.params),p):this._defaultHandler&&(_===""||_==="/"||_===this._hash||function(y,h,k){if(t()&&!h||!y.match(k))return!1;var v=y.split(k);return v.length<2||v[1]===""}(_,this._useHash,this._hash))?(s(function(){s(function(){f._callLeave(),f._lastRouteResolved={url:_,query:m,hooks:f._defaultHandler.hooks},f._defaultHandler.handler(m)},f._defaultHandler.hooks)},this._genericHooks),!0):(this._notFoundHandler&&s(function(){s(function(){f._callLeave(),f._lastRouteResolved={url:_,query:m,hooks:f._notFoundHandler.hooks},f._notFoundHandler.handler(m)},f._notFoundHandler.hooks)},this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),typeof window!="undefined"&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var l=this;typeof document!="undefined"&&this._findLinks().forEach(function(u){u.hasListenerAttached||(u.addEventListener("click",function(p){if((p.ctrlKey||p.metaKey)&&p.target.tagName.toLowerCase()=="a")return!1;var f=l.getLinkPath(u);l._destroyed||(p.preventDefault(),l.navigate(f.replace(/\/+$/,"").replace(/^\/+/,"/")))}),u.hasListenerAttached=!0)})},generate:function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=this._routes.reduce(function(f,g){var m;if(g.name===l)for(m in f=g.route,u)f=f.toString().replace(":"+m,u[m]);return f},"");return this._useHash?this._hash+p:p},link:function(l){return this._getRoot()+l},pause:function(){var l=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];this._paused=l,this._historyAPIUpdateMethod=l?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(l){return l===void 0?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=l,l)},disableIfAPINotAvailable:function(){t()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(l){return l.getAttribute("href")},hooks:function(l){this._genericHooks=l},_add:function(l){var u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;return typeof l=="string"&&(l=encodeURI(l)),this._routes.push((u===void 0?"undefined":e(u))==="object"?{route:l,handler:u.uses,name:u.as,hooks:p||u.hooks}:{route:l,handler:u,hooks:p}),this._add},_getRoot:function(){return this.root!==null?this.root:(this.root=c(this._cLoc().split("?")[0],this._routes),this.root)},_listen:function(){var l=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if(typeof window!="undefined"&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var u=this._cLoc(),p=void 0,f=void 0;(f=function(){p=l._cLoc(),u!==p&&(u=p,l.resolve()),l._listeningInterval=setTimeout(f,200)})()}},_cLoc:function(){return typeof window!="undefined"?window.__NAVIGO_WINDOW_LOCATION_MOCK__!==void 0?window.__NAVIGO_WINDOW_LOCATION_MOCK__:o(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var l=this._lastRouteResolved;l&&l.hooks&&l.hooks.leave&&l.hooks.leave(l.params)}},n.PARAMETER_REGEXP=/([:*])(\w+)/g,n.WILDCARD_REGEXP=/\*/g,n.REPLACE_VARIABLE_REGEXP="([^/]+)",n.REPLACE_WILDCARD="(?:.*)",n.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",n.MATCH_REGEXP_FLAGS="",n})});var ji=Yn((Vh,ja)=>{var Ia=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'],Ri=Ia.join(","),Ui=typeof Element=="undefined"?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;function Di(e,t){t=t||{};var n=e.ownerDocument||e,o=[],i=[],r=new Po(n),a=e.querySelectorAll(Ri);t.includeContainer&&Ui.call(e,Ri)&&(a=Array.prototype.slice.apply(a),a.unshift(e));var c,d,s;for(c=0;c<a.length;c++)d=a[c],!!Ma(d,r)&&(s=Ua(d),s===0?o.push(d):i.push({documentOrder:c,tabIndex:s,node:d}));var l=i.sort(Wc).map(function(u){return u.node}).concat(o);return l}Di.isTabbable=Oc;Di.isFocusable=qc;function Ma(e,t){return!(!Ra(e,t)||Xc(e)||Ua(e)<0)}function Oc(e,t){if(!e)throw new Error("No node provided");return Ui.call(e,Ri)===!1?!1:Ma(e,t)}function Ra(e,t){return t=t||new Po(e.ownerDocument||e),!(e.disabled||Gc(e)||t.isUntouchable(e))}var Nc=Ia.concat("iframe").join(",");function qc(e,t){if(!e)throw new Error("No node provided");return Ui.call(e,Nc)===!1?!1:Ra(e,t)}function Ua(e){var t=parseInt(e.getAttribute("tabindex"),10);return isNaN(t)?Vc(e)?0:e.tabIndex:t}function Wc(e,t){return e.tabIndex===t.tabIndex?e.documentOrder-t.documentOrder:e.tabIndex-t.tabIndex}function Hc(e,t){for(var n=0,o=e.length;n<o;n++)if(t(e[n]))return e[n]}function Vc(e){return e.contentEditable==="true"}function Da(e){return e.tagName==="INPUT"}function Gc(e){return Da(e)&&e.type==="hidden"}function zc(e){return Da(e)&&e.type==="radio"}function Xc(e){return zc(e)&&!Kc(e)}function Yc(e){for(var t=0;t<e.length;t++)if(e[t].checked)return e[t]}function Kc(e){if(!e.name)return!0;var t=e.ownerDocument.querySelectorAll('input[type="radio"][name="'+e.name+'"]'),n=Yc(t);return!n||n===e}function Po(e){this.doc=e,this.cache=[]}Po.prototype.hasDisplayNone=function(t,n){if(t.nodeType!==Node.ELEMENT_NODE)return!1;var o=Hc(this.cache,function(r){return r===t});if(o)return o[1];n=n||this.doc.defaultView.getComputedStyle(t);var i=!1;return n.display==="none"?i=!0:t.parentNode&&(i=this.hasDisplayNone(t.parentNode)),this.cache.push([t,i]),i};Po.prototype.isUntouchable=function(t){if(t===this.doc.documentElement)return!1;var n=this.doc.defaultView.getComputedStyle(t);return this.hasDisplayNone(t,n)?!0:n.visibility==="hidden"};ja.exports=Di});var Za=Yn((En,Yi)=>{(function(e,t){typeof En=="object"&&typeof Yi=="object"?Yi.exports=t():typeof define=="function"&&define.amd?define("Fuse",[],t):typeof En=="object"?En.Fuse=t():e.Fuse=t()})(En,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(o,i,r){n.o(o,i)||Object.defineProperty(o,i,{enumerable:!0,get:r})},n.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},n.t=function(o,i){if(1&i&&(o=n(o)),8&i||4&i&&typeof o=="object"&&o&&o.__esModule)return o;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:o}),2&i&&typeof o!="string")for(var a in o)n.d(r,a,function(c){return o[c]}.bind(null,a));return r},n.n=function(o){var i=o&&o.__esModule?function(){return o.default}:function(){return o};return n.d(i,"a",i),i},n.o=function(o,i){return Object.prototype.hasOwnProperty.call(o,i)},n.p="",n(n.s=0)}([function(e,t,n){function o(l){return(o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u})(l)}function i(l,u){for(var p=0;p<u.length;p++){var f=u[p];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(l,f.key,f)}}var r=n(1),a=n(7),c=a.get,d=(a.deepValue,a.isArray),s=function(){function l(g,m){var _=m.location,y=_===void 0?0:_,h=m.distance,k=h===void 0?100:h,v=m.threshold,F=v===void 0?.6:v,T=m.maxPatternLength,L=T===void 0?32:T,E=m.caseSensitive,I=E!==void 0&&E,M=m.tokenSeparator,j=M===void 0?/ +/g:M,Y=m.findAllMatches,Q=Y!==void 0&&Y,z=m.minMatchCharLength,ne=z===void 0?1:z,Z=m.id,de=Z===void 0?null:Z,re=m.keys,he=re===void 0?[]:re,ue=m.shouldSort,Pe=ue===void 0||ue,Fe=m.getFn,Be=Fe===void 0?c:Fe,pe=m.sortFn,ke=pe===void 0?function(U,D){return U.score-D.score}:pe,we=m.tokenize,me=we!==void 0&&we,Se=m.matchAllTokens,Ee=Se!==void 0&&Se,C=m.includeMatches,B=C!==void 0&&C,P=m.includeScore,R=P!==void 0&&P,S=m.verbose,A=S!==void 0&&S;(function(U,D){if(!(U instanceof D))throw new TypeError("Cannot call a class as a function")})(this,l),this.options={location:y,distance:k,threshold:F,maxPatternLength:L,isCaseSensitive:I,tokenSeparator:j,findAllMatches:Q,minMatchCharLength:ne,id:de,keys:he,includeMatches:B,includeScore:R,shouldSort:Pe,getFn:Be,sortFn:ke,verbose:A,tokenize:me,matchAllTokens:Ee},this.setCollection(g),this._processKeys(he)}var u,p,f;return u=l,(p=[{key:"setCollection",value:function(g){return this.list=g,g}},{key:"_processKeys",value:function(g){if(this._keyWeights={},this._keyNames=[],g.length&&typeof g[0]=="string")for(var m=0,_=g.length;m<_;m+=1){var y=g[m];this._keyWeights[y]=1,this._keyNames.push(y)}else{for(var h=null,k=null,v=0,F=0,T=g.length;F<T;F+=1){var L=g[F];if(!L.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var E=L.name;if(this._keyNames.push(E),!L.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var I=L.weight;if(I<0||I>1)throw new Error('"weight" property in key must bein the range of [0, 1)');k=k==null?I:Math.max(k,I),h=h==null?I:Math.min(h,I),this._keyWeights[E]=I,v+=I}if(v>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(g){var m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{limit:!1};this._log(`---------
Search pattern: "`.concat(g,'"'));var _=this._prepareSearchers(g),y=_.tokenSearchers,h=_.fullSearcher,k=this._search(y,h);return this._computeScore(k),this.options.shouldSort&&this._sort(k),m.limit&&typeof m.limit=="number"&&(k=k.slice(0,m.limit)),this._format(k)}},{key:"_prepareSearchers",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",m=[];if(this.options.tokenize)for(var _=g.split(this.options.tokenSeparator),y=0,h=_.length;y<h;y+=1)m.push(new r(_[y],this.options));return{tokenSearchers:m,fullSearcher:new r(g,this.options)}}},{key:"_search",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],m=arguments.length>1?arguments[1]:void 0,_=this.list,y={},h=[];if(typeof _[0]=="string"){for(var k=0,v=_.length;k<v;k+=1)this._analyze({key:"",value:_[k],record:k,index:k},{resultMap:y,results:h,tokenSearchers:g,fullSearcher:m});return h}for(var F=0,T=_.length;F<T;F+=1)for(var L=_[F],E=0,I=this._keyNames.length;E<I;E+=1){var M=this._keyNames[E];this._analyze({key:M,value:this.options.getFn(L,M),record:L,index:F},{resultMap:y,results:h,tokenSearchers:g,fullSearcher:m})}return h}},{key:"_analyze",value:function(g,m){var _=this,y=g.key,h=g.arrayIndex,k=h===void 0?-1:h,v=g.value,F=g.record,T=g.index,L=m.tokenSearchers,E=L===void 0?[]:L,I=m.fullSearcher,M=m.resultMap,j=M===void 0?{}:M,Y=m.results,Q=Y===void 0?[]:Y;(function z(ne,Z,de,re){if(Z!=null){if(typeof Z=="string"){var he=!1,ue=-1,Pe=0;_._log(`
Key: `.concat(y===""?"--":y));var Fe=I.search(Z);if(_._log('Full text: "'.concat(Z,'", score: ').concat(Fe.score)),_.options.tokenize){for(var Be=Z.split(_.options.tokenSeparator),pe=Be.length,ke=[],we=0,me=E.length;we<me;we+=1){var Se=E[we];_._log(`
Pattern: "`.concat(Se.pattern,'"'));for(var Ee=!1,C=0;C<pe;C+=1){var B=Be[C],P=Se.search(B),R={};P.isMatch?(R[B]=P.score,he=!0,Ee=!0,ke.push(P.score)):(R[B]=1,_.options.matchAllTokens||ke.push(1)),_._log('Token: "'.concat(B,'", score: ').concat(R[B]))}Ee&&(Pe+=1)}ue=ke[0];for(var S=ke.length,A=1;A<S;A+=1)ue+=ke[A];ue/=S,_._log("Token score average:",ue)}var U=Fe.score;ue>-1&&(U=(U+ue)/2),_._log("Score average:",U);var D=!_.options.tokenize||!_.options.matchAllTokens||Pe>=E.length;if(_._log(`
Check Matches: `.concat(D)),(he||Fe.isMatch)&&D){var oe={key:y,arrayIndex:ne,value:Z,score:U};_.options.includeMatches&&(oe.matchedIndices=Fe.matchedIndices);var le=j[re];le?le.output.push(oe):(j[re]={item:de,output:[oe]},Q.push(j[re]))}}else if(d(Z))for(var W=0,K=Z.length;W<K;W+=1)z(W,Z[W],de,re)}})(k,v,F,T)}},{key:"_computeScore",value:function(g){this._log(`

Computing score:
`);for(var m=this._keyWeights,_=!!Object.keys(m).length,y=0,h=g.length;y<h;y+=1){for(var k=g[y],v=k.output,F=v.length,T=1,L=0;L<F;L+=1){var E=v[L],I=E.key,M=_?m[I]:1,j=E.score===0&&m&&m[I]>0?Number.EPSILON:E.score;T*=Math.pow(j,M)}k.score=T,this._log(k)}}},{key:"_sort",value:function(g){this._log(`

Sorting....`),g.sort(this.options.sortFn)}},{key:"_format",value:function(g){var m=[];if(this.options.verbose){var _=[];this._log(`

Output:

`,JSON.stringify(g,function(E,I){if(o(I)==="object"&&I!==null){if(_.indexOf(I)!==-1)return;_.push(I)}return I},2)),_=null}var y=[];this.options.includeMatches&&y.push(function(E,I){var M=E.output;I.matches=[];for(var j=0,Y=M.length;j<Y;j+=1){var Q=M[j];if(Q.matchedIndices.length!==0){var z={indices:Q.matchedIndices,value:Q.value};Q.key&&(z.key=Q.key),Q.hasOwnProperty("arrayIndex")&&Q.arrayIndex>-1&&(z.arrayIndex=Q.arrayIndex),I.matches.push(z)}}}),this.options.includeScore&&y.push(function(E,I){I.score=E.score});for(var h=0,k=g.length;h<k;h+=1){var v=g[h];if(this.options.id&&(v.item=this.options.getFn(v.item,this.options.id)[0]),y.length){for(var F={item:v.item},T=0,L=y.length;T<L;T+=1)y[T](v,F);m.push(F)}else m.push(v.item)}return m}},{key:"_log",value:function(){var g;this.options.verbose&&(g=console).log.apply(g,arguments)}}])&&i(u.prototype,p),f&&i(u,f),l}();e.exports=s},function(e,t,n){function o(d,s){for(var l=0;l<s.length;l++){var u=s[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(d,u.key,u)}}var i=n(2),r=n(3),a=n(6),c=function(){function d(p,f){var g=f.location,m=g===void 0?0:g,_=f.distance,y=_===void 0?100:_,h=f.threshold,k=h===void 0?.6:h,v=f.maxPatternLength,F=v===void 0?32:v,T=f.isCaseSensitive,L=T!==void 0&&T,E=f.tokenSeparator,I=E===void 0?/ +/g:E,M=f.findAllMatches,j=M!==void 0&&M,Y=f.minMatchCharLength,Q=Y===void 0?1:Y,z=f.includeMatches,ne=z!==void 0&&z;(function(Z,de){if(!(Z instanceof de))throw new TypeError("Cannot call a class as a function")})(this,d),this.options={location:m,distance:y,threshold:k,maxPatternLength:F,isCaseSensitive:L,tokenSeparator:I,findAllMatches:j,includeMatches:ne,minMatchCharLength:Q},this.pattern=L?p:p.toLowerCase(),this.pattern.length<=F&&(this.patternAlphabet=a(this.pattern))}var s,l,u;return s=d,(l=[{key:"search",value:function(p){var f=this.options,g=f.isCaseSensitive,m=f.includeMatches;if(g||(p=p.toLowerCase()),this.pattern===p){var _={isMatch:!0,score:0};return m&&(_.matchedIndices=[[0,p.length-1]]),_}var y=this.options,h=y.maxPatternLength,k=y.tokenSeparator;if(this.pattern.length>h)return i(p,this.pattern,k);var v=this.options,F=v.location,T=v.distance,L=v.threshold,E=v.findAllMatches,I=v.minMatchCharLength;return r(p,this.pattern,this.patternAlphabet,{location:F,distance:T,threshold:L,findAllMatches:E,minMatchCharLength:I,includeMatches:m})}}])&&o(s.prototype,l),u&&o(s,u),d}();e.exports=c},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(o,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:/ +/g,a=new RegExp(i.replace(n,"\\$&").replace(r,"|")),c=o.match(a),d=!!c,s=[];if(d)for(var l=0,u=c.length;l<u;l+=1){var p=c[l];s.push([o.indexOf(p),p.length-1])}return{score:d?.5:1,isMatch:d,matchedIndices:s}}},function(e,t,n){var o=n(4),i=n(5);e.exports=function(r,a,c,d){for(var s=d.location,l=s===void 0?0:s,u=d.distance,p=u===void 0?100:u,f=d.threshold,g=f===void 0?.6:f,m=d.findAllMatches,_=m!==void 0&&m,y=d.minMatchCharLength,h=y===void 0?1:y,k=d.includeMatches,v=k!==void 0&&k,F=l,T=r.length,L=g,E=r.indexOf(a,F),I=a.length,M=[],j=0;j<T;j+=1)M[j]=0;if(E!==-1){var Y=o(a,{errors:0,currentLocation:E,expectedLocation:F,distance:p});if(L=Math.min(Y,L),(E=r.lastIndexOf(a,F+I))!==-1){var Q=o(a,{errors:0,currentLocation:E,expectedLocation:F,distance:p});L=Math.min(Q,L)}}E=-1;for(var z=[],ne=1,Z=I+T,de=1<<(I<=31?I-1:30),re=0;re<I;re+=1){for(var he=0,ue=Z;he<ue;)o(a,{errors:re,currentLocation:F+ue,expectedLocation:F,distance:p})<=L?he=ue:Z=ue,ue=Math.floor((Z-he)/2+he);Z=ue;var Pe=Math.max(1,F-ue+1),Fe=_?T:Math.min(F+ue,T)+I,Be=Array(Fe+2);Be[Fe+1]=(1<<re)-1;for(var pe=Fe;pe>=Pe;pe-=1){var ke=pe-1,we=c[r.charAt(ke)];if(we&&(M[ke]=1),Be[pe]=(Be[pe+1]<<1|1)&we,re!==0&&(Be[pe]|=(z[pe+1]|z[pe])<<1|1|z[pe+1]),Be[pe]&de&&(ne=o(a,{errors:re,currentLocation:ke,expectedLocation:F,distance:p}))<=L){if(L=ne,(E=ke)<=F)break;Pe=Math.max(1,2*F-E)}}if(o(a,{errors:re+1,currentLocation:F,expectedLocation:F,distance:p})>L)break;z=Be}var me={isMatch:E>=0,score:ne===0?.001:ne};return v&&(me.matchedIndices=i(M,h)),me}},function(e,t){e.exports=function(n,o){var i=o.errors,r=i===void 0?0:i,a=o.currentLocation,c=a===void 0?0:a,d=o.expectedLocation,s=d===void 0?0:d,l=o.distance,u=l===void 0?100:l,p=r/n.length,f=Math.abs(s-c);return u?p+f/u:f?1:p}},function(e,t){e.exports=function(){for(var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=[],r=-1,a=-1,c=0,d=n.length;c<d;c+=1){var s=n[c];s&&r===-1?r=c:s||r===-1||((a=c-1)-r+1>=o&&i.push([r,a]),r=-1)}return n[c-1]&&c-r>=o&&i.push([r,c-1]),i}},function(e,t){e.exports=function(n){for(var o={},i=n.length,r=0;r<i;r+=1)o[n.charAt(r)]=0;for(var a=0;a<i;a+=1)o[n.charAt(a)]|=1<<i-a-1;return o}},function(e,t){var n=function(a){return Array.isArray?Array.isArray(a):Object.prototype.toString.call(a)==="[object Array]"},o=function(a){return a==null?"":function(c){if(typeof c=="string")return c;var d=c+"";return d=="0"&&1/c==-1/0?"-0":d}(a)},i=function(a){return typeof a=="string"},r=function(a){return typeof a=="number"};e.exports={get:function(a,c){var d=[];return function s(l,u){if(u){var p=u.indexOf("."),f=u,g=null;p!==-1&&(f=u.slice(0,p),g=u.slice(p+1));var m=l[f];if(m!=null)if(g||!i(m)&&!r(m))if(n(m))for(var _=0,y=m.length;_<y;_+=1)s(m[_],g);else g&&s(m,g);else d.push(o(m))}else d.push(l)}(a,c),d},isArray:n,isString:i,isNum:r,toString:o}}])})});var os=Yn((xn,Io)=>{(function(e,t){"use strict";var n="1.0.2",o="",i="?",r="function",a="undefined",c="object",d="string",s="major",l="model",u="name",p="type",f="vendor",g="version",m="architecture",_="console",y="mobile",h="tablet",k="smarttv",v="wearable",F="embedded",T=255,L="Amazon",E="Apple",I="ASUS",M="BlackBerry",j="Browser",Y="Chrome",Q="Edge",z="Firefox",ne="Google",Z="Huawei",de="LG",re="Microsoft",he="Motorola",ue="Opera",Pe="Samsung",Fe="Sony",Be="Xiaomi",pe="Zebra",ke="Facebook",we=function(W,K){var X={};for(var ce in W)K[ce]&&K[ce].length%2==0?X[ce]=K[ce].concat(W[ce]):X[ce]=W[ce];return X},me=function(W){for(var K={},X=0;X<W.length;X++)K[W[X].toUpperCase()]=W[X];return K},Se=function(W,K){return typeof W===d?Ee(K).indexOf(Ee(W))!==-1:!1},Ee=function(W){return W.toLowerCase()},C=function(W){return typeof W===d?W.replace(/[^\d\.]/g,o).split(".")[0]:t},B=function(W,K){if(typeof W===d)return W=W.replace(/^\s\s*/,o).replace(/\s\s*$/,o),typeof K===a?W:W.substring(0,T)},P=function(W,K){for(var X=0,ce,V,Ie,ae,$,O;X<K.length&&!$;){var H=K[X],se=K[X+1];for(ce=V=0;ce<H.length&&!$;)if($=H[ce++].exec(W),$)for(Ie=0;Ie<se.length;Ie++)O=$[++V],ae=se[Ie],typeof ae===c&&ae.length>0?ae.length===2?typeof ae[1]==r?this[ae[0]]=ae[1].call(this,O):this[ae[0]]=ae[1]:ae.length===3?typeof ae[1]===r&&!(ae[1].exec&&ae[1].test)?this[ae[0]]=O?ae[1].call(this,O,ae[2]):t:this[ae[0]]=O?O.replace(ae[1],ae[2]):t:ae.length===4&&(this[ae[0]]=O?ae[3].call(this,O.replace(ae[1],ae[2])):t):this[ae]=O||t;X+=2}},R=function(W,K){for(var X in K)if(typeof K[X]===c&&K[X].length>0){for(var ce=0;ce<K[X].length;ce++)if(Se(K[X][ce],W))return X===i?t:X}else if(Se(K[X],W))return X===i?t:X;return W},S={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},A={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0","2000":"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0","7":"NT 6.1","8":"NT 6.2","8.1":"NT 6.3","10":["NT 6.4","NT 10.0"],RT:"ARM"},U={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[g,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[g,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,g],[/opios[\/ ]+([\w\.]+)/i],[g,[u,ue+" Mini"]],[/\bopr\/([\w\.]+)/i],[g,[u,ue]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,g],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[g,[u,"UC"+j]],[/\bqbcore\/([\w\.]+)/i],[g,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[g,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[g,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[g,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[g,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+j],g],[/\bfocus\/([\w\.]+)/i],[g,[u,z+" Focus"]],[/\bopt\/([\w\.]+)/i],[g,[u,ue+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[g,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[g,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[g,[u,ue+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[g,[u,"MIUI "+j]],[/fxios\/([-\w\.]+)/i],[g,[u,z]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 "+j]],[/(oculus|samsung|sailfish)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 "+j],g],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],g],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,g],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,ke],g],[/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,g],[/\bgsa\/([\w\.]+) .*safari\//i],[g,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[g,[u,Y+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,Y+" WebView"],g],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[g,[u,"Android "+j]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,g],[/version\/([\w\.]+) .*mobile\/\w+ (safari)/i],[g,[u,"Mobile Safari"]],[/version\/([\w\.]+) .*(mobile ?safari|safari)/i],[g,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[g,R,S]],[/(webkit|khtml)\/([\w\.]+)/i],[u,g],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],g],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[g,[u,z+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[u,g]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,Ee]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,o,Ee]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,Ee]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[pt]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[f,Pe],[p,h]],[/\b((?:s[cgp]h|gt|sm)-\w+|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[f,Pe],[p,y]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[f,E],[p,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[f,E],[p,h]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[f,Z],[p,h]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}-[atu]?[ln][01259x][012359][an]?)\b(?!.+d\/s)/i],[l,[f,Z],[p,y]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[f,Be],[p,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[f,Be],[p,h]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[f,"OPPO"],[p,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[f,"Vivo"],[p,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[f,"Realme"],[p,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[f,he],[p,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[f,he],[p,h]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[f,de],[p,h]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[f,de],[p,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[f,"Lenovo"],[p,h]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[f,"Nokia"],[p,y]],[/(pixel c)\b/i],[l,[f,ne],[p,h]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[f,ne],[p,y]],[/droid.+ ([c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[f,Fe],[p,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[f,Fe],[p,h]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[f,"OnePlus"],[p,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[f,L],[p,h]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[f,L],[p,y]],[/(playbook);[-\w\),; ]+(rim)/i],[l,f,[p,h]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[f,M],[p,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[f,I],[p,h]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[f,I],[p,y]],[/(nexus 9)/i],[l,[f,"HTC"],[p,h]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic|sony)[-_ ]?([-\w]*)/i],[f,[l,/_/g," "],[p,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[f,"Acer"],[p,h]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[f,"Meizu"],[p,y]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[f,"Sharp"],[p,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,l,[p,y]],[/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,l,[p,h]],[/(surface duo)/i],[l,[f,re],[p,h]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[f,"Fairphone"],[p,y]],[/(u304aa)/i],[l,[f,"AT&T"],[p,y]],[/\bsie-(\w*)/i],[l,[f,"Siemens"],[p,y]],[/\b(rct\w+) b/i],[l,[f,"RCA"],[p,h]],[/\b(venue[\d ]{2,7}) b/i],[l,[f,"Dell"],[p,h]],[/\b(q(?:mv|ta)\w+) b/i],[l,[f,"Verizon"],[p,h]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[f,"Barnes & Noble"],[p,h]],[/\b(tm\d{3}\w+) b/i],[l,[f,"NuVision"],[p,h]],[/\b(k88) b/i],[l,[f,"ZTE"],[p,h]],[/\b(nx\d{3}j) b/i],[l,[f,"ZTE"],[p,y]],[/\b(gen\d{3}) b.+49h/i],[l,[f,"Swiss"],[p,y]],[/\b(zur\d{3}) b/i],[l,[f,"Swiss"],[p,h]],[/\b((zeki)?tb.*\b) b/i],[l,[f,"Zeki"],[p,h]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],l,[p,h]],[/\b(ns-?\w{0,9}) b/i],[l,[f,"Insignia"],[p,h]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[f,"NextBook"],[p,h]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],l,[p,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],l,[p,y]],[/\b(ph-1) /i],[l,[f,"Essential"],[p,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[f,"Envizen"],[p,h]],[/\b(trio[-\w\. ]+) b/i],[l,[f,"MachSpeed"],[p,h]],[/\btu_(1491) b/i],[l,[f,"Rotor"],[p,h]],[/(shield[\w ]+) b/i],[l,[f,"Nvidia"],[p,h]],[/(sprint) (\w+)/i],[f,l,[p,y]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[f,re],[p,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[f,pe],[p,h]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[f,pe],[p,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,l,[p,_]],[/droid.+; (shield) bui/i],[l,[f,"Nvidia"],[p,_]],[/(playstation [345portablevi]+)/i],[l,[f,Fe],[p,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[f,re],[p,_]],[/smart-tv.+(samsung)/i],[f,[p,k]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[f,Pe],[p,k]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,de],[p,k]],[/(apple) ?tv/i],[f,[l,E+" TV"],[p,k]],[/crkey/i],[[l,Y+"cast"],[f,ne],[p,k]],[/droid.+aft(\w)( bui|\))/i],[l,[f,L],[p,k]],[/\(dtv[\);].+(aquos)/i],[l,[f,"Sharp"],[p,k]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w ]*; *(\w[^;]*);([^;]*)/i],[[f,B],[l,B],[p,k]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,k]],[/((pebble))app/i],[f,l,[p,v]],[/droid.+; (glass) \d/i],[l,[f,ne],[p,v]],[/droid.+; (wt63?0{2,3})\)/i],[l,[f,pe],[p,v]],[/(quest( 2)?)/i],[l,[f,ke],[p,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[p,F]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[p,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[p,h]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,h]],[/(phone|mobile(?:[;\/]| safari)|pda(?=.+windows ce))/i],[[p,y]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[g,[u,Q+"HTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[g,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,g],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[g,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,g],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[g,R,A]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[g,R,A]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[g,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"],[g,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86)/i],[g,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,g],[/\(bb(10);/i],[g,[u,M]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[g,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[g,[u,z+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[g,[u,"webOS"]],[/crkey\/([\d\.]+)/i],[g,[u,Y+"cast"]],[/(cros) [\w]+ ([\w\.]+\w)/i],[[u,"Chromium OS"],g],[/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,g],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],g],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,g]]},D=function(W,K){if(typeof W===c&&(K=W,W=t),!(this instanceof D))return new D(W,K).getResult();var X=W||(typeof e!==a&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:o),ce=K?we(U,K):U;return this.getBrowser=function(){var V={};return V[u]=t,V[g]=t,P.call(V,X,ce.browser),V.major=C(V.version),V},this.getCPU=function(){var V={};return V[m]=t,P.call(V,X,ce.cpu),V},this.getDevice=function(){var V={};return V[f]=t,V[l]=t,V[p]=t,P.call(V,X,ce.device),V},this.getEngine=function(){var V={};return V[u]=t,V[g]=t,P.call(V,X,ce.engine),V},this.getOS=function(){var V={};return V[u]=t,V[g]=t,P.call(V,X,ce.os),V},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return X},this.setUA=function(V){return X=typeof V===d&&V.length>T?B(V,T):V,this},this.setUA(X),this};D.VERSION=n,D.BROWSER=me([u,g,s]),D.CPU=me([m]),D.DEVICE=me([l,f,p,_,y,k,h,v,F]),D.ENGINE=D.OS=me([u,g]),typeof xn!==a?(typeof Io!==a&&Io.exports&&(xn=Io.exports=D),xn.UAParser=D):typeof define===r&&define.amd?define(function(){return D}):typeof e!==a&&(e.UAParser=D);var oe=typeof e!==a&&(e.jQuery||e.Zepto);if(oe&&!oe.ua){var le=new D;oe.ua=le.getResult(),oe.ua.get=function(){return le.getUA()},oe.ua.set=function(W){le.setUA(W);var K=le.getResult();for(var X in K)oe.ua[X]=K[X]}}})(typeof window=="object"?window:xn)});window.BeFunky=window.BeFunky||{};BeFunky.editorExternalImage=null;BeFunky.projectToOpenInSection={editor:void 0,collage:void 0,designer:void 0};BeFunky.appContainer=document.getElementById("bfn-app");BeFunky.appContentInjected=Boolean(BeFunky.appContainer.firstElementChild);setTimeout(()=>{if(BeFunky.isCreateRoute()&&window.$googleDriveState==null){let e=document.getElementById("chrome-extension-button");if(!e)return;e.addEventListener("click",()=>{let t=document.getElementById("chrome-extension-button").getAttribute("data-url");t!=null&&t.length>0&&(window.bf_eventTrack("EXTERNAL","CHROME_EXTENSION","OPEN"),setTimeout(()=>{try{try{window.setApplicationMode("photoeditor")}catch{}if(t.includes("http"))try{BFN.BfnService.ToJsUrlUploader(t,null,"chrome_extension")}catch{}else{t=t.split(",")[1];try{BFN.BfnService.ToJsBase64Uploader(t,void 0,"chrome_extension")}catch{}}}catch{}},1500))})}},0);BeFunky.signOut=e=>{try{window.bfn_mp.logout()}catch{}if(BeFunky.clearSignInModals(),BeFunky.isAppleAppStoreApp){BeFunky.showLoadScreen(),window.execNative({type:"sign-out",req_params:{redirectURL:e}});return}e=e||n(),BeFunky.callSignOutAPI().then(()=>{t(e)}).catch(o=>{o!=="request_failed"&&BeFunky.throwError("Sign-out failed:",o),t(`${BeFunky.Params.siteUrl}sign-out/?next=${encodeURIComponent(e)}`)});function t(o){BeFunky.removeLocal("latest_user_email"),window.onbeforeunload=null,window.location.href=o}function n(){if(BeFunky.isInstalled())return BeFunky.getDashboardUrlInLanguage();let o=BeFunky.LanguageManager.language[window.isAppOpen?"app":"site"],i=o!=="en"&&BeFunky.LanguageManager.siteLanguages.includes(o)?`${o}/`:"";return`${BeFunky.Params.siteUrl}${i}`}};BeFunky.callSignOutAPI=function(){return BeFunky.requestAPI("auth/sign-out",{},{showLoadScreen:!0}).then(e=>{if(e.data!=="success")throw"invalid_response"}).catch(e=>{if(e!=="not_logged_in")throw e})};BeFunky.updateLanguage=function(e){return BeFunky.requestAPI("auth/update-language",{lang:e}).then(t=>{if(t.data!=="success")throw"invalid_response"}).catch(t=>{BeFunky.logError("Unable to change language",t)})};Object.assign(BeFunky.Params,{nextBillingDateMonthly:Or($l()),nextBillingDateAnnual:Or(Il())});function $l(){let e=new Date;return e.setMonth(e.getMonth()+1),e}function Il(){let e=new Date;return e.setFullYear(e.getFullYear()+1),e}function Or(e){let t=`${e.getMonth()+1}`,n=`${e.getDate()}`,o=e.getFullYear();return t.length<2&&(t=`0${t}`),n.length<2&&(n=`0${n}`),[t,n,o].join("")}BeFunky.getDefaultUser=()=>({email:"",username:"",language:"",isNewUser:!1,pl:""});BeFunky.User=BeFunky.getDefaultUser();var ti=!1,Nr=!0;BeFunky.log=(...e)=>{ti&&console.log(...e)};BeFunky.logWarning=(...e)=>{(ti||Nr)&&console.warn(...e)};BeFunky.logError=(...e)=>{(ti||Nr)&&console.error(...e)};BeFunky.throwError=(e,...t)=>{if(!(e instanceof Error||window.DOMError&&e instanceof DOMError))try{e=new Error(e)}catch{e=new Error(`Unknown error ${typeof e}`)}BeFunky.isAppleAppStoreApp?Sentry.addBreadcrumb({category:"error",message:`Sending ${e.name} to Sentry: ${e.message}`,data:t,level:"error"}):BeFunky.logError(`Sending ${e.name} to Sentry:`,e.message,...t),BeFunky.Params.IS_LC?setTimeout(()=>{throw e},0):Sentry.captureException(e)};BeFunky.reportWarning=(e,...t)=>{console.warn(e,...t),BeFunky.isAppleAppStoreApp&&t.length&&Sentry.addBreadcrumb({category:"warning",message:e,data:t,level:"warning"}),Sentry.withScope(n=>{n.setLevel("warning"),Sentry.captureException(new Error(e))})};BeFunky.reportUserAction=e=>{console.log("User action:",e)};BeFunky.loggingFlags=(getCookie("logging_flags")||"").split(",").map(e=>e.trim()).filter(Boolean);var qr={_default:"mediumslateblue",autosave:"darkturquoise",editor_image:"turquoise",canvas_interaction:"burlywood",app_action:"darkslateblue",selection_interaction:"darkturquoise",app_history:"darkorchid",paint_history:"darkred"};BeFunky.logFeature=(e,...t)=>{if(!BeFunky.loggingFlags.includes(e))return;let o=`color: white; background: ${qr[e]||qr._default}; border-radius: 3px; padding: 2px 4px`;console.log(`%c${e}`,o,...t)};BeFunky.isTextBoxFocused=()=>{let e=document.activeElement;return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&["text","number","search","email","password","tel","url","time","date","datetime-local","month","week"].includes(e.type)};BeFunky.debounce=(e,t,n=!1)=>{let o;return function(){let i=this,r=arguments,a=n&&!o,c=function(){o=null,a||e.apply(i,r)};t==="raf"?(cancelAnimationFrame(o),o=requestAnimationFrame(c)):t==="ric"?(cancelIdleCallback(o),o=requestIdleCallback(c)):(clearTimeout(o),o=setTimeout(c,t)),a&&e.apply(i,r)}};BeFunky.throttle=(e,t)=>{let n,o,i;return function(){let r=this,a=arguments;n?(clearTimeout(o),o=setTimeout(()=>{Date.now()-i>=t&&(e.apply(r,a),i=Date.now())},t-(Date.now()-i))):(e.apply(r,a),i=Date.now(),n=!0)}};BeFunky.throttleRAF=e=>{let t=!1;return function(...n){let o=this;t||(t=!0,requestAnimationFrame(()=>{e.apply(o,n),t=!1}))}};BeFunky.randomString=e=>{let t="",n="abcdefghijklmnopqrstuvwxyz0123456789",o=n.length;for(let i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*o));return t};BeFunky.hash=e=>{let t=0,n=0,o=e.length;for(;n<o;)t=(t<<5)-t+e.charCodeAt(n++)<<0;return t+2147483647+1};BeFunky.getType=function(e){let t=Object.prototype.toString.call(e).slice(8,-1);return t!=="Object"?t:e&&e.constructor&&e.constructor.name?e.constructor.name:"Object"};BeFunky.waitUntil=function({condition:e,onSuccess:t,onTimeout:n,interval:o=200,maxAttempts:i=10}){if(![e,t,n].every(d=>typeof d=="function"))throw new Error("3 functions must be provided to BeFunky.waitUntil");let a=0;c();function c(){if(e())return t();if(a>=i)return n();a++,setTimeout(c,o)}};BeFunky.getSvgHtml=function(e,{classes:t="icon",style:n}={}){if(typeof t!="string")throw new Error(`Invalid SVG class: ${BeFunky.getType(t)}`);return`
    <svg class="${t}" ${n?`style="${n}"`:""}>
        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#${e}"></use>
    </svg>
    `.trim()};BeFunky.once=function(e,t){let n;return function(){return e&&(n=e.apply(t||this,arguments),e=null),n}};BeFunky.isLoggedIn=()=>!!window.latestUserData.email;BeFunky.isPlus=()=>window.latestUserData.pl==="1";BeFunky.isStripeUser=()=>window.latestUserData.is_strp===1;BeFunky.callbackTimeout=function(e,t=3e3){let n=!1,o=!1,i=Date.now(),r=()=>{n||(n=!0,o&&console.log(`Callback for ${e} was eventually called after ${Date.now()-i}ms`))};return setTimeout(()=>{n||(o=!0,BeFunky.throwError(`Callback for ${e} still not called after ${t}ms`))},t),r};BeFunky.stringValue=function(e){let t=BeFunky.getType(e),n=e;if(e instanceof Error||window.DOMError&&e instanceof DOMError)t=e.name||t,n=e.message;else if(e instanceof Blob)n=`{ size: ${BeFunky.formatBytes(e.size)}, type: ${e.type} }`;else if(e instanceof Event)n=`{ type: ${e.type}, target: ${e.target}, currentTarget: ${e.currentTarget} }`;else if(typeof e=="object")try{n=JSON.stringify(e)}catch{}else typeof n=="string"?n=`"${n}"`:n=`${n}`;return n.length>100&&(n=`${n.slice(0,100)}...`),`${t}: ${n}`};var ni=[],Ml=BeFunky.debounce(()=>{requestIdleCallback(()=>{BeFunky.waitUntil({condition:()=>window.ga,onSuccess:()=>{console.log(`Sending ${ni.length} user timing(s)`),ni.splice(0).forEach(e=>window.ga("send","timing",...e))},onTimeout:()=>{},interval:500,maxAttempts:20})})},2e3);BeFunky.trackUserTiming=function(e,t,n){let o=Date.now(),i=!1;return(r=Date.now()-o)=>{i||(i=!0,!(r<=1)&&(!BeFunky.Params.enableUserTimings||e==="Background Removal"&&(console.log(`-- ${e} timing : ${t} ${n} : ${r}`),ni.push([e,t,r,n]),Ml())))}};BeFunky.setLocal=function(e,t){try{return localStorage.setItem(e,t),!0}catch{return!1}};BeFunky.getLocal=function(e){try{return localStorage.getItem(e)}catch{return}};BeFunky.removeLocal=function(e){try{return localStorage.removeItem(e),!0}catch{return!1}};BeFunky.setLocalSession=function(e,t){try{return sessionStorage.setItem(e,t),!0}catch{return!1}};BeFunky.getLocalSession=function(e){try{return sessionStorage.getItem(e)}catch{return}};BeFunky.getUrlParameter=function(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");let n=new RegExp(`[\\?&]${e}=([^&#]*)`).exec(window.location.search);return n===null?"":decodeURIComponent(n[1].replace(/\+/g," "))};BeFunky.isCreateRoute=(e=window.location.href)=>["create","es/crear","pt/criar","de/erstellen","fr/creer"].some(n=>e.startsWith(`/${n}`)||e.startsWith(`${BeFunky.Params.siteUrl}${n}`));BeFunky.isDashboard=(e=window.location.href)=>{let{siteUrl:t,pwaStartUrl:n}=BeFunky.Params,o=e.replace(t,"/"),i=n.replace(t,"/");return new RegExp(`^/(${BeFunky.LanguageManager.siteLanguages.join("|")})/`).test(o)&&(o=o.slice(3)),o.startsWith(i)};BeFunky.getDashboardUrlInLanguage=(e=BeFunky.LanguageManager.language.site)=>{BeFunky.LanguageManager.siteLanguages.includes(e)||(e="en");let{siteUrl:t,pwaStartUrl:n}=BeFunky.Params;if(e==="en")return n;let o=n.replace(t,"/");return`${t}${e}${o}`};BeFunky.shouldOpenInNewTabNotPWA=e=>BeFunky.isAppleAppStoreApp?!0:BeFunky.isIOS?!e.startsWith(BeFunky.Params.siteUrl):!(e.startsWith(BeFunky.Params.siteUrl)&&/\/my-account|\/myphotos/.test(e)||BeFunky.isDashboard(e)||BeFunky.isCreateRoute(e));var Rl=(e,t,n)=>{if(!t||t.length!==3)throw"Invalid linkHTML translation";e==="SUPPORT"&&(e="https://support.befunky.com/hc/en-us/requests/new"),typeof n!="boolean"&&(n=BeFunky.isInstalled()&&BeFunky.shouldOpenInNewTabNotPWA(e));let[o,i,r]=t,a=Object.keys(i).length?BeFunky.LanguageManager.getString(o,r):BeFunky.LanguageManager.getStringReplacements(o,i,r);return`<a href="${e}" ${n?'target="_blank" rel="noopener"':""}>${a}</a>`};BeFunky.toLinkHTML=(e,t)=>(n,o)=>Rl(e,[n,{},o],t);BeFunky.formatBytes=(e,t=1)=>{if(!e)return"0 Bytes";let n=e/1024,o=n/1024,i=o/1024;return i>1?`${i.toFixed(1)} GB`:o>1?`${o.toFixed(1)} MB`:`${n.toFixed(t)} KB`};BeFunky.usingServiceWorker=()=>Boolean(navigator.serviceWorker&&navigator.serviceWorker.controller);BeFunky.addToServiceWorkerCache=(e,t,n=!0)=>{if(BeFunky.usingServiceWorker())return o();n&&BeFunky.waitUntil({condition:()=>BeFunky.usingServiceWorker(),onTimeout:()=>{},onSuccess:o,maxAttempts:10,interval:1e3});function o(){navigator.serviceWorker.controller.postMessage({type:"ADD_TO_CACHE",cacheName:e,url:t})}};BeFunky.addPassiveListener=(e,t,n)=>{e.addEventListener(t,n,{passive:!0})};BeFunky.removePassiveListener=(e,t,n)=>{e.removeEventListener(t,n,{passive:!0})};BeFunky.isRetina=function(){let e=`
        (-webkit-min-device-pixel-ratio: 1.5),
        (min--moz-device-pixel-ratio: 1.5),
        (-o-min-device-pixel-ratio: 3/2),
        (min-resolution: 1.5dppx)`;if(window.devicePixelRatio>=1.5||window.matchMedia&&window.matchMedia(e).matches){if("chrome"in window){let t=window.outerWidth,n=window.innerWidth,o=t/n;if(o>1.02)return window.devicePixelRatio/o>=1.5}return!0}return!1};BeFunky.setupInfiniteScroll=function(e,{threshold:t=800}={}){let n,o,i;return{listenForScroll:a,recalculateScrollPosition:r};function r(){o=void 0,typeof i=="function"&&i()}function a(c,d){n||(n=e());let s=BeFunky.randomString(5);i&&BeFunky.removePassiveListener(n,"scroll",i),i=BeFunky.throttle(()=>{if(s!==i.id)return;if(c()){BeFunky.removePassiveListener(n,"scroll",i);return}o||(o={scrollHeight:n.scrollHeight,offsetHeight:n.offsetHeight});let{scrollHeight:l,offsetHeight:u}=o,{scrollTop:p}=n,f=l-u-p;if(!l&&!u){o=void 0;return}f<=t&&(BeFunky.removePassiveListener(n,"scroll",i),d())},50),i.id=s,o=void 0,requestAnimationFrame(()=>{c()||(BeFunky.addPassiveListener(n,"scroll",i),i())})}};BeFunky.handleLitGalleryScroll=()=>{let e,t,n;function o(c){t=c?c.target:t,e||(e={scrollHeight:t.scrollHeight,offsetHeight:t.offsetHeight});let{scrollHeight:d,offsetHeight:s}=e,{scrollTop:l}=t;if(!d&&!s){e=void 0;return}n&&n({scrollHeight:d,offsetHeight:s,scrollTop:l})}function i(){e=void 0,t&&o()}function r(c){t&&(t.scrollTop=c)}function a(){return t?t.scrollTop:0}return{handleScroll:{handleEvent:BeFunky.throttle(o,16),passive:!0},recalculateScrollPosition:i,setOnScrollCallback:c=>{n=c},scrollTo:r,getScrollTop:a}};BeFunky.addParamsToURL=(e,t,n=!0)=>{let o=e.split("?")[0].split("#")[0],i=Object.entries(t),r=i.length?`?${i.map(([a,c])=>`${a}=${n?encodeURIComponent(c):c}`).join("&")}`:"";return`${o}${r}`};BeFunky.escapeHTML=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");BeFunky.randomIntForUser=()=>{let e=parseInt(BeFunky.getLocal("random-1-100"));return Number.isNaN(e)&&(e=t(1,100),BeFunky.setLocal("random-1-100",e.toString())),e;function t(n,o){return Math.floor(Math.random()*(o-n+1)+n)}};BeFunky.setSentryTag=(e,t)=>{Sentry.configureScope(n=>{n.setTag(e,t)})};BeFunky.wait=(e,t)=>{let n=e.findIndex(a=>!(["raf","ric"].includes(a)||typeof a=="number"));if(n!==-1)throw new Error(`Invalid timer in timerQueue: ${BeFunky.stringValue(e[n])}`);let o=()=>{};return i(0),()=>o();function i(a){if(a>=e.length)return t();let c=e[a];["raf","ric"].includes(c)?o=r()[c](()=>i(++a)):o=r().timeout(()=>i(++a),c)}function r(){return{raf:a=>{let c=requestAnimationFrame(a);return()=>cancelAnimationFrame(c)},ric:a=>{let c=requestIdleCallback(a);return()=>cancelIdleCallback(c)},timeout:(a,c)=>{let d=setTimeout(a,c);return()=>clearTimeout(d)}}}};BeFunky.withLoadScreen=function(e,t=!0,n={}){return new Promise((o,i)=>{let r=!1;return BeFunky.showLoadScreen(Ve({onCancel:t?()=>{r=!0,i("cancelled_by_user")}:void 0},n)),e.then(a=>{r||BeFunky.hideLoadScreen(),o(a)},a=>{r||BeFunky.hideLoadScreen(),i(a)})})};BeFunky.onMatchMedia=function(e,t,n=!1){let o=window.matchMedia(e),i={isMatched:o.matches,removeListener:null},r=a=>{i.isMatched=a.matches,t(i)};return o.addEventListener?(o.addEventListener("change",r),i.removeListener=()=>o.removeEventListener("change",r)):(o.addListener(r),i.removeListener=()=>o.removeListener(r)),n&&t(i),i};BeFunky.truncateEmail=function(e,t){let n=e.length-t;if(n<=0)return e;if(n>0){let o=Math.round(t*.618),[i,r]=e.split("@");if(r.length<=o)return`${i.slice(0,i.length-n-1)}...@${r}`;if(i.length<o){let s=r.slice(0,r.length-n-1);return`${i}@${s}...`}let a=Math.ceil(n/2),c=i.slice(0,i.length-a-1),d=r.slice(0,r.length-a-1);return`${c}...@${d}...`}};window.getLocaleDateString=()=>{let e=new Date,t=`${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getDate().toString().padStart(2,"0")}/${e.getFullYear().toString().padStart(4,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`,n="unknown";try{n=/.*\s(.+)/.exec(new Date().toLocaleDateString(navigator.language,{timeZoneName:"short"}))[1]}catch{n=new Date().toTimeString().match(new RegExp("[A-Z](?!.*[(])","g")).join("")}return`${t} (${n})`};window.hideEmail=e=>e.replace(/(.{2})(.*)(.{2})(?=@)/,(t,n,o,i)=>o.length>=3?`${n}${"*".repeat(Math.max(Math.min(o.length,5),o.length/3))}${i}`:`${n}${"*".repeat(o.length+i.length)}`);BeFunky.reviewApp=()=>{if(BeFunky.isTWA){let e=parseInt(BeFunky.getLocal("review_prompt_time")),t=1e3*60*60*24*30*3;(!e||Date.now()-e>t)&&(window.open("befunky://review","_blank"),BeFunky.setLocal("review_prompt_time",Date.now().toString()))}else BeFunky.isAppleAppStoreApp&&window.execNative({type:"in_app_review"})};var{userAgent:Ue}=navigator;BeFunky.isAppleAppStoreApp=typeof window.execNative!="undefined";BeFunky.isEdge=/Edge?\/\d+/.test(Ue);BeFunky.isOpera=/Opera|OPR\//.test(Ue);BeFunky.isChromium=Boolean(window.chrome);BeFunky.isChrome=BeFunky.isChromium&&!BeFunky.isOpera&&!BeFunky.isEdge;BeFunky.isChromeOnIOS=/CriOS/.test(Ue);BeFunky.isSafari=/^((?!chrome|android).)*safari/i.test(Ue)||BeFunky.isAppleAppStoreApp;var Wr=BeFunky.isSafari?Ue.match(/version\/([\d.]+)?( mobile\/[a-z\d]+)? safari/i)||Ue.match(/(?:ipad|iphone|ipod).*os[_ ]([\d._]+)/i):null;BeFunky.safariVersion=Wr?parseFloat(Wr[1].replace("_",".")):0;if(BeFunky.isSafari){let e;"BigInt64Array"in window?e=15:"replaceAll"in String.prototype&&(e=13.1),e&&e>BeFunky.safariVersion&&(BeFunky.logWarning("Guessing Safari version",BeFunky.safariVersion,"->",e),BeFunky.safariVersion=e)}BeFunky.isFirefox=/firefox/i.test(Ue);var Hr=BeFunky.isFirefox?Ue.match(/ firefox\/([\d.]+)/i):null;BeFunky.firefoxVersion=Hr?parseInt(Hr[1]):0;var Vr=BeFunky.isChromium?Ue.match(/ chrome\/([\d.]+)/i):null;BeFunky.chromiumVersion=Vr?parseInt(Vr[1]):0;BeFunky.isMac=navigator.platform.includes("Mac");BeFunky.isSafariMojave=BeFunky.isSafari&&/Mac OS X 10_14/.test(Ue);BeFunky.isAndroid=/(android)/i.test(Ue);BeFunky.isIPadOS=navigator.maxTouchPoints>1&&(BeFunky.isMac&&BeFunky.safariVersion>=13||/ipad.*os[_ ]\d/i.test(Ue)||BeFunky.isMac&&BeFunky.isChromeOnIOS);BeFunky.isTablet=/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/i.test(Ue)||BeFunky.isIPadOS;BeFunky.isIOS=/iPad|iPhone|iPod/.test(navigator.platform)||BeFunky.isIPadOS||BeFunky.isAppleAppStoreApp;BeFunky.isMobile=BeFunky.isAndroid||BeFunky.isIOS||BeFunky.isTablet||/mobile/i.test(Ue);BeFunky.isSmartphone=BeFunky.isMobile&&!BeFunky.isTablet;BeFunky.isSmartphone&&BeFunky.appContainer.classList.add("bfn--smartphone");BeFunky.isWindows=navigator.platform.includes("Win");BeFunky.isChromeOS=/\bCrOS\b/.test(Ue);BeFunky.isDropShadowSupported=!(BeFunky.isChromium&&/Mac OS X 10_(10|11)/.test(Ue));var Ul=BeFunky.isChromium&&BeFunky.chromiumVersion<=86;BeFunky.isImageBitmapSupported="createImageBitmap"in window&&!Ul&&!BeFunky.isSafari&&!BeFunky.isAppleAppStoreApp;BeFunky.deviceCategory="desktop";BeFunky.isTablet?BeFunky.deviceCategory="tablet":BeFunky.isMobile&&(BeFunky.deviceCategory="mobile");BeFunky.testingFlags=(getCookie("testing_flags")||"").split(",").map(e=>e.trim()).filter(Boolean);BeFunky.testingFlags.length&&console.log("Testing Flags:",BeFunky.testingFlags);var Kt;zr()?(Kt=!0,BeFunky.setLocalSession("is_standalone_mode","yes")):Kt=BeFunky.getLocalSession("is_standalone_mode")==="yes";BeFunky.isOldTWA=Dl();BeFunky.isTWA=BeFunky.isOldTWA||jl();BeFunky.twaAppId=BeFunky.isOldTWA?"com.befunky.pwato.twa":BeFunky.isTWA?"air.com.befunky.BeFunkyPhotoEditor":"";var Gr=Ol();BeFunky.isInstalled=()=>Kt||zr()||BeFunky.isTWA||Gr||BeFunky.isAppleAppStoreApp;BeFunky.platform="browser";BeFunky.isTWA?BeFunky.platform="play_store":Gr?BeFunky.platform="microsoft_store":BeFunky.isAppleAppStoreApp?BeFunky.platform="apple_app_store":BeFunky.isInstalled()&&(BeFunky.platform="desktop");BeFunky.usePlayStorePricing=Boolean(BeFunky.platform==="play_store"&&"getDigitalGoodsService"in window);function zr(){return Boolean(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)}function Dl(){let e;if(window.location.href.startsWith(BeFunky.Params.pwaStartUrl)&&window.location.hash==="#play-store-twa"?(e=!0,BeFunky.setLocalSession("is_play_store_twa","yes")):e=BeFunky.getLocalSession("is_play_store_twa")==="yes",e){let t={StandaloneMode:Kt,ChromeOS:BeFunky.isChromeOS,getDigitalGoodsService:"getDigitalGoodsService"in window},n=Object.entries(t).filter(([,o])=>!o).map(([o])=>o);n.length&&(e=!1,BeFunky.isChromeOS&&BeFunky.reportWarning(`Old Play Store TWA detection failed: ${n.join(", ")}`))}return e}function jl(){let e,t=window.location.href.startsWith(BeFunky.Params.pwaStartUrl)&&window.location.hash==="#play-store-twa-v2",n=window.location.hash==="#use-shared-twa-image";if(t||n?(e=!0,BeFunky.setLocalSession("is_play_store_twa_v2","yes")):e=BeFunky.getLocalSession("is_play_store_twa_v2")==="yes",e){let o={StandaloneModeChromeOS:!(BeFunky.isChromeOS&&!Kt),AndroidOrChromeOS:BeFunky.isAndroid||BeFunky.isChromeOS,getDigitalGoodsService:"getDigitalGoodsService"in window},i=Object.entries(o).filter(([,r])=>!r).map(([r])=>r);i.length&&(i.length===1&&i[0]==="getDigitalGoodsService"?BeFunky.logWarning("getDigitalGoodsService not available on TWA"):BeFunky.chromiumVersion>=88&&(BeFunky.isAndroid||BeFunky.isChromeOS)&&BeFunky.reportWarning(`New Play Store TWA detection failed: ${i.join(", ")}`))}return e}function Ol(){let e;if(document.referrer==="app-info://platform/microsoft-store"?(e=!0,BeFunky.setLocalSession("is_ms_store_pwa","yes")):e=BeFunky.getLocalSession("is_ms_store_pwa")==="yes",e){let t={StandaloneMode:Kt,Windows:BeFunky.isWindows,Edge:BeFunky.isEdge},n=Object.entries(t).filter(([,o])=>!o).map(([o])=>o);n.length&&BeFunky.reportWarning(`Microsoft Store PWA detection issue: ${n.join(", ")}`)}return e}var Kn=(e,t)=>[...e].filter(n=>n instanceof HTMLElement).map(n=>t(n)),Jn=(e,t)=>t(e);NodeList.prototype.setStyles=HTMLCollection.prototype.setStyles=function(e){return Kn(this,t=>Object.assign(t.style,e)),this};HTMLElement.prototype.setStyles=function(e){return Jn(this,t=>Object.assign(t.style,e)),this};HTMLElement.prototype.setLang=function(e,t,n){let o=typeof t=="object"?t:void 0;if(n||(n=typeof t=="string"?t:"app"),!BeFunky.LanguageManager)return BeFunky.throwError("setLang called too early"),this;if(this.onLanguageUpdate&&(this.onLanguageUpdate=void 0),o)return this.setAttribute("data-lang",e),BeFunky.LanguageManager.registerElement(this,o,n),this;let i=e;return/^[a-z0-9_!]+$/.test(e)&&(this.setAttribute("data-lang",e),i=BeFunky.LanguageManager.getString(e,n)),this.nodeName==="INPUT"||this.nodeName==="TEXTAREA"?this.setAttribute("placeholder",i):i.includes("<")?this.innerHTML=i:this.textContent=i,this};HTMLElement.prototype.closestParent=function(e){if(e(this))return this;if(!!this.parentElement)return this.parentElement.closestParent(e)};HTMLElement.prototype.hasClass=function(e){return this.classList.contains(e)};HTMLElement.prototype.setClass=function(e){return this.className=e,this};NodeList.prototype.addClass=HTMLCollection.prototype.addClass=function(e){return Kn(this,t=>t.classList.add(e)),this};HTMLElement.prototype.addClass=function(e){return Jn(this,t=>t.classList.add(e)),this};NodeList.prototype.removeClass=HTMLCollection.prototype.removeClass=function(e){return Kn(this,t=>t.classList.remove(e)),this};HTMLElement.prototype.removeClass=function(e){return Jn(this,t=>t.classList.remove(e)),this};function Xr(e,t){return n=>{typeof t!="boolean"&&BeFunky.throwError("toggleClass not provided with a boolean",e),t?n.classList.add(e):n.classList.remove(e)}}NodeList.prototype.toggleClass=HTMLCollection.prototype.toggleClass=function(e,t){return Kn(this,Xr(e,t)),this};HTMLElement.prototype.toggleClass=function(e,t){return Jn(this,Xr(e,t)),this};Array.prototype.unique=function(){let e=this.concat();for(let t=0;t<e.length;++t)for(let n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e};Array.prototype.shuffle=function(){for(let e,t,n=this.length;n;e=parseInt(Math.random()*n),t=this[--n],this[n]=this[e],this[e]=t);return this};Array.prototype.isIdenticalTo=function(e){if(!Array.isArray(e)||this.length!==e.length)return!1;for(let t=0,n=this.length;t<n;t++)if(Array.isArray(this[t])&&Array.isArray(e[t])){if(!this[t].isIdenticalTo(e[t]))return!1}else if(this[t]!==e[t])return!1;return!0};var Jt=Boolean(window.PointerEvent),Yr=performance.now(),Nl=function(e){if(window.preventPointerMoveThrottling||BeFunky.Params.isBeta)return;let t=performance.now();t-Yr<16?(e.stopImmediatePropagation(),e.preventDefault()):Yr=t};document.addEventListener(Jt?"pointermove":"mousemove",Nl,!0);BeFunky.pointerover=Jt?"pointerover":"mouseover";BeFunky.pointerout=Jt?"pointerout":"mouseout";BeFunky.pointerdown=Jt?"pointerdown":"mousedown";BeFunky.pointermove=Jt?"pointermove":"mousemove";BeFunky.pointerup=Jt?"pointerup":"mouseup";BeFunky.pointercancel="pointercancel";var oi={},Mt=null;Object.defineProperty(BeFunky,"globalPointerCoords",{get(){return Mt&&(oi.x=Mt.clientX,oi.y=Mt.clientY),oi}});Object.defineProperty(BeFunky,"globalPointerEvent",{get(){return Mt}});var Qn=e=>{Mt=e};document.addEventListener(BeFunky.pointerdown,Qn,!0);document.addEventListener(BeFunky.pointermove,Qn,!0);document.addEventListener(BeFunky.pointerup,Qn,!0);document.addEventListener(BeFunky.pointercancel,Qn,!0);BeFunky.dispatchPointerEvent=(e,t,n,o=0,i=0,r={})=>{if(!(typeof e=="string"&&e.includes("pointer")&&BeFunky.hasOwnProperty(e)&&typeof BeFunky[e]=="string")||!(t&&t.dispatchEvent&&typeof t.dispatchEvent=="function")||!["mouse","touch","pen",void 0,null].includes(n))return;e=BeFunky[e],n=n||(Mt?Mt.pointerType:"mouse");let a=new PointerEvent(e,{view:window,bubbles:!0,cancelable:!0,pointerType:n,clientX:o,clientY:i});a.data=r,t.dispatchEvent(a)};BeFunky.isPointerDown=!1;document.addEventListener(BeFunky.pointerdown,e=>{e.isTrusted&&(BeFunky.isPointerDown=!0)},!0);document.addEventListener(BeFunky.pointerup,e=>{e.isTrusted&&(BeFunky.isPointerDown=!1)},!0);document.addEventListener("touchstart",e=>{e.isTrusted&&(BeFunky.isPointerDown=!0)},!0);document.addEventListener("touchend",e=>{e.isTrusted&&(BeFunky.isPointerDown=!1)},!0);var ii=window.innerWidth,Rt=window.innerHeight;window.addEventListener("resize",()=>{ii=window.innerWidth,Rt=window.innerHeight});BeFunky.isWiderThanMobile=()=>ii>=801;if(BeFunky.isIOS||BeFunky.isAppleAppStoreApp){window.addEventListener("orientationchange",()=>{setTimeout(()=>{ii===window.innerWidth&&Rt===window.innerHeight||window.dispatchEvent(new Event("resize"))},200)});let e=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--100vh"));e!==window.innerHeight&&(BeFunky.logWarning("Fixed innerHeight right away",e,window.innerHeight),window.dispatchEvent(new Event("resize"))),BeFunky.onLoad(()=>{Rt!==window.innerHeight&&(BeFunky.logWarning("Fixed innerHeight on load",Rt,window.innerHeight),window.dispatchEvent(new Event("resize")))}),window.addEventListener("INIT",()=>{if(!("visualViewport"in window))return;let t=Date.now(),n=200,o=50;i(1);function i(r){r>o||(Rt<window.innerHeight&&visualViewport.height===window.innerHeight?(BeFunky.logWarning("Fixed innerHeight after app init",`${((Date.now()-t)/1e3).toFixed(1)}s`,Rt,window.innerHeight,visualViewport.height),window.dispatchEvent(new Event("resize"))):Rt<window.screen.height&&setTimeout(()=>i(++r),n))}})}BeFunky.isOnline=()=>BeFunky.testingFlags.includes("simulate_offline")?Math.random()>.8:navigator.onLine!==!1;var Kr=()=>{},pt;BeFunky.whenOnline=function(){if(BeFunky.isOnline())return Promise.resolve();if(pt)return pt;let e=!0;BeFunky.logError("User is offline"),setTimeout(()=>{e&&(Kr=BeFunky.acknowledge("user_offline",{isCritical:!0}))},100),pt=window.deferredPromise();let t=Date.now();return pt.then(n=>{e=!1;let o=Date.now()-t;Kr(),n==="browser"&&(BeFunky.logError(`Browser back online after ${o}`),pt=void 0),n==="offline_test"&&(BeFunky.reportWarning("Browser offline but /offline-test/ worked",{latency:o}),setTimeout(()=>{pt=void 0},1e3*60))}),ql(pt),Wl(pt),pt};function ql(e){window.addEventListener("online",function t(){window.removeEventListener("online",t),e.resolve("browser")})}function Wl(e){let t=new XMLHttpRequest;t.open("GET",`${BeFunky.Params.siteUrl}offline-test/?nocache=${Math.random().toString().split(".")[1]}`),t.onload=function(){this.responseText==="online"&&e.resolve("offline_test")},t.send()}BeFunky.inFlightRequests={};BeFunky.request=function(e,t,n){let{headers:o={},responseType:i="json",method:r="GET",body:a=null,downloadProgressHandler:c,uploadProgressHandler:d,responseHeadersHandler:s,fallbackURLs:l=[],promptToRetryIfOffline:u=!0,logErrorMessage:p=!1}=t;if(BeFunky.isAppleAppStoreApp)return o["X-Request-From"]="befunky_mobile_app",(i==="blob"||e.toLowerCase().startsWith("../")||e.toLowerCase().startsWith("/")||e.toLowerCase().startsWith("file:/"))&&(o.is_native_local_file="true"),r==="GET"&&(o.method="GET"),window.requestWrapperForMobileApp(e,a,o,i,({response:h})=>{if(h&&typeof h.error=="string")return p&&h.message&&BeFunky.logError("API error name & message:",h.error,h.message),n({error:h.error});if(i==="blob"){if(typeof h=="string"){try{h.includes("base64,")||(h=`base64,${h}`)}catch{}try{h=BFN.BlobUtils.base64ToBlob(h)}catch{}}else if(typeof h=="object"){let k=new Uint8Array(h);h=new Blob([k]),k=null}}else if(i==="document"&&typeof h=="string")try{h=h.replace(/\\"/g,'"'),h=new DOMParser().parseFromString(h,"text/html")}catch{}n({response:h})}),{abort:()=>{}};let f=typeof t.withCredentials=="boolean"?t.withCredentials:r==="POST";if(!["","arraybuffer","blob","document","json","text"].includes(i))throw new Error(`Invalid responseType: ${BeFunky.stringValue(i)}`);if(!["GET","POST"].includes(r))throw new Error(`Invalid method: ${BeFunky.stringValue(i)}`);if(l.length&&(c||d))throw new Error("Cannot use progress w/ fallbackURLs b/c multiple XHR objects are created");if(Array.isArray(l)&&l.length){let h=n;n=k=>{if(k.hasOwnProperty("error")){BeFunky.logError(`Failed to fetch URL: ${e.split("/").pop()}. Attempting next fallback URL.`,k);let v=t.fallbackURLs.shift();k.offlineRetryCancelled&&(t.promptToRetryIfOffline=!1),BeFunky.request(v,t,h)}else h(k)}}let g=new XMLHttpRequest,{inFlightRequests:m}=BeFunky;g.onload=function(){delete m[e];let{response:h}=this,{status:k}=this;if(i==="json")try{h=JSON.parse(this.responseText)}catch{h=null}if(k<200||k>=400){if(h&&typeof h.error=="string")return p&&h.message&&BeFunky.logError("API error name & message:",h.error,h.message),n({error:h.error});if(h&&h.error&&h.error.code&&h.error.message)return n({error:h.error});if(h&&h.code&&h.message)return n({error:h.code});if(i==="blob"&&h instanceof Blob)return F(h);let L=["","text","json"].includes(i)?this.responseText:h;BeFunky.throwError(`Unexpected ${k} error from ${v()}`,L),n({error:"invalid_response"})}else{if(i==="json"&&!h)return BeFunky.throwError(`Got invalid JSON from ${v()}`,e,this.responseText),n({error:"invalid_response"});h&&h.error&&BeFunky.throwError("Status code does not match response",JSON.stringify({url:e,status:k,response:h})),n({response:h})}function v(){let L=e;return L.startsWith(BeFunky.Params.siteUrl)&&(L=L.replace(BeFunky.Params.siteUrl,"/")),L=L.split("?")[0].split("#")[0],L.length>50&&(L=`${L.slice(0,50)}...`),L}function F(L){T(L).then(E=>{let{error:I}=JSON.parse(E);if(typeof I!="string")throw"no_error_string";return I}).then(E=>n({error:E}),()=>{BeFunky.throwError(`Unexpected ${k} error from ${v()}`,L),n({error:"invalid_response"})})}function T(L){return new Promise((E,I)=>{if(setTimeout(()=>I("timeout"),1e3),typeof L.text=="function")return L.text().then(E,I);let M=new FileReader;M.onload=()=>E(M.result),M.onerror=j=>I(j),M.readAsText(L)})}},typeof s=="function"&&(g.onreadystatechange=function(){if(this.readyState===this.HEADERS_RECEIVED){let h=g.getAllResponseHeaders().trim().split(/[\r\n]+/),k={};h.forEach(v=>{let F=v.split(": "),T=F.shift();k[T]=F.join(": ")}),s(k)}}),g.onerror=_(),g.onabort=_(),g.ontimeout=_();function _(){return function(h){if(delete m[e],u&&!BeFunky.isOnline()&&BeFunky.usingServiceWorker()){console.log("Request failed while offline",{reason:h.type,url:e,errorEvent:h}),Hl(()=>BeFunky.request(e,t,n),()=>n({error:"request_failed",offlineRetryCancelled:!0}));return}n({error:"request_failed"})}}c&&BeFunky.addProgressHandler(g,c),d&&BeFunky.addProgressHandler(g,d,!0),g.withCredentials=f,g.open(r,e,!0),i!=="json"&&(g.responseType=i),Object.entries(o).forEach(([h,k])=>{g.setRequestHeader(h,k)}),g.wasAborted=!1,g.wasSent=!1;let y=g.abort;return g.abort=function(){g.wasSent?(g.wasAborted=!0,y.call(g)):g.wasAborted||(g.wasAborted=!0,g.onabort())},!BeFunky.isOnline()&&!BeFunky.usingServiceWorker()?BeFunky.whenOnline().then(()=>{g.wasAborted||(g.wasSent=!0,g.send(a))}):(g.wasSent=!0,g.send(a)),m[e]=g,g};var _t=null;function Hl(e,t){if(_t){_t.confirmHandlers.push(e),_t.cancelHandlers.push(t);return}_t={confirmHandlers:[e],cancelHandlers:[t]},BeFunky.confirm("user_offline",{confirmText:"try_again",onConfirm:()=>{_t.confirmHandlers.forEach(n=>n()),_t=null},onCancel:()=>{_t.cancelHandlers.forEach(n=>n()),_t=null}})}BeFunky.requestAPI=function(e,t={},n={}){let o,i=new Promise((r,a)=>{e.endsWith("/")||(e+="/");let c=`${BeFunky.Params.siteUrl}api/${e}`,d;if(e.startsWith("get/")){let l=Object.entries(t).map(([u,p])=>`${u}=${encodeURIComponent(p)}`).join("&");l&&(c+=`?${l}`),d={method:"GET"}}else{let l=getCsToken();t.CSRFtoken=l,t.client_date=window.getLocaleDateString();let{browser:u,device:p}=Vl();u&&(t.browser=u),p&&(t.device=p),typeof window.webglUnmaskedRenderer!="undefined"&&(t.graphic_info=btoa(window.webglUnmaskedRenderer)),d={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":l,"X-User-Email":window.latestUserData.email||""},body:Object.entries(t).map(([f,g])=>`${f}=${encodeURIComponent(g)}`).join("&")}}let s=Object.assign({},d,n);BeFunky.isAppleAppStoreApp?window.requestWrapperForMobileApp(c,s.hasOwnProperty("body")?s.body:null,s,"json",l=>{if(l=l.response,l&&typeof l.error!="undefined")return a(l.error);r(l)}):(n.showLoadScreen&&(typeof n.showLoadScreen=="object"?BeFunky.showLoadScreen(n.showLoadScreen):BeFunky.showLoadScreen()),o=BeFunky.request(c,s,({error:l,response:u})=>{if(n.showLoadScreen&&BeFunky.hideLoadScreen(),["already_logged_in","not_logged_in","wrong_user"].includes(l)?BeFunky.UserManager.checkUserToken(l,"API"):BeFunky.UserManager.resetPolling(),l)return a(l);if(!u||!u.data)return a("invalid_response");r(u)}))});return i.request=o,i};function Vl(){let e=window.getSystemInformation(),t=e.browser.name;e.browser.major&&(t=`${t} ${e.browser.major}`);let n="";if(e.device.model&&(e.device.vendor&&(n+=`${e.device.vendor} `),n+=e.device.model),e.os.name){let o=e.os.name;e.os.version&&(o+=` ${e.os.version}`),n.length>0?n+=` (${o})`:n=o}return{browser:t,device:n}}BeFunky.addProgressHandler=function(e,t,n=!1){!n&&e&&e.onprogress===null?e.onprogress=o:n&&e&&e.upload&&e.upload.onprogress===null&&(e.upload.onprogress=o);function o(i){i&&i.lengthComputable&&t(i.loaded,i.total)}};BeFunky.failureReason=function(e){return typeof e!="string"?`Unknown request error: ${BeFunky.getType(e)}`:e==="not_logged_in"&&BeFunky.isLoggedIn()?BeFunky.LanguageManager.getString("acknowledge_session_expired"):e==="invalid_token"?BeFunky.LanguageManager.getString("error_invalid_csrf_token"):e==="quota_exceeded"?BeFunky.LanguageManager.getString("error_invalid_response"):/^[a-z0-9_]+$/.test(e)?BeFunky.LanguageManager.getString(`error_${e}`):`Error: ${e}`};BeFunky.loadScriptWithXHR=function(e){return new Promise((t,n)=>{BeFunky.request(e,{responseType:"text"},({error:o,response:i})=>{if(o)return n(o);let r=document.createElement("script"),a=document.getElementsByTagName("script")[0].parentElement;r.text=i,a.appendChild(r),t()})})};BeFunky.createFormData=function(e){let t=new FormData;return Object.entries(e).forEach(([n,o])=>{t.append(n,o)}),t};BeFunky.uploadFileToS3=function(e,{bucket:t,contentType:n,fileName:o,progressHandler:i}){let r={cancelUpload:()=>{BeFunky.throwError("cancelUpload called too soon")}},a=new Promise((s,l)=>{c().then(d).then(s,l)});return a.cancelUpload=()=>r.cancelUpload(),a;function c(){let s={bucket:t,content_type:n};o&&(s.filename=o);let l=BeFunky.requestAPI("direct-upload",s);return r.cancelUpload=()=>l.request.abort(),l.then(u=>{let{url:p,inputs:f}=u.data;if(!p||!f)throw"invalid_response";return{url:p,inputs:f}})}function d({url:s,inputs:l}){let u={method:"POST",body:BeFunky.createFormData(Object.assign({},l,{file:e})),withCredentials:!1,responseType:"text",uploadProgressHandler:i};return new Promise((p,f)=>{let g=BeFunky.request(s,u,({error:m,response:_})=>{if(m)return f(m);let y;try{let h=new window.DOMParser().parseFromString(_,"text/xml");if(y={url:decodeURIComponent(h.querySelector("Location").textContent),name:decodeURIComponent(h.querySelector("Key").textContent)},!y.url||!y.name)throw"missing_data"}catch(h){return BeFunky.throwError("Invalid XML response from S3",h,_),f("invalid_response")}return p(y)});r.cancelUpload=()=>g.abort()})}};BeFunky.loadScript=(e,t=()=>!1,n=()=>{})=>new Promise((o,i)=>{if(t())return o();let r=document.createElement("script");n(r),r.src=e,r.onload=()=>o(),r.onerror=()=>{BeFunky.logError("Failed to load script:",e),i("request_failed")};let a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a)});var Jr=new WeakMap,gt=e=>(...t)=>{let n=e(...t);return Jr.set(n,!0),n},Ut=e=>typeof e=="function"&&Jr.has(e);var ri=typeof window!="undefined"&&window.customElements!=null&&window.customElements.polyfillWrapFlushCallback!==void 0;var hn=(e,t,n=null)=>{for(;t!==n;){let o=t.nextSibling;e.removeChild(t),t=o}};var Xe={},Zn={};var it=`{{lit-${String(Math.random()).slice(2)}}}`,ai=`<!--${it}-->`,Qr=new RegExp(`${it}|${ai}`),Qt="$lit$",eo=class{constructor(t,n){this.parts=[],this.element=n;let o=[],i=[],r=document.createTreeWalker(n.content,133,null,!1),a=0,c=-1,d=0,{strings:s,values:{length:l}}=t;for(;d<l;){let u=r.nextNode();if(u===null){r.currentNode=i.pop();continue}if(c++,u.nodeType===1){if(u.hasAttributes()){let p=u.attributes,{length:f}=p,g=0;for(let m=0;m<f;m++)Zr(p[m].name,Qt)&&g++;for(;g-- >0;){let m=s[d],_=to.exec(m)[2],y=_.toLowerCase()+Qt,h=u.getAttribute(y);u.removeAttribute(y);let k=h.split(Qr);this.parts.push({type:"attribute",index:c,name:_,strings:k}),d+=k.length-1}}u.tagName==="TEMPLATE"&&(i.push(u),r.currentNode=u.content)}else if(u.nodeType===3){let p=u.data;if(p.indexOf(it)>=0){let f=u.parentNode,g=p.split(Qr),m=g.length-1;for(let _=0;_<m;_++){let y,h=g[_];if(h==="")y=rt();else{let k=to.exec(h);k!==null&&Zr(k[2],Qt)&&(h=h.slice(0,k.index)+k[1]+k[2].slice(0,-Qt.length)+k[3]),y=document.createTextNode(h)}f.insertBefore(y,u),this.parts.push({type:"node",index:++c})}g[m]===""?(f.insertBefore(rt(),u),o.push(u)):u.data=g[m],d+=m}}else if(u.nodeType===8)if(u.data===it){let p=u.parentNode;(u.previousSibling===null||c===a)&&(c++,p.insertBefore(rt(),u)),a=c,this.parts.push({type:"node",index:c}),u.nextSibling===null?u.data="":(o.push(u),c--),d++}else{let p=-1;for(;(p=u.data.indexOf(it,p+1))!==-1;)this.parts.push({type:"node",index:-1}),d++}}for(let u of o)u.parentNode.removeChild(u)}},Zr=(e,t)=>{let n=e.length-t.length;return n>=0&&e.slice(n)===t},si=e=>e.index!==-1,rt=()=>document.createComment(""),to=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;var mn=class{constructor(t,n,o){this.__parts=[],this.template=t,this.processor=n,this.options=o}update(t){let n=0;for(let o of this.__parts)o!==void 0&&o.setValue(t[n]),n++;for(let o of this.__parts)o!==void 0&&o.commit()}_clone(){let t=ri?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),n=[],o=this.template.parts,i=document.createTreeWalker(t,133,null,!1),r=0,a=0,c,d=i.nextNode();for(;r<o.length;){if(c=o[r],!si(c)){this.__parts.push(void 0),r++;continue}for(;a<c.index;)a++,d.nodeName==="TEMPLATE"&&(n.push(d),i.currentNode=d.content),(d=i.nextNode())===null&&(i.currentNode=n.pop(),d=i.nextNode());if(c.type==="node"){let s=this.processor.handleTextExpression(this.options);s.insertAfterNode(d.previousSibling),this.__parts.push(s)}else this.__parts.push(...this.processor.handleAttributeExpressions(d,c.name,c.strings,this.options));r++}return ri&&(document.adoptNode(t),customElements.upgrade(t)),t}};var ea=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),zl=` ${it} `,Zt=class{constructor(t,n,o,i){this.strings=t,this.values=n,this.type=o,this.processor=i}getHTML(){let t=this.strings.length-1,n="",o=!1;for(let i=0;i<t;i++){let r=this.strings[i],a=r.lastIndexOf("<!--");o=(a>-1||o)&&r.indexOf("-->",a+1)===-1;let c=to.exec(r);c===null?n+=r+(o?zl:ai):n+=r.substr(0,c.index)+c[1]+c[2]+Qt+c[3]+it}return n+=this.strings[t],n}getTemplateElement(){let t=document.createElement("template"),n=this.getHTML();return ea!==void 0&&(n=ea.createHTML(n)),t.innerHTML=n,t}};var no=e=>e===null||!(typeof e=="object"||typeof e=="function"),oo=e=>Array.isArray(e)||!!(e&&e[Symbol.iterator]),yn=class{constructor(t,n,o){this.dirty=!0,this.element=t,this.name=n,this.strings=o,this.parts=[];for(let i=0;i<o.length-1;i++)this.parts[i]=this._createPart()}_createPart(){return new kt(this)}_getValue(){let t=this.strings,n=t.length-1,o=this.parts;if(n===1&&t[0]===""&&t[1]===""){let r=o[0].value;if(typeof r=="symbol")return String(r);if(typeof r=="string"||!oo(r))return r}let i="";for(let r=0;r<n;r++){i+=t[r];let a=o[r];if(a!==void 0){let c=a.value;if(no(c)||!oo(c))i+=typeof c=="string"?c:String(c);else for(let d of c)i+=typeof d=="string"?d:String(d)}}return i+=t[n],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}},kt=class{constructor(t){this.value=void 0,this.committer=t}setValue(t){t!==Xe&&(!no(t)||t!==this.value)&&(this.value=t,Ut(t)||(this.committer.dirty=!0))}commit(){for(;Ut(this.value);){let t=this.value;this.value=Xe,t(this)}this.value!==Xe&&this.committer.commit()}},wt=class{constructor(t){this.value=void 0,this.__pendingValue=void 0,this.options=t}appendInto(t){this.startNode=t.appendChild(rt()),this.endNode=t.appendChild(rt())}insertAfterNode(t){this.startNode=t,this.endNode=t.nextSibling}appendIntoPart(t){t.__insert(this.startNode=rt()),t.__insert(this.endNode=rt())}insertAfterPart(t){t.__insert(this.startNode=rt()),this.endNode=t.endNode,t.endNode=this.startNode}setValue(t){this.__pendingValue=t}commit(){if(this.startNode.parentNode===null)return;for(;Ut(this.__pendingValue);){let n=this.__pendingValue;this.__pendingValue=Xe,n(this)}let t=this.__pendingValue;t!==Xe&&(no(t)?t!==this.value&&this.__commitText(t):t instanceof Zt?this.__commitTemplateResult(t):t instanceof Node?this.__commitNode(t):oo(t)?this.__commitIterable(t):t===Zn?(this.value=Zn,this.clear()):this.__commitText(t))}__insert(t){this.endNode.parentNode.insertBefore(t,this.endNode)}__commitNode(t){this.value!==t&&(this.clear(),this.__insert(t),this.value=t)}__commitText(t){let n=this.startNode.nextSibling;t=t==null?"":t;let o=typeof t=="string"?t:String(t);n===this.endNode.previousSibling&&n.nodeType===3?n.data=o:this.__commitNode(document.createTextNode(o)),this.value=t}__commitTemplateResult(t){let n=this.options.templateFactory(t);if(this.value instanceof mn&&this.value.template===n)this.value.update(t.values);else{let o=new mn(n,t.processor,this.options),i=o._clone();o.update(t.values),this.__commitNode(i),this.value=o}}__commitIterable(t){Array.isArray(this.value)||(this.value=[],this.clear());let n=this.value,o=0,i;for(let r of t)i=n[o],i===void 0&&(i=new wt(this.options),n.push(i),o===0?i.appendIntoPart(this):i.insertAfterPart(n[o-1])),i.setValue(r),i.commit(),o++;o<n.length&&(n.length=o,this.clear(i&&i.endNode))}clear(t=this.startNode){hn(this.startNode.parentNode,t.nextSibling,this.endNode)}},io=class{constructor(t,n,o){if(this.value=void 0,this.__pendingValue=void 0,o.length!==2||o[0]!==""||o[1]!=="")throw new Error("Boolean attributes can only contain a single expression");this.element=t,this.name=n,this.strings=o}setValue(t){this.__pendingValue=t}commit(){for(;Ut(this.__pendingValue);){let n=this.__pendingValue;this.__pendingValue=Xe,n(this)}if(this.__pendingValue===Xe)return;let t=!!this.__pendingValue;this.value!==t&&(t?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=t),this.__pendingValue=Xe}},ro=class extends yn{constructor(t,n,o){super(t,n,o);this.single=o.length===2&&o[0]===""&&o[1]===""}_createPart(){return new _n(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}},_n=class extends kt{},ta=!1;(()=>{try{let e={get capture(){return ta=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch{}})();var ao=class{constructor(t,n,o){this.value=void 0,this.__pendingValue=void 0,this.element=t,this.eventName=n,this.eventContext=o,this.__boundHandleEvent=i=>this.handleEvent(i)}setValue(t){this.__pendingValue=t}commit(){for(;Ut(this.__pendingValue);){let r=this.__pendingValue;this.__pendingValue=Xe,r(this)}if(this.__pendingValue===Xe)return;let t=this.__pendingValue,n=this.value,o=t==null||n!=null&&(t.capture!==n.capture||t.once!==n.once||t.passive!==n.passive),i=t!=null&&(n==null||o);o&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=Xl(t),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=t,this.__pendingValue=Xe}handleEvent(t){typeof this.value=="function"?this.value.call(this.eventContext||this.element,t):this.value.handleEvent(t)}},Xl=e=>e&&(ta?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);var li=class{handleAttributeExpressions(t,n,o,i){let r=n[0];return r==="."?new ro(t,n.slice(1),o).parts:r==="@"?[new ao(t,n.slice(1),i.eventContext)]:r==="?"?[new io(t,n.slice(1),o)]:new yn(t,n,o).parts}handleTextExpression(t){return new wt(t)}},ci=new li;function ui(e){let t=di.get(e.type);t===void 0&&(t={stringsArray:new WeakMap,keyString:new Map},di.set(e.type,t));let n=t.stringsArray.get(e.strings);if(n!==void 0)return n;let o=e.strings.join(it);return n=t.keyString.get(o),n===void 0&&(n=new eo(e,e.getTemplateElement()),t.keyString.set(o,n)),t.stringsArray.set(e.strings,n),n}var di=new Map;var pi=new WeakMap,Dt=(e,t,n)=>{let o=pi.get(t);o===void 0&&(hn(t,t.firstChild),pi.set(t,o=new wt(Object.assign({templateFactory:ui},n))),o.appendInto(t)),o.setValue(e),o.commit()};typeof window!="undefined"&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.4.1");var bt=(e,...t)=>new Zt(e,t,"html",ci);var gi=new WeakMap,so=gt(e=>t=>{let n=gi.get(t);if(e===void 0&&t instanceof kt){if(n!==void 0||!gi.has(t)){let o=t.committer.name;t.committer.element.removeAttribute(o)}}else e!==n&&t.setValue(e);gi.set(t,e)});var na=new WeakMap,oa=gt(e=>t=>{if(!(t instanceof kt)||t instanceof _n||t.committer.name!=="style"||t.committer.parts.length>1)throw new Error("The `styleMap` directive must be used in the style attribute and must be the only part in the attribute.");let{committer:n}=t,{style:o}=n.element,i=na.get(t);i===void 0&&(o.cssText=n.strings.join(" "),na.set(t,i=new Set)),i.forEach(r=>{r in e||(i.delete(r),r.indexOf("-")===-1?o[r]=null:o.removeProperty(r))});for(let r in e)i.add(r),r.indexOf("-")===-1?o[r]=e[r]:o.setProperty(r,e[r])});var kn,ia=0;function fi(e){kn=e}function hi(){kn=null,ia=0}function ra(){return ia++}var lo=Symbol("haunted.phase"),en=Symbol("haunted.hook"),mi=Symbol("haunted.update"),yi=Symbol("haunted.commit"),at=Symbol("haunted.effects"),Ft=Symbol("haunted.layoutEffects"),wn="haunted.context";var cf,uf,df,co=class{constructor(t,n){J(this,"update");J(this,"host");J(this,"virtual");J(this,cf);J(this,uf);J(this,df);this.update=t,this.host=n,this[en]=new Map,this[at]=[],this[Ft]=[]}run(t){fi(this);let n=t();return hi(),n}_runEffects(t){let n=this[t];fi(this);for(let o of n)o.call(this);hi()}runEffects(){this._runEffects(at)}runLayoutEffects(){this._runEffects(Ft)}teardown(){this[en].forEach(n=>{typeof n.teardown=="function"&&n.teardown()})}};cf=en,uf=at,df=Ft;var Kl=Promise.resolve().then.bind(Promise.resolve());function aa(){let e=[],t;function n(){t=null;let o=e;e=[];for(var i=0,r=o.length;i<r;i++)o[i]()}return function(o){e.push(o),t==null&&(t=Kl(n))}}var Jl=aa(),sa=aa(),hf,tn=class{constructor(t,n){J(this,"renderer");J(this,"host");J(this,"state");J(this,hf);J(this,"_updateQueued");this.renderer=t,this.host=n,this.state=new co(this.update.bind(this),n),this[lo]=null,this._updateQueued=!1}update(){this._updateQueued||(Jl(()=>{let t=this.handlePhase(mi);sa(()=>{this.handlePhase(yi,t),sa(()=>{this.handlePhase(at)})}),this._updateQueued=!1}),this._updateQueued=!0)}handlePhase(t,n){switch(this[lo]=t,t){case yi:this.commit(n),this.runEffects(Ft);return;case mi:return this.render();case at:return this.runEffects(at)}}render(){return this.state.run(()=>this.renderer.call(this.host,this.host))}runEffects(t){this.state._runEffects(t)}teardown(){this.state.teardown()}};hf=lo;var Ql=(e="")=>e.replace(/-+([a-z])?/g,(t,n)=>n?n.toUpperCase():"");function la(e){class t extends tn{constructor(i,r,a){super(i,a||r);J(this,"frag");this.frag=r}commit(i){e(i,this.frag)}}function n(o,i,r){let a=(r||i||{}).baseElement||HTMLElement,{observedAttributes:c=[],useShadowDOM:d=!0,shadowRootInit:s={}}=r||i||{};class l extends a{constructor(){super();J(this,"_scheduler");d===!1?this._scheduler=new t(o,this):(this.attachShadow(Ve({mode:"open"},s)),this._scheduler=new t(o,this.shadowRoot,this))}static get observedAttributes(){return o.observedAttributes||c||[]}connectedCallback(){this._scheduler.update()}disconnectedCallback(){this._scheduler.teardown()}attributeChangedCallback(g,m,_){if(m===_)return;let y=_===""?!0:_;Reflect.set(this,Ql(g),y)}}function u(f){let g=f,m=!1;return Object.freeze({enumerable:!0,configurable:!0,get(){return g},set(_){m&&g===_||(m=!0,g=_,this._scheduler&&this._scheduler.update())}})}let p=new Proxy(a.prototype,{getPrototypeOf(f){return f},set(f,g,m,_){let y;return g in f?(y=Object.getOwnPropertyDescriptor(f,g),y&&y.set?(y.set.call(_,m),!0):(Reflect.set(f,g,m,_),!0)):(typeof g=="symbol"||g[0]==="_"?y={enumerable:!0,configurable:!0,writable:!0,value:m}:y=u(m),Object.defineProperty(_,g,y),y.set&&y.set.call(_,m),!0)}});return Object.setPrototypeOf(l.prototype,p),l}return n}var Ce=class{constructor(t,n){J(this,"id");J(this,"state");this.id=t,this.state=n}};function Zl(e,...t){let n=ra(),o=kn[en],i=o.get(n);return i||(i=new e(n,kn,...t),o.set(n,i)),i.update(...t)}function Te(e){return Zl.bind(null,e)}function uo(e){return Te(class extends Ce{constructor(t,n,o,i){super(t,n);J(this,"callback");J(this,"lastValues");J(this,"values");J(this,"_teardown");e(n,this)}update(t,n){this.callback=t,this.values=n}call(){(!this.values||this.hasChanged())&&this.run(),this.lastValues=this.values}run(){this.teardown(),this._teardown=this.callback.call(this.state)}teardown(){typeof this._teardown=="function"&&this._teardown()}hasChanged(){return!this.lastValues||this.values.some((t,n)=>this.lastValues[n]!==t)}})}function _i(e,t){e[at].push(t)}var ki=uo(_i);var wi=Te(class extends Ce{constructor(e,t,n){super(e,t);J(this,"Context");J(this,"value");J(this,"_ranEffect");J(this,"_unsubscribe");this._updater=this._updater.bind(this),this._ranEffect=!1,this._unsubscribe=null,_i(t,this)}update(e){if(this.state.virtual)throw new Error("can't be used with virtual components");return this.Context!==e&&(this._subscribe(e),this.Context=e),this.value}call(){this._ranEffect||(this._ranEffect=!0,this._unsubscribe&&this._unsubscribe(),this._subscribe(this.Context),this.state.update())}_updater(e){this.value=e,this.state.update()}_subscribe(e){let t={Context:e,callback:this._updater};this.state.host.dispatchEvent(new CustomEvent(wn,{detail:t,bubbles:!0,cancelable:!0,composed:!0}));let{unsubscribe:n=null,value:o}=t;this.value=n?o:e.defaultValue,this._unsubscribe=n}teardown(){this._unsubscribe&&this._unsubscribe()}});function ca(e){return t=>{let n={Provider:class extends HTMLElement{constructor(){super();J(this,"listeners");J(this,"_value");this.listeners=new Set,this.addEventListener(wn,this)}disconnectedCallback(){this.removeEventListener(wn,this)}handleEvent(o){let{detail:i}=o;i.Context===n&&(i.value=this.value,i.unsubscribe=this.unsubscribe.bind(this,i.callback),this.listeners.add(i.callback),o.stopPropagation())}unsubscribe(o){this.listeners.delete(o)}set value(o){this._value=o;for(let i of this.listeners)i(o)}get value(){return this._value}},Consumer:e(function({render:o}){let i=wi(n);return o(i)}),defaultValue:t};return n}}var nn=Te(class extends Ce{constructor(e,t,n,o){super(e,t);J(this,"value");J(this,"values");this.value=n(),this.values=o}update(e,t){return this.hasChanged(t)&&(this.values=t,this.value=e()),this.value}hasChanged(e=[]){return e.some((t,n)=>this.values[n]!==t)}});function ec(e,t){e[Ft].push(t)}var po=uo(ec);var go=Te(class extends Ce{constructor(e,t,n){super(e,t);J(this,"args");this.updater=this.updater.bind(this),typeof n=="function"&&(n=n()),this.makeArgs(n)}update(){return this.args}updater(e){if(typeof e=="function"){let t=e,[n]=this.args;e=t(n)}this.makeArgs(e),this.state.update()}makeArgs(e){this.args=Object.freeze([e,this.updater])}});var Hf=Promise.resolve();var bi=Te(class extends Ce{constructor(e,t,n,o,i){super(e,t);J(this,"reducer");J(this,"currentState");this.dispatch=this.dispatch.bind(this),this.currentState=i!==void 0?i(o):o}update(e){return this.reducer=e,[this.currentState,this.dispatch]}dispatch(e){this.currentState=this.reducer(this.currentState,e),this.state.update()}});var Fi=e=>nn(()=>({current:e}),[]);function vi({render:e}){let t=la(e),n=ca(t);return{component:t,createContext:n}}var ua=Array.prototype.includes;function da(){let e=new WeakMap,t=new WeakMap;class n extends tn{constructor(r,a){super(r,a);J(this,"args");this.state.virtual=!0}render(){return this.state.run(()=>this.renderer.apply(this.host,this.args))}commit(r){this.host.setValue(r),this.host.commit()}teardown(){super.teardown();let r=t.get(this);e.delete(r)}}function o(i){function r(...a){return c=>{let d=e.get(c);d||(d=new n(i,c),e.set(c,d),t.set(d,c),Bi(d,c)),d.args=a,d.update()}}return gt(r)}return o}function Bi(e,t,n=t.startNode){let o=n.parentNode,i=new MutationObserver(r=>{for(let a of r)if(ua.call(a.removedNodes,n)){i.disconnect(),n.parentNode instanceof ShadowRoot?Bi(e,t):e.teardown();break}else if(ua.call(a.addedNodes,n.nextSibling)){i.disconnect(),Bi(e,t,n.nextSibling||void 0);break}});i.observe(o,{childList:!0})}var{component:fo,createContext:tc}=vi({render:Dt}),Si=da();var nc=Te(class extends Ce{constructor(e,t,n){super(e,t);this.isTornDown=!1;let{contexts:o}=BeFunky.LanguageManager;if(!o.includes(n))throw new Error(`Invalid useLanguageUpdate context: ${n}. Should be one of these: ${o.join(", ")}.`);this.languageContext=n,this.onLanguageChange=this.onLanguageChange.bind(this),BeFunky.LanguageManager.addLanguageUpdateListener(this.onLanguageChange)}onLanguageChange(e){e.includes(this.languageContext)&&this.state.update()}update(e){this.isTornDown&&(BeFunky.LanguageManager.addLanguageUpdateListener(this.onLanguageChange),this.isTornDown=!1);let t=BeFunky.LanguageManager.language[this.languageContext],n=BeFunky.LanguageManager.loadedLanguages.includes(t);return`${t}-${n}`}teardown(){this.isTornDown=!0,BeFunky.LanguageManager.removeLanguageUpdateListener(this.onLanguageChange)}}),pa=nc;var oc=Te(class extends Ce{constructor(e,t,n){super(e,t);this.mediaQueryString=n,this.isTornDown=!1,this.startListening()}startListening(){let{isMatched:e,removeListener:t}=BeFunky.onMatchMedia(this.mediaQueryString,this.onMatchChange.bind(this));this.isMatched=e,this.removeListener=t}onMatchChange({isMatched:e}){e!==this.isMatched&&(this.isMatched=e,this.state.update())}update(e){return this.isTornDown&&(this.isTornDown=!1,this.startListening()),this.isMatched}teardown(){this.isTornDown=!0,this.removeListener()}}),ga=oc;var ic=Te(class extends Ce{constructor(e,t){super(e,t);this.isTornDown=!1,this.onUserDataChange=this.onUserDataChange.bind(this),this.startListening()}startListening(){window.onUserStatusChange(this.onUserDataChange,!1),this.userData=this.getRelevantUserData()}getRelevantUserData(){return{isLoggedIn:BeFunky.isLoggedIn(),isPlus:BeFunky.isPlus(),email:window.latestUserData.email,username:window.latestUserData.user_name}}onUserDataChange(){let e=this.getRelevantUserData();JSON.stringify(e)!==JSON.stringify(this.userData)&&(this.userData=e,this.state.update())}update(e){return this.isTornDown&&(this.isTornDown=!1,this.startListening()),this.userData}teardown(){this.isTornDown=!0,window.offUserStatusChange(this.onUserDataChange)}}),fa=ic;var ha=e=>Boolean(e&&e.getHTML&&e.getTemplateElement),ho=(e,t,n=!1)=>{if(Array.isArray(e)){let[i,r]=e;return n?BeFunky.LanguageManager.getStringReplacements(i,r,t):lc(i,r,t)}let o=BeFunky.LanguageManager.getString(e,t);return n?o:bt([o])},rc=(e,t)=>ho(e,"app",t),ac=(e,t)=>ho(e,"site",t),sc=(e,t)=>ho(e,"modal",t);function lc(e,t,n){let o=[],i=BeFunky.LanguageManager.getString(e,n),r=i.split(/({{[a-z0-9_!]+}})/i);for(let a=0;a<r.length;a++){let c=r[a];if(c.startsWith("{{")){let d=c.replace(/[{}]/g,""),s=t[d];typeof s=="function"&&(s=s(d,n)),typeof s=="string"?a===0?(r[a]=s+(r[a+1]||""),r.splice(a+1,1)):(r[a-1]=(r[a-1]||"")+s+(r[a+1]||""),r.splice(a,2),a-=1):(ha(s)||BeFunky.throwError(`Invalid template replacement for {{${d}}} in ${e}: ${BeFunky.getType(s)}`),o.push(s),r.splice(a,1))}}if(t.hasOwnProperty("suffix")&&!i.includes("{{suffix}}")){let a=r.pop(),c=t.suffix;typeof c=="function"&&(c=c("suffix",n)),typeof c!="string"&&BeFunky.throwError(`Invalid suffix for ${e}: ${BeFunky.getType(c)}`,c),r.push(`${a} ${c}`)}return bt(r,...o)}var cc=(e,t)=>{let n=document.createElement("string");return Array.isArray(e)?n.setLang(e[0],e[1],t):n.setLang(e,t),n},uc=gt((e,t)=>n=>n.committer.element.setAttributeNS(e,n.committer.name,t)),dc=(e,t="icon",{style:n,tooltip:o}={})=>bt`<svg class="${t}" style=${so(n)} data-tooltip=${so(o)}>
        <use xlink:href="${uc("http://www.w3.org/1999/xlink",`#${e}`)}"></use>
    </svg>`,pc=(...e)=>{let t=document.createElement("div");return Dt(bt(...e),t),t.firstElementChild},gc=(e,t)=>{let n={},o={};Object.entries(e).forEach(([a,c])=>{n[a]=c,Object.defineProperty(o,a,{get(){return n[a]}})});let i=(a,c)=>{let d=!1,s={};return Object.entries(c).forEach(([l,u])=>{a.hasOwnProperty(l)?u!==a[l]&&(d=!0,s[l]=[a[l],u],a[l]=u):BeFunky.throwError(`Invalid state property "${l}"`,Object.keys(a),Object.keys(c))}),{hasUpdated:d,updates:s}},r=a=>{let{hasUpdated:c,updates:d}=i(n,a);c&&t(d)};return t({}),[o,r]};function fc(e,t,n={}){try{customElements.define(e,fo(t,Ve({useShadowDOM:!1},n)))}catch(o){BeFunky.throwError(o,`Unable to setup <${e}>`)}}BeFunky.lit={isTemplateResult:ha,icon:dc,elem:pc,html:bt,string:cc,setupState:gc,render:Dt,ifDefined:so,styleMap:oa,lang:ho,appLang:rc,siteLang:ac,modalLang:sc,component:fo,virtual:Si,useState:go,useMemo:nn,useEffect:ki,useLayoutEffect:po,useRef:Fi,useReducer:bi,useLanguageUpdate:pa,useMediaQuery:ga,useUserStatus:fa,defineCustomElement:fc,hook:Te,Hook:Ce};var ma=class{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.appLanguages=["en","es","pt","fr","de","it","tr","zh","ja","ko","ru","no","ar"],this.siteLanguages=["en","es","pt","fr","de","it"],this.contexts=["app","site","modal"],this.languageData=this.appLanguages.reduce((r,a)=>(r[a]={},r),{}),this.languageUpdateListeners=[],this.loadingPromises={},this.loadedLanguages=[],this.queueLanguageRender=BeFunky.debounce(this.renderLanguageStrings.bind(this),"raf"),this.defaultLanguage="en";let t=getCookie("lang"),n=document.documentElement.lang,o=[t,n,this.defaultLanguage].find(r=>this.appLanguages.includes(r)),i;document.documentElement.getAttribute("data-use-app-lang")==="true"?i=o:i=[n,this.defaultLanguage].find(r=>this.appLanguages.includes(r)),this.log({initialAppLanguage:o,initialSiteLanguage:i}),this._language={app:o,site:i,modal:i},this.loadLanguage(i).then(()=>this.queueLanguageRender(),()=>{}),this.loadLanguage(o).then(()=>this.queueLanguageRender(),()=>{}),requestIdleCallback(()=>{[o,i].includes(this.defaultLanguage)||this.loadLanguage(this.defaultLanguage).catch(()=>{}),this.handleBrowserLanguage()})}log(...t){BeFunky.logFeature("lang",...t)}loadLanguage(t){if(!this.appLanguages.includes(t))throw new Error("Invalid language ID");if(this.loadingPromises[t])return this.loadingPromises[t];let n=`${t}${BeFunky.Params.languageVersions[t]}.json`,o=`${BeFunky.Params.globalAssetsPath}languages/all/${n}`,i=()=>new Promise((a,c)=>{BeFunky.isAppleAppStoreApp&&setTimeout(()=>c("ios_timeout"),2e3),BeFunky.request(o,{},({response:d,error:s})=>{if(s||!d||typeof d!="object")return c(s||"invalid_response");a(d)})}),r=BeFunky.retry(`lang-${t}`,2,i).then(a=>(this.languageData[t]=a,this.loadedLanguages.push(t),this.log("Loaded JSON",t),a),a=>{throw this.loadingPromises[t]=void 0,BeFunky.logError(`Unable to get translations for language "${t}"`,a||"invalid_response"),a});return this.loadingPromises[t]=r,r}setLanguage(t,n){if(!this.appLanguages.includes(t))throw new Error("Invalid language ID");if(!Array.isArray(n)||!n.every(i=>this.contexts.includes(i)))throw new Error("Invalid language context");n.forEach(i=>{this._language[i]!==t&&(this.log("Set language",i,t),this._language[i]=t,this.loadLanguage(t).then(()=>this.queueLanguageRender(),()=>{}))});let o=window.isAppOpen?this._language.app:this._language.site;this.language.modal!==o&&(this._language.modal=o,this.loadLanguage(o).then(()=>this.queueLanguageRender(),()=>{})),n.includes("app")&&(window.BFN&&BFN.SettingsManager?BFN.SettingsManager.updateSetting("language",this.language.app):BeFunky.SettingsService&&BeFunky.SettingsService.updateSetting("language",this.language.app),BeFunky.User.language=this.language.app,BeFunky.isAppleAppStoreApp&&setCookie("lang",this.language.app,365))}handleBrowserLanguage(){if(getCookie("lang"))return;let t;try{t=navigator.language.substr(0,2)}catch{}if(!this.appLanguages.includes(t)||t===this.language.app||t===this.language.site)return;let n=async()=>{await this.loadLanguage(t);let o=this.getLanguageNames().find(({id:i})=>i===t).name;o!=="English"&&(o=o.toLowerCase()),BeFunky.showToast({message:this.getStringReplacements("view_in_language",{language:o},t),acceptButton:this.getString("change_language",t),onAccept:()=>{BeFunky.LanguageManager.setLanguage(t,["app","site"])}})};BeFunky.isDashboard()||BeFunky.html5app_created?n():window.addEventListener("INIT_COMPLETE",n)}renderLanguageStrings(t){this.lastRender=this.lastRender||{app:"",site:"",modal:""};let n=[];if(Object.entries(this.lastRender).forEach(([r,a])=>{let c=this.language[r];if(c!==a){if(r==="app"&&!BeFunky.appContentInjected||!this.loadedLanguages.includes(c))return;this.log("Update language strings",r,c),i(o(r),r),this.lastRender[r]=c,n.push(r),r==="app"&&window.BFN&&BFN.appContainer&&BFN.appContainer.removeClass(`app-lang-${a}`).addClass(`app-lang-${c}`)}}),!n.length)return;this.languageUpdateListeners.forEach(r=>{r(n)});function o(r){if(r==="app")return t?[...t.querySelectorAll("[data-lang]")]:[...document.querySelectorAll("#bfn-app [data-lang]")];if(r==="site")return[...document.querySelectorAll("#site_root [data-lang]")];if(r==="modal")return[...document.querySelectorAll(".modal [data-lang], .dialog [data-lang]")]}function i(r,a){r.forEach(c=>{if(typeof c.onLanguageUpdate=="function"){c.onLanguageUpdate();return}let d=c.getAttribute("data-lang");if(d.startsWith("<")){c.innerHTML=d;return}let s=BeFunky.LanguageManager.getString(d,a);c.nodeName==="INPUT"||c.nodeName==="TEXTAREA"?c.setAttribute("placeholder",s):s.includes("<")?c.innerHTML=s:c.textContent=s})}}registerElement(t,n,o){if(!t||!t.dataset.lang)return BeFunky.logError("Element must have a data-lang attribute.");let i=t.dataset.lang;t.onLanguageUpdate=()=>{t.innerHTML=this.getStringReplacements(i,n,o)},t.onLanguageUpdate()}getString(t,n="app"){if(typeof t!="string")return BeFunky.throwError(`${BeFunky.getType(t)} passed to LanguageManger.getString`,t),"";let o;if(this.contexts.includes(n))o=this.language[n];else if(this.appLanguages.includes(n))o=n;else return BeFunky.throwError(`Invalid context/language "${n}" passed to LanguageManger.getString`),"";let i=this.languageData[o][t];if(i)return i;if(o!==this.defaultLanguage){let a=this.languageData[this.defaultLanguage][t];if(a)return a}if(!/^[a-z0-9_!]+$/.test(t))return t;return r();function r(){return t.split("_").map(a=>a==="dlx"?"DLX":a.charAt(0).toUpperCase()+a.slice(1)).join(" ")}}isTranslated(t,n="app"){return!!this.languageData[this.language[n]][t]}getStringReplacements(t,n,o){let i=this.getString(t,o);return Object.keys(n).forEach(r=>{let a=n[r];if(typeof a=="function"&&(a=a(r,o)),typeof a!="string")return BeFunky.throwError(`Invalid string replacement for {{${r}}} in ${t}: ${BeFunky.getType(a)}`,a);i=i.split(`{{${r}}}`).join(a),r==="suffix"&&!i.includes("{{suffix}}")&&(i=`${i} ${a}`)}),i}addLanguageUpdateListener(t){this.languageUpdateListeners.includes(t)||this.languageUpdateListeners.push(t)}removeLanguageUpdateListener(t){let n=this.languageUpdateListeners.indexOf(t);n!==-1&&this.languageUpdateListeners.splice(n,1)}getLanguageNames(){return[{id:"en",name:"English"},{id:"es",name:"Espa\xF1ol"},{id:"fr",name:"Fran\xE7ais"},{id:"de",name:"Deutsch"},{id:"no",name:"Norsk"},{id:"pt",name:"Portugu\xEAs"},{id:"it",name:"Italiano"},{id:"tr",name:"T\xFCrk\xE7e"},{id:"ru",name:"P\u0443\u0441\u0441\u043A\u0438\u0439"},{id:"zh",name:"\u4E2D\u6587\uFF08\u7B80\u4F53\uFF09"},{id:"ja",name:"\u65E5\u672C\u8A9E"},{id:"ko",name:"\uD55C\uAD6D\uC5B4"},{id:"ar",name:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629/\u0639\u0631\u0628\u064A"}]}handleUserUpdateLanguage(t){this.setLanguage(t,["app"]),window.BFN&&BFN.BfnService&&BFN.BfnService.track("CREATE","LANGUAGE",this.language.app.toUpperCase())}get language(){return this._language}};BeFunky.LanguageManager=new ma;var ya=["#E14A43","#FB9F39","#F5E949","#B7D93F","#67C369","#6A91CD","#966DB8","#CF6399"],_a=[0,2,4,6,1,3,5,7],st=24,mo=Math.sqrt(st**2/2);function hc(){mc.call(this),yc.call(this),_c.call(this)}function mc(){this.show=kc.bind(this),this.hide=wc.bind(this),this.style.position="relative",this.style.pointerEvents="none",this.style.width=`${st*2}px`,this.style.height=`${st*2}px`}function yc(){this.bladeContainer=document.createElement("div"),this.bladeContainer.style.position="absolute",this.bladeContainer.style.left=`${st}px`,this.bladeContainer.style.top=`${st}px`,this.appendChild(this.bladeContainer)}function _c(){for(let e=0;e<_a.length;e++){let t=_a[e],n=ya[t],o=t/ya.length*(Math.PI*2),i=document.createElement("div");i.style.position="absolute",i.style.left=`${Math.cos(o)*st-Math.cos(o+Math.PI/2)*(st/1.5)}px`,i.style.top=`${Math.sin(o)*st-Math.sin(o+Math.PI/2)*(st/1.5)}px`,this.bladeContainer.appendChild(i);let r=document.createElement("div");r.style.position="absolute",r.style.transform=`rotate(${o*(180/Math.PI)}deg)`,i.appendChild(r);let a=document.createElement("div");a.style.position="absolute",a.style.backgroundColor="rgba(0,0,0,0)",a.style.transform="rotate(-45deg)",a.style.left=`-${mo}px`,a.style.bottom=`-${st+mo}px`,a.style.border=`${mo+1}px solid rgba(0,0,0,0)`,a.style.borderTop=`${mo+1}px solid ${n}`,a.style.opacity="0.8",r.appendChild(a)}}function kc(){this.addClass("load-screen__iris--visible")}function wc(){this.removeClass("load-screen__iris--visible")}function ka(e){hc.call(e)}var{containerElement:ft,irisElement:wa,messageElement:Pi}=Sc(),vt=!1,yo=!0,ba=!1,_o="",Fa,ko=!1,Li,jt,va,Ci=()=>{},Ba=()=>{};function bc({message:e="",showIris:t=!0,progress:n="",isCancellable:o=!0,onCancel:i,beforeAllowCancelDelay:r,visibilityDelay:a=300}={}){Ci(),Ba();let c=vt===!0;vt=!0;let d="";e&&(d+=Pa(e)),typeof n=="number"&&(n=`${n}%`),typeof n=="string"&&n&&(d+=` <strong class="load-screen__progress">${n}</strong>`),Pi.innerHTML=d,_o=e,!e&&!t&&BeFunky.throwError("Please specify a message when hiding the load screen iris"),c||ft.addClass("load-screen--active").setStyles({pointerEvents:""}),ft.hasClass("load-screen--invisible")?a>0&&yo?Ci=BeFunky.wait([a,"raf"],()=>{ft.removeClass("load-screen--invisible"),wo(t),yo=!1}):(ft.removeClass("load-screen--invisible"),wo(t),yo=!1):wo(t);let s=Date.now();va={lastProgressTime:s,lastProgressValue:0,loadSpeed:0,lastDisplayTime:s,lastDisplayValue:0,animationFrame:null},typeof r!="number"&&(r=typeof i=="function"?500:1500),vc(o,i,r)}function Sa(){Ci(),!!vt&&(vt=!1,ft.addClass("load-screen--invisible"),ft.setStyles({pointerEvents:"none"}),Ba=BeFunky.wait([100,"raf"],()=>{ft.removeClass("load-screen--active").setStyles({pointerEvents:""}),Pi.innerHTML="",_o="",wo(!1),yo=!0}),typeof jt=="function"&&jt())}function Fc(e,t,n=0){if(!a())return;if(t=Math.round(t),Number.isNaN(t)||t<0||t>100)return BeFunky.throwError("Invalid load screen percentage",t);let o=va;cancelAnimationFrame(o.animationFrame);let i=Date.now();o.loadSpeed=(t-o.lastProgressValue)/(i-o.lastProgressTime),o.lastProgressValue=t,o.lastProgressTime=i,o.lastDisplayValue||(o.lastDisplayTime=i),r();function r(){o.animationFrame=requestAnimationFrame(()=>{if(!a())return;let c=Date.now(),d=Math.min(1,Math.round(o.loadSpeed*(c-o.lastDisplayTime))),s=Math.min(o.lastProgressValue,Math.max(n,o.lastDisplayValue+d));s>o.lastDisplayValue&&(Pi.innerHTML=`${Pa(e)} <strong class="load-screen__progress">${s}%</strong>`,o.lastDisplayValue=s,o.lastDisplayTime=c),s<o.lastProgressValue&&r()})}function a(){return vt&&e===_o}}function wo(e){ba!==e&&(ba=e,e?wa.show():wa.hide())}function vc(e,t,n){clearTimeout(Fa),ko=!1,e&&(Fa=setTimeout(()=>{ko=!0,Li=t},n))}function Bc(e){let t=()=>BeFunky.confirm("confirm_cancel",{onConfirm:()=>{jt=void 0,Sa(),typeof Li=="function"&&Li()},onCancel:()=>{jt=void 0},confirmText:"yes",cancelText:"no"});e.addEventListener("click",()=>{!ko||!vt||(jt=t())}),document.addEventListener("keyup",n=>{if(!vt||jt||n.key!=="Escape")return;let o=BeFunky.getModal();o&&o.isDialog||(n.stopImmediatePropagation(),!!ko&&(jt=t()))})}function Sc(){let e=document.createElement("div").setClass("load-screen load-screen--invisible");e.id="load_screen_root";let t=document.createElement("div").addClass("load-screen__iris");ka(t);let n=document.createElement("div").addClass("load-screen__message");return e.appendChild(t),e.appendChild(n),document.body.appendChild(e),Bc(e),{containerElement:e,irisElement:t,messageElement:n}}function Pc(e){e!==ft.parentElement&&e.appendChild(ft)}function Lc(){return _o}function Cc(){return vt}function Pa(e){try{return BeFunky.LanguageManager.getString(e)}catch{return e}}BeFunky.showLoadScreen=bc;BeFunky.hideLoadScreen=Sa;BeFunky.moveLoadScreen=Pc;BeFunky.updateLoadScreenProgress=Fc;BeFunky.getLoadScreenMessage=Lc;BeFunky.isLoadScreenActive=Cc;var{isTemplateResult:La,render:Ec,html:Ei,elem:Ca,siteLang:Ai,icon:Ac}=BeFunky.lit,bo=Ca`<div class="notifications" style="display: none"><div class="notifications__inner"></div></div>`,Fo=bo.firstElementChild,Tc=BeFunky.once(()=>{let e=BeFunky.isModalOpen("my_account_modal")?BeFunky.getModal("my_account_modal").modalElement.querySelector(".section"):document.querySelector(".section:not(.section__app-tiles)");e?e.insertBefore(bo,e.firstChild):BeFunky.reportWarning("Failed to append notifications container b/c section was not found")});BeFunky.showNotification=function({message:e,button:t,isDismissable:n=!0,onDismiss:o,type:i="error"}){let r=BeFunky.createNotification({message:e,button:t,isDismissable:n,onDismiss:o,type:i});return xc(r),window.scrollTo(0,0),()=>Aa(r)};BeFunky.createNotification=function({message:e,button:t,isDismissable:n=!0,onDismiss:o,type:i="error"}){if(!Ea(e)&&!La(e))throw new Error("Invalid message");if(t&&!Ea(t.text))throw new Error("Invalid button");if(!["error","warning","success"].includes(i))throw new Error("Invalid type");t&&typeof t.onClick!="function"&&(t.onClick=()=>{}),typeof o!="function"&&(o=()=>{});let r=Ca`<div class=${`notification notification--${i}`}></div>`;return a(),BeFunky.LanguageManager.addLanguageUpdateListener(a),r.onTeardown=()=>{BeFunky.LanguageManager.removeLanguageUpdateListener(a)},r;function a(){Ec(c(),r)}function c(){return Ei`
            <div class="notification__content">
                <p class="notification__message">${La(e)?e:Ai(e)}</p>
                ${t?d():""}
            </div>
            ${n?s():""}
        `}function d(){return Ei`<button class="button button--xs button--white-outline-notheme notification__button" @click=${t.onClick}>
            ${Ai(t.text)}
        </button>`}function s(){return Ei`<button @click=${()=>{o(),Aa(r)}} class="button button--transparent button--icon button--xs notification__close" aria-label=${Ai("dismiss",!0)}>
            ${Ac("cancel-icon","icon icon--14")}
        </button>`}};function Ea(e){return!!(typeof e=="string"&&e.length||Array.isArray(e)&&typeof e[0]=="string"&&e[0].length)}function xc(e){Tc(),Fo.insertBefore(e,Fo.firstChild),bo.setStyles({display:""})}function Aa(e){!e||(e.onTeardown(),Fo.removeChild(e),Fo.firstElementChild||bo.setStyles({display:"none"}))}var xa=fn(Ta()),Ot=BeFunky.Params.siteUrl.replace(/\/$/,""),vo=new xa.default(Ot),bn=0,$i=!1,Ii=!1,Mi=!1;BeFunky.initialRoute=jc();var Fn=$c(BeFunky.initialRoute);BeFunky.sessionRoutes=[BeFunky.initialRoute];BeFunky.ignoreDeepLinkAction=!1;var Bo={"/create/":tt,"/es/crear/":tt,"/pt/criar/":tt,"/de/erstellen/":tt,"/fr/creer/":tt,"/create/:deepLink/":tt,"/es/crear/:deepLink/":tt,"/pt/criar/:deepLink/":tt,"/de/erstellen/:deepLink/":tt,"/fr/creer/:deepLink/":tt};vo.hooks({before(e,t){let n=bn===0,o=window.location.href.replace(Ot,"");console.log("Handling route:",bn,o,t||""),bn++,n||(Ii?BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1]=o:BeFunky.sessionRoutes.push(o),Mc(o)),BeFunky.ignoreDeepLinkAction=$i,BeFunky.isCreateRoute()||Uc(),Mi?(BeFunky.throwError("Attempting to resolve a route while another is in process",BeFunky.sessionRoutes),e(!1)):(Mi=!0,e())},after(){Mi=!1}});vo.notFound(Ic);setTimeout(()=>{Object.keys(Bo).forEach(e=>$a(e)),vo.on(Bo).resolve(),Rc()},0);BeFunky.pushRoute=ve;BeFunky.getCurrentRoute=Bt;BeFunky.canonicalRoute=Fn;function je(e,t){if($a(e,!0),bn===0)Bo[e]=t;else throw new Error(`Route registered too late: ${e}`)}function $a(e,t=!1){if(!e||!e.startsWith("/")||!e.endsWith("/"))throw new Error(`Invalid route key "${e}"`);if(t&&Bo[e])throw new Error(`Duplicate route key "${e}"`)}function ve(e,t=!1){if(e=e.replace(/\/?(\?|#|$)/,"/$1"),e.startsWith("/")||(e=`/${e}`),e===Bt()){BeFunky.isAppleAppStoreApp||BeFunky.reportWarning(`Duplicate route pushed: ${e}`);return}if(BeFunky.isAppleAppStoreApp){if(BeFunky.isCreateRoute(e)){let o=e.split("/").filter(Boolean).pop(),i=["create","crear","criar","erstellen","creer"].includes(o)?"":o;console.log("Entering app section in iOS",e,i),BeFunky.closeModal("dashboard_modal",!1),window.openUploadPanel(i,!0)}else console.log("Ignoring pushRoute in iOS app",e);return}let n=Boolean(BeFunky.isCreateRoute()&&BeFunky.isCreateRoute(e));Ii=t||n,$i=!1,vo.navigate(e),$i=!0}function Bt(){return BeFunky.sessionRoutes[BeFunky.sessionRoutes.length-1]}function $c(e){let t=document.querySelector('link[rel="canonical"]');return t&&t.href?t.href.replace(Ot,""):(BeFunky.logWarning("Unable to get canonical tag for this page"),e)}function tt(e){let t=e&&e.deepLink?e.deepLink:"";window.isAppOpen||window.openUploadPanel(t)}function Ic(){if(bn===0){BeFunky.isCreateRoute()&&(BeFunky.throwError("Not found route called for create route",BeFunky.sessionRoutes),tt(null));return}let e=So(window.location.href);e!==So(BeFunky.initialRoute)&&e!==So(Fn)&&(console.log("Reloading page to force browser to navigate to server-side route:",window.location.href),window.location.reload())}function Mc(e){window.ga?(window.ga("set","page",e),Ii||window.ga("send","pageview")):BeFunky.logError("Unable to track client-side route in Google Analytics",{route:e})}function Rc(){[...document.querySelectorAll("a[data-route]")].filter(t=>t.href.startsWith(Ot)).forEach(t=>{t.addEventListener("click",n=>{if(n.preventDefault(),t.offsetParent===null){BeFunky.logError("Ignoring data-route link click b/c it's hidden");return}e(t),ve(t.href.replace(Ot,""))})});function e(t){let{href:n}=t;if(!n||!BeFunky.isCreateRoute(n))return;let i=So(n).split("/").pop(),r;if(["create","crear","criar","erstellen","creer"].includes(i))r="PHOTO-EDITOR";else if(window.deepLinkRouteData[i])r=window.deepLinkRouteData[i].trackingID;else{BeFunky.throwError("Unsure how to track deep link button click",i,n);return}let a,c=document.getElementById("site_nav");c&&c.contains(t)&&(a="HEADER"),BeFunky.trackDeepLink(r,a)}}function Uc(){if(!window.isAppOpen||!BeFunky.html5app_created)return;let e=BeFunky.LanguageManager.isTranslated("confirm_hide")?BeFunky.LanguageManager.getString("confirm_hide"):"Are you sure you would like to hide the application?";if(window.confirm(e))Dc(),window.hideEditor(!1),BeFunky.webglContextWasLost&&window.location.reload();else{let n=window.location.href;window.history.forward(),setTimeout(()=>{n===window.location.href&&(console.log("Using Back instead of Forward to return to app"),window.history.back())},100)}}function Dc(){let e=BeFunky.getModal(),t=0;for(;e;){if(BeFunky.closeModal(e.modalID),console.log("Closed modal:",e.modalID),t++,t>10){BeFunky.throwError("Unexpected number of modals");break}e=BeFunky.getModal()}}function So(e){let t=e.replace(Ot,"").split("?")[0].split("#")[0].replace(/\/$/,"");return t.startsWith("/")?t:`/${t}`}function jc(){let e=window.location.href.replace(Ot,"");if(!BeFunky.isAppleAppStoreApp&&e.includes("//")){let t=window.location.href.replace(e,"");e=e.replace(/\/+/g,"/"),window.history.replaceState({},"",t+e),BeFunky.logError("Removed duplicate slash from URL. Referrer = ",document.referrer)}return e}var Ja=fn(ji());var vn=(...e)=>BeFunky.logFeature("pricing",...e),Oi;async function Oa(){if(Oi)return Oi;let e;try{if(e=await window.getDigitalGoodsService("https://play.google.com/billing"),!e)throw new Error("service_unavailable")}catch(t){throw BeFunky.reportWarning(`Digital goods service not working: ${t.name}: ${t.message}`),t}return Oi=e,e}function Na({month:e,year:t}){return vn("Fetching currency & value from DigitalGoodsService..."),Oa().then(n=>Promise.all([n.getDetails([e.id]).then(([o])=>o),n.getDetails([t.id]).then(([o])=>o)])).then(([n,o])=>{vn("Set currency & value on price pair for Play Store",{monthlyPrice:e,yearlyPrice:t},{monthlyPriceDetails:n,yearlyPriceDetails:o}),Object.assign(e,{currency:n.price.currency.toLowerCase(),value:n.price.value}),Object.assign(t,{currency:o.price.currency.toLowerCase(),value:o.price.value})})}async function Lo(){if(BeFunky.isPlus())return;vn("Checking for active subscriptions...");let n=(await(await Oa()).listPurchases()).filter(({itemId:l})=>BeFunky.Params.play_store_prices.some(u=>u.active&&u.id===l));if(vn("Active subscriptions:",n),n.length===0)return;let o=await Promise.all(n.map(l=>BeFunky.requestAPI("transaction/check-purchase-token",{purchaseToken:l.purchaseToken,sku:l.itemId,package:BeFunky.twaAppId}).catch(u=>({error:u}))));vn("Responses:",o),n.length>1&&(n.forEach((l,u)=>{console.log(`Active subscription #${u+1}`,l,o[u])}),BeFunky.throwError("Google Play user has multiple subscriptions"));let{data:i,error:r}=o[0];if(r){r!=="request_failed"&&BeFunky.reportWarning(`Failed to check purchase token: ${r}`,o[0]);return}let{user:a,subscription:c}=i,{itemId:d,purchaseToken:s}=n[0];if(c&&["plus","trialing"].includes(c.status)){if(!a){if(!BeFunky.isLoggedIn()){BeFunky.reportWarning("Not verifying Google Play subscription b/c user is logged-out",{user:a,subscription:c,sku:d,purchaseToken:s});return}let l;try{if(l=(await BeFunky.requestAPI("transaction/g-play-validate",{sku:d,purchaseToken:s,package:BeFunky.twaAppId})).data,!l)throw"invalid_response"}catch(u){BeFunky.throwError(`Play Store payment validation failed: ${u.code||u.message||u}`,u,{user:a,subscription:c,sku:d,purchaseToken:s});return}console.log("Verified Google Play subscription and associated it with current BeFunky user"),BeFunky.UserManager.updateUserDataAndTrackNativeAppStoreSubscription(l);return}if(c.status!==a.status){BeFunky.throwError("Google Play user status out of sync with BeFunky user status",{user:a,subscription:c,sku:d,purchaseToken:s});return}if(!c.isAcknowledged){BeFunky.throwError("Google Play subscription is not acknowledged",{user:a,subscription:c,sku:d,purchaseToken:s});return}if(!a.email||!["free","plus","trialing"].includes(a.status)){BeFunky.throwError("Invalid user from check-purchase-token",{user:a,subscription:c,sku:d,purchaseToken:s});return}return a}}var Nt=(...e)=>BeFunky.logFeature("pricing",...e);function Jc(){let e="US";return getCookie("ui_country")||e}async function qa({month:e,year:t}){if(Nt("Fetching currency & value from ios native app bridge..."),!BeFunky.isAppleAppStoreApp)throw new Error("not_native_app");let{products:n}=await window.getAppleAppStorePricesDetail({monthId:e.id,yearId:t.id});if(!n.length)throw new Error("products_not_found");n.forEach(o=>{o.id===e.id?(Nt("Set currency & value on monthly price for Apple App Store",o.id,o),Object.assign(e,{currency:o.currency.toLowerCase(),value:o.price})):o.id===t.id&&(Nt("Set currency & value on yearly price for Apple App Store",o.id,o),Object.assign(t,{currency:o.currency.toLowerCase(),value:o.price}))})}async function nt(e,t){if(BeFunky.freeTrialToUpgrade=!1,BeFunky.isPlus()||window.appleSubscriptionInProcessing)return;if(Nt("Checking existing purchases..."),!BeFunky.isAppleAppStoreApp)throw new Error("not_native_app");window.getUserCountryFromSwift(m=>{console.log("Swift country:",m)});let n=await window.restoreAppStorePurchase(e,t);if(!n||n&&n.error||n&&!n.purchase_item)return;let o=n.purchase_item&&typeof n.purchase_item.receipt!="undefined"&&n.purchase_item.receipt.length>0,i=n.purchase_item&&typeof n.purchase_item.originalTransaction!="undefined"&&n.purchase_item.originalTransaction.length>0;if(!o&&!i)return;Nt("Existing purchases:",{restorePurchase:n});let{productId:r}=n.purchase_item,{originalTransaction:a}=n.purchase_item,{transactionId:c}=n.purchase_item,{receipt:d}=n.purchase_item,s={};o?s.receipt=d:(s.productId=r,s.originalTransaction=a,s.transactionId=c),s.distinct_id=window.mixpanel&&typeof window.mixpanel.bfn_distinct_id!="undefined"&&window.mixpanel.bfn_distinct_id.length>0?window.mixpanel.bfn_distinct_id:"";let l=await BeFunky.requestAPI("transaction/app-store-check-transaction",s);Nt("App store transaction",l);let{data:u,error:p}=l;if(p){p!=="request_failed"&&BeFunky.reportWarning(`Failed to check transaction: ${p}`,l),BeFunky.appStoreReceiptIsFreeTrialing=!0,BeFunky.getFreeTrialEnabled()||BeFunky.setFreeTrialEnabled(!0);return}let{user:f,subscription:g}=u;if(g&&(g.status=="trialing"||g.isReceiptTrialPeriod===!0||g.isReceiptTrialPeriod==="true"?(BeFunky.appStoreReceiptIsFreeTrialing=!0,BeFunky.freeTrialToUpgrade=!1,BeFunky.getFreeTrialEnabled()||BeFunky.setFreeTrialEnabled(!0)):BeFunky.getFreeTrialEnabled()&&(BeFunky.setFreeTrialEnabled(!1),BeFunky.removeLocal("user_trial"),BeFunky.freeTrialToUpgrade=!0)),g&&["plus","trialing"].includes(g.status)){if(e){if(!g.productId||!g.originalTransaction){BeFunky.throwError("App Store payment validation failed: no original transaction found",{user:f,subscription:g});return}c=g.transactionId}typeof g.productId!="undefined"&&g.productId.length>0&&r!=g.productId&&(r=g.productId),typeof g.originalTransaction!="undefined"&&g.originalTransaction.length>0&&a!=g.originalTransaction&&(a=g.originalTransaction);try{a&&a.length>0&&BeFunky.setLocal("appstore_otid",a)}catch{}let m=BeFunky.Params.apple_app_store_prices.find(({id:h,active:k})=>k&&h===r);if(Nt("Active price:",m),!m)return;let _=m.value,y=Jc();if(!f||f&&typeof f.email!="undefined"&&f.email.length<1||f&&typeof f.status!="undefined"&&f.status==="free"){let h;try{if(h=(await BeFunky.requestAPI("transaction/app-store-verify-purchase",{productId:r,originalTransaction:a,transactionId:c,verifyActiveSubscription:"1",amount:_,country:y,distinct_id:window.mixpanel&&typeof window.mixpanel.bfn_distinct_id!="undefined"&&window.mixpanel.bfn_distinct_id.length>0?window.mixpanel.bfn_distinct_id:""})).data,!h)throw"invalid_response"}catch(k){if(k.code==="user_is_plus"){BeFunky.setLocal("appstore_otid",a),window.updateUserStatus(Object.assign({},window.latestUserData,{pl:"1"}));let v=k.status&&(k.status==="plus"||k.status==="trialing")?k.status:"plus";return{email:"",status:v}}else BeFunky.throwError(`App Store payment validation failed: ${k.code||k.message||k}`,k,{user:f,subscription:g,productId:r,originalTransaction:a});return}console.log("Verified App Store subscription");try{h.originalTransactionId&&BeFunky.setLocal("appstore_otid",h.originalTransactionId)}catch{}return BeFunky.UserManager.updateUserDataAndTrackNativeAppStoreSubscription(h),f&&f.status=="free"&&(f.status="plus"),(!e||e&&t)&&f&&["trialing","plus","free"].includes(f.status)?{status:f.status}:void 0}if(!["plus","trialing"].includes(f.status)&&!["plus","trialing"].includes(g.status)&&g.status!==f.status){BeFunky.throwError("App Store user status out of sync with BeFunky user status",{user:f,subscription:g,productId:r,originalTransaction:a});return}if(!["free","plus","trialing"].includes(f.status)){BeFunky.throwError("Invalid user from app-store-check-transaction",{user:f,subscription:g,productId:r,originalTransaction:a});return}}else if(g&&typeof g.originalTransaction!="undefined"&&g.originalTransaction.length>0)try{BeFunky.getLocal("appstore_otid")||BeFunky.setLocal("appstore_otid",g.originalTransaction)}catch{}return f}BeFunky.checkExistingAppStorePurchasesAndGetUser=nt;var on=(...e)=>BeFunky.logFeature("pricing",...e),Wa=BeFunky.Params.play_store_prices.filter(e=>e.active),Ha=BeFunky.Params.apple_app_store_prices.filter(e=>e.active),Va=BeFunky.Params.prices.filter(e=>e.active),Ni="US",Co=getCookie("ui_country");function lt(){return Co||Ni}var Le="PENDING",Qc=eu().then(e=>{Le=e}),Ga="year",za=[];function ht(){return Ga}function Bn(e){if(!["month","year"].includes(e))throw new Error(`Invalid recurring value: ${BeFunky.stringValue(e)}`);Ga=e,za.forEach(t=>t(e))}function Sn(e){za.push(e)}function Xa(){if(Le==="PENDING"){BeFunky.throwError("getPrices() called too early");return}return Le||BeFunky.throwError("No month/year price group found",Le),Le}function Pn(){return Qc.then(()=>Xa())}function Eo(e){let t=Xa();if(t)return t[e]}function Ye(e,t){let{unit_amount:n,value:o,currency:i}=e,r=new Intl.NumberFormat([t],{style:"currency",currency:i,currencyDisplay:"symbol"});return o&&o.includes(",")&&BeFunky.throwError("Invalid price value format:",i,o),r.format(o||n/100)}function qi(){Pn().then(({month:e,year:t})=>{let n=[e.country,e.currency,e.unit_amount,t.unit_amount].join("_").toUpperCase();window.bf_eventTrack("PROMOTION","UPGRADE_PLUS",n)})}BeFunky.trackPricesViewed=qi;function Wi(){let e;try{e=JSON.parse(BeFunky.getLocal("user_promo"))}catch{}if(e&&typeof e.code=="string"&&e.country&&e.expires>Date.now())return e}var Hi=["US","GB","AU","CA"];function Ln(e,t=!1,n=!0){if(e!==lt())throw new Error(`Mismatched free trial country: ${e}`);if(n&&!Hi.includes(e))throw new Error(`Invalid free trial country: ${e}`);let o=30;BeFunky.setLocal("user_trial",JSON.stringify({country:e,expires:Date.now()+1e3*60*60*24*o,enablePaywall:t})),qt(!0,t)}function Zc(){let e;try{e=JSON.parse(BeFunky.getLocal("user_trial"))}catch{}if(e&&e.country&&e.expires>Date.now())return e}var Ao=BeFunky.usePlayStorePricing||BeFunky.isAppleAppStoreApp,To=!1,Ya=[];function Vi(){return Ao}function qt(e,t){on(`${e?"Enabling":"Disabling"} free trial`),on(`${t?"Enabling":"Disabling"} paywall`),Ao=Boolean(e),To=Boolean(t),Ya.forEach(n=>n(Ao,To))}function Gi(e,t=!0){Ya.push(e),t&&e(Ao,To)}BeFunky.getFreeTrialEnabled=Vi;BeFunky.setFreeTrialEnabled=qt;BeFunky.isPaywallEnabled=()=>To;BeFunky.onFreeTrialEnabledChange=Gi;BeFunky.isInDemoMode=()=>navigator.languages&&navigator.languages.some(e=>e.startsWith("x-dm-country-"))||BeFunky.testingFlags.includes("chromeos_store_demo_mode");BeFunky.acknowledgeDemoMode=()=>{BeFunky.acknowledge("demo_mode_dialog_body",{heading:"demo_mode_dialog_heading"})};function Cn(e){let t=Va.find(o=>o.country===e&&o.recurring==="month"),n=Va.find(o=>o.country===e&&o.recurring==="year");if(t&&n)return{month:t,year:n};if(BeFunky.Params.eurozoneCountries.includes(e))return Cn("eurozone")}function eu(){return BeFunky.usePlayStorePricing?(Le={month:Wa.find(e=>e.recurring==="month"),year:Wa.find(e=>e.recurring==="year")},Na(Le).then(()=>{BeFunky.onLoad(()=>{if(BeFunky.isOldTWA){BeFunky.confirm("error_old_twa",{confirmText:"open_play_store",onConfirm:()=>window.open("https://play.google.com/store/apps/details?id=air.com.befunky.BeFunkyPhotoEditor","_blank")});return}Lo().then(({email:e,status:t}={})=>{e&&t&&BeFunky.UserManager.handlePlayStoreUser(e,t,"initial")}).catch(e=>{BeFunky.throwError("Play Store purchases issue",e)})})}).catch(e=>BeFunky.logError("Failed to update Play Store prices",e)).then(()=>Le)):BeFunky.isAppleAppStoreApp?(Le={month:Ha.find(e=>e.recurring==="month"),year:Ha.find(e=>e.recurring==="year")},qa(Le).then(()=>{BeFunky.onLoad(()=>{let e=100,t=200;BeFunky.waitUntil({condition:()=>window.isMixPanelInit,onSuccess:()=>{nt(!0).then(({email:n,status:o}={})=>{n&&o&&BeFunky.UserManager.handleAppStoreUser(n,o,"initial")}).catch(n=>{})},onTimeout:()=>{},interval:t,maxAttempts:e})})}).catch(e=>{BeFunky.throwError(e,"Failed to update Apple App Store prices")}).then(()=>Le)):Promise.resolve().then(()=>{let e=Wi();if(e&&(Le=Cn(e.country),Le))return on("Set price pair from promo in LocalStorage",Le),Le;BeFunky.removeLocal("user_promo");let t=Boolean(BeFunky.User.subscr_count),n=Zc();return n&&!t&&(Le=Cn(n.country),Le)?(on("Set price pair from trial in LocalStorage",Le),qt(!0,n.enablePaywall),Le):(BeFunky.removeLocal("user_trial"),BeFunky.removeLocal("user_price"),Le=zi(),Le)})}function zi(){let e;return Co&&(e=Cn(Co),e)?(on(`Set price pair for user's country ${Co}`,e),e):(e=Cn(Ni),on(`Set price pair for fallback country ${Ni}`,e),e)}function Ka(e){if(!Array.isArray(e)||e.length!==2||!e.every(i=>tu(i)))return;let t=e.map(i=>BeFunky.Params.prices.find(r=>r.id===i)).filter(Boolean),n=t.find(i=>i.recurring==="month"),o=t.find(i=>i.recurring==="year");if(!(!n||!o))return{month:n,year:o}}function tu(e){return BeFunky.Params.prices.some(t=>t.id===e)}function nu(){let e=document.querySelector(".site-nav");t(),BeFunky.addPassiveListener(window,"scroll",t);function t(){e.toggleClass("site-nav--scrolling",window.scrollY>0)}}function ou(){let e=document.getElementById("site_root"),t=document.querySelector(".site-nav__dropdown-root"),n=document.querySelector(".site-nav__dropdown-bg"),o=document.querySelector(".site-nav__dropdown-container"),i=document.querySelector(".site-nav__dropdown-arrow"),r=Array.from(document.querySelectorAll(".site-nav__item[data-dropdown]")),a=Array.from(document.querySelectorAll(".site-nav__dropdown-section[data-dropdown]")),c=[],d=!1;r.forEach(g=>{let m=g.getAttribute("data-dropdown"),_=a.find(k=>k.getAttribute("data-dropdown")===m);if(!_)return BeFunky.throwError(`Unable to find dropdown section: "${m}"`);let y=_.firstElementChild,h={index:c.length,name:m,opener:g,section:_,content:y,arrowOffset:parseInt(_.getAttribute("data-arrow-offset"))||-8};c.push(h),g.addEventListener("mouseenter",()=>{l(h)}),g.addEventListener("click",()=>{BeFunky.handleNextFocus(g,0,{showOutline:!1})}),g.delegateFocus=k=>{l(h);let v=(0,Ja.default)(y);return k===-1?v[v.length-1]:v[0]},y.addClass("focus-avoid"),y.exitFocusTrap=k=>{y.addClass("focus-avoid"),BeFunky.handleNextFocus(g,k),d===h&&u()},y.addEventListener("click",k=>{d!==h&&(BeFunky.logWarning("Click ignored on hidden dropdown menu"),k.preventDefault())}),g.setAttribute("aria-haspopup",!0),g.setAttribute("aria-expanded",!1)});let s=BeFunky.debounce(f,"ric");BeFunky.onLoad(s),window.addEventListener("resize",s),BeFunky.LanguageManager.addLanguageUpdateListener(g=>{g.includes("site")&&s()}),f(),BeFunky.measureSiteNavDropdowns=s;function l(g,m=!1){if(d===g&&!m)return;if(d&&d!==g&&(d.opener.setAttribute("aria-expanded",!1),d.content.addClass("focus-avoid"),d=g,t.removeClass("site-nav__dropdown-root--disable-transitions")),!d){d=g,t.addClass("site-nav__dropdown-root--disable-transitions"),l(g,!0),document.addEventListener("mouseover",p),document.addEventListener("touchstart",p);return}d=g;let _=Math.round(g.openerMidX-g.contentWidth/2+g.xOffset),y=Math.round(g.openerMidX+g.arrowOffset);i.setStyles({transform:`translateX(${y}px)`}),o.setStyles({transform:`translateX(${_}px)`,width:`${g.contentWidth}px`,height:`${g.contentHeight}px`}),n.setStyles({transform:`translateX(${_}px)`,width:`${g.contentWidth}px`,height:`${g.contentHeight}px`}),c.forEach(({index:h,section:k})=>{let v;h<g.index?v="left":h===g.index?v="active":v="right",k.setClass(`site-nav__dropdown-section site-nav__dropdown-section--${v}`)}),g.opener.setAttribute("aria-expanded",!0),t.removeClass("site-nav__dropdown-root--inactive"),g.content.removeClass("focus-avoid")}function u(){!d||(d.opener.setAttribute("aria-expanded",!1),d.content.addClass("focus-avoid"),d=!1,t.addClass("site-nav__dropdown-root--inactive"),document.removeEventListener("mouseover",p),document.removeEventListener("touchstart",p))}function p(g){r.includes(g.target)||t.contains(g.target)||!e.contains(g.target)&&!window.isAppOpen||g.type==="mouseover"&&d&&d.content.contains(document.activeElement)||u()}function f(){window.isAppOpen||window.webgl_is_supported&&BeFunky.isCreateRoute()||(t.setStyles({transform:"none",transition:"none"}),window.requestAnimationFrame(()=>{c.forEach(g=>{let m=window.innerWidth,_=g.content.getBoundingClientRect(),y=g.opener.getBoundingClientRect(),h=y.left+y.width/2,k=h-_.width/2,v=h+_.width/2,F=m-v,T=48,L=0;k<T?F>T*2?L=T-k:L=(m-_.width)/2-k:F<T&&(L=F-T),Object.assign(g,{contentWidth:_.width,contentHeight:_.height,openerMidX:h,xOffset:L})}),t.setStyles({transform:"",transition:""}),d&&l(d,!0)}))}}function iu(){let e=document.querySelector(".site-nav__popup-root"),t=document.querySelector(".site-nav__hamburger"),n=document.querySelector(".site-nav__popup-close"),o=document.querySelectorAll(".site-nav__popup-accordion"),i=document.getElementById("site_root");t.addEventListener("click",s=>{s.stopPropagation(),a()}),n.addEventListener("click",c),e.addEventListener("click",s=>s.stopPropagation()),[...o].forEach(s=>{s.addEventListener("click",()=>d(s))});let r=!1;function a(){r||(r=!0,e.addClass("site-nav__popup-root--active"),i.addClass("site-root--site-nav-popup-active"),document.addEventListener("click",c))}function c(){!r||(r=!1,e.removeClass("site-nav__popup-root--active"),i.removeClass("site-root--site-nav-popup-active"),document.removeEventListener("click",c))}function d(s){let l="site-nav__popup-accordion--open",u=s.hasClass(l);o.removeClass(l),u||s.addClass(l)}}function ru(){[document.querySelector(".site-nav__dropdown-link--sign-out"),document.querySelector(".site-nav__popup-button--sign-out")].forEach(t=>{let n=window.location.href,o=["/myphotos","/my-account"];n.endsWith("/")&&o.every(i=>!n.includes(i))&&(t.href+=`?next=${encodeURIComponent(n)}`)})}function au(){let e=BeFunky.isCreateRoute(),t=window.innerWidth<768;e||t?setTimeout(n,2e3):n();function n(){[...document.querySelectorAll(".site-nav__dropdown-image")].forEach(o=>window.loadLazyImage(o))}}BeFunky.updateSiteNavForUser=function({username:e,email:t,isPlus:n}={}){let o=document.getElementById("site_nav");if(!o)return;if(!t){o.addClass("site-nav--not-signed-in").removeClass("site-nav--signed-in").removeClass("site-nav--user-is-plus");return}let i=document.querySelector(".site-nav__user-circle"),r=[...document.querySelectorAll(".site-nav__user-email")],a=r.map(c=>c.parentElement);i.textContent=(e||t).slice(0,1).toUpperCase(),a.forEach(c=>{c.title=t}),r[0].textContent=BeFunky.truncateEmail(t,21),r[1].textContent=BeFunky.truncateEmail(t,27),o.removeClass("site-nav--not-signed-in").addClass("site-nav--signed-in").toggleClass("site-nav--user-is-plus",n),window.innerWidth>767&&BeFunky.measureSiteNavDropdowns()};var Qa=document.getElementById("site_root");Qa&&(nu(),ou(),iu(),ru(),au(),window.onUserStatusChange(e=>{if(!e.email)return BeFunky.updateSiteNavForUser();let{user_name:t,email:n,pl:o}=e;BeFunky.updateSiteNavForUser({username:t,email:n,isPlus:o==="1"})}),Gi(e=>{Qa.querySelector(".site-nav__upgrade-button").setLang(e?"start_free_trial":"upgrade","site")}));function su(){let e=BeFunky.isDashboard()?t():[...document.querySelectorAll(".site-footer__language-choice a")];n(),BeFunky.LanguageManager.addLanguageUpdateListener(o=>{o.includes("site")&&n()}),e.forEach(o=>{o.addEventListener("click",i=>{i.preventDefault();let r=o.getAttribute("data-choose-lang");if(!BeFunky.LanguageManager.appLanguages.includes(r))return BeFunky.throwError("Language link missing valid language ID",r);let a=o.href.split("?")[0].split("#")[0],c=window.location.href.split("?")[0].split("#")[0],d=a!==c,s=!1;if(BeFunky.updateLanguage(r).then(()=>{d&&l()}),d){BeFunky.showLoadScreen();let u=1500;setTimeout(()=>{BeFunky.throwError(`Language change timed out after ${u}ms`),setTimeout(l,50)},u)}BeFunky.LanguageManager.setLanguage(r,["app","site"]);function l(){s||(s=!0,window.location.href=o.href)}})});function t(){let o=document.querySelector(".site-footer__language-choice");for(;o.firstElementChild&&o.firstElementChild.nodeName==="A";)o.removeChild(o.firstElementChild);let i=BeFunky.LanguageManager.getLanguageNames().map(({id:r,name:a})=>{let c=document.createElement("a");return c.textContent=a,c.setAttribute("data-choose-lang",r),c.href=BeFunky.getDashboardUrlInLanguage(r),c});return i.forEach(r=>o.appendChild(r)),i}function n(){let o=e.find(i=>i.getAttribute("data-choose-lang")===BeFunky.LanguageManager.language.site);o&&(document.querySelector(".site-footer__current-language").textContent=o.textContent)}[...document.querySelectorAll("#get_started_modal a")].forEach(o=>{o.addEventListener("click",()=>BeFunky.closeModal("get_started_modal"))})}document.getElementById("site_root")&&requestIdleCallback(()=>su());var{html:Xi,lang:lu,icon:cu,defineCustomElement:uu,ifDefined:du,useEffect:pu,useLanguageUpdate:gu}=BeFunky.lit,rn=mu();uu("panel-header",fu,{observedAttributes:["lang-id","modifier","clue-id","buttons"]});function fu({langId:e,modifier:t,buttons:n="",isPlus:o=!1,clueId:i,buttonPosition:r={},_priorButtons:a={}}){let c=this;c.toggleButtons||(this.classList.add("panel-header",`panel-header--${t}`),Object.defineProperty(c,"toggleButtons",{get(){return(v,F)=>{c.buttons=hu(c.buttons,v,F)}}})),gu("app");let{left:d,right1:s,right2:l}=h(n);return pu(()=>{c._priorButtons={left:d,right1:s,right2:l}},[n]),u();function u(){return Xi`
            ${d?p("left",d):""}
            <h3 class=${k("panel-header__text",[t,m()])}>
                <string>${lu(e||"")}</string>
                ${o&&!BeFunky.isPlus()?Xi`<span class="panel-header__plus-badge badge badge--plus hide-if-premium"></span>`:""}
            </h3>
            ${p("right1",s)}
            ${p("right2",l)}
        `}function p(v,F){let T=[k("button",["icon","sm",v==="left"?"grey-200":"transparent"]),k("panel-header__button",[F?"":"hidden",t,F,v,_(v,!F)]),F?"":"focus-avoid"].join(" "),L=F?"":a[v];return Xi`
            <button @click=${y} .buttonData=${rn[F]} class=${T} data-tooltip=${du(g(F))}>${f(v,F||L)}</button>`}function f(v,F){if(!F)return"";let T=rn[F].icon,L=rn[F].iconSize;return cu(T,`icon ${L!=="default"?"icon--18 ":""}icon--${F}`,{style:v==="right2"?"backface-visibility: hidden;":""})}function g(v){if(!!v)return rn[v].tooltip}function m(){return s&&l?"":s||l?"wider-1x":"wider-2x"}function _(v,F){if(v==="left")return"";if(v==="right2"&&F)return"move-1x";if(v==="right1"&&F)return l?"move-1x":"move-2x";if(v==="right1"&&!l)return"move-1x"}function y(v){let{event:F,eventBubbles:T=!1}=v.target.buttonData;c.dispatchEvent(new Event(F,{bubbles:T})),F==="HELP"&&i&&BFN.HelpClueManager.toggle(i)}function h(v){let F={left:"",right1:"",right2:""},T;return window.BFN&&(T=BFN.cluesToHideOnTablet.find(L=>L===i)),v.split(",").map(L=>L.trim()).filter(L=>T&&L==="help"&&BeFunky.isTablet||(L==="batch_add"||L==="batch_remove")&&(BeFunky.isChromeOnIOS||BeFunky.isAppleAppStoreApp)?!1:L).forEach(L=>{let E=rn[L];if(E){let I=r[L]||E.position;F[I]=L}}),F}function k(v,F=[]){return[v,...F.filter(Boolean).map(T=>`${v}--${T}`)].join(" ")}}function hu(e="",t,n=!0){let o=e.split(",").map(c=>c.trim()).filter(Boolean),i=[],r=[];return Object.entries(t).forEach(([c,d])=>{rn[c]||BeFunky.logError(`Invalid button: ${c}`),d?i.push(c):r.push(c)}),(n?[...o,...i]:[...i,...o]).filter(c=>!r.includes(c)).unique().join(",")}function mu(){return{help:{icon:"info-icon",event:"HELP",position:"right1"},close:{icon:"cancel-icon",iconSize:"default",event:"CLOSE",eventBubbles:!0,position:"right2"},select:{icon:"select-all-icon",tooltip:"select_all",event:"SELECT",position:"right1"},deselect:{icon:"deselect-all-icon",tooltip:"deselect_all",event:"DESELECT",position:"right2"},batch_add:{icon:"batch-processing-icon",tooltip:"batch_tool_add",event:"BATCH",position:"right1"},batch_remove:{icon:"batch-processing-selected-icon",tooltip:"batch_tool_remove",event:"BATCH",position:"right1"},back:{icon:"arrow-icon",iconSize:"default",event:"BACK",position:"left"},view_all:{icon:"pop-out-icon",iconSize:"default",tooltip:"view_all",event:"VIEW_ALL",position:"right2"}}}var es=fn(Za());BeFunky.autocomplete=(e,{inputElement:t,options:n,minValueLength:o=2,allowEmpty:i=!1,generateItem:r,onSelect:a=()=>{}})=>function(){this.setClass("autocomplete scrollable-content"),t.hasAutocomplete=!0;let c=n.slice().filter(s=>typeof s.label=="string"&&s.label.length);this.init=function(){this.currentValue="",this._currentOption=void 0,this.noResultsText="No results",this.ignoreNextTextUpdate=!1,t.setAttribute("autocomplete","off"),c.forEach(f=>{f.element=this.createItem(f)});let s={shouldSort:!0,includeScore:!0,includeMatches:!0,threshold:.2,location:0,distance:100,maxPatternLength:32,minMatchCharLength:o,keys:["label"]};this.fuse=new es.default(n,s);let l=25,u=BeFunky.debounce(this.handleTextUpdate.bind(this),l);t.addEventListener("change",u),t.addEventListener("keyup",u),t.addEventListener("focus",this.handleTextUpdate.bind(this)),t.addEventListener("blur",f=>{let g=f.relatedTarget||f.explicitOriginalTarget;if(g!==void 0||!BeFunky.isSafari){this.contains(g)||(this.hide(),this.ignoreNextTextUpdate=!0,setTimeout(()=>{this.ignoreNextTextUpdate=!1},500));return}setTimeout(()=>{BeFunky.waitUntil({condition:()=>!this.isHovered,onTimeout:()=>{},onSuccess:()=>{document.activeElement!==t&&!this.contains(document.activeElement)&&this.hide()},interval:200,maxAttempts:15})},200)});let p={callback:d,condition:f=>f.hasClass("autocomplete__item")||f.hasAutocomplete};BeFunky.addArrowKeyHandler(p),t.addEventListener("keydown",f=>{f.key!=="Enter"||f.keyCode!==13||(this.handleTextUpdate(),!(this.currentValue.length<o)&&this.currentOption&&(f.preventDefault(),this.selectOption(this.currentOption)))}),this.addEventListener("click",f=>{let g=f.target;!g||!g.hasClass("autocomplete__item")||this.selectOption(g.option)}),this.addEventListener("focusout",f=>{let g=f.relatedTarget||f.explicitOriginalTarget||document.activeElement;(!g||g!==t&&!this.contains(g))&&this.hide()}),this.isHovered=!1,this.addEventListener("mouseenter",()=>{this.isHovered=!0}),this.addEventListener("mouseleave",()=>{this.isHovered=!1})},this.show=function(){this.addClass("autocomplete--active"),this.style.setProperty("--scrollable-content-width",`${this.getBoundingClientRect().width-16}px`)},this.hide=function(){this.removeClass("autocomplete--active")},this.updateOptions=function(){let s=this.currentValue.length;if(s<o&&!(s===0&&i))return this.hide();let l=s?this.fuse.search(this.currentValue).filter(({score:p})=>p<.5):[];if(r&&(!l.length||l[0].score>0)){let p=this.createItemFromUserInput();p&&(p.index===-1?l.push(p):l.splice(p.index,0,p))}let u=document.createDocumentFragment();if(l.length)l.forEach(({item:p,matches:f,isGenerated:g})=>{if(!g){let m=0,_=p.label;f[0]&&f[0].indices.forEach(([y,h])=>{_=`${_.slice(0,m+y)}<span>${p.label.slice(y,h+1)}</span>${p.label.slice(h+1)}`,m+=13}),p.element.innerHTML=_}u.appendChild(p.element)}),this.currentOption=l[0].item;else{let p=this.createItem({label:this.noResultsText});p.addClass("autocomplete__item--no-results"),u.appendChild(p),this.currentOption=void 0}for(;this.firstElementChild;)this.removeChild(this.firstElementChild);this.appendChild(u),this.show()},this.createItemFromUserInput=function(){let{html:s,index:l}=r(this.currentValue)||{};if(!s)return;let u={label:this.currentValue};return u.element=this.createItem(u),u.element.innerHTML=s,{isGenerated:!0,index:l,item:{label:this.currentValue,element:u.element}}},this.createItem=function(s){let l=document.createElement("button");return l.className="button button--transparent button--fullwidth button--left-align autocomplete__item",l.type="button",l.option=Object.assign({},s),l.textContent=s.label,l.addEventListener("focus",()=>{this.currentOption=s}),l},this.selectOption=function(s){let l=s.label;l!==this.noResultsText&&(this.hide(),this.ignoreNextTextUpdate=!0,setTimeout(()=>{this.ignoreNextTextUpdate=!1},500),t.value=l,a(s))},this.handleTextUpdate=function(){if(this.ignoreNextTextUpdate){this.ignoreNextTextUpdate=!1;return}let s=t.value.trim();if(s===this.currentValue)return document.activeElement!==t?void 0:s.length>=o?this.show():!s.length&&i?this.show():void 0;this.currentValue=s,this.updateOptions()};function d(s,l,u){if(l==="left"||l==="right")return!0;if(u.type==="keydown")return;if(s.hasClass("autocomplete__item")){let g=l==="up"?s.previousElementSibling:s.nextElementSibling;if(g)g.focus();else if(l==="up"){let m=s.parentElement.previousElementSibling;m&&m.nodeName==="INPUT"&&m.focus()}return}if(l!=="down")return;let f=s.nextElementSibling.children;f.length>=2&&f[1].focus()}Object.defineProperty(this,"currentOption",{set(s){if(this._currentOption!==s){if(this._currentOption&&this._currentOption.element.removeClass("button--selected"),!s){this._currentOption=void 0;return}if(!s.element||typeof s.label!="string")throw"Invalid currentOption";this._currentOption=s,this._currentOption.element.addClass("button--selected")}},get(){return this._currentOption}}),this.init()}.bind(e)();var{html:yu,useState:_u,defineCustomElement:ku,lang:wu}=BeFunky.lit;ku("textarea-counter",bu,{observedAttributes:["maxlength","placeholder"]});function bu({maxlength:e="500",placeholder:t=""}){let[n,o]=_u(0),i=parseInt(e)||500;return this.hasOwnProperty("value")||Object.defineProperty(this,"value",{get(){let c=this.querySelector("textarea");return c===null?"":c.value},set(){}}),r();function r(){let c=BeFunky.debounce(a,100),d=n>=i,s=Math.max(3,Math.min(Math.round(i/30),6));return yu`
        <div class=${`text-area ${d?"text-area--at-limit":""}`}>
            <textarea
                class="textarea focus-initially"
                rows=${s}
                maxlength=${i}
                placeholder=${wu(t,"app",!0)}
                @change=${c}
                @keyup=${c}
                @blur=${c}></textarea>
            <p class="text-sm text-area__char-count">
                ${`${n} / ${i}`}
            </p>
        </div>
        `}function a(c){o(c.target.value.length)}}BeFunky.contextMenu=(e,t,{hideOnClick:n=!0,onHide:o,offset:i,targetEvents:r=["click",BeFunky.pointerup],hoverOffEventTarget:a}={})=>function(){this.setAttribute("class","context-menu context-menu--hidden"),this.setStyles({visibility:"hidden"}),this.offsetX=parseInt(i&&i.x)||0,this.offsetY=parseInt(i&&i.y)||0,this.hoverOffEventTarget=a||BFN.appContainer;let c=(s,l,{onClick:u,hasDivider:p,children:f,translate:g=!0,shortcutText:m},_=!1)=>{BeFunky.isMobile&&(m=void 0);let y="button button--transparent button--fullwidth context-menu__item";p&&(y+=" context-menu__item--has-divider"),m&&(y+=" context-menu__item--has-shortcut"),f&&(y+=" button--has-icon context-menu__item--has-children"),_&&(y+=" context-menu__item--is-child");let h=document.createElement("div");h.className=y;let k=document.createElement("string");if(g?k.setLang(l):k.innerHTML=l,h.appendChild(k),m&&h.appendChild(BFN.shortcutString(m)),h.contextMenuItemName=l,h.addEventListener("click",v=>{v.stopPropagation(),typeof u=="function"&&!h.hasAttribute("disabled")&&(u(v),n&&this.hide())}),f){h.insertAdjacentHTML("beforeend",`<svg class="icon icon--chevron-right">
                    <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#chevron-icon"></use>
                </svg>
            `);let v=Object.keys(f);h.contextMenuItemChildren=v;let F=document.createElement("div").addClass("context-menu__children");h.appendChild(F),v.forEach(T=>c(F,T,f[T],!0))}s.appendChild(h)},d=document.createDocumentFragment();Object.keys(t).forEach(s=>c(d,s,t[s])),this.appendChild(d),this.init=function(){this.initDefaultValues()},this.initDefaultValues=function(){this.enabled=!0,this.visible=!1,this.lastShownTime=0,this.displayAbove=!1,this.getItems(),this.target=this._target=null,this.oncontextmenu=()=>!1,this.addEventListener(BeFunky.pointerdown,s=>s.stopPropagation())},this.getItems=function(){this.items={},[...this.children].forEach(s=>{if(this.items[s.contextMenuItemName]=s,s.contextMenuItemChildren){let{children:l}=s.lastElementChild;s.contextMenuItemChildren.forEach((u,p)=>{if(this.items[u])throw`Duplicate context menu item name: ${u}`;this.items[u]=l[p]})}})},this.show=(s,l)=>{this.visible=!0;let u=this.getBoundingClientRect(),p=Math.round(s+u.width),f=Math.round(l+u.height),g=window.innerWidth,m=window.innerHeight;p>g&&(s-=u.width),f>m&&(l-=u.height),s=Math.round(s),l=Math.round(l),this.setStyles({transform:`translateX(${s}px) translateY(${l}px)`,visibility:""}),this.removeClass("context-menu--hidden"),this.addEventListener(BeFunky.pointerover,this.stopPropagation),this.hoverOffEventTarget.addEventListener(BeFunky.pointerover,this.hide),document.addEventListener("keydown",this.hideOnKeyDown),BeFunky.wait(["raf","raf"],()=>{this.visible&&this.addEventListener("click",this.hide)}),this.dispatchEvent(new Event("SHOW")),[...this.querySelectorAll(".context-menu__children")].forEach(_=>{let y=_.getBoundingClientRect(),h=Math.round(y.left+y.width),k=Math.round(y.top+y.height);h>g&&_.addClass("context-menu__children--left-side"),k>m&&_.setStyles({transform:`translateY(${m-k}px)`})}),this.lastShownTime=Date.now()},this.hide=s=>{!this.visible||(this.visible=!1,typeof o=="function"&&o(s,Date.now()-this.lastShownTime),this.addClass("context-menu--hidden"),[...this.querySelectorAll(".context-menu__children")].forEach(l=>{l.removeClass("context-menu__children--left-side"),l.setStyles({transform:""})}),this.removeEventListener(BeFunky.pointerover,this.stopPropagation),this.hoverOffEventTarget.removeEventListener(BeFunky.pointerover,this.hide),document.removeEventListener("keydown",this.hideOnKeyDown),this.removeEventListener("click",this.hide),this.dispatchEvent(new Event("HIDE")),BeFunky.wait([150,"raf"],()=>{this.visible||this.setStyles({visibility:"hidden"})}))},this.hideOnKeyDown=s=>{[16,17,91,93].includes(s.keyCode)||this.hide()},this.showButton=s=>{this.items[s].removeClass("context-menu__item--hidden")},this.hideButton=s=>{this.items[s].addClass("context-menu__item--hidden")},this.toggleButton=(s,l)=>{l?this.showButton(s):this.hideButton(s)},this.updateChildren=(s,l)=>{let u=this.items[s];if(!u)throw`Invalid context menu item name: ${s}`;if(!u.contextMenuItemChildren)throw`Context menu item ${s} does not support children`;let p=u.lastElementChild,f=Object.keys(l);p.innerHTML="",p.contextMenuItemChildren=f,f.forEach(g=>c(p,g,l[g])),this.getItems()},this.handleTargetClick=BeFunky.debounce(s=>{this.enabled&&this.displayAbove&&this.show(s.pageX+this.offsetX,s.pageY-window.scrollY-(this.offsetHeight-this.offsetY)),this.enabled&&this.show(s.pageX+this.offsetX,s.pageY-window.scrollY+this.offsetY)},0),this.stopPropagation=s=>s.stopPropagation(),Object.defineProperty(this,"target",{set(s){if(this.target!==s){if(!(s instanceof HTMLElement)){BeFunky.logError("Context menu target must be HTML Element");return}this._target&&r.forEach(l=>{this._target.removeEventListener(l,this.handleTargetClick)}),this._target=s,r.forEach(l=>{this._target.addEventListener(l,this.handleTargetClick)})}},get(){return this._target}}),this.init()}.bind(e)();var{html:ct,useLanguageUpdate:Fu,lang:xo,defineCustomElement:vu,useState:ts,useEffect:Bu}=BeFunky.lit;vu("plus-pricing",Su,{observedAttributes:["context"]});function Su({context:e="site"}){let[t,n]=ts(null),[o,i]=ts(ht());Bu(()=>{this.addClass("plus-pricing"),Pn().then(u=>{n(u)}),Sn(i)},[]),Fu(e);let r=t?l():0,a=!BeFunky.isAppleAppStoreApp;return c();function c(){return ct`
        <label class=${`plus-pricing__card ${o==="year"?"plus-pricing__card--selected":""}`} tabindex="0">
            <input type="radio" name="plan" value="yearly" .checked=${o==="year"} @change=${()=>Bn("year")}>
            ${t?s(t.year,a):d()}
            <span class="plus-pricing__description">${a?xo(["billed_annually_at",{price:t?`<strong>${Ye(t.year,BeFunky.LanguageManager.language[e])}</strong>`:"..."}],e):xo("billed_annually")}</span>
            ${r>0?ct`<span class="plus-pricing__most-popular">${xo(["save_percent",{percent:r.toString()}],e)}</span>`:""}
        </label>
        <label class=${`plus-pricing__card ${o==="month"?"plus-pricing__card--selected":""}`} tabindex="0">
            <input type="radio" name="plan" value="monthly" .checked=${o==="month"} @change=${()=>Bn("month")}>
            ${t?s(t.month):d()}
            <span class="plus-pricing__description">${xo("billed_monthly",e)}</span>
        </label>`}function d(){return ct`<div class="plus-pricing__price"><div class="loading-spinner"></div></div>`}function s(u,p=!1){switch(p&&u.recurring==="year"&&(u=g(u)),u.currency){case"usd":{let[_,y]=f();return m("$",_,y)}case"gbp":{let[_,y]=f();return m("\xA3",_,y)}case"eur":{let[_,y]=f();return m("\u20AC",_,y)}case"mxn":{let[_,y]=f();return m("$",_,y!=="00"?y:"","MXN")}case"isk":case"nok":{let[_,y]=f();return ct`
                <div class="plus-pricing__price">
                    <span class="plus-pricing__currency">Kr. </span>
                    <span class="plus-pricing__large-amount">${_}</span>
                    <span class="plus-pricing__small-amount"><sup style="text-decoration: underline">${y}</sup></span>
                </div>
                `}case"cad":{let[_,y]=f();return m("$",_,y,"CAD")}case"aud":{let[_,y]=f();return m("A$",_,y)}default:if(u.unit_amount)BeFunky.throwError(`Unhandled currency: ${u.currency}`);else{let _=Ye(u,BeFunky.LanguageManager.language[e]),y=_.split(/\d/),h=y[0],k=y[y.length-1],v=_.slice(h.length);v=v.slice(0,v.length-k.length);let F=v.match(/^(.+)([.,])(\d\d)$/);if(F){let[,T,L,E]=F;return m(h,T,E,k,L)}return ct`
                    <div class="plus-pricing__price">
                        ${h?ct`<span class="plus-pricing__currency">${h}</span>`:""}
                        <span class="plus-pricing__large-amount">${v}</span>
                        ${k?ct`<span class="plus-pricing__currency" style="margin: 0 0 0 4px">${k}</span>`:""}
                    </div>
                    `}}function f(){return u.unit_amount?(u.unit_amount/100).toFixed(2).split("."):parseFloat(u.value).toFixed(2).split(".")}function g(){return u.unit_amount?Object.assign({},u,{unit_amount:parseInt(u.unit_amount)/12}):Object.assign({},u,{value:(parseFloat(u.value)/12).toString()})}function m(_,y,h,k,v="."){return ct`
            <div class="plus-pricing__price">
                <span class="plus-pricing__currency">${_}</span>
                <span class="plus-pricing__large-amount">${y}</span>
                ${h?ct`<span class="plus-pricing__small-amount">${v}${h}</span>`:""}
                ${k?ct`<span class="plus-pricing__currency" style="margin: 0 0 0 4px">${k}</span>`:""}
            </div>
            `}}function l(){if(t.month.unit_amount){let p=t.month.unit_amount*12;return Math.floor(100*(p-t.year.unit_amount)/p)}let u=parseFloat(t.month.value)*12;return Math.floor(100*(u-parseFloat(t.year.value))/u)}}function An(e){let t=!1;BeFunky.showLoadScreen({onCancel:()=>{t=!0,BeFunky.throwError("User cancelled load screen while waiting on Stripe JS")}}),delete window.stripe_load_error,console.log("Loading Stripe JS..."),window.loadAndInitStripe(),BeFunky.waitUntil({condition:()=>window.stripe||window.stripe_load_error||t,onSuccess:()=>{if(!t){if(BeFunky.hideLoadScreen(),window.stripe)return e();n()}},onTimeout:()=>{t||(BeFunky.hideLoadScreen(),n())},interval:200,maxAttempts:25});function n(){if(BeFunky.throwError("Failed to load or initialize Stripe"),t)return;let o=BeFunky.isOnline()?["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}]:"user_offline",i=BeFunky.isOnline()?`${BeFunky.Params.globalImagesPath}illustrations/paper-refresh.svg`:`${BeFunky.Params.globalImagesPath}illustrations/warning.svg`;BeFunky.acknowledge(o,{imageUrl:i})}}var{html:Oe,elem:$o,icon:Ki,useLanguageUpdate:Pu,modalLang:Ge,defineCustomElement:Lu,useState:St,useEffect:Ji}=BeFunky.lit,ns=(...e)=>BeFunky.logFeature("payment",...e),Tn={},mt={number:$o`<div id="payment_modal_card_number" class="form-field__input payment-modal__card-number"><span>${Ge("loading")}</span></div>`,expiry:$o`<div id="payment_modal_card_expiry" class="form-field__input payment-modal__card-expiry"></div>`,cvc:$o`<div id="payment_modal_card_cvc" class="form-field__input payment-modal__card-cvc"></div>`,wallet:$o`<div></div>`},ze={number:null,expiry:null,cvc:null,wallet:null},Ne={};function Cu({mode:e,email:t,initialPromoCode:n,onPaymentSubmit:o}){if(!["charge","update","update_from_payflow","free_trial"].includes(e))throw new Error(`Invalid payment form mode: ${e}`);let i=this,[r,a]=St(ht()),[c,d]=St(),[s,l]=St(typeof window.stripe=="object"),[u,p]=St({}),[f,g]=St(""),[m,_]=St(n),[y,h]=St(!1),[k,v]=St(!1);Object.assign(Ne,{displayError:Se,clearError:me,getSharedSubmitData:pe,onPaymentSubmit:o,prices:c,recurring:r,setCardType:g,setWalletAvailable:v}),ns("Render",{recurring:r,prices:c,isStripeLoaded:s,errors:u,cardType:f,promoCode:m,isValidatingPromo:y,isWalletAvailable:k});let F=["update","update_from_payflow"].includes(e),T=k&&!F,L=e==="charge"&&typeof n=="string",E=L&&Tn[m]===!0,I=E||e==="free_trial";return Ji(()=>{Pn().then(B=>{d(B)}),Sn(a)},[]),Ji(()=>{if(!s)An(()=>l(!0));else if(s&&c){let B=Eu();Au(B),BeFunky.Params.isBeta&&Tu(B)}},[s,c]),Ji(()=>{L&&n?C(n):L||_()},[n]),Pu("modal"),M();function M(){return Oe`
        ${j()}
        ${F?"":Oe`<plus-pricing context="modal"></plus-pricing>`}
        <div class="centered-modal__column">
            <form id="payment_modal_form" @submit=${Be}>
                ${Y()}
                ${Q()}
                ${ne()}
                ${Z()}
                ${L?de():""}
                ${F?"":re()}
                ${he()}
            </form>
            <p class="payment-modal__footer">
                ${Ki("lock-icon","icon",{style:"margin-top: -4px;"})}
                <string>${Ge("payment_modal_digicert")}</string>
            </p>
        </div>
        `}function j(){return F?Oe`<h2 class="centered-modal__heading h3">${Ge("payment_modal_heading_update")}</h2>`:e==="free_trial"?Oe`
                <h2 class="centered-modal__heading h3">${Ge("payment_modal_heading_7_day_trial")}</h2>
                <p class="centered-modal__column centered-modal__subheading text-lg">${Ge("payment_modal_subheading_trial")}
            `:Oe`<h2 class="centered-modal__heading h3">${Ge("payment_modal_heading")}</h2>`}function Y(){return u.form?Oe`<div class="form-errors">
            <div class="form-errors__container">
                <p>${Ge(u.form)}</p>
            </div>
            <button @click=${()=>me("form")} class="button button--icon button--xs form-errors__close-button">
                ${Ki("cancel-icon","icon icon--14")}
            </button>
        </div>`:""}function Q(){return Oe`
        <div class="form-field payment-modal__wallet" style=${`display: ${T?"":"none"}`}>
            ${mt.wallet}
            <div class="payment-modal__wallet-divider">
                <hr>
                <span data-lang="or_pay_with_card"></span>
            </div>
        </div>`}function z(B){let P=u[B]?Ge(u[B]):"";return Oe`<p class="form-field__error">${P}</p>`}function ne(){let B=BeFunky.debounce(ue,100);return Oe`
        <div class="form-field">
            <label class="form-field__label" for="payment_modal_card_holder_name">${Ge("payment_modal_cc_name")}</label>
            <input
                type="text"
                name="cc-holdername"
                class=${`form-field__input ${u.name?"form-field__input--invalid":""}`}
                id="payment_modal_card_holder_name"
                data-bf="confirm-upgrade__cc-holdername"
                autocomplete="cc-name"
                @change=${B}
                @keyup=${B}
                @blur=${B}
            >
            ${z("name")}
        </div>`}function Z(){return["number","expiry","cvc"].forEach(B=>{u[B]&&mt[B].addClass("form-field__input--invalid")}),Oe`
        <div class="form-field">
            <label class="form-field__label" for="payment_modal_card_inputs">${Ge("payment_modal_cc_info")}</label>
            <fieldset class="form-field__fieldset" id="payment_modal_card_inputs">
                ${mt.number}
                ${z("number")}
                <div id="payment_modal_card_type" class="payment-modal__card-type">${f?Oe`<img alt=${f} src=${`${BeFunky.Params.globalAssetsPath}icons/credit-cards/cc-${f}.svg`} />`:""}</div>

                <div class="payment-modal__field-container">
                    ${mt.expiry}
                    ${z("expiry")}

                    ${mt.cvc}
                    ${z("cvc")}
                </div>
            </fieldset>
        </div>`}function de(){let B=BeFunky.debounce(Pe,100),P=y||E?"payment-modal__promo-button button button--md button--selected":"payment-modal__promo-button button button--md button--grey-outline";return Oe`
        <div class="form-field payment-modal__promo">
            <label class="form-field__label" for="payment_modal_promo_inputs">${Ge("promo_code")}</label>
            <fieldset class="form-field__fieldset" id="payment_modal_promo_inputs">
                <input
                    type="text"
                    name="promo-code"
                    class=${`form-field__input payment-modal__promo-input ${u.promo?"form-field__input--invalid":""}`}
                    id="payment_modal_promo"
                    value=${n}
                    @change=${B}
                    @keyup=${B}
                    @blur=${B}
                >
                ${z("promo")}

                <button @click=${Fe} type="button" id="payment_modal_apply_promo" class=${P} .disabled=${y||Boolean(u.promo)}>
                    <span>${Ge(E?"promo_applied":"apply_promo")}</span>
                    ${E?Ki("checkmark-icon","icon payment-modal__promo-checkmark"):""}
                    ${y?Oe`<span id="payment_modal_promo_spinner" class="loading-spinner payment-modal__promo-spinner"></span>`:""}
                </button>
            </fieldset>
        </div>`}function re(){if(!c)return"";let B=r==="month"?"billing_summary_monthly":"billing_summary_annual";I&&(B+="_trial");let P={amount:()=>`<strong>${Ye(c[r],BeFunky.LanguageManager.language.modal)}</strong>`,renewal_policy:BeFunky.toLinkHTML(`${BeFunky.Params.siteUrl}renewal-policy/`,!0)};return Oe`<p class="payment-modal__billing-summary">${Ge([B,P])}</p>`}function he(){let B="submit_payment";return I&&(B="start_free_trial"),F&&(B="update"),Oe`<button type="submit" class="button button--fullwidth button--xl button--blue" data-bf="confirm-upgrade__submit">${Ge(B)}</button>`}function ue(B){let P=B.target;ke(P)?me("name"):Se("name","error_blank_name")}function Pe(B){let P=B.target;we(P)?me("promo"):Se("promo","error_invalid_promo_code"),_(P.value)}function Fe(){let B=document.getElementById("payment_modal_promo").value.trim();C(B)}function Be(B){B.preventDefault(),u.form&&me("form");let P=document.getElementById("payment_modal_card_holder_name"),R=P.value.trim();if(u.name||!R){P.dispatchEvent(new Event("change"));return}!ze.number||o(Ve({cardHolderName:R,stripeElement:ze.number},pe()))}function pe(){return{email:t,mode:e,recurring:r,displayError:Se,clearInputs:Ee,promoCode:E?m:void 0}}function ke(B){let P=B.value.replace(/[\d@~`#$%^&*()\\/<>!¡™£¢∞§¶•ªº≠+=:;…¨"{}[\]|?]/g,"");return B.value!==P&&(B.value=P),P.length>=3}function we(B){let P=B.value.replace(/[^a-z0-9-]/g,"");return B.value!==P&&(B.value=P),P?P.length>=10&&Tn[P]!==!1:!0}function me(B){if(!u.hasOwnProperty(B))return;let P=Object.assign({},u);delete P[B],p(P)}function Se(B,P){let R=typeof P=="string"&&/^[a-z0-9_]+$/.test(P)?BeFunky.LanguageManager.getString(P,"modal"):P;["name","number","expiry","cvc","promo","form"].includes(B)||BeFunky.throwError(`Invalid field name: ${B}`),p(Object.assign({},u,{[B]:R})),P==="error_trial_found"&&(typeof i.initialPromoCode=="string"&&(i.initialPromoCode=void 0),i.mode==="free_trial"&&(i.mode="charge"),qt(!1,!1),BeFunky.removeLocal("user_trial")),console.log(`Payment error displayed ${B==="form"?"on form":`on ${B} field`}: "${R}"`)}function Ee(){document.getElementById("payment_modal_card_holder_name").value="",ze.number.clear(),ze.expiry.clear(),ze.cvc.clear()}function C(B){Tn.hasOwnProperty(B)||(h(!0),BeFunky.requestAPI("transaction/validate-promo-code",{promo_code:B}).then(({data:P})=>{if(P!=="success")throw"invalid_response";Tn[B]=!0}).catch(P=>{P==="invalid_promo_code"?(Tn[B]=!1,Se("promo","error_invalid_promo_code")):Se("promo",BeFunky.failureReason(P))}).then(()=>{h(!1)}))}}function Eu(){let e=["bg","cs","da","de","el","en","es","et","fi","fr","hu","id","it","ja","lt","lv","ms","mt","nb","nl","pl","pt","ro","ru","sk","sl","sv","tr","zh"],t=BeFunky.LanguageManager.language.modal,n=e.includes(t)?t:"auto";return window.stripe.elements({locale:n,fonts:[{cssSrc:"https://fonts.googleapis.com/css2?family=Mulish:wght@400&display=swap"}]})}function Au(e){let t={style:{base:{color:"#1D1B2F",fontWeight:400,fontFamily:"Mulish, Avenir Next, Trebuchet MS, system-ui, sans-serif",fontSize:"16px",fontSmoothing:"antialiased",lineHeight:"24px","::placeholder":{color:"#84809D"}},invalid:{color:"#1D1B2F"}},classes:{focus:"form-field__input--focused",invalid:"form-field__input--invalid"}};ze.number=e.create("cardNumber",t),ze.number.mount(mt.number),ze.number.on("change",({brand:n,error:o})=>{n&&Ne.setCardType(n==="unknown"?"":n),o?Ne.displayError("number",o.message):Ne.clearError("number")}),ze.expiry=e.create("cardExpiry",t),ze.expiry.mount(mt.expiry),ze.expiry.on("change",({error:n})=>{n?Ne.displayError("expiry",n.message):Ne.clearError("expiry")}),ze.cvc=e.create("cardCvc",t),ze.cvc.mount(mt.cvc),ze.cvc.on("change",({error:n})=>{n?Ne.displayError("cvc",n.message):Ne.clearError("cvc")})}function Tu(e){let t=window.stripe.paymentRequest(Yt(Ve({},o()),{country:lt(),requestPayerName:!0,requestPayerEmail:!0})),n=e.create("paymentRequestButton",{paymentRequest:t});t.canMakePayment().then(i=>{ns("canMakePayment",i),i?(Ne.setWalletAvailable(!0),n.mount(mt.wallet),t.on("paymentmethod",r=>{r&&r.paymentMethod&&Ne.onPaymentSubmit(Ve({paymentRequestPaymentMethod:r.paymentMethod,paymentRequestCompleteFunction:r.complete},Ne.getSharedSubmitData()))})):Ne.setWalletAvailable(!1)}),Sn(()=>{Promise.resolve().then(()=>{t.update(o())})});function o(){let i=Ne.prices[Ne.recurring],{unit_amount:r,currency:a}=i;return{currency:a,total:{label:Ne.recurring==="month"?"BeFunky Plus Monthly":"BeFunky Plus Annual",amount:r}}}}Lu("payment-form",Cu);var is=fn(os());window.getSystemInformation=(e=!1)=>{let t=(0,is.default)();if(delete t.ua,delete t.cpu,t.wbglts=window.webglTextureSize||-1,t.wbglcts=window.webglCombinedTextureUnits||-1,t.wbglumr=window.webglUnmaskedRenderer||-1,t.screen=window.screen?`${screen.width} x ${screen.height}`:"",t.viewport=`${window.innerWidth} x ${window.innerHeight}`,t.appType="HTML5",t.performance_issue=window.webGLPerformanceIssue||"Not checked",e){let n=o=>JSON.stringify(o).replace(/"([:,])"/g,"$1 ").replace(/"/g,"");return Object.entries(t).map(([o,i])=>`--${o.toUpperCase()}: ${n(i)}`).join(", ")}return t};var Mo=BeFunky.appContentInjected?Promise.resolve():void 0;function $n(){if(Mo)return Mo;return Mo=rs().catch(e),Mo;function e(){return BeFunky.retry("app HTML",4,rs)}}function rs(){return new Promise((e,t)=>{let n=`${BeFunky.Params.globalAssetsPath}html/bfn-app-min${BeFunky.Params.BFN_APP_HTML_VERSION}.txt`,o={responseType:"text"};BeFunky.request(n,o,({error:i,response:r})=>{if(i||!r||!r.length){BeFunky.logError("Unable to download app HTML txt file",n,i||BeFunky.stringValue(r)),t(i);return}BeFunky.Params.IS_LC&&(r=r.replace(/ src="\/images\//g,` src="${BeFunky.Params.globalImagesPath}`));let a=document.createElement("template");a.innerHTML=r,e(a)})})}BeFunky.html5app_created=!1;BeFunky.originalPageTitle=document.title;BeFunky.readyHtml5App=async()=>{if(BeFunky.html5app_created)return;let e=!1,t=BeFunky.once(()=>{BeFunky.isAppleAppStoreApp||BeFunky.showLoadScreen({visibilityDelay:0,beforeAllowCancelDelay:1500,onCancel:()=>{e=!0,BeFunky.leaveCreateRoute()}})});if(BeFunky.isAppleAppStoreApp&&(!BeFunky.iOSAppShortcut||BeFunky.iOSAppShortcut==="camera")&&BeFunky.openDashboardModal(),BeFunky.appContainer.addClass(`app-lang-${BeFunky.LanguageManager.language.app}`),BeFunky.appContentInjected){let{type:i}=window.currentDeepLinkParameters;if(i!=="collage"&&i!=="designer")BeFunky.cleanupEnterAppImmediately(),t(),document.getElementById("appViewport").addClass("show-drag-drop-area--initial"),document.getElementById("canvas_drag_drop_area").addClass("drag-drop-area--initial");else{let a=document.getElementById("app_loading_overlay");(!a||!a.offsetHeight)&&t()}}else{t();try{let i=await $n();if(e)return;let r=i.content;BeFunky.appContentInjected=!0,BeFunky.LanguageManager.renderLanguageStrings(r),BeFunky.appContainer.appendChild(r),BeFunky.cleanupEnterAppImmediately()}catch(i){return n(),BeFunky.throwError(`Failed to load & inject app HTML: ${i}`,i),o()}}try{if(await window.onScriptLoad("scripts"),await window.onScriptLoad("app"),e)return;if(!(window.PIXI&&window.BFN&&window.BFN.readyApp))throw console.log("typeof PIXI = ",typeof window.PIXI),console.log("typeof BFN = ",typeof window.BFN),window.BFN&&console.log("typeof BFN.readyApp = ",typeof window.BFN.readyApp),console.log("window.appBundleLoaded = ",window.appBundleLoaded),console.log("window.BfnmaxImageSize = ",window.BfnmaxImageSize),"Unexpected startup error";BFN.readyApp(()=>{BeFunky.html5app_created=!0})}catch(i){return n(),BeFunky.throwError(`Failed to load app/scripts JS: ${i}`,i),o()}function n(){navigator.connection&&console.log("Connection info:",["downlink","effectiveType","rtt"].map(r=>`	${r}: ${navigator.connection[r]}`).join("	"))}function o(){e||(BeFunky.hideLoadScreen(),BeFunky.acknowledge(["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}],{onAcknowledge:()=>window.location.reload(),imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-refresh.svg`}))}};window.isAppOpen=!1;var Ro=0;window.openApp=()=>{if(BeFunky.sessionRoutes.length===1&&BeFunky.isCreateRoute(BeFunky.sessionRoutes[0])?Ro=0:Ro=window.pageYOffset||0,window.isAppOpen){BeFunky.logError("openApp called unnecessarily b/c WebGL app is already open");return}if(window.isAppOpen=!0,BeFunky.moveModalRoot(BeFunky.appContainer),BeFunky.moveLoadScreen(BeFunky.appContainer),!BeFunky.isAppleAppStoreApp){let e=document.getElementById("site_root")||document.getElementById("wrapper");e.setStyles({display:"none"}),[...e.querySelectorAll('video, iframe[src^="https://player.vimeo.com"]')].forEach(t=>{t.nodeName==="VIDEO"?t.pause():t.contentWindow.postMessage(JSON.stringify({method:"pause"}),"*")})}document.body.addClass("prevent-body-scroll").addClass("app-is-open"),BeFunky.updateThemeColor("app"),BeFunky.LanguageManager.setLanguage(BeFunky.LanguageManager.language.app,["modal"]),BeFunky.appContainer.setStyles({display:""}).removeClass("bfn--hidden"),BeFunky.readyHtml5App()};BeFunky.cleanupEnterAppImmediately=()=>{let e=document.getElementById("app_loading_overlay");e&&(e.setStyles({display:"none"}),requestIdleCallback(()=>{e.parentElement&&e.parentElement.removeChild(e)}))};window.setApplicationMode=e=>{(!e||typeof e!="string")&&(e="photoeditor"),BeFunky.html5app_created&&BFN.AppModel.changeAppSection(e)};window.currentDeepLinkParameters={type:"photoeditor"};var xu=BeFunky.once(()=>{let{elem:e,html:t,lang:n,render:o}=BeFunky.lit,i=BeFunky.isIOS?"open_app_store":"open_play_store",r=BeFunky.isIOS?"https://itunes.apple.com/us/app/befunky-photo-editor/id442716817?mt=8":"https://play.google.com/store/apps/details?id=air.com.befunky.BeFunkyPhotoEditor",a="native_app_teaser_modal",c=`${BeFunky.Params.globalImagesPath}teasers/native-app-screenshots.png`,d=e`<div id="${a}" class="modal teaser-modal teaser-modal--image"></div>`,s=()=>t`
    <div class="teaser-modal__image">
        <div class="teaser-modal__fade-in-image" style=${`background-image: url(${c}); opacity: 1`}></div>
    </div>
    <div class="teaser-modal__col-right">
        <h2 class="h4">${n("native_app_prompt_heading")}</h2>
        <p id="teaser_modal_body">${n("native_app_prompt_body")}</p>
        <div class="teaser-modal__buttons">
            <button @click=${()=>BeFunky.closeModal(a)} class="button button--lg button--grey-300">${n("cancel")}</button>
            <button @click=${()=>{window.open(r,"_blank"),BeFunky.closeModal(a)}} class=${"button button--blue button--lg teaser-modal__button"}>${n(i)}</button>
        </div>
    </div>
    `,l=()=>o(s(),d);l(),BeFunky.LanguageManager.addLanguageUpdateListener(l),BeFunky.openModal(d,{onClose:()=>{BeFunky.LanguageManager.removeLanguageUpdateListener(l)},size:"large",destroyOnClose:!0,addCloseButton:!0})});window.openUploadPanel=(e,t=!1)=>{let{type:n="photoeditor",img:o,template:i,tag:r}=window.deepLinkRouteData[e]||e||{};if(window.failed_webgl_tests.length&&!window.has_acknowledged_webgl_issue&&window.webgl_is_supported){window.has_acknowledged_webgl_issue=!0;let l=window.failed_webgl_tests,u={failingTests:l,hasUsedAppBefore:Boolean(getCookie("gl_sprt")==="1"||BeFunky.getLocal("__IndexedDB_version"))};if(l.includes("no_high_perf_canvas")&&!BeFunky.isMobile){let p=`
                <p data-lang="acknowledge_perf_issue">${BeFunky.LanguageManager.getString("acknowledge_perf_issue")}</p>
                <p>${BeFunky.toLinkHTML(BeFunky.getArticleForPerfIssue(),!0)("learn_more","app")}</p>
            `;BeFunky.acknowledge(p,{isCritical:!0}),BeFunky.logWarning("User entered app without high perf canvas",window.webglUnmaskedRenderer,JSON.stringify(u))}else BeFunky.logWarning("User entered app after WebGL test(s) failed",JSON.stringify(u))}let a=!BeFunky.html5app_created&&BeFunky.Params.openurl?BeFunky.Params.openurl:o;if(window.currentDeepLinkParameters={type:n,template:i,tag:r,img:a},window.webgl_is_supported){BeFunky.setupPaywallOnce(),BeFunky.shouldInstallNativeApp&&xu(),t||window.openApp(),window.applyDeepLinkParameters();return}let{message:c,link:d,linkText:s="learn_more"}=BeFunky.webGLTestResultsTemplate(window.failed_webgl_tests,!1);BeFunky.confirm(c,{confirmText:s,onConfirm:()=>window.open(d,"_blank")}),BeFunky.leaveCreateRoute(),window.failed_webgl_tests.length||BeFunky.throwError("failed_webgl_tests inaccurate")};BeFunky.getArticleForPerfIssue=()=>BeFunky.isChromium?BeFunky.isOpera?"https://support.befunky.com/hc/en-us/articles/360045634352#h_opera":BeFunky.isEdge?"https://support.befunky.com/hc/en-us/articles/360054839372":"https://support.befunky.com/hc/en-us/articles/360054508232":BeFunky.isFirefox?"https://support.befunky.com/hc/en-us/articles/360054510672":BeFunky.isSafari?"https://support.befunky.com/hc/en-us/articles/360045634352#h_safari":"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-browser-is-unable-to-run-befunky";BeFunky.setupPaywallOnce=BeFunky.once(()=>{if(!BeFunky.isNewUserEligibleForFreeTrial||![["/features/photo-to-art/","/create/photo-to-art/"],["/features/photo-to-cartoon/","/create/photo-to-cartoon/"],["/features/background-remover/","/create/background-remover/"],["/features/digital-art/","/create/digital-art/"],["/features/photo-enhancer/","/create/photo-enhancer/"],["/features/graphic-designer/","/create/designer/"],["/features/card-maker/","/create/card-maker/"],["/features/brochure-maker/","/create/brochure-maker/"],["/features/poster-maker/","/create/poster-maker/"],["/features/banner-maker/","/create/banner-maker/"]].some(i=>BeFunky.sessionRoutes.map(n).isIdenticalTo(i)))return;Ln(lt(),!0),bf_eventTrack("ONBOARDING_7DAY_TRIAL_SAVE","TRIAL OFFERED",o(BeFunky.initialRoute));function n(i){return i.split(/[?#]/)[0]}function o(i){return i.split(/[?#]/)[0].split("/").filter(Boolean).pop()}});BeFunky.leaveCreateRoute=()=>{setTimeout(()=>{BeFunky.isCreateRoute()&&(BeFunky.sessionRoutes.length>1?window.history.back():ve(Fn)),BeFunky.updateThemeColor("site"),BeFunky.measureSiteNavDropdowns&&BeFunky.measureSiteNavDropdowns(),BeFunky.appContainer.style.display!=="none"&&!BeFunky.appContainer.hasClass("bfn--hidden")&&window.hideEditor()},0)};BeFunky.trackDeepLink=function(e,t){if(typeof e!="string")return BeFunky.throwError(`Invalid action: ${BeFunky.getType(e)}`,e);if(!t){let n=[...BeFunky.sessionRoutes].reverse().find(o=>!BeFunky.isCreateRoute(o));if(!n){console.log("Session routes:",JSON.stringify(BeFunky.sessionRoutes)),BeFunky.throwError("Unable to find non-create route to track Deep Link button click");return}n==="/"?t="HOME":t=n.split("?")[0].split("#")[0].replace(/(^\/)|(\/$)/g,"").replace(/\//g,"_").toUpperCase()}window.bf_eventTrack("EXTERNAL",e,t)};window.hideEditor=(e=!0)=>{if(BeFunky.appContainer.addClass("bfn--hidden"),window.UIToggler&&BeFunky.html5app_created&&UIToggler.cancelActiveEditorTool(),BeFunky.moveModalRoot(document.body),BeFunky.moveLoadScreen(document.body),(document.getElementById("site_root")||document.getElementById("wrapper")).setStyles({display:""}),BeFunky.updateThemeColor("site"),BeFunky.befunkyPopupDivOpened!==!0&&document.body.removeClass("prevent-body-scroll"),document.body.removeClass("app-is-open"),window.isAppOpen=!1,document.title=BeFunky.originalPageTitle,BeFunky.LanguageManager.setLanguage(BeFunky.LanguageManager.language.site,["modal"]),(window.webgl_is_supported||!e)&&BeFunky.isCreateRoute()){let n=[...BeFunky.sessionRoutes].slice(1).reverse().find(o=>!BeFunky.isCreateRoute(o));typeof n=="string"?ve(n):ve(Fn)}return window.scrollTo?window.scrollTo(0,Ro):document.documentElement.scrollTop=Ro,BeFunky.measureSiteNavDropdowns&&BeFunky.measureSiteNavDropdowns(),BeFunky.setSentryTag("app_section","site"),!1};window.applyDeepLinkParameters=()=>{let{type:e,img:t}=window.currentDeepLinkParameters;console.log("Entering app w/ deep link parameters:",window.currentDeepLinkParameters),t&&(BeFunky.editorExternalImage={behavior:"load_as_start_new",loadImage:()=>{BFN.BfnService.ToJsUrlUploader(t,null,"sample")}}),window.setApplicationMode(e)};document.addEventListener("visibilitychange",()=>{let e=new Date,t=`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}`;BeFunky.Params.IS_LC||console.log(`Tab ${document.visibilityState} at ${t}`)});{let e;BeFunky.updateThemeColor=function(t){if(e=e||document.head.querySelector('meta[name="theme-color"]'),!e)return;let n;t==="app"?n=window.BFN&&BFN.getTheme&&BFN.getTheme()==="light"?"#F8F8FB":"#1C1D26":n=e.getAttribute("default-value")||"#FAFAFA",e.setAttribute("content",n)}}window.createJavascriptElements=(e,t)=>{let n=(o,i,r,a,c)=>{let d=document.createElement("script");d.type="text/javascript",d.async=t==null,d.src=o,i&&(d.id=i),r&&d.setAttribute(r,a),c!=null&&(d.onreadystatechange=c,d.onload=c),(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(d)};e!=null&&n(e,null,null,null,t)};window.isEmailAddress=e=>/^[\w-+]+(\.[\w-+]+)*@([\w-]+\.)+[a-zA-Z]{2,10}$/.test(e);window.parseXml=e=>new window.DOMParser().parseFromString(e,"text/xml");window.azrc={isFunction(e){return toString.call(e)==="[object Function]"},isArray(e){return toString.call(e)==="[object Array]"},isPlainObject(e){if(!e||toString.call(e)!=="[object Object]"||e.nodeType||e.setInterval||e.constructor&&!hasOwnProperty.call(e,"constructor")&&!hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))return!1;let t;for(t in e);return t===void 0||hasOwnProperty.call(e,t)},extend(){let e,t,n,o,i,r,a=arguments[0]||{},c=1,d=arguments.length,s=!1;for(typeof a=="boolean"&&(s=a,a=arguments[1]||{},c=2),typeof a!="object"&&!window.azrc.isFunction(a)&&(a={}),d===c&&(a=this,--c);c<d;c++)if((e=arguments[c])!=null)for(t in e)n=a[t],o=e[t],a!==o&&(s&&o&&(window.azrc.isPlainObject(o)||(i=window.azrc.isArray(o)))?(i?(i=!1,r=n&&window.azrc.isArray(n)?n:[]):r=n&&window.azrc.isPlainObject(n)?n:{},a[t]=window.azrc.extend(s,r,o)):o!==void 0&&(a[t]=o));return a}};BeFunky.ConvertToBool=e=>e!=""&&(e=="1"||e=="true"||e==!0||e=="yes");BeFunky.befunkyPopupDivOpened=!1;var Qi=[];BeFunky.befunkyPopupContainerOpen=(e,t,n=!0)=>{let o=e.replace("#",""),i=document.getElementById(o);if(t||(t={}),Qi.includes(o)||Qi.push(o),n){let d=BeFunky.getModal(),s=d?d.modalElement.id:void 0;if(Qi.includes(s)){BeFunky.preventModalDispose=!0,BeFunky.closeModal(s),BeFunky.preventModalDispose=!1;let l=document.getElementById("modal_root");l.addClass("modal-root--disable-transitions"),requestAnimationFrame(()=>{l.removeClass("modal-root--disable-transitions")})}}BeFunky.befunkyPopupDivOpened=!0;let r=t.addCaptcha&&i.querySelector(".captcha"),a=()=>{if(!r)return;let d=i.querySelector("[type=submit]");d.disabled=!0,BeFunky.renderOrResetCaptcha(r,()=>{d.disabled=!1})},c=()=>{!r||!r.parentElement||r.parentElement.replaceChild(document.createElement("div").addClass("captcha"),r)};BeFunky.openModal(i,{onOpen:()=>{a(),t.onOpen&&t.onOpen()},onClose:()=>{c(),$u(i),BeFunky.preventModalDispose?BeFunky.befunkyPopupDivOpened=!1:as(),typeof i.onModalClose=="function"&&i.onModalClose(),t.onClose&&t.onClose()},addLightThemeClass:!0,addCloseButton:typeof t.addCloseButton=="boolean"?t.addCloseButton:!0,closeOnClickOutside:typeof t.closeOnClickOutside=="boolean"?t.closeOnClickOutside:!0,size:t.size||"large",isCritical:!!t.isCritical,destroyOnClose:!!t.destroyOnClose})};BeFunky.befunkyPopupContainerClose=()=>{if(BeFunky.befunkyPopupDivOpened){let e=BeFunky.getModal(),t=e?e.modalElement.id:void 0;t&&BeFunky.closeModal(t);let n=document.getElementById("modal_root");n.addClass("modal-root--disable-transitions"),requestAnimationFrame(()=>{n.removeClass("modal-root--disable-transitions"),as()})}return!1};function as(){BeFunky.isLoggedIn()&&typeof BeFunky.LoginPanelObj.onLogin=="function"?BeFunky.LoginPanelObj.onLogin():!BeFunky.isLoggedIn()&&typeof BeFunky.LoginPanelObj.onCloseWithoutLogin=="function"&&BeFunky.LoginPanelObj.onCloseWithoutLogin(),BeFunky.befunkyPopupDivOpened=!1,BeFunky.LoginPanelObj.onLogin=!1,BeFunky.LoginPanelObj.onCloseWithoutLogin=!1}function $u(e){let t=e.querySelector(".form-errors");t&&(t.innerHTML=""),e.querySelectorAll(".form-field__input--invalid").removeClass("form-field__input--invalid")}var{html:ot,setupState:Iu,render:ss,lang:Pt,icon:Mu,ifDefined:ls}=BeFunky.lit;function Je(e,t,{formClass:n="form-modal__form"}={}){t=Object.assign({title:"test",notification:"",button:"submit",context:"site",confirmation:"",fields:[{name:"test",label:"label",maxLength:100,errorMessage:"error_message",isValid:!0,type:"text",sanitize:m=>m,validate:()=>!0}],onSubmit:console.log,submissionErrors:[]},t);let i=!1,r=BeFunky.debounce(()=>{ss(s(),e),i||(i=!0,g(e))},"raf"),[a,c]=Iu(t,r);BeFunky.LanguageManager.addLanguageUpdateListener(r);let d=Math.floor(Math.random()*1e6);return{teardown:()=>ss(ot``,e),setFormState:c};function s(){return a.confirmation?l():ot`
        <h3 class="h5">${Pt(a.title,a.context)}</h3>
        <form class=${n} @submit=${p}>
            ${a.notification?ot`
                <p class="form-modal__notification">${Pt(a.notification,a.context)}</p>
            `:""}
            ${a.submissionErrors.length?ot`
                <div class="form-errors">
                    <div class="form-errors__container">
                    ${a.submissionErrors.map(m=>ot`<div>${Pt(m,a.context)}</div>`)}
                    </div>
                    <button @click=${u} type="button" class="button button--icon button--xs form-errors__close-button">
                        ${Mu("cancel-icon","icon icon--14")}
                    </button>
                </div>
            `:""}
            ${a.fields.map(({name:m,label:_,type:y="text",errorMessage:h="",maxLength:k,isValid:v,sanitize:F,fieldType:T="input",initialValue:L=""})=>{let E;typeof F=="function"&&(E=BeFunky.debounce(M=>{let j=F(M.target.value);j!==M.target.value&&(M.target.value=j)},100));let I;return T==="input"&&(I=E?ot`
                    <input
                        class="${`form-field__input ${v===!1?"form-field__input--invalid":""}`}"
                        value=${L}
                        id=${f(m)}
                        name=${m}
                        type=${y}
                        maxlength=${ls(k)}
                        required
                        @change=${E}
                        @keyup=${E}
                        @blur=${E}
                    >
                `:ot`
                    <input
                        class="${`form-field__input ${v===!1?"form-field__input--invalid":""}`}"
                        id=${f(m)}
                        name=${m}
                        type=${y}
                        maxlength=${ls(k)}
                        required
                    >
                `),T==="textarea"&&(I=E?ot`
                    <textarea
                        class="${`form-field__textarea ${v===!1?"form-field__textarea--invalid":""}`}"
                        id=${f(m)}
                        name=${m}
                        type=${y}
                        required
                        rows="8"
                        cols="50"
                        @change=${E}
                        @keyup=${E}
                        @blur=${E}
                    ></textarea>
                `:ot`
                    <textarea
                        class="${`form-field__textarea ${v===!1?"form-field__textarea--invalid":""}`}"
                        id=${f(m)}
                        name=${m}
                        type=${y}
                        required
                        rows="8"
                        cols="50"
                    ></textarea>
                `),ot`
                    <div class="form-field">
                        <label class="form-field__label" for=${f(m)}>${Pt(_,a.context)}</label>
                        ${I}
                        <p class="form-field__error">${Pt(h,a.context)}</p>
                    </div>
                `})}
            <button class="button button--blue button--md" type="submit">${Pt(a.button,a.context)}</button>
        </form>
        `}function l(){return ot`
            <h3 class="h5">${Pt(a.title,a.context)}</h3>
            <p class="form-modal__confirmation">${Pt(a.confirmation,a.context)}</p>
        `}function u(){c({submissionErrors:[]})}function p(m){m.preventDefault();let _=a.fields.map(({name:h})=>h).reduce((h,k)=>(h[k]=document.getElementById(f(k)).value,h),{}),y=a.fields.map(h=>{let k=typeof h.validate!="function"||h.validate(_[h.name],_);return Object.assign({},h,{isValid:k})});c({fields:y}),y.every(h=>h.isValid)&&a.onSubmit(_)}function f(m){return`input_${d}_${m.replace(/^[^a-z]+|[^\w:.-]+/gi,"")}`}function g(m){let _=m.querySelectorAll("input");for(let y=0;y<_.length;y++)if(_[y].offsetParent){_[y].focus();break}}}function Ru(e){let t=document.createElement("div").setClass("modal form-modal");return t.id=`modal_form_${e}`,t}function Uu(e,t){BeFunky.openModal(e,{addCloseButton:!0,size:"extra-small",destroyOnClose:!0,onClose:t})}BeFunky.formModal=Je;BeFunky.createFormModalContainer=Ru;BeFunky.openFormModal=Uu;window.webgl_is_supported=!1;window.graphic_black_list=[];window.failed_webgl_tests=[];Du();BeFunky.runWebGLTests=Zi;BeFunky.webGLTestResultsTemplate=Xu;BeFunky.checkWebGLSupport=cs;function Du(){cs(),window.webgl_is_supported&&requestIdleCallback(()=>{$n().catch(()=>{})}),/(Windows 7|Windows NT 6.1)/.test(navigator.userAgent||"")||window.webglTextureSize<4096||!BeFunky.isRetina()?window.bfn_resolution=1:BeFunky.isIOS?window.bfn_resolution=window.devicePixelRatio:window.bfn_resolution=2}function cs(){let{results:e,canvasContext:t}=Zi(),n=e.filter(r=>!r.hasPassed).map(r=>r.name);if(window.failed_webgl_tests=n,requestIdleCallback(()=>{ju(n),Ou(n)}),window.webgl_is_supported=Nu(n),!window.webgl_is_supported){BeFunky.logError("WebGL test failed",window.failed_webgl_tests);let r=n.includes("no_webgl_canvas")?"no_webgl_canvas":n[0];window.bf_eventTrack("EXTERNAL","WEBGL_DISABLED_REASON",r.toUpperCase());return}window.FixedPixiPaddingSize=8;let o=4096;window.BfnmaxImageSize=o-window.FixedPixiPaddingSize,window.webglCombinedTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let i=window.webglTextureSize>window.BfnmaxImageSize&&window.webglCombinedTextureUnits>79?8192:Math.min(4096,window.webglTextureSize)||4096;window.BfnmaxImageSize=Math.min(window.BfnmaxImageSize,i-window.FixedPixiPaddingSize),console.log("Max Image Size Set:",window.BfnmaxImageSize,"Max Image Size that BeFunky can support:",i),window.bf_eventTrack("EXTERNAL","WEBGL_GRAPHIC",window.webglUnmaskedRenderer||"(unknown)"),navigator.deviceMemory&&window.bf_eventTrack("EXTERNAL","DEVICE_MEMORY",navigator.deviceMemory)}function ju(e){if(BeFunky.testingFlags.includes("disable_webgl_performance_check")||e.includes("no_webgl_canvas"))return;let t=!e.includes("no_high_perf_canvas"),n=window.webglUnmaskedRenderer||"(unknown)",o;try{o=JSON.parse(BeFunky.getLocal("last_renderer"))}catch{}if(BeFunky.setLocal("last_renderer",JSON.stringify({isHighPerformance:t,renderer:n})),o&&o.isHighPerformance!==t){let i=t?"WEBGL_PERF_FIXED":"WEBGL_PERF_BROKEN",r=n===o.renderer?`SAME: ${n}`:`${o.renderer} \u2192 ${n}`;bf_eventTrack("EXTERNAL",i,r),t?BeFunky.logWarning("WebGL performance was fixed",r):BeFunky.logWarning("WebGL performance got worse:",r)}}function Ou(e){!e.includes("mobile_gpu_not_in_whitelist")||e.includes("old_android_version")||BeFunky.testingFlags.includes("disable_webgl_performance_check")||e.includes("no_webgl_canvas")||e.includes("no_high_perf_canvas")||window.bf_eventTrack("EXTERNAL","BLOCKED_MOBILE_GPU",window.webglUnmaskedRenderer)}function Nu(e){return BeFunky.setSentryTag("high_perf_canvas",!e.includes("no_high_perf_canvas")),e.length?e.length===1&&e[0]==="no_high_perf_canvas"&&!BeFunky.isMobile?(BeFunky.logWarning("Allowing desktop user to use app w/ low perf canvas"),!0):qu()&&!e.includes("no_webgl_canvas")?(BeFunky.logWarning(`Enabling WebGL even though test failed: ${e[0]}`,{failingTests:e}),!0):(setCookie("gl_sprt","0",365),!1):(setCookie("gl_sprt","1",365),!0)}function qu(){return getCookie("gl_sprt")==="1"||Boolean(BeFunky.getLocal("__IndexedDB_version"))}function Zi(){let e=[],t=(a,c)=>{e.push({name:a,hasPassed:!c})},n=navigator.userAgent||"";t("old_windows_version",/(Windows NT 5.1|Windows NT 5.2|Windows NT 6.0|Windows XP)/.test(n)),t("old_mac_version",zu(n)),t("old_browser_version",Hu()),t("old_android_version",Vu());let o;if(BeFunky.testingFlags.includes("disable_webgl_performance_check")?window.webGLPerformanceIssue=Gu():(o=us(!0),t("no_high_perf_canvas",!(o instanceof WebGLRenderingContext)),window.webGLPerformanceIssue=o instanceof WebGLRenderingContext?"No":"Yes"),o||(o=us(!1),t("no_webgl_canvas",!(o instanceof WebGLRenderingContext))),!o)return{results:e,canvasContext:o};let i=o.getExtension("OES_standard_derivatives");window.webglTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),t("no_oes_standard_derivatives",!i),t("small_texture_size",window.webglTextureSize<4096);let r=o.getExtension("WEBGL_debug_renderer_info");if(r){let a=BeFunky.Params.isAdmin?getCookie("webglUnmaskedRenderer"):!1,c=o.getParameter(r.UNMASKED_RENDERER_WEBGL);if(window.webglUnmaskedRenderer=a||c,BeFunky.setSentryTag("graphics_card",window.webglUnmaskedRenderer+(a?" (from cookie)":"")),window.webglUnmaskedRenderer&&window.webglUnmaskedRenderer.includes("SwiftShader")){window.webGLPerformanceIssue="Yes";let d=e.find(({name:s})=>s==="no_high_perf_canvas");d&&(d.hasPassed=!1)}!BeFunky.Params.isBeta&&BeFunky.isSmartphone&&!BeFunky.isTWA&&!BeFunky.isIOS&&!BeFunky.isMac&&t("mobile_gpu_not_in_whitelist",!Wu(window.webglUnmaskedRenderer))}return{results:e,canvasContext:o}}function Wu(e){if(!e)return!1;let t=e.match(/Adreno.* (\d+)/);if(t&&parseInt(t[1])>=540)return!0;let n=e.match(/Mali-G(\d+)/);if(n&&parseInt(n[1])>=57)return!0;let o=e.match(/PowerVR.* GE(\d+)/);return!!(o&&parseInt(o[1])>=8320)}function Hu(){return!!(BeFunky.isChromium&&BeFunky.chromiumVersion<69||BeFunky.isFirefox&&BeFunky.firefoxVersion<65||BeFunky.isSafari&&BeFunky.safariVersion<12.1)}function Vu(){if(!BeFunky.isAndroid)return!1;let{os:e}=window.getSystemInformation();return Boolean(e&&e.name==="Android"&&parseInt(e.version)<=7)}function us(e){try{let t=document.createElement("canvas"),n={failIfMajorPerformanceCaveat:e,alpha:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0,stencil:!0};return t.getContext("webgl",n)||t.getContext("experimental-webgl",n)}catch(t){BeFunky.logError("getCanvasContext failed:",typeof t,t instanceof Error,t instanceof Event),BeFunky.throwError(t)}return null}function Gu(e){try{e||(e=document.createElement("canvas"));let t={failIfMajorPerformanceCaveat:!0},n=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);if(!n)return"Yes";if(typeof n.getContextAttributes().failIfMajorPerformanceCaveat=="undefined")return"Not implemented"}catch{}return"No"}function zu(e){if(!BeFunky.isIOS&&/(MacPPC|MacIntel|Mac_PowerPC|Macintosh|Mac OS X)/.test(e)){let t=/10[._\d]+/.exec(e);if(t){let n=t[0];/[_]/.test(n)&&(n=n.split("_").join("."));let o=n.split(".");if(o[1]&&parseInt(o[1])<10)return!0}}return!1}function Xu(e,t=!0){e=e||Zi().results.filter(p=>!p.hasPassed).map(p=>p.name);let{html:n,lang:o}=BeFunky.lit,r=[{errors:["old_windows_version"],message:"error_old_windows",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-operating-system-is-out-of-date"},{errors:["old_mac_version"],message:"error_old_mac",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-operating-system-is-out-of-date"},{errors:["old_browser_version"],message:"error_old_browser",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-browser-is-out-of-date"},{errors:["no_oes_standard_derivatives","small_texture_size"],message:"acknowledge_cant_run_app",link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-computer-doesnt-meet-the-minimum-requirements"},{errors:["no_webgl_canvas"],message:()=>n`
                <p style="margin-bottom: 0.5rem">${o("acknowledge_cant_run_app")}</p>
                <ul>
                    ${BeFunky.isChrome&&BeFunky.chromiumVersion>=104?n`<li>${o("use_non_chrome_browser")}</li>`:""}
                    <li>${o("restart_browser")}</li>
                    ${BeFunky.isWindows?n`<li>${o("update_gpu_driver")}</li>`:""}
                </ul>
            `,link:"https://support.befunky.com/hc/en-us/articles/360045634352#h_your-browser-is-unable-to-run-befunky"},{errors:["mobile_gpu_not_in_whitelist","old_android_version"],message:()=>n`
                <p>${o("try_mobile_app")}</p>
            `,link:"https://play.google.com/store/apps/details?id=air.com.befunky.BeFunkyPhotoEditor",linkText:"open_play_store"},{errors:["no_high_perf_canvas"],message:"acknowledge_perf_issue",link:BeFunky.getArticleForPerfIssue(),type:"warning"}].map(p=>Yt(Ve({},p),{errors:p.errors.filter(f=>e.includes(f))})).filter(p=>p.errors.length);if(t)return n`
        <p>${o("checked_your_computer")}</p>
        ${e.length?c(r[0]):a()}
        ${e.length?"":n`<p style="margin-bottom: 0.5rem">${o("contact_our_support_team")}</p>`}
        <button @click=${d} class="button button--blue">${o("contact_support_heading")}</button>
        `;return r[0];function a(){let p=BeFunky.createNotification({message:"computer_meets_the_requirements",type:"success",isDismissable:!1});return p.setStyles({margin:"0 0 1.5rem 0",fontSize:"inherit"}),p}function c({message:p,link:f,linkText:g="learn_more",type:m="error"}){let _=BeFunky.createNotification({message:typeof p=="function"?p():p,type:m,isDismissable:!1,button:{text:g,onClick:()=>window.open(f,"_blank")}});return _.setStyles({margin:"0 0 1.5rem 0",fontSize:"inherit"}),_}function d(){let p=s("support"),f=BeFunky.isLoggedIn()?BeFunky.User.email:"",g;window.getSystemInformation(!0).then(y=>{g=y});let{teardown:m,setFormState:_}=Je(p,{title:"contact_support_heading",fields:[{name:"email",label:"email",type:"text",initialValue:f,errorMessage:"error_invalid_email",validate:window.isEmailAddress,sanitize:y=>y.trim()},{name:"comment",label:"comment",fieldType:"textarea",type:"text"}],button:"submit",onSubmit:({email:y,comment:h})=>{let k=h,v="Compatibility Check Results",F=`${g} 

----WEBGL INFO----

${u()}`;BeFunky.requestAPI("auth/send-feedback",{email:y,subject:v,message:k,system_info:F},{showLoadScreen:!0}).then(T=>{if(T.data!=="success")throw"invalid_response";_({confirmation:"contact_support_thanks"})}).catch(T=>{BeFunky.logError("Unable to send compatibility check support email",T),_({submissionErrors:[BeFunky.failureReason(T)]})})}});l(p,m)}function s(p){let f=document.createElement("div").setClass("modal form-modal");return f.id=`modal_form_${p}`,f}function l(p,f){BeFunky.openModal(p,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onClose:f})}function u(){return e.length===0?"Passed all WebGL tests":e.length===1?`Failed one WebGL test: ${e[0]}`:`Failed ${e.length} WebGL tests: ${e.join(", ")}`}}function In(){if(!window.isMixPanelInit||!window.mixpanel||typeof mixpanel.identify!="function")return console.log(`Mixpanel load: ${window.isMixPanelInit}`),console.log(`Mixpanel identify: ${typeof mixpanel.identify}`),console.log(`Mixpanel pl: ${BeFunky.User.pl}`),console.log(`Mixpanel subscr: ${BeFunky.User.subscr_usr}`),console.log(`Mixpanel plantype: ${BeFunky.User.plan_type}`),BeFunky.throwError("Mixpanel could not track purchase");if(typeof window.bfn_mp!="undefined"&&typeof window.mixpanel!="undefined"){let e=!1;if((typeof navigator.doNotTrack!="undefined"&&BeFunky.ConvertToBool(navigator.doNotTrack)===!0||typeof navigator.msDoNotTrack!="undefined"&&BeFunky.ConvertToBool(navigator.msDoNotTrack)===!0||typeof window.doNotTrack!="undefined"&&BeFunky.ConvertToBool(window.doNotTrack)===!0)&&(e=!0),e===!0){console.log("Mixpanel do not track enabled");try{window.bfn_mp.trackingEnabled=!1;let t=window.bfn_mp.track("subscription_started");t||(console.log("bfn_mp.identifier = ",window.bfn_mp.identifier),console.log(`Mixpanel upl: ${BeFunky.User.pl}`),console.log(`Mixpanel subscr: ${BeFunky.User.subscr_usr}`),console.log(`Mixpanel plantype: ${BeFunky.User.plan_type}`));let n={data:{people:t[0]!==null?t[0]:"",super:t[1]!==null?t[1]:"",property:t[2]!==null?t[2]:""}};n=btoa(JSON.stringify(n)),BeFunky.requestAPI("auth/has-opted-out-tracking",{event:"subscription_started",data:n})}catch(t){BeFunky.throwError("Mixpanel has_opted_out_tracking block error: ",t)}}else try{window.bfn_mp.track("subscription_started")}catch{}}}var ds=class{constructor(){window.onUserStatusChange(this.handleUserDataChange.bind(this)),this.listenForUserChangesInOtherTabs(),this.setupPolling(),this.closeWarningDialog=()=>{},this.playStorePlusUserExists=!1,window.initialUser&&this.getInitialUserStatus()}async getInitialUserStatus(t=!0){try{let n=await BeFunky.requestAPI("auth/status",{},{showLoadScreen:!1}),{data:o}=n;if(!o.email)throw BeFunky.throwError("/status/ missing email",n),"invalid_response";console.log("/status/ complete: logged-in"),window.initialUserStatus.resolve&&window.initialUserStatus.resolve(n),window.updateUserStatus(o)}catch(n){console.log(`/status/ error = ${n}`),window.initialUserStatus.resolve&&window.initialUserStatus.resolve({error:n}),window.updateUserStatus({error:"not_logged_in"}),t&&n!=="not_logged_in"&&setTimeout(()=>{this.getInitialUserStatus(!1)},1e3)}}listenForUserChangesInOtherTabs(){window.addEventListener("storage",t=>{if(t.key!=="latest_user_email")return;let{error:n,emailInBrowser:o,debugData:i}=this.detectUserChangeInDifferentTab()||{};if(!n){this.closeWarningDialog();return}this.decodeUserToken().then(r=>{let a=r?Object.assign({},r,{email:this.anonymizeEmail(r.email)}):"(no_user)";return n==="not_logged_in"&&r||o&&o!==r.email?BeFunky.throwError("LocalStorage does not match Fastly",a,i):this.handleUserSessionError({error:n,userData:r})}).catch(r=>{r==="request_failed"?BeFunky.logError(`/check-user/ polling failed: ${r}`):BeFunky.reportWarning(`/check-user/ polling failed: ${r}`,r)})})}setupPolling(){this.pollingTimeout=null,this.pollingInterval=1e3*60*60,this.resetPolling()}resetPolling(){clearTimeout(this.pollingTimeout),this.pollingTimeout=setTimeout(this.checkUserToken.bind(this),this.pollingInterval)}checkUserToken(t,n){BeFunky.isAppleAppStoreApp||(clearTimeout(this.pollingTimeout),this.decodeUserToken().then(o=>{if(t==="already_logged_in"&&o&&BeFunky.isLoggedIn())return;let i;if(o&&!BeFunky.isLoggedIn()?i="already_logged_in":!o&&BeFunky.isLoggedIn()?i="not_logged_in":o.email&&window.latestUserData.email&&o.email!==window.latestUserData.email&&(i="wrong_user"),t&&t!==i){if(!o&&t==="not_logged_in"&&!BeFunky.isLoggedIn())return;let r=o?Object.assign({},o,{email:this.anonymizeEmail(o.email)}):"(no_user)";BeFunky.throwError(`User session errors do not match. Fastly = "${i}", ${n} = "${t}"`,r);return}i&&this.handleUserSessionError({error:i,userData:o})}).catch(o=>{o==="request_failed"?BeFunky.logError(`/check-user/ polling failed: ${o}`):BeFunky.reportWarning(`/check-user/ polling failed: ${o}`,o)}).then(()=>{this.resetPolling()}))}decodeUserToken(){return new Promise((t,n)=>{let o=`${BeFunky.Params.siteUrl}check-user/`,i={method:"POST"};BeFunky.request(o,i,({error:r,response:a})=>{if(r==="not_logged_in")return t(!1);if(a&&a.email)return t(a);n(r||"invalid_response")})})}detectUserChangeInDifferentTab(){let t=window.latestUserData.email,n=BeFunky.getLocal("latest_user_email"),o=t?`Logged in as ${this.anonymizeEmail(t)}`:"Logged out",i=n?`Logged in as ${this.anonymizeEmail(n)}`:n===null?"Logged out":"Unknown",r=`[In this tab: ${o}] vs [In browser: ${i}]`;if(!t&&n)return{error:"already_logged_in",emailInThisTab:t,emailInBrowser:n,debugData:r};if(t&&n===null)return{error:"not_logged_in",emailInThisTab:t,emailInBrowser:n,debugData:r};if(t&&n&&t!==n)return{error:"wrong_user",emailInThisTab:t,emailInBrowser:n,debugData:r}}anonymizeEmail(t){return`${t.slice(0,2)}...@${t.slice(t.indexOf("@")+1,t.indexOf("@")+3)}...`}handleUserSessionError({error:t,userData:n}){this.closeWarningDialog();let o=window.latestUserData.email;if(t==="already_logged_in"){this.closeWarningDialog=BeFunky.confirm("user_already_logged_in",{confirmText:["continue_as_user",{username:n.user_name||n.email}],onConfirm:()=>{BeFunky.requestAPI("auth/status",{},{showLoadScreen:!0}).then(({data:i})=>{i.email?window.updateUserStatus(i):BeFunky.throwError("/status/ missing email",i)}).catch(i=>{BeFunky.reportWarning(`/status/ failed when handling session error: ${i}`)}).then(()=>{BeFunky.hideLoadScreen()})},onCancel:()=>{}});return}if(t==="not_logged_in"){this.handleClientSideLogout(),this.closeWarningDialog=BeFunky.acknowledge(["user_not_logged_in_refresh",{email:o}]);return}if(t==="wrong_user"){this.closeWarningDialog=BeFunky.acknowledge(["user_not_logged_in_refresh",{email:o}]);return}BeFunky.throwError("Unhandled user session error",t)}handleClientSideLogout(){if(window.updateUserStatus({error:"not_logged_in"}),BeFunky.User=BeFunky.getDefaultUser(),window.BFN&&BFN.BfnService&&BFN.BfnService.updateUserData)try{BFN.BfnService.updateUserData()}catch(t){BeFunky.throwError("updateUserData error after client-side logout",t)}BeFunky.clearSignInModals()}handleUserDataChange(t){let{user_name:n,email:o,pl:i,btknid:r,language:a,register_date:c,register_from:d,login_date:s,login_count:l,newUser:u,isMailVerified:p,plan_type:f,subscr_date:g,subscr_count:m,subscr_amount:_,subscr_first_date:y,subscr_ltv:h,subscr_usr:k,subscr_tusr:v,subscription_status:F,trial_source:T,payment_type:L,can_change_user_name:E,is_subscribe_newsletter:I,is_beta_user:M=0,options:j,luk:Y,error:Q}=t;if(Q&&(BeFunky.User=BeFunky.getDefaultUser()),BeFunky.User.email=o||"",BeFunky.User.username=n||"",BeFunky.User.pl=i||"",t.btknid&&(BeFunky.Params.btknid=r,BeFunky.Params.isBetaUser=M===1,BeFunky.User.language=a,BeFunky.User.register_date=c,BeFunky.User.register_from=d,BeFunky.User.login_date=s,BeFunky.User.login_count=parseInt(l),BeFunky.User.isNewUser=BeFunky.ConvertToBool(u),BeFunky.User.options=j,BeFunky.User.subscription_status=F,BeFunky.User.trial_source=T,BeFunky.User.payment_type=L,BeFunky.User.can_change_user_name=BeFunky.ConvertToBool(E),BeFunky.User.is_subscribe_newsletter=BeFunky.ConvertToBool(I),BeFunky.User.isMailVerified=p==="1",BeFunky.Params.isMailVerified=p==="1",BeFunky.User.plan_type=f,BeFunky.User.subscr_date=g,BeFunky.User.subscr_count=m,BeFunky.User.subscr_amount=_,BeFunky.User.subscr_first_date=y,BeFunky.User.subscr_ltv=h,BeFunky.User.subscr_usr=k,BeFunky.User.subscr_tusr=v),a&&a!==BeFunky.LanguageManager.language.app)try{BeFunky.LanguageManager.setLanguage(a,["app"]),window.BFN&&BFN.SettingsManager&&(BFN.SettingsManager.remoteSettings.language=a)}catch(z){BeFunky.throwError(z,n,BeFunky.stringValue(a))}if(Vi()&&m&&(qt(!1,!1),BeFunky.removeLocal("user_trial")),window.BFN&&BFN.BfnService)try{BFN.BfnService.updateUserData()}catch(z){BeFunky.throwError("updateUserData error",z)}BeFunky.setSentryTag("plus",BeFunky.isPlus()),Sentry.configureScope(z=>{Y&&z.setUser({id:Y})}),setTimeout(()=>{["free","plus"].includes(F)&&BeFunky.SettingsService.getUserSettings(({settings:z})=>{!z||z.trialing==="trialing"&&BeFunky.SettingsService.updateSetting("trialing",F).then(()=>{let ne=parseInt(f)>0?"YEARLY":"MONTHLY",Z=T==="chromeos_perk_two_trial"?"TRIAL_CONVERSION":T.toUpperCase();F==="free"?bf_eventTrack(Z,ne,"TRIAL CANCELLED"):F==="plus"&&(bf_eventTrack(Z,ne,"TRIAL SUCCEEDED"),bf_eventTrack("CONVERSION",ne,"CREDITCARD"))})})}),requestIdleCallback(()=>this.showNotificationIfLastPaymentFailed())}handlePlayStoreUser(t,n,o){if(t.toLowerCase()===BeFunky.User.email.toLowerCase()||n==="free"||BeFunky.isPlus())return;if(this.playStorePlusUserExists=!0,o==="upgrade")return i();o==="initial"&&(BeFunky.isDashboard()||window.isAppOpen)&&i();function i(){let r=window.hideEmail(t);return window.BFN&&BFN.ProjectManager&&BFN.ProjectManager.autoSave&&BFN.ProjectManager.autoSave[BFN.AppModel.sectionID].lastSaveLocation==="memory"?BeFunky.acknowledge(["chromeos_prompt_sign_in_plus",{email:r}]):BeFunky.confirm(["chromeos_prompt_sign_in_plus",{email:r}],{confirmText:["sign_in_as",{email:r}],onConfirm:()=>{BeFunky.setLocalSession("next_sign_in_email",t),BeFunky.signOut(`${BeFunky.Params.siteUrl}sign-in/`)},focusConfirmButton:!1})}}handleAppStoreUser(t,n,o,i){if(t&&t.toLowerCase()===BeFunky.User.email.toLowerCase()){o==="restore-account"&&n==="free"?BeFunky.showAppStoreRestoreNotFound(i):i&&r(i);return}if((!n||n&&n==="free")&&o!=="initial"&&o!=="upgrade"){o==="restore-account"?BeFunky.showAppStoreRestoreNotFound(()=>{BeFunky.isPlus()?i&&i():a()}):BeFunky.isPlus()?r(i):r(a);return}if(["trialing","plus"].includes(n)&&o!=="initial"&&o!=="upgrade"){let c=BeFunky.getLocal("appstore_otid");c?window.checkAnonymousUserIsPlus(c,!0,d=>{d?BeFunky.showAndTrackAppStoreSubscriptionRestored(()=>{r(a,d)}):BeFunky.isPlus()?i&&r(i):r(a)}):BeFunky.isPlus()?i&&r(i):r(a);return}if(BeFunky.isPlus()){r(i);return}o==="upgrade"||o==="restore"||o==="restore-account"||o==="restore-pricing"?r(()=>{a()}):o==="initial"&&(BeFunky.isDashboard()||window.isAppOpen)&&a();function r(c,d){d&&!!BeFunky.freeTrialToUpgrade&&(BeFunky.freeTrialToUpgrade=!1),!!BeFunky.freeTrialToUpgrade&&o==="restore-pricing"?(BeFunky.freeTrialToUpgrade=!1,BeFunky.acknowledge("free_trials_are_one_time_offer",{onAcknowledge:()=>{c&&c(d)}})):(BeFunky.freeTrialToUpgrade=!1,c&&c(d))}function a(c){if(!BeFunky.isLoggedIn()&&o!=="restore"&&o!=="restore-account"&&o!=="restore-pricing"){i&&i(c);return}if(!t){i&&i(c);return}if(!n){i&&i(c);return}let d=window.hideEmail(t);BeFunky.appStoreRestorePromptDisplayed=!0;let s=n==="free"?"apple_appstore_prompt_sign_in_free":"apple_appstore_prompt_sign_in_plus";return window.BFN&&BFN.ProjectManager&&BFN.ProjectManager.autoSave&&BFN.ProjectManager.autoSave[BFN.AppModel.sectionID].lastSaveLocation==="memory"?BeFunky.acknowledge([s,{email:d}]):BeFunky.confirm([s,{email:d}],{confirmText:"yes",cancelText:"no",onConfirm:()=>{BeFunky.setLocalSession("next_sign_in_email",t),BeFunky.isLoggedIn()?BeFunky.signOut("sign-in"):BeFunky.openLoginPanel("SIGNIN"),i&&i(c)},onCancel:()=>{i&&i(c)},focusConfirmButton:!1})}}updateUserDataAndTrackNativeAppStoreSubscription(t){let n={pl:"1",subscr_usr:1,plan_type:t.plan_type,subscr_amount:t.subscr_amount,subscr_date:t.subscr_date,payment_type:t.payment_type},o=t.trial_started,i=Boolean(o),r=parseInt(t.plan_type)>0?"yearly":"monthly";i?(n.trial_source=o,n.subscription_status="trialing",bf_eventTrack(o.toUpperCase(),r.toUpperCase(),"TRIAL STARTED"),BeFunky.isLoggedIn()&&BeFunky.SettingsService.updateSetting("trialing","trialing")):bf_eventTrack("CONVERSION",r.toUpperCase(),"CREDITCARD"),BeFunky.User.subscr_date&&bf_eventTrack("RESUBSCRIBE",r.toUpperCase(),"CREDITCARD"),window.updateUserStatus(Object.assign({},window.latestUserData,n)),In()}showNotificationIfLastPaymentFailed(){if(latestUserData.delinquent!==!0)return;let t=parseInt(BeFunky.getLocal("delinquent_notification_time")),n=1e3*60*60*24*3;(!t||Date.now()-t>n)&&(BeFunky.openAnnouncementModal("payment_failed",{onConfirm:()=>{BeFunky.openPaymentPanel("year","update")}}),BeFunky.setLocal("delinquent_notification_time",Date.now()),window.onScriptLoad("app").then(()=>{let o=new BFN.UserActionVO;o.eventID="delinquent_prompt_shown",o.track()}))}};BeFunky.UserManager=new ds;BeFunky.captchaWidget=null;BeFunky.renderOrResetCaptcha=(e,t=()=>{})=>{if(!e)return BeFunky.throwError("Unable to find captcha container"),t();ps(()=>{if(e.firstElementChild)return window.grecaptcha.reset(),t();let n=BeFunky.Params.IS_LC?"6LePbqoUAAAAAITuugtKJnS15GkfdP5MZGInsrk8":"6LcXOpkUAAAAAOKNQzyDv-gS8Nu6cTgwW6m3sXQu";return BeFunky.captchaWidget=window.grecaptcha.render(e,{sitekey:n,hl:BeFunky.LanguageManager.language[window.isAppOpen?"app":"site"],size:"invisible",callback(o){o!==""&&(BeFunky.invisibleCaptchaHandler(o),console.log("User successfully completed captcha"))}}),t()})};BeFunky.getCaptchaResponse=()=>{try{return window.grecaptcha.getResponse(BeFunky.captchaWidget)}catch{}return""};BeFunky.invisibleCaptchaHandler=()=>{typeof BeFunky.executeCaptchaCallback=="function"&&(BeFunky.executeCaptchaCallback(),BeFunky.executeCaptchaCallback=null)};BeFunky.executeCaptchaCallback=null;BeFunky.executeCaptcha=e=>{if(BeFunky.executeCaptchaCallback=e,window.grecaptcha.execute(BeFunky.captchaWidget),window.innerHeight<650){let n;BeFunky.waitUntil({condition:()=>(n=n||t(),!!n),onTimeout:()=>{},onSuccess:()=>{let{top:o}=n.parentElement.getBoundingClientRect();n.parentElement.setStyles({maxHeight:`calc(100vh - ${o}px)`,overflowY:"auto"})},interval:300,maxAttempts:15})}function t(){return[...document.querySelectorAll('iframe[title^="recaptcha"]')].find(o=>{try{return o.parentElement.parentElement.style.visibility!=="hidden"}catch{}return!1})}};function ps(e,t=!1){if(i())return e();let n=`https://www.google.com/recaptcha/api.js?${new URLSearchParams({h1:BeFunky.LanguageManager.language[window.isAppOpen?"app":"site"],render:"explicit"}).toString()}`;BeFunky.loadScript(n).then(()=>{BeFunky.waitUntil({condition:i,interval:100,maxAttempts:50,onSuccess:e,onTimeout:o})},o);function o(r){t?BeFunky.throwError(`Unable to load Google ReCAPTCHA: ${r}`,{grecaptcha:window.grecaptcha}):BeFunky.befunkyPopupDivOpened&&!BeFunky.isLoggedIn()&&BeFunky.confirm("error_request_failed",{confirmText:"try_again",onConfirm:()=>{i()?e():ps(e,!0)},onCancel:()=>{i()&&e()}})}function i(){return window.grecaptcha&&typeof window.grecaptcha.render=="function"}}BeFunky.closeAccount=e=>{let t={closeKey:e};BeFunky.requestAPI("auth/close-account",t,{showLoadScreen:!0}).then(n=>{if(n.data!=="success")throw"invalid_response";BeFunky.showLoadScreen({message:"closing_account",progress:0}),setTimeout(BeFunky.updateAccountCloseStatus,2555)}).catch(n=>{BeFunky.throwError("Unable to close account",JSON.stringify({error:n})),gs()})};var Uo=!1,er=0;BeFunky.updateAccountCloseStatus=()=>{Uo||(Uo=!0,BeFunky.requestAPI("auth/close-account-status",{}).then(e=>{Uo=!1;let t=parseInt(e.data.stepPercentageComplete)||0;if(t?er=t:er++,BeFunky.showLoadScreen({message:"closing_account",progress:er}),parseInt(e.data.isFinished)===1){BeFunky.hideLoadScreen(),BeFunky.acknowledge("account_deleted",{onAcknowledge:()=>{BeFunky.signOut()},imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/photo-project-shredder.svg`});return}setTimeout(BeFunky.updateAccountCloseStatus,100)}).catch(e=>{Uo=!1,BeFunky.hideLoadScreen(),BeFunky.throwError("Unable to get account close status",JSON.stringify({error:e})),gs()}))};function gs(){let{elem:e,lang:t}=BeFunky.lit;BeFunky.acknowledge(e`
    <div>
        <p>${t("error_close_account","site")}</p>
        <p>${t(["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}],"site")}</p>
    </div>`)}window.googleAuth2=null;window.DRV_CLIENT_ID="303057181160-pvs0ajfctrvv15i4rmirjsve2plp8m92.apps.googleusercontent.com";window.DRV_SCOPES="https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/drive.file";window.DRV_ACCESS=null;window.DRV_ACCESS_TIME=null;window.DRV_FLASH_CALLBACK=null;window.DRV_CLIENT_VERSION="v3";window.googleDrivePickerOpenerButton=document.createElement("button");var Wt=window.$googleDriveState?deferredPromise():void 0,Qe=(...e)=>BeFunky.logFeature("google_drive",...e);window.googleDrivePickerOpenerButton.id="___googleDrivePickerOpenerButton";window.googleDrivePickerOpenerButton.addEventListener("click",()=>{if(window.driveApiLoadedCallback!==null){try{window.driveApiLoadedCallback()}catch{}window.driveApiLoadedCallback=null}});if($googleDriveState){try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch{}BeFunky.editorExternalImage={behavior:"load_instead_of_autosave",loadImage:()=>{BeFunky.showLoadScreen(),Wt.then(e=>{downloadDriveFile(e)}).catch(e=>{BeFunky.logError("Failed to load Drive image:",e),BeFunky.hideLoadScreen()}).then(()=>{Wt=void 0})}}}window.onDrvApiLoad=()=>{Qe("onDrvApiLoad");let e=()=>{console.log("GOOGLE client init"),gapi.client.init({apiKey:"AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw"}).then(()=>{dv_handleAuthResult()})},t=()=>{let o=gapi.auth2.getAuthInstance().currentUser.get(),i=o.getAuthResponse().access_token,r=o.getAuthResponse().id_token;r&&r.length>0&&i&&i.length>0&&(DRV_ACCESS=i,gapi.load("client",e))},n=()=>{gapi.auth2.getAuthInstance().signIn().then(()=>{console.log("GOOGLE signed in"),t()}).catch(o=>{console.error("Google sign-in failed",o),BeFunky.hideLoadScreen()})};gapi.load("auth2",{callback:()=>{gapi.auth2.init({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES}).then(()=>{gapi.auth2.getAuthInstance().isSignedIn.get()===!0?t():BeFunky.confirm("google_drive_access",{onConfirm:n,onCancel:()=>{BeFunky.logError("User cancelled Drive access")},confirmText:"ok",cancelText:"cancel"})}).catch(o=>{console.error("Google auth2.init failed",o),BeFunky.hideLoadScreen()})}})};window.googleDriveCallbackCheck=()=>{let e=!1;try{window.addEventListener("focus",n=>{e=!0},!1)}catch{}let t=setInterval(()=>{DRV_ACCESS!==null?window.clearInterval(t):e!==!1&&(window.clearInterval(t),DRV_ACCESS===null&&(DRV_FLASH_CALLBACK!==null?dv_handleAuthResult(null):notApiLoadedGoToApp()))},1e3)};window.driveInmediateDisplay=e=>{if(!(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")){window.driveApiLoadedCallback=function(){window.driveInmediateDisplay(e)};try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch{}return}if(DRV_FLASH_CALLBACK=e!==null?e:null,DRV_ACCESS===null)gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},dv_handleAuthResult),DRV_FLASH_CALLBACK!==null&&googleDriveCallbackCheck();else if(DRV_FLASH_CALLBACK!=null&&DRV_ACCESS!==null)if(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")gapi.client.load("drive",window.DRV_CLIENT_VERSION,driveClientLoaded);else try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch{}};window.dv_handleAuthResult=e=>{Qe("dv_handleAuthResult",{authResult:e,DRV_ACCESS});let t=null;if(!e&&DRV_ACCESS!==null)t=DRV_ACCESS;else try{t=e.access_token?e.access_token:null}catch{}if(t!==null)if(DRV_ACCESS=t,$googleDriveState!=null,typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")Qe("call gapi.client.load()"),gapi.client.load("drive",window.DRV_CLIENT_VERSION,driveClientLoaded);else{Qe("create JS with onDrvApiLoad");try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch{}}else sendToFlashFromDrvParams();window.driveApiLoadedCallback!==null&&window.googleDrivePickerOpenerButton.click()};window.driveClientLoaded=()=>{Qe("driveClientLoaded"),!DRV_FLASH_CALLBACK&&$googleDriveState!=null&&(bf_eventTrack("EXTERNAL","GOOGLE_DRIVE","OPEN"),checkDriveFile($googleDriveState)),sendToFlashFromDrvParams()};window.sendToFlashFromDrvParams=()=>{if(DRV_FLASH_CALLBACK!==null){let e="https://www.googleapis.com/upload/drive/v3/files";if(DRV_ACCESS!=null)try{BFN.BfnService.callbackFromJs(e,DRV_ACCESS)}catch{}else try{BFN.BfnService.callbackFromJs()}catch{}DRV_FLASH_CALLBACK=null}};window.checkDriveFile=e=>{Qe("checkDriveFile",e);try{BeFunky.showLoadScreen();let t=window.DRV_CLIENT_VERSION==="v3"?"id,webContentLink,mimeType,resourceKey":"id,downloadUrl,mimeType";gapi.client.drive.files.get({fileId:e,fields:t}).execute(o=>{Qe("checkDriveFile response",o),Wt?o.error?(Qe("driveImageReadyPromise rejected"),Wt.reject(o.error)):(Qe("driveImageReadyPromise resolved"),Wt.resolve(o)):downloadDriveFile(o)})}catch(t){BeFunky.hideLoadScreen(),Wt&&Wt.reject(t)}};window.downloadDriveFile=e=>{Qe("downloadDriveFile",e);try{if(e===null){BeFunky.hideLoadScreen();return}let t=typeof e.downloadUrl!="undefined"?e.downloadUrl:typeof e.webContentLink!="undefined"?e.webContentLink:!1;if(t){window.DRV_CLIENT_VERSION==="v3"&&(t=`https://www.googleapis.com/drive/v3/files/${e.id}?alt=media`);let n=gapi.auth.getToken().access_token,{mimeType:o}=e;if(n!=null){let i={responseType:"blob",headers:{Authorization:`Bearer ${n}`}};return e.resourceKey&&(i.headers["X-Goog-Drive-Resource-Keys"]=e.resourceKey),BeFunky.request(t,i,({response:r,error:a})=>{if(a&&(BeFunky.throwError("Unable to download Drive image",a),BeFunky.hideLoadScreen()),window.$googleDriveState){let c=window.location.href;if(c.includes("?state="))try{window.history.replaceState({},"",c.split("?state=")[0])}catch(d){BeFunky.throwError(d)}}BFN.PhotoEditorModel.loadNewImage(r),BFN.BfnService.track("CREATE","UPLOAD","DRIVE"),BFN.BfnService.trackMediaOpened("image","drive")})}}}catch{BeFunky.hideLoadScreen()}};window.insertDriveFile=(e,t)=>{Qe("insertDriveFile",e,t);let n=i=>{if(Qe("drv_pickerFolderCallback",i),i[google.picker.Response.ACTION]==google.picker.Action.PICKED){openApp();let r=i[google.picker.Response.DOCUMENTS][0].id;if(r!=null){let a="-------314159265358979323846",c=`\r
--${a}\r
`,d=`\r
--${a}--`,s={title:t,name:t,mimeType:"image/jpeg",parents:[r]},l=`${c}Content-Type: application/json\r
\r
${JSON.stringify(s)}${c}Content-Type: image/jpeg\r
Content-Transfer-Encoding: base64\r
\r
${e}${d}`,u=gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":`multipart/mixed; boundary="${a}"`},body:l}),p=f=>{try{BFN.BfnService.callbackDriveInsertFile()}catch{}};u.execute(p)}}else if(i[google.picker.Response.ACTION]==google.picker.Action.CANCEL){notApiLoadedGoToApp();try{BFN.BfnService.callbackDriveInsertFile("cancel")}catch{}}},o=()=>{if(drv_pickerApiLoaded!==!1&&DRV_ACCESS!==null){let i=new google.picker.DocsView().setIncludeFolders(!0).setMimeTypes("application/vnd.google-apps.folder").setSelectFolderEnabled(!0);new google.picker.PickerBuilder().setAppId("303057181160").setOAuthToken(DRV_ACCESS).setTitle("Select a Folder").addView(i).setDeveloperKey("AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw").setOrigin(`${window.location.protocol}//${window.location.host}`).setCallback(n).build().setVisible(!0)}else notApiLoadedGoToApp()};drv_pickerApiLoaded!==!1&&DRV_ACCESS!==null?o():drv_pickerApiLoaded===!1&&DRV_ACCESS!==null?gapi.load("picker",{callback:function(){drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=o,window.googleDrivePickerOpenerButton.click()}}):drvImmediatTryed==!1&&(drvImmediatTryed=!0,document.body.addClass("prevent-body-scroll"),gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},i=>{if(i&&!i.error){DRV_ACCESS=i.access_token;try{DRV_ACCESS_TIME=new Date().getTime()}catch{}gapi.load("picker",{callback:function(){drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=o,window.googleDrivePickerOpenerButton.click()}})}}),googleDriveCallbackCheck())};window.drv_pickerApiLoaded=!1;window.drvImmediatTryed=!1;window.driveApiLoadedCallback=null;window.drv_OpenPicker=()=>{if(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")drv_pickerApiLoaded!==!1&&DRV_ACCESS!==null?drv_createPicker():drv_pickerApiLoaded===!1&&DRV_ACCESS!==null?gapi.load("picker",{callback:onDrvPickerApiLoad}):drvImmediatTryed==!1&&(drvImmediatTryed=!0,document.body.addClass("prevent-body-scroll"),gapi.auth2.authorize({client_id:DRV_CLIENT_ID,scope:DRV_SCOPES,immediate:!1},handleDrvApiAuthResultImmediate),googleDriveCallbackCheck());else{window.driveApiLoadedCallback=window.drv_OpenPicker;try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch{}}};window.handleDrvApiAuthResultImmediate=e=>{e&&!e.error&&(DRV_ACCESS=e.access_token,gapi.load("picker",{callback:onDrvPickerApiLoad}))};window.onDrvPickerApiLoad=()=>{drv_pickerApiLoaded=!0,window.driveApiLoadedCallback=drv_createPicker,window.googleDrivePickerOpenerButton.click()};window.drv_createPicker=()=>{if(drv_pickerApiLoaded&&DRV_ACCESS){let e=new google.picker.View(google.picker.ViewId.DOCS);e.setMimeTypes("image/png,image/jpeg,image/jpg"),new google.picker.PickerBuilder().setAppId("303057181160").setOAuthToken(DRV_ACCESS).addView(e).addView(new google.picker.DocsUploadView).setDeveloperKey("AIzaSyAs50xh8tgvIStq5wYwMuEylaLS2-kYaqw").setOrigin(`${window.location.protocol}//${window.location.host}`).setCallback(drv_pickerCallback).build().setVisible(!0)}else notApiLoadedGoToApp()};window.notApiLoadedGoToApp=()=>{drvImmediatTryed=!1,openApp()};window.gaDriveScrollHandler=()=>{window.scrollTo(0,0)};window.drv_pickerCallback=e=>{if(e.action==google.picker.Action.PICKED){let t=e.docs[0].id;if(window.removeEventListener("scroll",window.gaDriveScrollHandler),t!==null){try{openApp()}catch{}if(typeof gapi!="undefined"&&typeof gapi.client!="undefined"&&typeof gapi.client.load!="undefined")gapi.client.load("drive",window.DRV_CLIENT_VERSION,()=>{try{BFN.PhotoEditorModel.confirmEditorLoadImage(()=>{checkDriveFile(t)})}catch{checkDriveFile(t)}});else try{createJavascriptElements("https://apis.google.com/js/api.js?onload=onDrvApiLoad")}catch{}}}else if(e.action.toLowerCase()!==google.picker.Action.LOADED){window.removeEventListener("scroll",window.gaDriveScrollHandler);try{openApp()}catch{}}else window.addEventListener("scroll",window.gaDriveScrollHandler)};var tr=!1,nr=!1;BeFunky.loginWithGoogle=()=>{if(BeFunky.showLoadScreen(),BeFunky.isAppleAppStoreApp)return new Promise((e,t)=>{window.execNative({type:"google_login"},n=>{if(n.error)return t(n.error);if(typeof n.id!="undefined"&&typeof n.email!="undefined")return e(BeFunky.handleSocialLogin("google",n))})});window.location.hostname==="localhost"?document.domain="localhost":document.domain="befunky.com",window.openCustomPopup(`${BeFunky.Params.siteUrl}GoogleLogin.php?__optkn=${getCsToken()}`,BeFunky.attemptGoogleLogin)};BeFunky.attemptGoogleLogin=e=>{if(!e||e==="cancel"){tr||BeFunky.hideLoadScreen();return}let{id:t,name:n,email:o,profile_image:i,access_token:r}=e;tr=!0,BeFunky.handleSocialLogin("google",{id:t,name:n,email:o,profile_image:i,access_token:r}).catch(()=>{}).then(()=>{tr=!1,BeFunky.hideLoadScreen()})};BeFunky.onLoad(()=>{if(BeFunky.isAppleAppStoreApp||BeFunky.isLoggedIn()||BeFunky.isSafari||BeFunky.isIOS)return;let e=document.createElement("script");e.src="https://accounts.google.com/gsi/client",e.onload=()=>{!window.google||(google.accounts.id.initialize({client_id:"303057181160-pvs0ajfctrvv15i4rmirjsve2plp8m92.apps.googleusercontent.com",prompt_parent_id:"g_id_onload",callback:window.handleGoogleLoginPrompt}),google.accounts.id.prompt())},document.head.appendChild(e)});window.handleGoogleLoginPrompt=e=>{if(BeFunky.isLoggedIn()||BeFunky.isSafari||BeFunky.isIOS||!window.google)return;if(nr){BeFunky.logWarning("Ignoring duplicate one-tap callback",e);return}if(BeFunky.isLoggedIn())return;console.log("One tap callback",e);let{credential:t}=e;if(!t)return;nr=!0;let n=!1;BeFunky.showLoadScreen({onCancel:()=>{n=!0}}),BeFunky.handleSocialLogin("google",{access_token:t}).catch(o=>{BeFunky.reportWarning("Social login failed after one-tap",o)}).then(()=>{BeFunky.hideLoadScreen(),nr=!1})};var or=!1;BeFunky.loginWithApple=()=>{if(BeFunky.isAppleAppStoreApp)return new Promise((e,t)=>{window.execNative({type:"apple_login"},n=>{if(n.error)return t(n);if(typeof n.id!="undefined"&&typeof n.email!="undefined")return e(BeFunky.handleSocialLogin("apple",n))})});document.domain="befunky.com",BeFunky.showLoadScreen(),window.openCustomPopup(`${BeFunky.Params.siteUrl}api/applelogin.php?__optkn=${getCsToken()}`,BeFunky.attemptAppleLogin)};BeFunky.attemptAppleLogin=e=>{if(!e||e==="cancel"){or||BeFunky.hideLoadScreen();return}let{id:t,name:n,email:o,access_token:i}=e;or=!0,BeFunky.handleSocialLogin("apple",{id:t,name:n,email:o,access_token:i}).catch(()=>{}).then(()=>{or=!1,BeFunky.hideLoadScreen()})};BeFunky.handleSocialLogin=function(e,t){return new Promise((n,o)=>{if(!["google","facebook","apple"].includes(e))return o(`Invalid social provider: ${e}`);let{id:i,email:r,name:a,gender:c,user_birthday:d,access_token:s}=t,l={user_id:i||"",sntype:e==="google"?"GOOGLE":e==="apple"?"APPLE":"FACEBOOK",email:r||"",CSRFtoken:getCsToken(),screenname:a||"",gender:c||"",user_birthday:d||"",access_token:s||""};if(BeFunky.isAppleAppStoreApp){let u=BeFunky.getLocal("appstore_otid");u&&(l.originalTransaction=u)}BeFunky.requestAPI("auth/sn-login",l).then(u=>{let p=["true",!0].includes(u.data.newUser)?"_NEW":"";return window.bf_eventTrack("EXTERNAL","SIGNIN_SOCIAL",e.toUpperCase()+p),BeFunky.onLoginSuccess(u.data),n(u.data)}).catch(u=>{if(typeof u=="string"&&typeof u.length!="undefined"&&u.toLowerCase().startsWith("users_not_match")){let p=u.toLowerCase().replace("users_not_match_",""),f=window.hideEmail(p);BeFunky.acknowledge(["prompt_use_appstore_account",{email:f}]),u="error_invalid_response"}if(u==="already_logged_in")return BeFunky.handleAlreadyLoggedInError(r).then(p=>{BeFunky.onLoginSuccess(p),n(p)}).catch(p=>{if(p==="different_user_logged_out")BeFunky.logError("Attempting sign in again now that existing user has been signed out"),BeFunky.handleSocialLogin(e,t).then(n,o);else throw u});throw u}).catch(u=>(BeFunky.logError("Social login failed:",u),o(u)))})};window.openCustomPopup=(e,t)=>{let n=750,o=600;e.includes("weheartit.com")&&(o=800);let i=screen.width/2-n/2,r=screen.height/2-o/2,a=null;try{a=window.open(e,"APP",`top=${r},left=${i},width=${n},height=${o},resizable=1`);try{a.focus()}catch{}}catch{t&&t("cancel");return}c();function c(){a==null||a.closed?t&&t("cancel"):setTimeout(c,500)}};BeFunky.openPopupWithBlockingWorkaround=(e,t)=>{let n=!1,o=()=>{n=!0};window.addEventListener("blur",o);let i,r=()=>{clearTimeout(i),window.removeEventListener("blur",o)};t(r,!1),i=setTimeout(()=>{n||BeFunky.acknowledge(e,{onAcknowledge:()=>t(r,!0),buttonText:"try_again"})},200)};var fs=class{constructor(){this.mightBeAuthorized=Boolean(getCookie("PHPSESSID"))}login(t=!0){return BeFunky.isAppleAppStoreApp?new Promise((n,o)=>{window.execNative({type:"google_photos_login"},i=>{if(i.error)return o(i.error);if(typeof i.code!="undefined"){let r=`${BeFunky.Params.siteUrl}api/google-photos/token/?__optkn=${getCsToken()}&code=${i.code}`,a={method:"GET",responseType:"text"};return BeFunky.request(r,a,({response:c,error:d})=>{if(d)return o({error:d});this.mightBeAuthorized=!0,n()})}return o("cancelled_by_user")})}):new Promise((n,o)=>{let i=()=>{this.loginSuccess&&this.loginSuccess("cancel"),this.loginSuccess=r=>{if(r==="cancel")return o("cancelled_by_user");this.mightBeAuthorized=!0,n()},window.location.hostname==="localhost"?document.domain="localhost":document.domain="befunky.com",window.openCustomPopup(`${BeFunky.Params.siteUrl}api/google-photos/token/?__optkn=${getCsToken()}`,BeFunky.GooglePhotosManager.loginSuccess)};if(!t)return i();BeFunky.confirm("google_photos_access",{onConfirm:i,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/gear.svg`,onCancel:()=>o("cancelled_by_user"),confirmText:"ok",cancelText:"cancel"})})}requestGooglePhotosAPI(t,n){return BeFunky.requestAPI(t,n,{logErrorMessage:!0}).catch(o=>{if(o!=="no_access_token")throw o;return this.mightBeAuthorized=!1,this.login().then(()=>this.requestGooglePhotosAPI(t,n))})}getAlbums(){return this.requestGooglePhotosAPI("google-photos/albums").then(({data:t})=>{if(!Array.isArray(t))throw"invalid_response";return t})}getAlbumMedia(t,n=""){return this.requestGooglePhotosAPI("google-photos/search-media",{album_id:t,next_page:n}).then(o=>{if(!Array.isArray(o.data))throw"invalid_response";return{mediaItems:o.data,nextPageToken:o.next_page}})}getMediaItem(t){return this.requestGooglePhotosAPI("google-photos/get-media-item",{id:t}).then(({data:n})=>{if(!n.id)throw"invalid_response";return n})}getAllMedia(t=""){return this.requestGooglePhotosAPI("google-photos/list-all-media",{next_page:t}).then(n=>{if(!Array.isArray(n.data))throw"invalid_response";return{mediaItems:n.data,nextPageToken:n.next_page}})}createAlbum(t){return this.requestGooglePhotosAPI("google-photos/create-album",{title:t}).then(({data:n})=>{if(!n.album_id)throw"invalid_response";return n})}uploadMedia(t,n,o){let i=()=>BeFunky.uploadFileToS3(t,{bucket:"artsyupload",contentType:t.type||"image/jpeg"}),r=a=>{let c={image_url:a,file_name:n};return o&&(c.album_id=o),this.requestGooglePhotosAPI("google-photos/upload-media",c)};return i().then(({url:a})=>r(a))}downloadGooglePhoto(t){return Promise.all([o(),n()]).catch(i=>{BeFunky.logError("Google Photo baseUrl may have expired. Refreshing metadata...",i);let r=t.id.replace("google_photos_","");return this.getMediaItem(r).then(a=>{let[c]=this.mediaItemsToImageObjects([a]);return(t.imageWidth!==c.imageWidth||t.imageHeight!==c.imageHeight)&&BeFunky.throwError("Google Photos image dimensions changed",t,c),t.thumbURL=c.thumbURL,t.imageURL=c.imageURL,Promise.all([o(),n()])})});function n(){return new Promise((i,r)=>{BFN.RequestUtils.getBlob(`${BeFunky.Params.uplUri}/loadImage.php?c=${encodeURIComponent(t.imageURL)}`,({blob:a,error:c})=>{if(c)return r(c);i(a)})})}function o(){return new Promise((i,r)=>{BFN.RequestUtils.getBase64(`${BeFunky.Params.uplUri}/loadImage.php?c=${encodeURIComponent(t.thumbURL)}`,({error:a,base64:c})=>{if(a)return r(a);i(c)})})}}mediaItemsToImageObjects(t){let n=BeFunky.isRetina()?300:200;return t.filter(({mimeType:o,width:i,height:r})=>/^image\//.test(o)&&i&&r).map(o=>{let i,r,a,c=o.width/o.height,d=BFN.maxImageSize;return o.width<d&&o.height<d?(i=`${o.baseUrl}=w${o.width}`,r=o.width,a=o.height):c>=1?(i=`${o.baseUrl}=w${d}`,r=d,a=Math.round(d/c)):(i=`${o.baseUrl}=h${d}`,r=Math.round(d*c),a=d),{id:`google_photos_${o.id}`,imageURL:i,imageWidth:r,imageHeight:a,thumbURL:`${o.baseUrl}=h${n}`,thumbWidth:Math.round(n*c),thumbHeight:n}})}disconnect(){return BeFunky.requestAPI("google-photos/disconnect",{},{showLoadScreen:!0}).then(t=>{if(t.data!=="success")throw"invalid_response";BeFunky.isAppleAppStoreApp&&(window.execNative({type:"google_photos_disconnect"}),this.mightBeAuthorized=!1)}).catch(t=>{throw BeFunky.reportWarning(`Google Photos disconnect failed: ${t}`),t})}};BeFunky.GooglePhotosManager=new fs;var Yu=1e3*30,Ku=1e3*60*60*6,hs=BeFunky.Params.IS_LC?Yu:Ku,ms=0,ys=()=>{},ir=BeFunky.debounce(e=>{window.swIndicator&&window.swIndicator.update(e,ar,ms>0)},0),rr=BeFunky.debounce(e=>{["installing","waiting","active"].map(t=>e[t]).filter(Boolean).forEach(t=>{t.version?ir(e):ws(t).then(()=>ir(e))})},50);window.addEventListener("appinstalled",()=>{window.bf_eventTrack("EXTERNAL","PWA","Installed"),BeFunky.setLocal("pwa_installed_time",Date.now().toString()),lr()});BeFunky.onMatchMedia("(display-mode: standalone)",()=>lr());lr();Fs();BeFunky.shouldInstallNativeApp=(BeFunky.isAndroid||BeFunky.isIOS)&&!BeFunky.isInstalled()&&!BeFunky.getLocal("pwa_installed_time");if("serviceWorker"in navigator&&(navigator.serviceWorker.addEventListener("controllerchange",Fs),BeFunky.onLoad(()=>{!window.webgl_is_supported||BeFunky.isAppleAppStoreApp||Ju()}),window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),!BeFunky.isMobile&&(BeFunky.beforeInstallPromptEvent=e)}),["#use-shared-pwa-image","#use-shared-twa-image"].includes(window.location.hash))){let e=bs(navigator.serviceWorker.controller,{type:"READY_FOR_IMAGE"});BeFunky.editorExternalImage={behavior:"load_instead_of_autosave",loadImage:()=>{BeFunky.withLoadScreen(e).then(t=>{qe("Device shared image to PWA",t),BFN.PhotoEditorModel.loadNewImage(t.media||t.mediaFromPWA,{filename:"BeFunky-snapshot"}),BFN.BfnService.track("CREATE","UPLOAD","SHARE_TARGET"),BFN.BfnService.trackMediaOpened("image","computer")}).catch(t=>{BeFunky.reportWarning(`Share target failed: ${t.name||t}`,t)})}},setTimeout(()=>{window.location.hash=""},100)}function Ju(){navigator.serviceWorker.register(`${BeFunky.Params.siteUrl}service-worker.js`).then(e=>{qe("Registration",Lt(e)),window.swReg=e,e.addEventListener("updatefound",()=>{Qu(e.installing,e),e.installing.addEventListener("statechange",()=>rr(e))}),e.waiting&&(_s(e.waiting,e),e.waiting.addEventListener("statechange",()=>rr(e))),e.active&&!BeFunky.usingServiceWorker()&&(qe("Asking to be claimed after hard refresh"),e.active.postMessage({type:"CLAIM_CLIENTS"})),setTimeout(()=>ar(e,hs),hs),rr(e)}).catch(e=>{e.name!=="AbortError"&&e.name!=="SecurityError"&&BeFunky.reportWarning(`Unable to register service worker: ${e.name}`,e)})}function qe(...e){BeFunky.logFeature("service_worker",...e)}function Qu(e,t){e.addEventListener("statechange",function n(o){o.target.state==="installed"&&(e.removeEventListener("statechange",n),_s(e,t))})}function _s(e,t){t.installing||t.waiting!==e||ws(e).then(n=>{if(t.installing||t.waiting!==e){qe(`Aborted update to version ${n}`,Lt(t));return}if(n===BeFunky.Params.serviceWorkerVersion){qe(`Activating version ${n} since it matches page`,Lt(t)),ys(),setTimeout(()=>{ks(e,t,!1)},1e3);return}qe(`Ready to update to version ${n} if it's the latest`,Lt(t)),ar(t).then(()=>{t.installing||t.waiting!==e||!BeFunky.isInstalled()||(qe(`Showing reload toast for ${n}`,Lt(t)),ys=BeFunky.showToast({message:"new_version_available",acceptButton:"refresh",onAccept:()=>{t.waiting?ks(t.waiting,t):t.active===e?(qe("Reloading page after SW activated in different tab... "),sr()):BeFunky.throwError("Unexpected SW state")},onDismiss:()=>{qe("Dismissed service worker update")}}))})})}function Lt(e){return{installing:e.installing?e.installing.version||!0:!1,waiting:e.waiting?e.waiting.version||!0:!1,active:e.active?e.active.version||!0:!1}}function ar(e,t){let n=typeof t!="number";return qe(n?"Checking for updated SW once":`Polling for updated SW every ${t/1e3}s`),o();function o(){return i(1),e.update().catch(a=>{BeFunky.logError("Unable to check for new SW",a,Lt(e))}).then(()=>{i(-1),n||r()})}function i(a){ms+=a,ir(e)}function r(){setTimeout(()=>{qe("Polling for new SW..."),requestIdleCallback(o)},t)}}function ks(e,t,n=!0){if(!n){e.postMessage({type:"SKIP_WAITING"});return}BeFunky.showLoadScreen(),BeFunky.whenOnline().then(()=>{e.postMessage({type:"SKIP_WAITING"});let o=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{qe("New service worker activated",Lt(t)),BeFunky.hideLoadScreen(),!o&&(o=!0,sr())}),setTimeout(()=>{o||(o=!0,BeFunky.reportWarning("SKIP_WAITING timed out after 5s",Lt(t)),sr())},5e3)})}function ws(e){return e.version?Promise.resolve(e.version):bs(e,{type:"GET_VERSION"}).then(t=>(t.version||BeFunky.throwError("Unable to get service worker version",t),e.version=t.version,t.version))}function bs(e,t){return new Promise(n=>{let o=new MessageChannel;o.port1.onmessage=function(i){n(i.data)},e.postMessage(t,[o.port2])})}function sr(){if(!window.BFN||!BFN.ProjectManager||BFN.ProjectManager.isFullyAutoSaved())qe("Reloading page..."),window.location.reload();else if(BeFunky.isMobile)BeFunky.acknowledge("save_then_reopen");else{let t=`padding: 0 4px; border: 1px solid; border-radius: 3px; opacity: 0.8; margin: 0 2px;${BeFunky.isMac?"":"letter-spacing: -0.5px;"}`;BeFunky.acknowledge(["save_then_refresh",{shortcut:`<string style="${t}">${e("R")}</string>`}])}function e(t){let n="\u2009";return[BeFunky.isMac?"\u2318":"Ctrl",...t.split("")].join(BeFunky.isMac?n:`${n}+${n}`)}}function Fs(){BeFunky.setSentryTag("sw",BeFunky.usingServiceWorker())}function lr(){Zu(),BeFunky.isInstalled()&&requestIdleCallback(()=>ed())}function Zu(){BeFunky.setSentryTag("installed",BeFunky.isTWA?"twa":BeFunky.isInstalled()?"pwa":!1)}var vs=!1;function ed(){if(vs)return;vs=!0,[document.querySelector(".site-nav__logo"),document.querySelector(".site-footer__logo")].filter(Boolean).forEach(t=>{t.href=BeFunky.getDashboardUrlInLanguage()}),BeFunky.isAndroid&&BeFunky.isTWA&&BeFunky.isDashboard()&&[document.getElementById("whats-new"),document.querySelector(".site-footer")].filter(Boolean).forEach(t=>t.setStyles({display:"none"}));let e=document.querySelector(".site-footer__link[data-lang=visionn]");e&&e.setStyles({display:"none"}),document.body.addEventListener("click",t=>{let n=t.target.closest?t.target.closest("a[href]"):null;if(!n)return;let o=BeFunky.shouldOpenInNewTabNotPWA(n.href),i=n.getAttribute("target")==="_blank",r=!n.href.startsWith(BeFunky.Params.siteUrl);if(qe({shouldOpenInNewTab:o,willOpenInNewTab:i,isExternalLink:r,href:n.href}),o&&BeFunky.isAndroid&&BeFunky.isTWA&&!n.href.startsWith("https://play.google.com")){console.log("Force open link in Chrome from Android TWA"),n.href=`${n.href.replace("https://","intent://")}#Intent;scheme=https;package=com.android.chrome;end`;return}if(BeFunky.isAppleAppStoreApp&&n.href.startsWith(`${BeFunky.Params.siteUrl}my-account/`)){t.preventDefault(),td();return}if(BeFunky.isAppleAppStoreApp&&n.href.startsWith(`${BeFunky.Params.siteUrl}myphotos/`)){t.preventDefault(),BFN.ImageLibraryManager.openModal("befunky");return}o!==i&&(o?(n.setAttribute("target","_blank"),n.setAttribute("rel",r?"noopener":"")):(n.removeAttribute("target"),n.removeAttribute("rel")))},!0)}function td(){if(!BeFunky.isLoggedIn())return BeFunky.reportWarning("Not logged in for My Account");let{elem:e,lang:t}=BeFunky.lit,n=e`
    <div id="my_account_modal">
        <div class="section section--bg-offwhite section--page-header">
            <div class="section__no-grid">
                <h1 class="h3" data-lang="account">${t("account")}</h1>
            </div>
        </div>
        <div></div>
    </div>`;BeFunky.setupMyAccountPage(n.lastElementChild),BeFunky.openModal(n,{addLightThemeClass:!0,addCloseButton:!0,isFullWidthOnMobile:!0,closeOnEscape:!1,destroyOnClose:!0})}var Bs=class{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){this.modal=null}openProjectModal(){if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();this.modal=this.modal||BeFunky.createProjectManagerModal(),this.modal.open()}openUserSavedProject(t,n){let o=BeFunky.isModalOpen("project_manager");return BFN.SavedProjectService.fetchBFD(t.fileurl).then(i=>{o&&BeFunky.closeModal("project_manager");let r=t.filename?t.filename.replace(/\.bfd$/i,""):void 0;return BFN.ProjectManager.confirmAndOpenProject(i,{filename:r,source:"befunky",thumbnail:n||this.getThumbURL(t,308)})}).catch(i=>(o&&this.openProjectModal(),i==="user_not_plus"&&BeFunky.openTeaserModal("plus_templates"),Promise.reject(i)))}getThumbURL(t,n){if(!t.thumburl)return BeFunky.throwError("User-saved project missing thumburl",t),"";let o={auto:"avif,webp",width:i(n*(BeFunky.isRetina()?1.5:1))};return BeFunky.addParamsToURL(t.thumburl,o);function i(r){return Math.ceil(r/50)*50}}openProjectFromOutsideOfApp(t){let n=BeFunky.isModalOpen("project_manager"),o=t.project_type;if(!["editor","collage","designer"].includes(o))return BeFunky.throwError("Invalid project_type",o);BeFunky.projectToOpenInSection[o]={projectName:t.filename,behavior:"ask_user",loadProject:async()=>{let r=await BFN.SavedProjectService.fetchBFD(t.fileurl),a=t.filename?t.filename.replace(/\.bfd$/i,""):void 0;return BFN.ProjectManager.confirmAndOpenProject(r,{filename:a,source:"befunky",skipConfirmation:!0})},getNewProjectThumbnail:()=>({image:BeFunky.SavedProjectManager.getThumbURL(t,308)})},ve({editor:"/create/",collage:"/create/collage/",designer:"/create/designer/"}[o]),n&&BeFunky.closeModal("project_manager")}};BeFunky.SavedProjectManager=new Bs;var nd={37:"left",39:"right",38:"up",40:"down"},Mn=[];BeFunky.addArrowKeyHandler=e=>{if(typeof e.callback!="function"||typeof e.condition!="function"){BeFunky.throwError("invalid arrow key handler",e);return}if(!Mn.includes(e))return Mn.push(e),function(){Mn.splice(Mn.indexOf(e),1)}};document.addEventListener("keydown",Ss);document.addEventListener("keyup",Ss);function Ss(e){if(BeFunky.isLoadScreenActive())return;let t=nd[e.keyCode];if(!t)return;let n=document.activeElement;if(!n)return;let o=Mn.find(({condition:i})=>i(n));!o||o.callback(n,t,e)||(e.stopImmediatePropagation(),e.preventDefault())}var Ps=class{constructor(){this.imagesPerPage=50,this.resetImageData()}resetImageData(){this.imageData={totalImages:null,fetchedImages:[],startPhotos:0,startLayers:0}}getPhotosAndLayers(t=1,n){if(!BeFunky.isLoggedIn())return n({error:"not_logged_in"});let{totalImages:o,fetchedImages:i}=this.imageData,r=t*this.imagesPerPage>i.length&&o>i.length;if(o==null||r)return this.getImagesFromAPI({startPhotos:this.imageData.startPhotos,startLayers:this.imageData.startLayers},({error:d,data:s,totalImages:l,startPhotos:u,startLayers:p})=>{if(d)return n({error:d});this.imageData={totalImages:l,fetchedImages:i.concat(s),startPhotos:u,startLayers:p},this.getPhotosAndLayers(t,n)});let a=(t-1)*this.imagesPerPage,c=a+this.imagesPerPage;return n({data:i.slice(a,c),totalPages:Math.ceil(o/this.imagesPerPage)})}getImagesFromAPI({startPhotos:t=0,startLayers:n=0}={},o){let i={start_images:t,start_layers:n,end:100};BeFunky.requestAPI("photo/library-images",i).then(r=>{let{data:a,total:c,start_images:d,start_layers:s}=r;if(!Array.isArray(a)||typeof c!="number"||typeof d!="number"||typeof s!="number")throw"invalid_response";if(a.length===0)throw"no_results";let l=a.map(u=>{let f=u.type==="befunky_layers"?"befunky_layer":"befunky_photo",g=u.url.endsWith(".png");return{id:`${f}_${u.id}`,date:u.dateCreated,imageURL:BeFunky.addParamsToURL(u.url,{io:"off"}),isTransparent:g,getImageURL:y=>m(u.url,y),thumbURL:m(u.url,108),thumbWidth:200,thumbHeight:200,title:u.title};function m(y,h){let k={auto:"avif,webp",width:_(h*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(y,k)}function _(y){return Math.ceil(y/50)*50}});return o({data:l,totalImages:c,startPhotos:d,startLayers:s})}).catch(r=>o({error:r}))}};BeFunky.ImagesService=new Ps;var Ls=class{constructor(){this.facebookAppID=typeof BeFunky.Params.facebook_app_id!="undefined"?BeFunky.Params.facebook_app_id:"120991377944644",this.scopes=typeof BeFunky.Params.facebook_app_scopes!="undefined"?BeFunky.Params.facebook_app_scopes:"email,public_profile,user_photos",this.fields="id,name,email",this.loadSdkPromise=null,this.hasBeenAuthorized=!1}loadSdk(){if(this.loadSdkPromise)return this.loadSdkPromise;if(this.loadSdkPromise=deferredPromise(),!document.getElementById("facebook-jssdk")){let t=document.createElement("div");t.id="fb-root",document.body.appendChild(t),window.fbAsyncInit=()=>{FB.init({appId:this.facebookAppID,cookie:!0,version:"v13.0"}),this.loadSdkPromise.resolve()},function(n,o,i){if(n.getElementById(i))return;let r=n.createElement(o),a=n.getElementsByTagName(o)[0];r.id=i,r.src="https://connect.facebook.net/en_US/sdk.js",r.onerror=()=>{BeFunky.logError(`Failed to load Facebook SDK${BeFunky.isFirefox?" b/c Firefox Private browsing":""}`),this.loadSdkPromise.reject("sdk_did_not_load"),this.loadSdkPromise=null,r.parentNode.removeChild(r)},a.parentNode.insertBefore(r,a)}.call(this,document,"script","facebook-jssdk")}return this.loadSdkPromise}getAccessToken(t){let n=this.scopes;if(t&&!n.split(",").includes(t))throw new Error(`Unsupported scope: ${t}`);if(BeFunky.isAppleAppStoreApp){let c={scopes:t.split(",")};return new Promise((d,s)=>{window.execNative({type:"facebook_access_token",req_params:c},l=>l&&typeof l.accessToken=="undefined"?s("unknown"):d({accessToken:l.accessToken}))})}return this.loadSdk().then(()=>new Promise((c,d)=>{if(window.location.protocol!=="https:")return BeFunky.logError("FB.getLoginStatus not called b/c this is a non-SSL page"),d("unknown");FB.getLoginStatus(({status:s,authResponse:l})=>{if(s==="connected")return c({accessToken:l.accessToken});c(o())},!0)})).then(c=>(this.hasBeenAuthorized=!0,t&&!Array.isArray(c.grantedScopes)?i().then(d=>({accessToken:c.accessToken,grantedScopes:d})):c)).then(c=>t&&!r(c.grantedScopes)?a():c);function o(c=!1){let d={scope:n,return_scopes:!0};return c&&(d.auth_type="rerequest"),new Promise((s,l)=>{BeFunky.openPopupWithBlockingWorkaround(["browser_block_social_login",{provider:"Facebook"}],u=>{FB.login(({status:p,authResponse:f})=>{if(u(),p==="connected"){let{accessToken:g,grantedScopes:m}=f;return s({accessToken:g,grantedScopes:m})}return l(p)},d)})})}function i(){return new Promise((c,d)=>{FB.api("/me/permissions",s=>{if(Array.isArray(s.data)){let u=s.data.filter(({status:p})=>p==="granted").map(({permission:p})=>p).join(",");return console.log("Granted scopes:",u),c(u)}let l;try{l=JSON.stringify(s)}catch{}BeFunky.throwError("Unable to get granted scopes from FB API",l||s),d("invalid_response")})})}function r(c){return c.split(",").includes(t)}function a(){return new Promise((c,d)=>{let s=`facebook_access_${t}`;BeFunky.LanguageManager.isTranslated(s)||(s=`Please allow BeFunky to access your Facebook ${t.replace(/_/g," ")}.`),BeFunky.confirm(s,{onConfirm:()=>{o(!0).then(l=>{if(r(l.grantedScopes))return c(l);d(`${t}_scope_declined`)}).catch(d)},onCancel:()=>{d(`${t}_scope_declined`)},confirmText:"continue"})})}}getUserData(){return this.getAccessToken("email").then(({accessToken:t})=>new Promise((n,o)=>{BeFunky.isAppleAppStoreApp?window.execNative({type:"facebook_user_info",req_params:{fileds:this.fields}},i=>{if(i.error)return o(i.error);i.access_token=t,n(i)}):FB.api("/me",{fields:this.fields},i=>{if(i.error)return o(i.error);i.access_token=t,n(i)})}))}loginWithFacebook(){return this.getUserData().then(t=>!t.email||!t.email.length?(BeFunky.confirm("facebook_email_login_failed",{onConfirm:()=>{BeFunky.openLoginPanel("REGISTER",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)},onCancel:()=>{window.open("https://www.facebook.com/","_blank")},confirmText:"register_with_email",cancelText:"go_to_facebook"}),Promise.reject("missing_email")):BeFunky.handleSocialLogin("facebook",t))}getPhotoAlbums(){return this.getAccessToken("user_photos").then(({accessToken:o})=>new Promise((i,r)=>{let c=`https://graph.facebook.com/v13.0/me?${["fields=albums.fields(name,photos.fields(picture,images).limit(100))",`access_token=${o}`].join("&")}`,d={headers:{"Content-Type":"application/x-www-form-urlencoded"}};BeFunky.request(c,d,({response:s,error:l})=>{if(l)return r(l);if(!s||!s.albums||!Array.isArray(s.albums.data))return r("invalid_response");let u=s.albums.data.filter(({photos:f})=>f&&f.data&&f.data.length);if(!u.length)return r("no_results");let p=u.map(({id:f,name:g,photos:m})=>{let _={id:f,name:g,nextPageURL:m.paging.next};return _.images=m.data.map(n).filter(Boolean),_});i(Promise.all(p.map(t)))})}),o=>(BeFunky.logError("Unable to get Facebook access token:",o),Promise.reject("invalid_access_token")));function t(o){return o.nextPageURL?new Promise(i=>{BeFunky.request(o.nextPageURL,{},({response:r,error:a})=>a||!r||!Array.isArray(r.data)?(BeFunky.throwError("Unable to get next page of Facebook album results",{error:a,response:r}),i(o)):(o.images=[...o.images,...r.data.map(n).filter(Boolean)],o.nextPageURL=r.paging.next,i(t(o))))}):o}function n(o){if(!o||!o.images||!o.images.length)return;let i=o.images.slice().sort((d,s)=>d.width>s.width?1:-1),r=i[i.length-1],a=275,c=i.find(d=>d.height>=a)||r;return{id:`facebook_${o.id}`,imageURL:r.source,imageWidth:r.width,imageHeight:r.height,thumbURL:c.source,thumbWidth:c.width,thumbHeight:c.height}}}};BeFunky.FacebookAuth=new Ls;var Cs=class{constructor(){this.init()}init(){this.initDefaultValues()}initDefaultValues(){}isValid(t,n){let o=/^[0-9A-F]{6}$/i,i={autosave:r=>["yes","no","ask"].includes(r),language:r=>BeFunky.LanguageManager.appLanguages.includes(r),artsy_fav:r=>Array.isArray(r)&&r.every(a=>typeof a=="string"),effects_fav:r=>Array.isArray(r)&&r.every(a=>typeof a=="string"),texture_fav:r=>Array.isArray(r)&&r.every(a=>typeof a=="string"),batch_processing_fav:r=>Array.isArray(r)&&r.every(a=>typeof a=="string"),fonts_fav:r=>Array.isArray(r)&&r.every(a=>typeof a=="string"),fonts_added:r=>Array.isArray(r)&&r.every(a=>a.type&&a.name&&(a.weights||a.weight&&a.fileName)),colors_recent:r=>Array.isArray(r)&&r.every(a=>o.test(a)),color_library:r=>Array.isArray(r)&&r.every(a=>typeof a.name=="string"&&Array.isArray(a.colors)&&a.colors.every(c=>o.test(c))&&a.colors.length<=100),watermarks:r=>Array.isArray(r)&&r.every(a=>a&&typeof a=="object"),use_case:r=>typeof r=="string",snapping:r=>["yes","no"].includes(r),display_distances:r=>["yes","no"].includes(r),guides:r=>["yes","no"].includes(r),dismissed_messages:r=>Array.isArray(r)&&r.every(a=>typeof a=="string"),trialing:r=>["trialing","plus","free",""].includes(r),theme_color:r=>["dark","light"].includes(r),canvas_bg_color:r=>["dark","light"].includes(r)};return i[t]?Boolean(i[t](n)):null}validateSettings(t,n=!1){let o={},i=n?"fetched from API":"specified by client";return!t||typeof t!="object"?(BeFunky.throwError(`Invalid settings ${i}. settings type = ${BeFunky.getType(t)}`),o):(Object.entries(t).forEach(([a,c])=>{let d=this.isValid(a,c);if(d===null){BeFunky.logError(`Unrecognized Setting "${a}" ${i}`);return}d?o[a]=t[a]:BeFunky.throwError(`Invalid settings ${i}. id = ${a}, value = ${c} (${BeFunky.getType(c)})`)}),o)}getUserSettings(t){let n=o=>{let i;o===""?(BeFunky.logError("No settings fetched from API"),i={}):i=this.validateSettings(o,!0),t({settings:i})};window.initialUserStatus.then(()=>{window.latestUserData.options?n(window.latestUserData.options):BeFunky.requestAPI("auth/get-user-options").then(o=>{if(typeof o.data!="object")throw"invalid_response";n(o.data)}).catch(o=>{t({error:o})})})}updateSetting(t,n){return new Promise((o,i)=>{if(window.BFN&&BFN.SettingsManager)return BFN.SettingsManager.updateSetting(t,n),o();this.updateUserSettings({[t]:n},({error:r})=>{r?i(r):o()})})}updateUserSettings(t,n){let o=this.validateSettings(t,!1);if(!Object.keys(o).length)return n({error:"No valid settings provided"});let i=JSON.stringify({data:o}),r=btoa(encodeURIComponent(i));BeFunky.requestAPI("auth/update-user-options",{data:r}).then(a=>{if(a.data!=="success")throw"invalid_response";if(BeFunky.isLoggedIn())try{Object.keys(o).includes("use_case")&&typeof o.use_case!="undefined"&&o.use_case.length>0&&typeof window.bfn_mp!="undefined"&&window.bfn_mp.identifier!==0&&typeof mixpanel!="undefined"&&mixpanel.people.set({"Use Case":o.use_case})}catch{}window.latestUserData.options&&Object.assign(window.latestUserData.options,o),n({success:!0})}).catch(a=>{n({error:a})})}};BeFunky.SettingsService=new Cs;var Es=class{constructor(){this.init()}init(){this.resetProjectData()}resetProjectData(){this.projectData={allProjectsFetched:!1,totalProjects:null,fetchedProjects:[]}}getFirst100Projects(){let{allProjectsFetched:t,fetchedProjects:n}=this.projectData;return t||n.length>=100?Promise.resolve(n.slice(0,100)):BeFunky.requestAPI("photo/projects/get",{start:0,end:100}).then(o=>{let i=o.data,r=parseInt(o.total);return Array.isArray(i)?!r||!i.length?Promise.reject("no_results"):(r<=100?(this.projectData.allProjectsFetched=!0,this.projectData.fetchedProjects=i,this.projectData.totalProjects=r):this.projectData.fetchedProjects.length||(this.projectData.allProjectsFetched=!1,this.projectData.fetchedProjects=i,this.projectData.totalProjects=r),i):Promise.reject("invalid_response")})}getAllProjects(){let{allProjectsFetched:t,fetchedProjects:n}=this.projectData;return t?Promise.resolve(n):BeFunky.requestAPI("photo/projects/get",{all:1}).then(o=>{let i=o.data,r=parseInt(o.total);return Array.isArray(i)?!r||!i.length?Promise.reject("no_results"):(this.projectData.fetchedProjects=i,this.projectData.allProjectsFetched=!0,this.projectData.totalProjects=r,i):Promise.reject("invalid_response")})}searchProjects(t){let n={all:1,keyword:t};return BeFunky.requestAPI("photo/projects/get",n).then(o=>{let i=o.data,r=parseInt(o.total);return Array.isArray(i)?!r||!i.length?Promise.reject("no_results"):i:Promise.reject("invalid_response")})}async deleteProject(t,n=!1){if(!BeFunky.isLoggedIn())throw"not_logged_in";let o={template:t};if((await BeFunky.requestAPI("photo/projects/delete",o,{showLoadScreen:n})).data!=="success")throw"invalid_response";let r=this.projectData.fetchedProjects.findIndex(({id:a})=>a===t);r!==-1&&(this.projectData.fetchedProjects.splice(r,1),this.projectData.totalProjects&&this.projectData.totalProjects--)}};BeFunky.SavedProjectFetcher=new Es;function od(){if(!navigator.cookieEnabled)return;let e=window.getCookie("new_country");if(!e||(BeFunky.requestAPI("auth/update-country",{iso:e}).then(i=>{i.data!=="success"&&BeFunky.logError("Unable to update user country",i),window.setCookie("new_country","",-1)}).catch(i=>{BeFunky.logError("Unable to update user country",i)}),BeFunky.getFreeTrialEnabled())||BeFunky.usePlayStorePricing)return;if(id()){Ln(lt(),!0,!1),bf_eventTrack("ONBOARDING_7DAY_TRIAL_SAVE","TRIAL OFFERED",o(BeFunky.initialRoute));return}if(!Hi.includes(e))return;if(!["/features/collage-maker/","/features/crop-photo/"].includes(n(BeFunky.initialRoute))){BeFunky.isNewUserEligibleForFreeTrial=!0;return}Ln(e,!1),bf_eventTrack("ONBOARDING_7DAY_TRIAL","TRIAL OFFERED",o(BeFunky.initialRoute));function n(i){return i.split(/[?#]/)[0]}function o(i){return i.split(/[?#]/)[0].split("/").filter(Boolean).pop()}}BeFunky.onLoad(od);function id(){let e=`${BeFunky.Params.siteUrl.slice(0,-1)}${BeFunky.initialRoute}`,t=new URLSearchParams(new URL(e).search);return t.get("utm_source")==="google"&&t.get("utm_medium")==="cpc"}var As=class{constructor(){this.init()}init(){this.cachedFolders=null}encodeSpecialChars(t){return btoa(encodeURIComponent(t))}getFolders(){return this.cachedFolders?Promise.resolve(this.cachedFolders.slice()):BeFunky.requestAPI("photo/projects/folder/get/").then(({data:t})=>{if(!t)throw"invalid_response";return this.cachedFolders=t.slice(),t})}createFolder(t){let n=this.encodeSpecialChars(t);return BeFunky.requestAPI("photo/projects/folder/add/",{name:n},{showLoadScreen:!0}).then(({data:o})=>{if(!o.name||!o.folderId)throw"invalid_response";return this.cachedFolders&&this.cachedFolders.unshift(o),o})}addProjectsToFolder(t,n){return BeFunky.requestAPI("photo/projects/set-folder/",{folder:t>0?t:"not_set",projects:n.join(",")},{showLoadScreen:!0}).then(({data:o})=>{if(o!=="success")throw"invalid_response";return BeFunky.SavedProjectFetcher.projectData.fetchedProjects.filter(({id:i})=>n.includes(i)).forEach(i=>{i.folderId=t}),o})}renameFolder(t,n){let o=this.encodeSpecialChars(n);return BeFunky.requestAPI("photo/projects/folder/update/",{folder:t,name:o},{showLoadScreen:!0}).then(({data:i})=>{if(!i.name||!i.folderId)throw"invalid_response";return this.cachedFolders&&(this.cachedFolders.find(r=>r.folderId===t).name=i.name),i})}deleteFolder(t,n){return BeFunky.requestAPI("photo/projects/folder/delete/",{folder:t,is_delete_projects:n?1:0},{showLoadScreen:!0}).then(({data:o})=>{if(o!=="success")throw"invalid_response";let i=BeFunky.SavedProjectFetcher.projectData.fetchedProjects,r=i.filter(a=>a.folderId===t);if(n?BeFunky.SavedProjectFetcher.projectData.fetchedProjects=i.filter(a=>a.folderId!==t):r.forEach(a=>{a.folderId=0}),this.cachedFolders){let a=this.cachedFolders.findIndex(c=>c.folderId===t);a!==-1&&this.cachedFolders.splice(a,1)}return o})}};BeFunky.ProjectFolderService=new As;BeFunky.openAfterUpgradeDialog=e=>{BeFunky.openDialog({id:"after_upgrade_dialog",heading:"thank_you_heading",body:["thank_you_body",{thank_you_everything_you_need:BeFunky.toLinkHTML(`${BeFunky.Params.blogUrl}tutorials/`,!0),google_play:BeFunky.toLinkHTML("https://play.google.com/store/apps/details?id=air.com.befunky.BeFunkyPhotoEditor",!0),app_store:BeFunky.toLinkHTML("https://itunes.apple.com/us/app/befunky-photo-editor/id442716817?mt=8",!0)}],buttons:[{href:`${BeFunky.Params.blogUrl}befunky-plus/`,text:"learn_more",type:["blue"],focusInitially:!0}],imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/card-confetti.jpg`,modalOptions:{addCloseButton:!0,addLightThemeClass:!0,onClose:e}})};BeFunky.openAfterRegisterDialog=()=>{let{html:e,modalLang:t}=BeFunky.lit,n={google_play:BeFunky.toLinkHTML("https://play.google.com/store/apps/details?id=air.com.befunky.BeFunkyPhotoEditor",!0),app_store:BeFunky.toLinkHTML("https://itunes.apple.com/us/app/befunky-photo-editor/id442716817?mt=8",!0)},o=()=>e`
        <p>${t("welcome_features")}</p>
        ${BeFunky.isTWA||BeFunky.isAppleAppStoreApp?"":e`
            <p>${t(["welcome_download_links",n])}</p>`}
    `;BeFunky.openDialog({id:"after_register_dialog",heading:"welcome_heading",body:o,buttons:[{text:"learn_more",type:["blue"],focusInitially:!0,href:`${BeFunky.Params.siteUrl}/learn/new-befunky-mobile`}],imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/confetti.jpg`,modalOptions:{addCloseButton:!0,addLightThemeClass:!0}})};var rd={displayError(e,t){let n=Ts(e);if(!n.firstElementChild){let i=document.createElement("div").addClass("form-errors__container");n.appendChild(i);let r=document.createElement("button").setClass("button button--icon button--xs form-errors__close-button");r.innerHTML=BeFunky.getSvgHtml("cancel-icon",{classes:"icon icon--14"}),r.addEventListener("click",()=>{n.innerHTML=""}),n.appendChild(r)}let o=document.createElement("div");Array.isArray(t)?o.setLang(...t):o.setLang(t),n.firstElementChild.appendChild(o)},clearError(e){Ts(e).innerHTML=""}};function Ts(e){return e instanceof HTMLElement?e.querySelector(".form-errors"):document.querySelector(`${e} .form-errors`)}var Ht=rd;BeFunky.LoginPanelObj={onLogin:!1,onClose:!1};var cr=BeFunky.getLocal("skip_captcha_token"),ut=!cr&&!BeFunky.isAppleAppStoreApp;ut||console.log("Captcha disabled for testing");BeFunky.openLoginPanel=(e,t=!1,n=!1)=>{if(BeFunky.isInDemoMode())return BeFunky.acknowledgeDemoMode();switch(BeFunky.LoginPanelObj.onLogin=t,BeFunky.LoginPanelObj.onCloseWithoutLogin=n,e){case"SIGNIN":BeFunky.befunkyPopupContainerOpen("#sign_in_modal",{addCaptcha:ut}),BeFunky.isAppleAppStoreApp||BeFunky.FacebookAuth.loadSdk().catch(o=>{o==="sdk_did_not_load"&&BeFunky.isFirefox&&(document.getElementById("sign_in_modal_facebook").disabled=!0)});break;case"REGISTER":BeFunky.befunkyPopupContainerOpen("#register_modal",{addCaptcha:ut}),BeFunky.isAppleAppStoreApp||BeFunky.FacebookAuth.loadSdk().catch(o=>{o==="sdk_did_not_load"&&BeFunky.isFirefox&&(document.getElementById("register_modal_facebook").disabled=!0)});break;case"FORGETPASS":BeFunky.befunkyPopupContainerOpen("#reset_password_modal",{addCaptcha:ut});break}};function ur(){let e=document.getElementById("sign_in_form"),t=document.getElementById("sign_in_form_email"),n=document.getElementById("sign_in_form_password"),o=!1;Ht.clearError(e),e.querySelectorAll(".form-field__input").removeClass("form-field__input--invalid");let i=t.value=t.value.trim();window.isEmailAddress(i)===!1&&(t.addClass("form-field__input--invalid"),o=!0),n.value.length<=2&&(n.addClass("form-field__input--invalid"),o=!0);let r="";if(ut&&(r=BeFunky.getCaptchaResponse(),r===""&&(BeFunky.executeCaptcha(ur),o=!0)),o)return;let a={userEmail:i,userPassBa:btoa(encodeURIComponent(n.value)),captcha_response:r};if(BeFunky.isAppleAppStoreApp){let c=BeFunky.getLocal("appstore_otid");c&&(a.originalTransaction=c)}BeFunky.requestAPI("auth/login",a,{showLoadScreen:!0,headers:dr()}).then(c=>{BeFunky.onLoginSuccess(c.data)}).catch(c=>{if(c==="already_logged_in")return BeFunky.handleAlreadyLoggedInError(i).then(BeFunky.onLoginSuccess);throw c}).catch(c=>{if(typeof c=="string"&&typeof c.length!="undefined"&&c.toLowerCase().startsWith("users_not_match")){let s=c.toLowerCase().replace("users_not_match_",""),l=window.hideEmail(s);BeFunky.acknowledge(["prompt_use_appstore_account",{email:l}]),c="error_invalid_response"}if(c==="different_user_logged_out")return BeFunky.logError("Attempting sign in again now that existing user has been signed out"),ur();typeof c=="string"?BeFunky.logError("Unable to sign in user:",c):BeFunky.throwError(c,"Unable to sign in user"),ut&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));let d={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",different_user_logged_in:["error_please_refresh",{contact_support:`<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">${BeFunky.LanguageManager.getString("contact_support")}</a>`}],invalid_email:"error_email_password"};Ht.displayError(e,d[c]||"error_invalid_response")})}function xs(){let e=document.getElementById("register_form"),t=document.getElementById("register_form_email"),n=document.getElementById("register_form_confirm_email"),o=document.getElementById("register_form_password"),i=!1;Ht.clearError(e),e.querySelectorAll(".form-field__input").removeClass("form-field__input--invalid");let r=t.value=t.value.trim(),a=n.value=n.value.trim();window.isEmailAddress(r)===!1&&(t.addClass("form-field__input--invalid"),i=!0),a!==r&&(n.addClass("form-field__input--invalid"),i=!0),o.value.length<6&&(o.addClass("form-field__input--invalid"),i=!0);let c="";if(ut&&(c=BeFunky.getCaptchaResponse(),c===""&&(BeFunky.executeCaptcha(xs),i=!0)),i)return;let d={_email_:r,_email_again:a,_pass_ba_:btoa(encodeURIComponent(o.value)),captcha_response:c,em_effects:0,em_articles:1};if(BeFunky.isAppleAppStoreApp){let s=BeFunky.getLocal("appstore_otid");s&&(d.originalTransaction=s)}BeFunky.requestAPI("auth/register",d,{showLoadScreen:!0,headers:dr()}).then(s=>{BeFunky.onLoginSuccess(s.data)}).catch(s=>{if(typeof s=="string"&&typeof s.length!="undefined"&&s.toLowerCase().startsWith("users_not_match")){let u=s.toLowerCase().replace("users_not_match_",""),p=window.hideEmail(u);BeFunky.acknowledge(["prompt_use_appstore_account",{email:p}]),s="error_invalid_response"}typeof s=="string"?BeFunky.logError("Unable to register user:",s):BeFunky.throwError(s,"Unable to register user"),ut&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));let l={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",already_logged_in:["error_please_refresh",{contact_support:`<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">${BeFunky.LanguageManager.getString("contact_support")}</a>`}],invalid_email:"error_email_already_in_use"};Ht.displayError(e,l[s]||"error_invalid_response")})}function $s(){let e=document.getElementById("reset_password_form"),t=document.getElementById("reset_password_form_email"),n=!1;Ht.clearError(e),e.querySelectorAll(".form-field__input").removeClass("form-field__input--invalid");let o=t.value=t.value.trim();window.isEmailAddress(o)===!1&&(t.addClass("form-field__input--invalid"),n=!0);let i="";if(ut&&(i=BeFunky.getCaptchaResponse(),i===""&&(BeFunky.executeCaptcha($s),n=!0)),n)return;let r={_email_:o,captcha_response:i};BeFunky.requestAPI("auth/forget-pass",r,{showLoadScreen:!0,headers:dr()}).then(a=>{if(a.data!=="success")throw"invalid_response";BeFunky.acknowledge(["reset_password_email_sent",{email:`<strong>${o}</strong>`}],{onAcknowledge:()=>{BeFunky.befunkyPopupContainerClose()},imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`})}).catch(a=>{BeFunky.logError("Unable to reset password:",a),a==="already_logged_in"&&BeFunky.throwError(a,"Unable to reset password"),ut&&BeFunky.renderOrResetCaptcha(e.querySelector(".captcha"));let c={invalid_token:"error_invalid_csrf_token",invalid_captcha:"error_captcha",request_failed:"error_request_failed",already_logged_in:["error_please_refresh",{contact_support:`<a href="https://support.befunky.com/hc/en-us/requests/new" target="_blank">${BeFunky.LanguageManager.getString("contact_support")}</a>`}],operation_failed:"error_email_not_registered"};Ht.displayError(e,c[a]||"error_invalid_response")})}BeFunky.onLoginSuccess=function(e){if(!e||!e.email){if(BeFunky.isAppleAppStoreApp&&e){BeFunky.throwError(`Login data missing email: ${JSON.stringify(e)}`,e);return}BeFunky.throwError("Login data missing email",e);return}window.updateUserStatus(e);let t=BeFunky.User.language;t&&t!==BeFunky.LanguageManager.language.site&&(BeFunky.LanguageManager.siteLanguages.includes(t)||BeFunky.isDashboard())&&document.documentElement.getAttribute("data-use-app-lang")==="true"&&BeFunky.LanguageManager.setLanguage(t,["site"]);try{window.bfn_mp.track(BeFunky.User.isNewUser?"user_registered":"user_logged_in")}catch{}let{onLogin:n}=BeFunky.LoginPanelObj;typeof n=="function"?(n(),BeFunky.LoginPanelObj.onLogin=!1,["sign_in_modal","register_modal"].forEach(o=>{BeFunky.closeModal(o,!1)})):BeFunky.User.isNewUser?(BeFunky.befunkyPopupContainerClose(),BeFunky.openAfterRegisterDialog()):(BeFunky.befunkyPopupContainerClose(),BeFunky.sessionRoutes.length===1&&BeFunky.Params.isHomepage&&!BeFunky.isDashboard()&&window.webgl_is_supported&&!window.onbeforeunload&&(window.location.href=BeFunky.getDashboardUrlInLanguage(BeFunky.User.language))),BeFunky.isProcessingAppStorePayment||sd()};BeFunky.clearSignInModals=()=>{document.getElementById("sign_in_form").reset(),document.getElementById("register_form").reset(),document.getElementById("reset_password_form").reset()};requestIdleCallback(ad);function ad(){let e=!0;document.getElementById("sign_in_modal_google").addEventListener("click",t),document.getElementById("sign_in_modal_facebook").addEventListener("click",n),document.getElementById("sign_in_modal_apple").setStyles({display:e?"":"none"}).addEventListener("click",o),BeFunky.isAppleAppStoreApp&&(document.getElementById("sign_in_modal_apple").querySelector("string").setLang("continue_with_apple"),document.getElementById("sign_in_modal_google").querySelector("string").setLang("continue_with_google"),document.getElementById("sign_in_modal_facebook").querySelector("string").setLang("continue_with_facebook")),document.getElementById("sign_in_form").addEventListener("submit",i=>{i.preventDefault(),ur()}),document.getElementById("sign_in_modal_create_account").addEventListener("click",i=>{i.preventDefault(),BeFunky.openLoginPanel("REGISTER",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)}),document.getElementById("sign_in_modal_forgot_password").addEventListener("click",i=>{i.preventDefault(),BeFunky.openLoginPanel("FORGETPASS",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)}),document.getElementById("register_modal_google").addEventListener("click",t),document.getElementById("register_modal_facebook").addEventListener("click",n),document.getElementById("register_modal_apple").setStyles({display:e?"":"none"}).addEventListener("click",o),BeFunky.isAppleAppStoreApp&&(document.getElementById("register_modal_apple").getElementsByTagName("string")[0].setLang("continue_with_apple"),document.getElementById("register_modal_google").getElementsByTagName("string")[0].setLang("continue_with_google"),document.getElementById("register_modal_facebook").getElementsByTagName("string")[0].setLang("continue_with_facebook")),document.getElementById("register_form").addEventListener("submit",i=>{i.preventDefault(),xs()}),document.getElementById("register_modal_has_account").addEventListener("click",i=>{i.preventDefault(),BeFunky.openLoginPanel("SIGNIN",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)}),document.getElementById("reset_password_form").addEventListener("submit",i=>{i.preventDefault(),$s()}),document.getElementById("reset_password_modal_sign_in").addEventListener("click",i=>{i.preventDefault(),BeFunky.openLoginPanel("SIGNIN",BeFunky.LoginPanelObj.onLogin,BeFunky.LoginPanelObj.onCloseWithoutLogin)});function t(){let i=BeFunky.loginWithGoogle();i&&i.catch(r=>{BeFunky.logError("Google login failed",r)}).then(()=>{BeFunky.isProcessingAppStorePayment||BeFunky.hideLoadScreen()})}function n(){BeFunky.showLoadScreen(),BeFunky.FacebookAuth.loginWithFacebook().catch(i=>{BeFunky.logError("Facebook login failed",i)}).then(()=>{BeFunky.hideLoadScreen()})}function o(){let i=BeFunky.loginWithApple();i&&i.catch(r=>{BeFunky.logError("Apple login failed",r)}).then(()=>{BeFunky.isProcessingAppStorePayment||BeFunky.hideLoadScreen()})}}BeFunky.handleAlreadyLoggedInError=function(e){return BeFunky.logError('Handling "already_logged_in" API error'),BeFunky.requestAPI("auth/status",{},{showLoadScreen:!0}).catch(t=>{throw BeFunky.throwError("/status/ failed after already_logged_in sign-in error",t),t}).then(t=>{if(!t.data.email)throw BeFunky.logError("User data missing email: ",JSON.stringify(t.data)),"invalid_response";return e.toLowerCase()===t.data.email.toLowerCase()?t.data:(BeFunky.logError(`Logging out existing user "${t.data.email}" so that new user "${e}" can sign in`),BeFunky.callSignOutAPI().then(()=>Promise.reject("different_user_logged_out"),()=>Promise.reject("different_user_logged_in")))})};function sd(){!BeFunky.isAppleAppStoreApp||setTimeout(()=>{BeFunky.showLoadScreen(),nt(!0,!0).then(({email:e,status:t}={})=>{BeFunky.UserManager.handleAppStoreUser(e,t,"restore",n=>{BeFunky.freeTrialToUpgrade=!1,BeFunky.hideLoadScreen(),n&&BeFunky.showAndTrackAppStoreSubscriptionRestored()})}).catch(()=>{BeFunky.freeTrialToUpgrade=!1,BeFunky.hideLoadScreen()})},111)}function dr(){let e={"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":getCsToken(),"X-User-Email":window.latestUserData.email||""};return cr&&(e["X-BeFunky-Skip-Captcha"]=cr),e}var{html:dt,setupState:ld,render:cd,modalLang:Vt,elem:ud}=BeFunky.lit;function pr(e,{onUpgrade:t,onSignIn:n}){let o=e.video?"modal teaser-modal teaser-modal--video":"modal teaser-modal teaser-modal--image",i=ud`<div id="teaser_modal" class=${o}>`,r=!1,a={headingText:"",featureName:"",images:[],showSecondImage:!1,video:"",text:"",learnMoreLink:"",isLoggedIn:!1,imageAspectRatio:void 0},c=BeFunky.debounce(()=>cd(l(),i),"raf"),[d,s]=ld(Object.assign({},a,e),c);return BeFunky.LanguageManager.addLanguageUpdateListener(c),d.images.length===2&&_(),i.teardown=y,i;function l(){let k=`button button--blue ${d.learnMoreLink?"button--lg":"button--xl"} teaser-modal__button`,v=BeFunky.getFreeTrialEnabled()?BeFunky.isAppleAppStoreApp?"upgrade_to_plus":"start_free_trial":BeFunky.isAppleAppStoreApp?"upgrade_to_plus":"upgrade_now";return dt`
        ${d.video?p():u()}
        <div class="teaser-modal__col-right">
            ${f()}
            <p id="teaser_modal_body">${Vt(d.text)}</p>
            <div class="teaser-modal__buttons">
                <button class=${k} @click=${g}>${Vt(v)}</button>
                ${d.learnMoreLink?dt`<a href=${d.learnMoreLink} class="teaser-modal__learn-link button button--lg button--link" rel="noopener" target="_blank">${Vt("learn_more")}</a>`:""}
            </div>
            ${d.isLoggedIn?"":dt`
            <p class="teaser-modal__sign-in">
                <string>${Vt("teaser_modal_have_an_account")}</string>
                <a @click=${m} href="#">${Vt("sign_in")}</a>
            </p>`}
        </div>
        `}function u(){if(!d.imageAspectRatio)return dt`
            <div class="teaser-modal__image" style=${`background-image: url(${d.images[0]});`}>
                ${d.images[1]?dt`<div class="teaser-modal__fade-in-image" style=${`background-image: url(${d.images[1]}); opacity: ${d.showSecondImage?1:0};`}>`:""}
            </div>`;let k=`position: absolute; ${T(d.images[0])};`,v=d.imageAspectRatio>1?100/d.imageAspectRatio:100*d.imageAspectRatio,F=d.imageAspectRatio>1?`width: 100%; height: ${v}%; left: 0; top: ${(100-v)/2}%; ${k}`:`height: 100%; width: ${v}%; top: 0; left: ${(100-v)/2}%; ${k}`;return dt`
            <div class="teaser-modal__image">
                <div style="${F}">
                ${d.images[1]?dt`<div class="teaser-modal__fade-in-image" style=${`${T(d.images[1])} opacity: ${d.showSecondImage?1:0};`}>`:""}
                </div>
            </div>`;function T(L){return`background: url(${L}) no-repeat center, url('${BeFunky.Params.globalImagesPath}app/checker_pattern.jpg') repeat; background-size: cover, auto;`}}function p(){return dt`
        <div class="teaser-modal__video">
            <video autoplay loop muted playsinline>
                <source src=${d.video} type="video/mp4">
            </video>
        </div>`}function f(){let k=d.headingText||["teaser_modal_heading",{this_feature:()=>BeFunky.LanguageManager.getString(d.featureName)}];return dt`<h2 class="h4">
            <string>${Vt(k)}</string>${BeFunky.isAppleAppStoreApp&&BeFunky.getFreeTrialEnabled()?dt` - <string>${Vt("teaser_free_trial_suffix")}</string>`:""}
        </h2>`}function g(){t()}function m(k){k.preventDefault(),n()}function _(){Promise.all(d.images.map(h)).then(()=>{r||setTimeout(k,1500)});function k(){requestAnimationFrame(()=>{r||(s({showSecondImage:!d.showSecondImage}),setTimeout(k,4e3))})}}function y(){r=!0,BeFunky.LanguageManager.removeLanguageUpdateListener(c)}function h(k){return new Promise((v,F)=>{let T=new Image;T.onload=v,T.onerror=F,T.src=k})}}var an={_default:{featureName:"this_feature",images:["global.jpg"]},paywall:{headingText:"teaser_paywall_heading",text:"teaser_paywall_body",images:["global.jpg"]},artsy:{featureName:"Artsy",text:"teaser_artsy",images:["artsy-before.jpg","artsy-after.jpg"]},background:{featureName:"background",text:"teaser_background",images:["background-before.jpg","background-after.jpg"]},batch_processing:{featureName:"batch_processing",text:"teaser_batch_processing",images:["batch-processing.jpg"]},clarity:{featureName:"clarity",text:"teaser_clarity",images:["clarity-before.jpg","clarity-after.jpg"]},clone:{featureName:"clone",text:"teaser_clone",images:["clone-before.jpg","clone-after.jpg"]},collage_wizard:{featureName:"collage_wizard",text:"teaser_collage_wizard",images:["collage-wizard.jpg"]},color_management:{headingText:"teaser_color_management_heading",text:"teaser_color_management_body",video:"color-library-teaser-compressed.mp4",learnMoreLink:`${BeFunky.Params.siteUrl}learn/improved-color-picker/`},cutout:{featureName:"cutout",text:"teaser_cutout",images:["cutout-before.jpg","cutout-after.jpg"]},designer_templates:{skipTeaser:!0},edit_layer:{featureName:"this_feature",text:"teaser_edit_layer_body",video:"edit-layer-teaser.mp4",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360004850012"},enhance_dlx:{featureName:"Enhance DLX",text:"teaser_enhance_dlx",images:["enhance-DLX-before.jpg","enhance-DLX-after.jpg"]},fill_light:{featureName:"fill_light",text:"teaser_fill_light",images:["fill-light-before.jpg","fill-light-after.jpg"]},font_management:{featureName:"this_feature",text:"teaser_font_management",video:"fonts-teaser-modal-v2.mp4",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-"},funky_focus:{featureName:"funky_focus",text:"teaser_funky_focus",images:["funky-focus-before.jpg","funky-focus-after.jpg"]},glow:{featureName:"glow",text:"teaser_glow",images:["glow-before.jpg","glow-after.jpg"]},lens_flares:{featureName:"lens_flare",text:"teaser_lens_flares",images:["lens-flare-before.jpg","lens-flare-after.jpg"]},photo_effects:{featureName:"photo_effects",text:"teaser_photo_effects",images:["photo-effects.jpg"]},plus_templates:{headingText:"teaser_plus_templates_heading",text:"teaser_plus_templates",images:["plus-templates.jpg"]},replace_color:{featureName:"replace_color",text:"teaser_replace_color",images:["replace-color-before.jpg","replace-color-after.jpg"]},reshape:{featureName:"reshape",text:"teaser_reshape",images:["reshape-before.jpg","reshape-after.jpg"]},save_editor:{headingText:"teaser_save_editor_heading",text:"teaser_save_editor",images:["global.jpg"]},save_collage:{headingText:"teaser_save_collage_heading",text:"teaser_save_collage",images:["collage-wizard.jpg"]},save_designer:{headingText:"pricing_modal_templates_heading",text:"teaser_save_designer",images:["designer-templates.jpg"]},top_nav_bar:{skipTeaser:!0},touchup:{featureName:"touch_up_tools_titlecase",text:"teaser_touchup",images:["touch-up-before.jpg","touch-up-after.jpg"]},vibrance:{featureName:"vibrance",text:"teaser_vibrance",images:["vibrance-before.jpg","vibrance-after.jpg"]},vignette:{featureName:"vignette",text:"teaser_vignette",images:["vignette-before.jpg","vignette-after.jpg"]}},Do;BeFunky.createAndOpenTeaser=(e,t)=>{an[e]=t,BeFunky.openTeaserModal(e)};BeFunky.openTeaserModal=(e="_default")=>{if(an.hasOwnProperty(e)||(BeFunky.logWarning(`Invalid teaser type "${e}" specified`),e="_default"),Do=e==="batch_processing"?"batch":dd(),an[e].skipTeaser){BeFunky.openPricingModal(Do);return}let{headingText:t,featureName:n,text:o,learnMoreLink:i,imageAspectRatio:r}=an[e],{images:a=[],video:c}=an[e];a=a.map(l=>l.startsWith("data:")?l:`${BeFunky.Params.globalImagesPath}teasers/${l}`),c=c?`${BeFunky.Params.globalImagesPath}teasers/${c}`:!1;let d=pr({headingText:t,featureName:n,images:a,video:c,learnMoreLink:i,imageAspectRatio:r,text:o||"teaser_default",isLoggedIn:BeFunky.isLoggedIn()},{onUpgrade:()=>BeFunky.openPricingModal(Do),onSignIn:()=>{BeFunky.openLoginPanel("SIGNIN",()=>{BeFunky.openPricingModal(Do)})}});document.body.appendChild(d);let s=an[e].hasOwnProperty("video")?[1032]:"large";BeFunky.befunkyPopupContainerOpen("#teaser_modal",{size:s,destroyOnClose:!0,onClose:()=>d.teardown()})};function dd(){try{return BFN.AppModel.sectionID}catch(e){BeFunky.logError("Unable to get current app section",e)}return""}var{html:gr,setupState:pd,render:gd,elem:fd}=BeFunky.lit;function fr(e){let t=fd`<figure class="announcement__figure"></figure>`,n=!1,o={video:"",images:null,imageIndex:0,isAnimatingNextImage:!1},i=BeFunky.debounce(()=>gd(c(),t),"raf"),[r,a]=pd(Object.assign({},o,e),i);return r.images&&r.images.length>1&&l(),t.teardown=u,t;function c(){return r.video?d():r.images?s():""}function d(){return gr`
        <div class="announcement__video">
             <video autoplay loop muted>
                <source src=${r.video} type="video/mp4">
            </video>
        </div>`}function s(){let f=r.images[r.imageIndex],g=r.images[p()],m=["announcement__image",f.class].filter(Boolean).join(" "),_=["announcement__image",g.class].filter(Boolean).join(" ");return r.images.length<=1?gr`
            <div class="announcement__images">
                <img class="announcement__image" alt=${f.alt||""} src=${f.url}>
            </div>`:gr`
        <div class="announcement__images">
            <img class=${m} alt=${f.alt||""} src=${f.url}>
            <img class=${_} alt=${g.alt||""} src=${g.url} style="${`opacity: ${r.isAnimatingNextImage?1:0}; left: 0; transition: ${r.isAnimatingNextImage&&g.fadeIn?"opacity 1s ease-in-out":"none"}`}">
        </div>`}function l(){let{duration:f}=r.images[r.imageIndex];setTimeout(()=>{if(n)return;r.images[p()].fadeIn?(a({isAnimatingNextImage:!0}),requestAnimationFrame(()=>{setTimeout(g,1e3)})):g()},f*1e3);function g(){n||(a({isAnimatingNextImage:!1,imageIndex:p()}),l())}}function u(){n=!0}function p(){return r.imageIndex<r.images.length-1?r.imageIndex+1:0}}var hr={edit_layer:{headingText:"edit_layer_announcement_header",bodyText:["edit_layer_announcement_body",{done_editing_image:()=>BeFunky.LanguageManager.getString("done_editing_image","modal")}],learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360004850012",video:"edit-layer-announcement-final.mp4"},font_management:{headingText:"font_announcement_title",bodyText:"font_announcement_body",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360001571631-How-Do-I-Add-My-Fonts-To-BeFunky-",video:"fonts-announcement-modal-v2.mp4"},pwa:{headingText:"pwa_announcement_headline",bodyText:"pwa_announcement_body",learnMoreLink:"https://support.befunky.com/hc/en-us/articles/360051162372",video:"pwa-announcement-modal.mp4",confirmText:"install_now",cancelText:"ask_later"},demo_mode:{headingText:"welcome_to_befunky",bodyText:"demo_mode_announcement_body",images:[{filename:"chrome-demo-welcome.jpg",alt:"Edit photos and create collages and designs with BeFunky"}]},native_app:{headingText:"native_app_announcement_header",bodyText:["native_app_announcement_body",{google_play:BeFunky.toLinkHTML("https://play.google.com/store/apps/details?id=air.com.befunky.BeFunkyPhotoEditor",!0),app_store:BeFunky.toLinkHTML("https://itunes.apple.com/us/app/befunky-photo-editor/id442716817?mt=8",!0)}],learnMoreLink:`${BeFunky.Params.blogUrl}new-befunky-mobile/`,video:"new-mobile-app.mp4",confirmText:"install_now",cancelText:"cancel"},payment_failed:{headingText:"payment_failed_announcement_heading",bodyText:"payment_failed_announcement_body",confirmText:"update_billing_info",cancelText:"not_now"}};BeFunky.openAnnouncementModal=(e,{onConfirm:t=()=>{},onCancel:n=()=>{},onAcknowledge:o=()=>{}}={})=>{let{headingText:i,bodyText:r,learnMoreLink:a,confirmText:c,cancelText:d}=hr[e],{video:s,images:l}=hr[e];s=s?`${BeFunky.Params.globalImagesPath}teasers/${s}`:"",l=l?l.map(m=>Yt(Ve({},m),{url:`${BeFunky.Params.globalImagesPath}teasers/${m.filename}`})):null;let u=fr({video:s,images:l}),p=!1,f=!1,g=c&&d?[{text:d,type:"grey-300",onClick:()=>{f=!0},size:"lg"},{text:c,type:["blue","ellipsis"],onClick:()=>{p=!0},size:"lg"}]:[{text:"ok_got_it",type:["blue","ellipsis"],size:"lg"}];a&&g.unshift({text:"learn_more",type:"link",href:a,style:g.length>1?"margin: 0 auto 0 0":"",size:"lg"}),BeFunky.openDialog({className:"announcement",heading:[i,{"new!":()=>`<span class="announcement__new-text">${BeFunky.LanguageManager.getString("new!")}</span>`}],body:r,figure:u,buttons:g,modalOptions:{size:"medium",addCloseButton:!1,addLightThemeClass:!0,closeOnClickOutside:!0,onClose:()=>{u.teardown(),o(),p?t():n(f)}}})};BeFunky.showAnnouncementOnce=(e,t)=>{if(!hr[e])return BeFunky.throwError("Invalid announcement type",e),Promise.resolve(!1);let n=`${e}_announcement`;return BFN.SettingsManager.getSetting("dismissed_messages").then(o=>o.includes(n)?!1:(BeFunky.openAnnouncementModal(e,t),BFN.SettingsManager.updateSetting("dismissed_messages",[...o,n]),!0))};var jo,hd=BeFunky.once(_d);BeFunky.openPricingModal=()=>{if(BeFunky.isPlus())return;jo||(BeFunky.showLoadScreen(),jo=md());let e=()=>{jo.then(()=>{BeFunky.hideLoadScreen();let t=document.getElementById("modal_root"),n=document.getElementById("pricing_modal"),o=n.querySelector(".pricing-table"),i=n.querySelector(".pricing-table__header-row");t.addEventListener("scroll",a,{passive:!0});function r(){i.setStyles({opacity:"1",pointerEvents:""}),i.removeClass("fixed")}function a(){let _=document.querySelector(".pricing-table__description-icon--active");_&&_.classList.remove("pricing-table__description-icon--active"),n.querySelectorAll(".pricing-table__row--active").removeClass("pricing-table__row--active");let y=o.offsetTop,h=o.offsetHeight,k=t.scrollTop;k<y&&r(),k>y&&k<h?(i.addClass("fixed"),i.setStyles({opacity:"1",top:"0",pointerEvents:""})):k>y&&i.setStyles({opacity:"0",pointerEvents:"none"})}let c=document.querySelectorAll(".pricing-table__description-icon"),d=document.querySelectorAll(".pricing-table__row");[...c].forEach(_=>{_.addEventListener("click",y=>f(y))}),[...d].forEach(_=>{_.addEventListener("click",y=>g(y))}),t.addEventListener(BeFunky.pointerdown,m);let s,l;BeFunky.isMobile&&(t.addEventListener("touchstart",u),t.addEventListener("touchmove",p));function u(_){window.isAppOpen&&(s=_.changedTouches[0].pageY)}function p(_){window.isAppOpen&&(l=_.changedTouches[0].pageY,t.scrollTop<=0&&s<=l&&_.preventDefault())}function f(_){if(BeFunky.isWiderThanMobile())return;let y=document.querySelector(".pricing-table__description-icon--active");y&&y.classList.remove("pricing-table__description-icon--active"),_.currentTarget.classList.add("pricing-table__description-icon--active")}function g(_){if(BeFunky.isWiderThanMobile())return;let y=n.querySelector(".pricing-table__row--active");y===_.currentTarget?_.currentTarget.removeClass("pricing-table__row--active"):(y&&y.removeClass("pricing-table__row--active"),_.currentTarget.addClass("pricing-table__row--active"))}function m(){if(BeFunky.isWiderThanMobile())return;let _=document.querySelector(".pricing-table__description-icon--active");_&&_.classList.remove("pricing-table__description-icon--active")}BeFunky.befunkyPopupContainerOpen("#pricing_modal",{onClose:()=>{t.removeEventListener("scroll",a,{passive:!0}),t.removeEventListener(BeFunky.pointerdown,m),t.removeEventListener("touchstart",u),t.removeEventListener("touchmove",p),r(),BeFunky.isAppleAppStoreApp&&!!BeFunky.freeTrialToUpgrade&&(BeFunky.freeTrialToUpgrade=!1)},size:[1024]}),qi()}).catch(t=>{BeFunky.hideLoadScreen(),typeof t!="string"&&BeFunky.throwError(`Pricing modal error: ${t.name||t}`,t),jo=void 0,BeFunky.closeModal("pricing_modal",!1),BeFunky.confirm(BeFunky.failureReason(t),{confirmText:"try_again",onConfirm:()=>BeFunky.openPricingModal()})})};BeFunky.getFreeTrialEnabled()&&BeFunky.isAppleAppStoreApp?(BeFunky.appStoreRestorePromptDisplayed=!1,BeFunky.showLoadScreen(),nt(!0,!0).then(({email:t,status:n}={})=>{BeFunky.UserManager.handleAppStoreUser(t,n,"restore-pricing",o=>{o?(BeFunky.hideLoadScreen(),BeFunky.befunkyPopupContainerClose(),BeFunky.showAndTrackAppStoreSubscriptionRestored()):e()})}).catch(()=>{e()})):e()};function md(){return yd().then(e=>{hd(e)})}function yd(){let e=`${BeFunky.Params.siteUrl}pricing/`,t={responseType:"document"};return new Promise((n,o)=>{BeFunky.request(e,t,({response:i,error:r})=>{if(r)return r!=="request_failed"&&BeFunky.throwError(`Failed to fetch pricing page: ${r}`,r),o(r);let a;try{if(a=i.body.querySelector("#main-content"),!a)throw"#main-content missing"}catch(c){return BeFunky.throwError("Invalid pricing page response",c,i),o("invalid_response")}n(a.innerHTML)})})}function _d(e){let t=document.getElementById("pricing_modal");t.innerHTML=e,o(),n();function n(){t.querySelectorAll(".pricing-shortcode").forEach(r=>{let a=r.closest(".section");if(a.hasClass("section--first")){a.addClass("section--pricing");let d=a.querySelector(".section__heading");d&&d.addClass("h3"),d&&d.nextElementSibling&&d.nextElementSibling.addClass("text-lg")}let c=r.querySelector(".pricing-shortcode__upgrade");c.addEventListener("click",()=>{window.onClickPrismicButton("pay")}),BeFunky.onFreeTrialEnabledChange(d=>{let s=BeFunky.isAppleAppStoreApp?"start_free_trial_7day":"start_free_trial";c.setLang(d?s:"upgrade_now","modal")}),window.onUserStatusChange(()=>{r.toggleClass("pricing-shortcode--is-free",!BeFunky.isPlus()),r.toggleClass("pricing-shortcode--is-plus",BeFunky.isPlus())}),r.style.visibility=""})}function o(){[...t.querySelectorAll("img")].forEach(c=>window.loadLazyImage(c)),[...t.querySelectorAll("a")].forEach(c=>{c.setAttribute("target","_blank"),c.setAttribute("rel","noopener")});let i=[];BeFunky.isAppleAppStoreApp&&[...t.querySelectorAll(".pricing-shortcode")].forEach(c=>{let d=document.createElement("p").setLang(BeFunky.getFreeTrialEnabled()?"billing_notice_free_trial":"billing_notice_subscription").setClass("text-sm").setStyles({maxWidth:"32rem",margin:"0 auto"});i.push(d),c.insertAdjacentElement("afterend",d)}),BeFunky.onFreeTrialEnabledChange(c=>{let d=t.querySelectorAll(".pricing-table__upgrade-button"),s=t.querySelector(".section__heading");s.setLang(c&&!BeFunky.isAppleAppStoreApp?"pricing_modal_trial_heading":"pricing_modal_heading"),s.nextElementSibling.setLang(c?"pricing_modal_trial_subheading":"pricing_modal_subline1"),[...d].forEach(l=>{l.setLang(c?"start_free_trial":"upgrade_now","modal")}),i.forEach(l=>l.setLang(BeFunky.getFreeTrialEnabled()?"billing_notice_free_trial":"billing_notice_subscription"))});let r=t.querySelectorAll(".pricing-table__sign-in-button"),a=t.querySelectorAll(".pricing-table__upgrade-button");window.onUserStatusChange(()=>{r.setStyles({display:BeFunky.isAppleAppStoreApp||BeFunky.isLoggedIn()?"none":""}),a.setStyles({display:BeFunky.isAppleAppStoreApp||BeFunky.isPlus()?"none":""})})}}var Oo=(...e)=>BeFunky.logFeature("payment",...e);BeFunky.promptUserToUpgradeToYearly=function(e,t){if(BeFunky.isAppleAppStoreApp)return BeFunky.acknowledge("complete_in_browser");e!==latestUserData.price_id&&(BeFunky.throwError("User data does not match customer info",latestUserData.price_id,e,latestUserData),t&&t());let{month:n,year:o}=Ka([latestUserData.price_id,latestUserData.price_pair_id]),i=Object.assign({},o,{unit_amount:o.unit_amount*.9}),r=n.unit_amount,a=r*12-o.unit_amount,c=BeFunky.LanguageManager.language.modal;if(a<0){BeFunky.throwError("Upgrade to yearly provides no savings",{centsSaved:a,currentMonthlyCents:r,newYearlyCents:o.unit_amount}),t&&t();return}let d=a/r,s=d>=1.75&&d<=2.75?"upgrade_yearly_modal_body_2_months":"upgrade_yearly_modal_body";console.log({monthsOfSavings:d,currentMonthlyCents:r});let l={currency:n.currency,unit_amount:a};BeFunky.confirm([s,{amount_saved:Ye(l,c),regular_annual_price:Ye(o,c),discounted_annual_price:Ye(i,c)}],{heading:"upgrade_yearly_modal_heading",confirmText:["upgrade_yearly_modal_confirm",{amount:Ye(i,c)}],cancelText:"not_now",imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/piggy-bank.jpg`,onConfirm:()=>{BeFunky.upgradeToYearlyPayNow(o)},onCancel:t})};BeFunky.upgradeToYearlyClose=()=>(BeFunky.befunkyPopupContainerClose(),window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","NOT_NOW"),!1);var Rn=()=>{};BeFunky.upgradeToYearlyPayNow=e=>{if(typeof window.stripe!="object")return An(()=>{BeFunky.upgradeToYearlyPayNow(e)});window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","PAY_NOW");let t=()=>{window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","UPGRADE_SUCCESS"),BeFunky.hideLoadScreen(),Rn(),BeFunky.showNotification({message:"upgrade_yearly_success",type:"success"}),BeFunky.updateMyAccountPageAfterUpgrade&&BeFunky.updateMyAccountPageAfterUpgrade()};BeFunky.showLoadScreen({visibilityDelay:0,isCancellable:!1}),BeFunky.requestAPI("transaction/upgrade-to-yearly",{price:e.id}).then(o=>{if(o.data!=="success"&&o.data.code&&o.data.cim)return n(o.data.cim);if(o.data!=="success")throw"invalid_response";t()}).catch(o=>{if(o==="already_yearly"||o==="already_exist")return t();BeFunky.hideLoadScreen(),window.bf_eventTrack("PROMOTION","UPGRADE_YEARLY_APP","UPGRADE_FAILURE"),BeFunky.logError("Unable to process payment upgrade to Yearly",o),BeFunky.Params.sendDebugErrors&&o!=="request_failed"&&BeFunky.throwError(`Upgrade to yearly error ${o.code||o}`),Rn();let i=o.code?Is(o.code).translationID:BeFunky.failureReason(o);Rn=BeFunky.showNotification({message:i,type:i==="error_processing_payment"?"warning":"error"})});function n(o){window.stripe.confirmCardPayment(o).then(i=>{let r={confirmed:i.error?"2":"1"};i.error&&BeFunky.logError("3D secure failed with error",i.error),BeFunky.requestAPI("transaction/upgrade-to-yearly",r,{}).then(a=>{if(a.data!=="success")throw"invalid_response";if(!i.error)return t();Rn();let c=i.error.message||"error_processing_payment";Rn=BeFunky.showNotification({message:c,type:c==="error_processing_payment"?"warning":"error"})}).catch(a=>{BeFunky.throwError("Upgrade to yearly after 3d secure failed",a)}).then(()=>{BeFunky.hideLoadScreen()})})}};BeFunky.openPaymentPanel=(e,t)=>{["charge","free_trial","update","update_from_payflow"].includes(t)||(t=BeFunky.getFreeTrialEnabled()?"free_trial":"charge"),["month","year"].includes(e)||(e=ht());let n=["update","update_from_payflow"].includes(t),o=n&&BeFunky.isPlus();if(BeFunky.isPlus()&&!n){let l=BeFunky.getModal(),u=l?l.modalElement.id:void 0;["sign_in_modal","register_modal"].includes(u)&&BeFunky.closeModal(u);return}if(ht()!==e&&Bn(e),!BeFunky.isLoggedIn()&&!BeFunky.isAppleAppStoreApp){BeFunky.openLoginPanel("REGISTER",()=>{t==="free_trial"&&!BeFunky.getFreeTrialEnabled()&&(t="charge"),BeFunky.openPaymentPanel(e,t)});return}if(BeFunky.usePlayStorePricing&&!o)return kd(Eo(e).id);if(BeFunky.isAppleAppStoreApp){o?BeFunky.acknowledge("complete_in_browser"):(BeFunky.isProcessingAppStorePayment=!0,wd(Eo(e)).catch(l=>{BeFunky.throwError("Unexpected app store payment failure:",l)}).then(()=>{BeFunky.isProcessingAppStorePayment=!1}));return}let{render:i,html:r}=BeFunky.lit,a=document.getElementById("payment_modal"),c=BeFunky.User.email||"",{code:d}=Wi()||{},s=r`
        <div class="centered-modal__bg centered-modal__bg--orange"></div>
        <payment-form class="centered-modal__content" .mode=${t} .email=${c} .initialPromoCode=${d} .onPaymentSubmit=${bd}></payment-form>
    `;i(s,a),BeFunky.befunkyPopupContainerOpen("#payment_modal")};async function kd(e){if(BeFunky.isOldTWA){BeFunky.confirm("error_old_twa",{confirmText:"open_play_store",onConfirm:()=>window.open("https://play.google.com/store/apps/details?id=air.com.befunky.BeFunkyPhotoEditor","_blank")});return}if(BeFunky.UserManager.playStorePlusUserExists&&typeof await Lo().then(({email:a,status:c}={})=>{if(a&&c)return BeFunky.UserManager.handlePlayStoreUser(a,c,"upgrade")})=="function")return;let t=[{supportedMethods:"https://play.google.com/billing",data:{sku:e}}],n;try{n=await new PaymentRequest(t).show(),Oo("Got paymentResponse:",n)}catch(r){r.name==="AbortError"||r.message.includes("was cancelled")?BeFunky.logError("User chose not to subscribe",r):r.name==="SecurityError"&&/requires .*user activation/.test(r.message)?(BeFunky.logWarning("Retry upgrade prompt",r),BeFunky.openPricingModal()):BeFunky.throwError(r,"PaymentRequest.show() failed");return}let o=n.details.purchaseToken||n.details.token;BeFunky.showLoadScreen({visibilityDelay:0,isCancellable:!1});let i;try{if(i=(await BeFunky.requestAPI("transaction/g-play-validate",{sku:e,purchaseToken:o,package:BeFunky.twaAppId})).data,!i)throw"invalid_response";Oo("Verified payment on backend",i)}catch(r){return BeFunky.throwError(`Play Store payment validation failed: ${r.code||r.message||r}`,r),BeFunky.hideLoadScreen(),n.complete("fail")}BeFunky.hideLoadScreen(),await n.complete("success"),BeFunky.UserManager.updateUserDataAndTrackNativeAppStoreSubscription(i),BeFunky.befunkyPopupContainerClose(),BeFunky.openAfterUpgradeDialog(),BeFunky.updateMyAccountPageAfterUpgrade&&BeFunky.updateMyAccountPageAfterUpgrade()}async function wd(e){if(!BeFunky.isAppleAppStoreApp){BeFunky.logError("Not iOS native app");return}if(window.appleSubscriptionInProcessing)return;BeFunky.showLoadScreen({visibilityDelay:0,isCancellable:!1});let t=!1,n=async()=>{if(t)return;t=!0,BeFunky.showLoadScreen({visibilityDelay:0,isCancellable:!1}),window.appleSubscriptionInProcessing=!0;let o=null;try{o=await window.purchaseAppStoreProduct(e.id,e.value,lt())}catch(a){o=a}if(o==null||o.error){BeFunky.hideLoadScreen(),window.appleSubscriptionInProcessing=!1,o!=null&&o.error==="user_cancelled"?BeFunky.logError("User chose not to subscribe"):o!=null&&o.error==="can_not_make_payment"||BeFunky.throwError(o!=null&&o.error?o.error:"unknown","App Store payment failed");return}if(Oo("Got paymentResponse:",o),!o.receipt){BeFunky.hideLoadScreen(),window.appleSubscriptionInProcessing=!1,BeFunky.throwError("App Store payment failed:",o);return}let i=BeFunky.getFreeTrialEnabled(),r;try{if(r=(await BeFunky.requestAPI("transaction/app-store-verify-purchase",{productId:e.id,amount:o.amount,receipt:o.receipt,country:o.country,trialing:i?"1":"0",distinct_id:window.mixpanel&&typeof window.mixpanel.bfn_distinct_id!="undefined"&&window.mixpanel.bfn_distinct_id.length>0?window.mixpanel.bfn_distinct_id:""})).data,!r)throw"invalid_response";Oo("Verified payment on backend",r)}catch(a){if(window.appleSubscriptionInProcessing=!1,BeFunky.hideLoadScreen(),typeof a.code!="undefined"&&a.code==="users_not_match"&&typeof a.user!="undefined"){let c=a.user,d=typeof a.status!="undefined"?a.status:"";BeFunky.UserManager.handleAppStoreUser(c,d,"initial");return}BeFunky.throwError(`App Store payment validation failed: ${a.code||a.message||a}`,a);return}if(window.appleSubscriptionInProcessing=!1,BeFunky.hideLoadScreen(),typeof r!="undefined"&&r&&r.status&&r.status==="free"){let a=typeof r.originalTransactionId!="undefined"?r.originalTransactionId:"";BeFunky.throwError(`App Store payment validation failed: Status is free ${a}`);return}typeof r!="undefined"&&r&&r.originalTransactionId&&r.originalTransactionId.length>0&&BeFunky.setLocal("appstore_otid",r.originalTransactionId),BeFunky.UserManager.updateUserDataAndTrackNativeAppStoreSubscription(r),BeFunky.befunkyPopupContainerClose(),BeFunky.isLoggedIn()?BeFunky.openAfterUpgradeDialog():BeFunky.openDialog({heading:"register_after_subscribe_heading",body:"register_after_subscribe_body",buttons:[{onClick:()=>BeFunky.openLoginPanel("REGISTER"),text:"create_account",type:["blue"],focusInitially:!0}],imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/card-confetti.jpg`,modalOptions:{addCloseButton:!0,addLightThemeClass:!0}})};BeFunky.appStoreRestorePromptDisplayed?await n():nt(!0,!0).then(({email:o,status:i}={})=>{BeFunky.UserManager.handleAppStoreUser(o,i,"restore",r=>{r?(BeFunky.hideLoadScreen(),BeFunky.befunkyPopupContainerClose(),BeFunky.showAndTrackAppStoreSubscriptionRestored()):n()})}).catch(()=>{n()})}var No=!1;function bd({cardHolderName:e,stripeElement:t,email:n,mode:o,recurring:i,displayError:r,clearInputs:a,paymentRequestPaymentMethod:c,paymentRequestCompleteFunction:d,promoCode:s}){if(No){BeFunky.logError("Already processing payment");return}BeFunky.showLoadScreen({visibilityDelay:0,isCancellable:!1}),No=!0,c?l({error:null,paymentMethod:c}):window.stripe.createPaymentMethod({type:"card",card:t,billing_details:{name:e}}).then(l).catch(p=>{BeFunky.logError("An unexpected payment-related error occurred",p),BeFunky.throwError(p),u(void 0,"Unknown error")});function l({error:p,paymentMethod:f}){if(p){u(p.code,p.message);return}if(!f||!f.id){u(void 0,"Missing Stripe payment method");return}let g="0";try{g=typeof growsumo!="undefined"&&growsumo.data.partner_key&&growsumo.data.partner_key.length>0?growsumo.data.partner_key:"0"}catch{}if(g!=="0")try{growsumo.data.email=n,growsumo.data.customer_key=n,growsumo.createSignup()}catch{}let m=Eo(i);if(!m){u(void 0,"Missing price");return}let _=(parseInt(m.unit_amount)/100).toFixed(2),y=o==="update_from_payflow"?"update-payflow-customer":o==="update"?"update-customer":"create-customer",h,k=i==="year"?"yearly":"monthly";if(o==="charge"||o==="free_trial"||o==="update")h={stripeEmail:n,stripeToken:f.id,holdername:e||"",isGrowsumo:g,handlerType:"subscription_purchase",price:m.id,promo_code:s||"",country:lt(),start_free_trial:o==="free_trial"?1:0,trial_from:BeFunky.isPaywallEnabled()?"save":""};else if(o==="update_from_payflow")h={stripeEmail:n,stripeToken:f.id,nextBillingDate:k==="monthly"?BeFunky.Params.nextBillingDateMonthly:BeFunky.Params.nextBillingDateAnnual,period:k};else return BeFunky.throwError(`Invalid payment mode: ${o}`);BeFunky.Params.return_fail_from_customer===!0&&(h.return_fail_from_customer=1);let v=F=>{if(No=!1,F&&F.error)return typeof F.error=="string"?u(F.error,BeFunky.failureReason(F.error)):F.error.code==="user_is_plus"?(BeFunky.throwError("Already-plus user filled out payment form"),u(F.error.code,"You are already a BeFunky Plus user")):u(F.error.code,F.error.message,F);if(F&&F.data&&F.data.action_needed&&F.data.cuid){let E=F.data.cuid;h={handlerType:"subscription_purchase_reaction",cuid:E};let I=F.data.action_needed;F.data.action_needed=null,F.data.cuid=null;let M=j=>{j.error?(h={handlerType:"subscription_purchase_reaction_error",cuid:E},BeFunky.requestAPI(`transaction/${y}`,h).then(()=>{},()=>{}),u("handle_card_error",j.error.message,F)):(d&&typeof d=="function"&&(d("success"),d=null),BeFunky.requestAPI(`transaction/${y}`,h).then(()=>{v(F)},Y=>{v({error:Y})}))};return o==="update"?window.stripe.confirmCardSetup(I).then(M):window.stripe.confirmCardPayment(I).then(M)}d&&typeof d=="function"&&d("success");let T=Boolean(F&&F.data&&F.data.trial_started);try{T||bf_eventTrack("CONVERSION",k.toUpperCase(),"CREDITCARD"),BeFunky.User.subscr_date&&o==="charge"&&bf_eventTrack("RESUBSCRIBE",k.toUpperCase(),"CREDITCARD")}catch(E){BeFunky.throwError("Unable to track payment conversion",E)}let L={pl:"1",subscr_usr:1};if(o!=="update"){if(F&&F.data&&F.data.plan_type?L.plan_type=F.data.plan_type:k?L.plan_type=k==="yearly"?1:0:BeFunky.throwError("Unable to get plan_type"),F&&F.data&&F.data.subscr_amount?L.subscr_amount=F.data.subscr_amount:k?L.subscr_amount=_:BeFunky.throwError("Unable to get subscr_amount"),F&&F.data&&F.data.subscr_date?L.subscr_date=F.data.subscr_date:window.bfn_mp?L.subscr_date=window.bfn_mp.getISODate():BeFunky.throwError("Unable to get subscr_date"),F&&F.data&&F.data.payment_type&&(L.payment_type=F.data.payment_type),T){L.subscription_status="trialing";let E=F.data.trial_started;L.trial_source=E;let I=E==="chromeos_perk_two_trial"?"TRIAL_CONVERSION":E.toUpperCase();bf_eventTrack(I,k.toUpperCase(),"TRIAL STARTED"),BeFunky.SettingsService.updateSetting("trialing","trialing")}}else window.onScriptLoad("app").then(()=>{let E=new BFN.UserActionVO;E.eventID="payment_method_updated",E.track()});window.updateUserStatus(Object.assign({},window.latestUserData,L)),o!=="update"&&In();try{BFN.BfnService.updateUserData()}catch{}BeFunky.hideLoadScreen(),o==="charge"||o==="free_trial"?(BeFunky.preventModalDispose=!0,BeFunky.closeModal("payment_modal"),BeFunky.preventModalDispose=!1,BeFunky.openAfterUpgradeDialog(BeFunky.LoginPanelObj.onCloseWithoutLogin||void 0)):BeFunky.closeModal("payment_modal"),a&&a(),BeFunky.updateMyAccountPageAfterUpgrade&&BeFunky.updateMyAccountPageAfterUpgrade()};if(BeFunky.Params.IS_LC)return console.log({endpoint:y,params:h}),v({error:"local_dev"});BeFunky.requestAPI(`transaction/${y}`,h).then(F=>{v(F)},F=>{v({error:F})})}function u(p,f,g){BeFunky.hideLoadScreen(),No=!1;let m=JSON.stringify({code:p,message:f});if(g&&g.error&&g.error.status){let{status:k}=g.error;m=JSON.stringify({code:p,message:f,status:k})}BeFunky.logError("A payment error occurred",m);let{field:_,translationID:y,reportError:h}=Is(p);h&&(c?BeFunky.throwError(`Payment wallet error ${p}`):BeFunky.throwError(`Payment error ${p}`)),d&&typeof d=="function"&&d("fail"),r&&r(_,y)}}function Is(e){switch(e){case"invalid_number":case"incorrect_number":case"incomplete_number":return{field:"number",translationID:"error_invalid_number",reportError:!1};case"expired_card":case"invalid_expiry_year_past":return{field:"form",translationID:"error_expired_card",reportError:!1};case"incomplete_expiry":return{field:"expiry",translationID:"error_incomplete_expiry",reportError:!1};case"invalid_expiry_year":return{field:"expiry",translationID:"error_invalid_expiry_year",reportError:!1};case"invalid_expiry_month":return{field:"expiry",translationID:"error_invalid_expiry_month",reportError:!1};case"incomplete_cvc":case"invalid_cvc":case"incorrect_cvc":return{field:"cvc",translationID:"error_invalid_cvc",reportError:!1};case"invalid_promo_code":case"used_before":return{field:"promo",translationID:"error_invalid_promo_code",reportError:!1};case"user_is_plus":return{field:"form",translationID:"error_already_upgraded",reportError:!0};case"subscribed_before":return{field:"form",translationID:["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT",!0)}],reportError:!0};case"trial_found":return{field:"form",translationID:"error_trial_found",reportError:!1};case"authentication_required":case"approve_with_id":case"call_issuer":case"card_not_supported":case"card_velocity_exceeded":case"currency_not_supported":case"do_not_honor":case"do_not_try_again":case"duplicate_transaction":case"fraudulent":case"generic_decline":case"incorrect_pin":case"incorrect_zip":case"insufficient_funds":case"invalid_account":case"invalid_amount":case"invalid_pin":case"issuer_not_available":case"lost_card":case"merchant_blacklist":case"new_account_information_available":case"no_action_taken":case"not_permitted":case"offline_pin_required":case"online_or_offline_pin_required":case"pickup_card":case"pin_try_exceeded":case"reenter_transaction":case"restricted_card":case"revocation_of_all_authorizations":case"revocation_of_authorization":case"security_violation":case"service_not_allowed":case"stolen_card":case"stop_payment_order":case"testmode_decline":case"transaction_not_allowed":case"try_again_later":case"withdrawal_count_limit_exceeded":case"card_declined":return{field:"form",translationID:"error_card_declined",reportError:!0};default:return{field:"form",translationID:"error_processing_payment",reportError:!0}}}var qo="user_photo_modal",Un={},Dn=null,jn=null,mr=!1,Ms=[],Gt=document.getElementById(qo),Rs,On,yr,Nn,sn;Gt&&(Rs=Gt.querySelector(".user-photo__image"),On=Gt.querySelector(".user-photo__title"),yr=Gt.querySelector(".user-photo__author"),Nn=Gt.querySelector(".user-photo__report-abuse"),Nn.addEventListener("click",()=>{if(!sn){let e=document.getElementById("user_photo_modal");e&&(sn=e.getAttribute("data-single-image-id"))}if(!sn)return BeFunky.throwError("reportAbuseImageID not found");BeFunky.closeModal(qo,!1),wr(sn)}));BeFunky.reportAbuse=wr;BeFunky.openUserPhotoModal=function(e,t,n,o){if(!Gt)return BeFunky.throwError("User Photo Modal not available");BeFunky.openModal(Gt,{onOpen:()=>{mr=!0,_r(e,t,o);let i=Us(e);i!==Bt()&&ve(i)},onClose:()=>{mr=!1,_r(),n!==Bt()&&ve(n)},addLightThemeClass:!0,addCloseButton:!0,size:"large",onArrowClick:i=>{let r=i==="left"?Dn:jn;r&&(_r(r,t,o),ve(Us(r)))}})};BeFunky.closeUserPhotoModal=function(){mr&&BeFunky.closeModal(qo)};function _r(e,t,n){if(e){let o=document.querySelector(".user-photo__image-box");o.innerHTML="",Un.hasOwnProperty(e.imageURL)?o.appendChild(Un[e.imageURL]):o.appendChild(kr(e)),On.textContent=e.title;let r=On.innerHTML.replace(/#(\w+)/gi,`<a href="${BeFunky.Params.siteUrl}explore/photos/$1/">#$1</a>`);if(On.innerHTML=r||"Untitled",yr.innerHTML=`by <a href="${BeFunky.Params.siteUrl}gallery/${e.nick}/">${e.nick}</a>`,t){let a=t.indexOf(e);Dn=t[a-1],jn=t[a+1];let[c,d]=BeFunky.getModal(qo).arrowButtons;c.disabled=!Dn,d.disabled=!jn,Fd()}}else Rs.src="",On.innerHTML="",yr.innerHTML="",Object.keys(Un).forEach(o=>{delete Un[o]});if(Nn.toggleClass("user-photo__report-abuse--hidden",!n),e){sn=e.id.replace("befunky_photo_","");let o=Ms.includes(sn);Nn.disabled=o,Nn.setLang(o?"abuse_reported":"report_abuse","site")}}function kr(e){let t=new Image;return t.src=e.imageURL,t.setClass("image-box__image explore-modal__image"),e.isTransparent&&t.addClass("image-box__image--is-transparent"),t.id="explore-image",Un[t.src]=t,t}function Fd(){requestIdleCallback(()=>{Dn&&kr(Dn),jn&&kr(jn)})}function Us(e){return`/explore/gallery/${e.id.split("_").pop()}/`}function wr(e){if(!BeFunky.isLoggedIn())return BeFunky.openLoginPanel("SIGNIN",()=>{BeFunky.befunkyPopupContainerClose(),wr(e)});if(!(BeFunky.User.isMailVerified!=null?BeFunky.User.isMailVerified:BeFunky.Params.isMailVerified))return BeFunky.confirm("please_verify_email",{onConfirm:BeFunky.sendVerificationEmail,confirmText:"send_verification_email",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`});let n=document.createElement("div");n.appendChild(document.createElement("p").setLang("report_abuse_prompt_1","site")),n.appendChild(document.createElement("p").setLang("report_abuse_prompt_2","site")),BeFunky.confirm(n,{heading:"report_abuse",confirmText:"report",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/flag.svg`,onConfirm:()=>{let o={mode:"reportAbuse",img_key:e};Bt().startsWith("/a/")&&(o.is_anonymous=1),BeFunky.requestAPI("photo/report-abuse",o,{showLoadScreen:!0}).then(()=>{Ms.push(e)}).catch(i=>{BeFunky.throwError("Unable to Report Abuse on image",i,e)}).then(()=>{BeFunky.acknowledge("report_abuse_thank_you",{heading:"report_abuse_sorry"})})}})}var{html:te,setupState:vd,render:br,modalLang:_e,elem:qn,icon:xe}=BeFunky.lit;BeFunky.createProjectManagerModal=function(){let e=qn`<div id="project_manager" class="modal modal--button-sm project-manager bfn"></div>`,t=1600,n=t-17*16-24*2,o=Math.min(t,window.innerWidth-32*2),i={isLoggedIn:!1,searchTerm:"",previousSearch:null,galleryWidth:BeFunky.isWiderThanMobile()?n:o,allProjects:[],sortMode:"MODIFIED",orientationMode:"ALL_ORIENTATION",projectTypeMode:"ALL_PROJECTS",viewMode:"THUMBNAIL",projectFolders:[],areProjectFoldersLoading:!1,selectedFolderId:-1,mobileView:"GALLERY",isLoading:!1,message:null,selectedProjectIDs:[]},r=!1,a=qn`<div id="context_menu_project_manager"></div>`,c=qn`<div id="context_menu_folder_manager"></div>`,d=BeFunky.debounce(()=>{let w=BeFunky.isWiderThanMobile()?m():_();br(w,e),r||Ke()},"raf"),[s,l]=vd(i,d);BeFunky.LanguageManager.addLanguageUpdateListener(d),window.onUserStatusChange(ae,!1);let u=vl(),p=L();F(),T();let f=null,g=null;return BeFunky.onMatchMedia(`(min-width: ${BFN.CSS.desktopAppMinWidth}px)`,()=>{d()}),Object.assign(e,{open:ye}),e;function m(){let w=s.selectedFolderId===-1,b=s.selectedFolderId===0,x="project-manager__folder button button--grey-200 button--left-align button--fullwidth";return te`
        <panel-header .langId=${"project_manager"} .modifier=${"modal"} buttons=${"close"}></panel-header>
        <div class="modal__body project-manager__body">
            <div class="project-manager__left-panel" clue-id="project_manager">
                <div id="project_manager_placeholder" style="position: relative;"></div>
                ${h()}
                ${s.isLoggedIn?te`
                    <button
                        class="${x} ${w?"button--selected":""}"
                        @click=${()=>O(-1)}
                    >
                        ${_e("all_projects")}
                    </button>
                    <button
                        class="${x} ${b?"button--selected":""}"
                        .folderId=${0}
                        @click=${()=>O(0)}
                    >
                        ${_e("unsorted_projects")}
                    </button>
                    <div class="project-manager__left-panel-buttons scrollable-content">
                        <div class="project-manager__folders-header">
                            <span class="text-sm">${_e("folders")}</span>
                            <button
                                class="button button--icon button--transparent"
                                @click=${$}
                            >
                                ${xe("plus-icon","icon")}
                            </button>
                        </div>
                        ${Pe()}
                    </div>`:""}
            </div>
            ${E()}
        </div>
        ${a}
        ${c}
        ${p}
        `}function _(){if(s.mobileView==="GALLERY")return y();if(s.mobileView==="FILTERS")return k();if(s.mobileView==="FOLDERS")return v()}function y(){let w=yl(),b;return s.selectedFolderId===-1?b="project_manager":s.selectedFolderId===0?b="unsorted_projects":b=Ko(s.selectedFolderId),te`
            <panel-header .langId=${b} .modifier=${"modal"} buttons=${"close"}></panel-header>
            <div class="modal__body project-manager__body">
                ${s.isLoggedIn?te`
                    <div class="project-manager__top-bar">
                        ${h()}
                        <div class="project-manager__top-bar-buttons">
                            <button
                                class="button button--grey-200 button--icon button--md project-manager__filter-button"
                                @click=${()=>l({mobileView:"FILTERS"})}>
                                    ${xe("edit-icon","icon icon--18")}
                                    ${w>0?te`
                                        <span class="count-indicator">${w}</span>`:""}
                            </button>
                            <button
                                class="button button--grey-200 button--icon button--md"
                                @click=${()=>l({mobileView:"FOLDERS"})}>
                                    ${xe("folder-icon","icon icon--18")}
                            </button>
                        </div>
                    </div>`:""}
                <div class="vertical-scroller" style="padding: 0 2rem; flex-grow: 1;">
                 ${s.isLoggedIn?M():re()}
                </div>
            </div>
            ${a}
        `}function h(){return te`
            <form role="search" class="search-box project-manager__search-box">
                <input
                    type="search"
                    .disabled=${!s.isLoggedIn}
                    id="project_manager_search"
                    placeholder=${_e("search_all_projects",!0)}
                    class="input project-manager__search-input search-box__input"
                    .value=${s.searchTerm}
                    @change=${w=>l({searchTerm:w.target.value})}
                    required
                >
                ${BeFunky.isWiderThanMobile()?te`
                    <button
                        type="reset"
                        class="button button--icon button--md button--transparent search-box__clear">
                        ${xe("cancel-icon","icon icon--10")}
                    </button>
                `:te`
                    <button
                        type="reset"
                        class="button button--icon button--md button--transparent search-box__clear"
                        @click=${Ee}>
                        ${xe("cancel-icon","icon icon--10")}
                    </button>
                `}
                </button>
                <button
                    type="submit"
                    .disabled=${!s.isLoggedIn}
                    class="button button--icon button--md button--white-outline search-box__submit"
                    @click=${me}
                >
                    ${xe("search-icon","icon")}
                </button>
            </form>

        `}function k(){return te`
            <panel-header
                .langId=${"filters"}
                .modifier=${"modal"}
                buttons=${"close"}
                @CLOSE=${Se}>
            </panel-header>
            <div class="modal__body project-manager__body vertical-scroller">
                <div class="project-manager__filters">
                    ${u.map(({items:w})=>w.map(b=>{let x=s.viewMode===b.mode||s.sortMode===b.mode||s.orientationMode===b.mode||s.projectTypeMode===b.mode;return b.heading?te`
                            <h3 class="text-sm bold">${_e(b.heading)}</h3>
                        `:te`
                            <button
                                class=${`project-manager__filter button button--grey-200 button--has-icon button--left-align button--fullwidth ${x?"button--selected":""}`}
                                @click=${b.onClick}>
                                ${xe(b.icon,"icon")}
                                <string>${_e(b.text)}</string>
                            </button>`}))}
                </div>
            </div>
        `}function v(){let w=s.selectedFolderId===-1,b=s.selectedFolderId===0,x="project-manager__folder button button--grey-200 button--has-icon button--left-align button--fullwidth",G=`${x} button--selected`,q=Jo(s.projectFolders);return te`
            <panel-header
                .langId=${"folders"}
                .modifier=${"modal"}
                buttons=${"close"}
                @CLOSE=${Se}>
            </panel-header>
            <div class="modal__body project-manager__body project-manager__folder-list vertical-scroller">
                <div class="project-manager__create-folder-container">
                    <button
                        class="button button--icon button--grey-300"
                        @click=${$}
                    >
                        ${xe("plus-icon","icon")}
                    </button>
                </div>
                <button
                    class=${`project-manager__folder button button--grey-200 button--left-align button--fullwidth ${w?"button--selected":""}`}
                    @click=${()=>H(-1)}
                >
                    ${_e("all_projects")}
                </button>
                <button
                    class="project-manager__folder button button--grey-200 button--left-align button--fullwidth ${b?"button--selected":""}"
                    .folderId=${0}
                    @click=${()=>H(0)}
                >
                    ${_e("unsorted_projects")}
                </button>
                ${q.length>0?te`
                    ${q.map(({folderId:ee,name:et})=>{let Ae=ee===s.selectedFolderId;return te`
                            <button class="${Ae?G:x}" .folderId=${ee}
                                    @click=${()=>H(ee)}
                            >
                                ${xe("folder-icon","icon")}
                                <string>${et}</string>
                                <div @click=${se}
                                     class="project-manager__folder-ellipsis button button--transparent">
                                    <span></span>
                                    <span></span>
                                    <span></span>
                                </div>
                            </button>`})}`:te`
                    <div class="project-manager__empty-state" style="text-align: center;">
                        <img
                            src=${BeFunky.Params.globalImagesPath}illustrations/no-folders.svg
                            class="gallery__empty-state-image"
                            alt="no results"/>
                        <p class="text-xs">${_e("project_folders_empty")}</p>
                    </div>
                `}
            </div>
            ${c}
        `}function F(){BeFunky.contextMenu(a,{open:{onClick:()=>U(f)},move:{onClick:()=>D([f])},rename:{onClick:()=>oe(f)},delete:{onClick:()=>le([f])}},{hoverOffEventTarget:document})}function T(){BeFunky.contextMenu(c,{delete:{onClick:()=>Re(g)},rename:{onClick:()=>Me(g)}},{hoverOffEventTarget:document})}function L(){let w=document.createElement("div");return BeFunky.dragScreen(w),w}function E(){return s.isLoggedIn?I():re()}function I(){return te`
        <div class="project-manager__right-panel">
            ${z()}
            <div
                class="scrollable-content scrollable-content--modal-right-panel"
                style=${`--scrollable-content-width: ${s.galleryWidth}px`}
            >
                ${M()}
            </div>
        </div>
        `}function M(){if(s.viewMode==="THUMBNAIL"||s.isLoading)return re();let w=Mr();return w.length?BeFunky.isWiderThanMobile()?j(w):Y(w):re()}function j(w){return requestIdleCallback(Q),te`
        <div class="panel-header project-manager__column-header-row" style=${`width: ${s.galleryWidth}px`}>
            <span class="project-manager__column-header-title project-manager__heading-name">
                ${_e("name")}
            </span>
            <span class="project-manager__column-header-title project-manager__heading-created">
                ${_e("date_created")}
            </span>
            <span class="project-manager__column-header-title project-manager__heading-modified">
                ${_e("last_modified")}
            </span>
        </div>
        ${w.map(b=>{let x=s.selectedProjectIDs.includes(b.id),G=s.selectedProjectIDs.length>1;return te`
                <div class="${`project-manager__project-row ${x?"project-manager__project-row--selected":""}`}" @click=${q=>B(q,b.id)} style=${`width: ${s.galleryWidth}px`} .draggedProjectId=${b.id}>
                    <button
                        class="${`button button--icon project-manager__circle ${x?"project-manager__circle--selected":""}`}"
                        @click="${q=>R(q,b.id)}"
                    >
                        ${xe("checkmark-icon","icon icon--selected icon--12")}
                    </button>
                    <div class="project-manager__name">
                    <div
                        class="project-manager__project-thumbnail"
                        style="background-image: url(${b.listViewThumbURL})"
                    ></div>
                        <span>${b.filename}</span>
                    </div>
                    <span class="project-manager__date-created">${Rr(b.creationDate)}</span>
                    <span class="project-manager__date-modified">${Rr(b.modifiedDate)}</span>
                    ${G?"":te`
                        <button
                            @click=${P}
                            class="button button--xs button--icon button--white-outline project-manager__edit-button project-manager__edit-button--list-view"
                        >
                            <span></span>
                            <span></span>
                            <span></span>
                        </button>`}
                </div>
            <div>`})}`}function Y(w){return te`
        ${w.map(b=>{let x=s.selectedProjectIDs.includes(b.id),G=s.selectedProjectIDs.length>1;return te`
                <div
                    class="${`project-manager__project-row ${x?"project-manager__project-row--selected":""}`}"
                    @click=${q=>B(q,b.id)}
                    style=${`width: ${s.galleryWidth}px`}
                    .draggedProjectId=${b.id}
                >
                        <div class="project-manager__name">
                        <div class="project-manager__project-thumbnail"
                             style="background-image: url(${b.listViewThumbURL})">
                        </div>
                            <span>${b.filename}</span>
                        </div>
                        ${G?"":te`
                        <button
                            @click=${P}
                            class="button button--xs button--icon project-manager__edit-button project-manager__edit-button--list-view"
                        >
                            <span></span>
                            <span></span>
                            <span></span>
                        </button>`}
                </div>
            <div>`})}`}function Q(){let w;[...e.querySelectorAll(".project-manager__project-row")].forEach(b=>{w=w||b.parentElement,we(b,()=>w)})}function z(){if(s.selectedProjectIDs.length>0){let b=s.selectedProjectIDs.length;return te`
            <div class="project-manager__results-header project-manager__results-header--multiselect">
                <button
                    style="position: absolute;"
                    class="button button--icon button--transparent"
                    @click=${()=>l({selectedProjectIDs:[]})}
                >
                    ${xe("cancel-icon")}
                </button>
                <string style="position: absolute; margin-left: 2.25rem;">
                    ${_e([b===1?"projects_selected_single":"projects_selected_multiple",{number:b.toString()}])}
                </string>
                <button
                    style="margin: 0 0.5rem 0 auto;"
                    class="button button--icon button--grey-200"
                    @click=${()=>D(s.selectedProjectIDs)}
                    data-tooltip="move"
                    data-tooltip-above
                >
                    ${xe("open-folder-icon")}
                </button>
                <button
                    style="margin: 0 auto 0 0;"
                    class="button button--icon button--grey-200"
                    @click=${()=>le(s.selectedProjectIDs)}
                    data-tooltip="delete"
                    data-tooltip-above
                >
                    ${xe("delete-icon")}
                </button>
            </div>
            `}let w;return s.searchTerm?w=_e(["search_results_for",{query:`<strong>${BeFunky.escapeHTML(s.searchTerm)}</strong>`}]):s.selectedFolderId===-1?w=_e("all_projects"):s.selectedFolderId===0?w=_e("unsorted_projects"):w=Ko(s.selectedFolderId),te`
            <div class="project-manager__results-header">
                <div class="project-manager__results-container">
                    <h3 class="project-manager__results-heading bold">${w}</h3>
                    ${s.searchTerm?Z():""}
                    ${de()}
                </div>
                <div class="project-manager__filters">
                    ${u.map(b=>ne(b))}
                </div>
            </div>
        `}function ne(w){let{mainButton:b,items:x,selectedMode:G}=w;return te`
        <dropdown-menu
            .mainButton=${b}
            .items=${x}
            .disabled=${!s.isLoggedIn}
            .selectedMode=${s[G]}
            .context="modal"
        ></dropdown-menu>`}function Z(){return te`
            <button
                class="button button--circle button--white-outline button--icon button--xs project-manager__clear-results"
                @click=${Ee}
                data-tooltip="cancel"
            >
                ${xe("cancel-icon","icon icon--10")}
            </button>
        `}function de(){if(s.projectTypeMode==="ALL_PROJECTS"&&s.orientationMode==="ALL_ORIENTATION")return;let w={ALL_ORIENTATION:"all_orientations",HORIZONTAL:"horizontal",VERTICAL:"vertical",SQUARE:"square",ALL_PROJECTS:"all_projects",EDITOR:"photo_editor",COLLAGE:"collage_maker",DESIGNER:"graphic_designer"};return te`
             <div class="project-manager__active-filters">
                ${s.orientationMode!=="ALL_ORIENTATION"?te`
                <div class="project-manager__active-filter chip">
                    <string>${_e(w[s.orientationMode])}</string>
                    <button
                        class="button button--icon"
                        @click=${C("ALL_ORIENTATION")}
                        data-tooltip="cancel"
                    >
                        ${xe("cancel-icon","icon icon--12")}
                    </button>
                </div>`:""}
                ${s.projectTypeMode!=="ALL_PROJECTS"?te`
                <div class="project-manager__active-filter chip">
                    <string>${_e(w[s.projectTypeMode])}</string>
                    <button
                        class="button button--icon" @click=${C("ALL_PROJECTS")}
                        data-tooltip="cancel"
                    >
                        ${xe("cancel-icon","icon icon--12")}
                    </button>
                </div>`:""}
            </div>
        `}function re(){let w=Mr().map(Ae=>Ae.imageObject),b=s.selectedProjectIDs.length>0,x=(Ae,{isSelected:xt,wasSelectButtonClicked:$t})=>{let It=Ae.id;($t||b)&&BeFunky.isWiderThanMobile()?l(xt?{selectedProjectIDs:[...s.selectedProjectIDs,It]}:{selectedProjectIDs:s.selectedProjectIDs.filter(Zo=>Zo!==It)}):U(It)},G="ontouchstart"in window,q=(Ae,{isSelected:xt})=>{let $t=Ae.id;l(xt?{selectedProjectIDs:[...s.selectedProjectIDs,$t]}:{selectedProjectIDs:s.selectedProjectIDs.filter(It=>It!==$t)})},ee=8;return te`<image-gallery
            class="gallery project-manager__thumbnail-gallery"
            .images=${w}
            .isLoading=${s.isLoading}
            .message=${s.message}
            .emptyState=${w.length?null:ke()}
            .rowHeight=${et()}
            .currentWidth=${s.galleryWidth}
            .addItemClass=${()=>"gallery__item--has-content"}
            .onClickItem=${x}
            .onLongPressItem=${G&&BeFunky.isWiderThanMobile()?q:void 0}
            .selectedImageIDs=${BeFunky.isWiderThanMobile()?s.selectedProjectIDs:void 0}
            .extendItemTemplate=${he}
            .setupItemDragging=${BeFunky.isWiderThanMobile()?ue:void 0}
            .useSelectButton=${!b}
            .gutterWidth=${ee}
            .borderWidth=${1}
        ></image-gallery>`;function et(){let Ae=s.galleryWidth-ee;return Math.min(215,Math.round(Ae/2))}}function he(w){let b=s.selectedProjectIDs.length>1;return te`
        <div class="gallery__item-content">
            <p class="project-manager__thumbnail-title">${Yo(w.id)}</p>
            ${b?"":te`
                <button @click=${x=>S(x,w)}
                        class="button button--xs button--icon button--white-outline project-manager__edit-button project-manager__edit-button--thumbnail-view"
                >
                    <span></span>
                    <span></span>
                    <span></span>
                </button>`}
        </div>
        `}function ue(w,{id:b}){!BeFunky.isWiderThanMobile()||(w.draggedProjectId=b,we(w,()=>w.parentElement.parentElement.parentElement.parentElement))}function Pe(){return s.areProjectFoldersLoading?Fe():Be()}function Fe(){return te`
            <div class="project-manager__loading">
                <div class="loading-spinner"></div>
                <string>${_e("loading")}</string>
            </div>`}function Be(){let w="project-manager__folder button button--grey-200 button--has-icon button--left-align button--fullwidth",b=`${w} button--selected`,x=Jo(s.projectFolders);return x.length>0?x.map(({folderId:G,name:q})=>{let ee=G===s.selectedFolderId;return te`
                    <button
                        class="${ee?b:w}"
                        .folderId=${G}
                        @click=${()=>O(G)}
                    >
                        ${xe("folder-icon","icon")}
                        <string>${q}</string>
                        <span @click=${se}
                            class="project-manager__folder-ellipsis button button--transparent">
                            <span></span>
                            <span></span>
                            <span></span>
                        </span>
                    </button>`}):te`
            <div class="project-manager__empty-state">
                <img
                    src=${BeFunky.Params.globalImagesPath}illustrations/no-folders.svg
                    class="gallery__empty-state-image"
                    alt="no results"/>
                <p class="text-xs">${_e("project_folders_empty")}</p>
            </div>`}function pe(w){let b,x=qn`<div id="move_to_folder" class="modal project-manager__move-folder-modal">`,G="project-manager__folder button button--transparent button--has-icon button--left-align button--fullwidth",q=()=>te`<div>
            <h6 class="project-manager__move-folder-header">${_e("move_to_folder")}</h6>
            <p>${_e("select_your_destination_folder")}</p>
            <div class="scrollable-content project-manager__move-folder-list">
                ${w===0?"":ee(0,_e("unsorted_projects",!0))}
                ${Jo(s.projectFolders).filter(({folderId:Ae})=>Ae!==w).map(({folderId:Ae,name:xt})=>ee(Ae,xt))}
            </div>
        </div>`;return br(q(),x),{dialogContent:x,getSelectedFolderId:()=>b};function ee(Ae,xt){let $t=s.allProjects.filter(Zo=>Zo.folderId===Ae).length,It=_e($t===1?"one_project":["multiple_projects",{number:$t.toString()}]);return te`
            <div
                class=${`${G} ${Ae===b?"button--selected":""}`}
                @click=${()=>et(Ae)}
            >
                ${xe("open-project-icon","icon")}
                <div class="project-manager__folder-name-container">
                    <span class="project-manager__folder-name text-sm">${xt}</span>
                    <span class="text-xxs project-manager__folder-count">(${It})</span>
                </div>
            </div>`}function et(Ae){b=Ae,br(q(),x)}}function ke(){if(!s.isLoggedIn)return{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/log-in-befunky-photos.svg`,text:"login_load_projects",buttonAction:Fl,buttonText:"sign_in"};if(!s.searchTerm&&!s.allProjects.length)return{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-projects-canvas.svg`,text:"no_saved_projects",linkText:"learn_more",linkHref:"https://support.befunky.com/hc/en-us/articles/360003279091-How-Do-I-Save-My-Project-So-I-Can-Edit-It-Later-"};if(s.searchTerm&&!s.allProjects.length)return{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-search-results-canvas.svg`,text:["no_results_for",{query:`"<strong>${BeFunky.escapeHTML(s.searchTerm)}</strong>"`}]};let w=s.orientationMode!=="ALL_ORIENTATION"||s.projectTypeMode!=="ALL_PROJECTS";return s.selectedFolderId>0&&w&&!s.searchTerm?{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-search-results-canvas.svg`,text:"no_results_in_folder"}:s.selectedFolderId>0&&!s.searchTerm?{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/empty-folder-canvas.svg`,text:"no_saved_projects_in_folder"}:{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-search-results-canvas.svg`,text:"error_no_results"}}function we(w,b){if(w.hasOwnProperty("dragging"))return;BeFunky.draggableElement(w,b,{dragScreen:p});let x=!1;w.addEventListener("dragstarted",()=>{if(w.pointerDownTarget&&w.pointerDownTarget.hasClass("gallery__select-button")){x=!0,w.cancelDragging();return}if(!s.selectedProjectIDs.length)l({selectedProjectIDs:[w.draggedProjectId]});else if(!s.selectedProjectIDs.includes(w.draggedProjectId)){x=!0,w.cancelDragging();return}x=!1,e.addClass("project-manager--dragging");let G=e.getBoundingClientRect();p.dragOffset={x:G.x,y:G.y};let q=s.selectedProjectIDs.length,ee=q===1?Yo(s.selectedProjectIDs[0]):BeFunky.LanguageManager.getStringReplacements("multiple_projects",{number:q.toString()});p.showNode(qn`
                <div class="project-manager__ghost">
                    <div class="project-manager__ghost-button button button--md button--has-icon button--selected">
                        ${xe("folder-icon")}
                        <string>${ee}</string>
                    </div>
                    ${q>1?te`
                    <div class="project-manager__ghost-button button button--md button--has-icon button--selected"></div>
                    <div class="project-manager__ghost-indicator">${q}</div>
                    `:""}
                </div>
            `,1)}),w.addEventListener("dragstopped",G=>{if(x)return;e.removeClass("project-manager--dragging");let{folderId:q}=G.detail.dropTarget||{};typeof q=="number"&&q>=0&&(fe(q,s.selectedProjectIDs),l({selectedProjectIDs:[]}))})}function me(w){w&&w.preventDefault();let b=s.searchTerm;gn(b)}function Se(w){w.stopPropagation(),l({mobileView:"GALLERY"})}function Ee(){gn()}function C(w){return function(){let x={ALL_ORIENTATION:"orientationMode",ALL_PROJECTS:"projectTypeMode"}[w];l({[x]:w})}}function B(w,b){w.target.nodeName!=="BUTTON"&&(s.selectedProjectIDs.length?s.selectedProjectIDs.includes(b)?l({selectedProjectIDs:s.selectedProjectIDs.filter(x=>x!==b)}):l({selectedProjectIDs:[...s.selectedProjectIDs,b]}):U(b)),f=b}function P(w){a.handleTargetClick(w)}function R(w,b){s.selectedProjectIDs.includes(b)?l({selectedProjectIDs:s.selectedProjectIDs.filter(x=>x!==b)}):l({selectedProjectIDs:[...s.selectedProjectIDs,b]})}function S(w,b){w.stopPropagation(),f=b.id,a.handleTargetClick(w)}function A(w){return function(){l({viewMode:w,selectedProjectIDs:[]})}}function U(w){let b=s.allProjects.find(({id:ee})=>ee===w);if(!window.isAppOpen||BeFunky.isAppleAppStoreApp&&BeFunky.getModal("dashboard_modal").isVisible){BeFunky.SavedProjectManager.openProjectFromOutsideOfApp(b);return}let{renderedWidth:x=0,url:G}=b.imageObject.lastRenderedThumb||{},q=x>=308?G:void 0;BeFunky.SavedProjectManager.openUserSavedProject(b,q).catch(ee=>{ee!=="cancelled_by_user"&&BeFunky.logError("Failed to open user-saved project",ee)})}function D(w){let b=s.projectFolders.length?q():void 0,{dialogContent:x,getSelectedFolderId:G}=pe(b);BeFunky.confirm(x,{onConfirm:async()=>{let ee=G();typeof ee=="number"&&ee>=0&&(await fe(ee,w),l({selectedProjectIDs:[]}))},className:"project-manager__move-dialog",confirmText:"move",cancelText:"cancel",size:"extra-small",focusConfirmButton:!1});function q(){let ee=s.allProjects.filter(({id:et})=>w.includes(et)).map(({folderId:et})=>et).unique();return ee.length===1?ee[0]:void 0}}function oe(w){let b=Yo(w),x=BeFunky.createFormModalContainer("project_title"),{teardown:G}=BeFunky.formModal(x,{title:"rename_project",fields:[{name:"projectname",label:"project_name",initialValue:b,errorMessage:"error_duplicate_project_name",maxLength:100,validate:q=>!ml(q),sanitize:q=>q.replace(/^[.\\]+/,"")}],button:"rename",onSubmit:({projectname:q})=>{pl(w,q.trim()).then(()=>{BeFunky.closeModal(x)})}},{formClass:"project-manager__rename-input"});BeFunky.openFormModal(x,G)}function le(w){let b=w.length===1?"confirm_delete_one_project":["confirm_delete_multiple_projects",{number:w.length.toString()}];BeFunky.confirm(b,{onConfirm:async()=>{w.length===1?await gl(w[0]):await fl(w),l({selectedProjectIDs:[]})},confirmText:"yes",cancelText:"no",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/photo-project-shredder.svg`})}function W(){l({sortMode:"RELEVANT"})}function K(){l({sortMode:"MODIFIED"})}function X(){l({sortMode:"CREATED"})}function ce(){l({sortMode:"NAME"})}function V(w){return function(){l({orientationMode:w,selectedProjectIDs:[]})}}function Ie(w){return function(){l({projectTypeMode:w,selectedProjectIDs:[]})}}function ae(){l({isLoggedIn:BeFunky.isLoggedIn()}),s.isLoggedIn&&(gn(),ge())}function $(){let w=BeFunky.createFormModalContainer("create_folder"),{teardown:b}=BeFunky.formModal(w,{title:"create_folder",fields:[{name:"foldername",label:"folder_name",initialValue:"",maxLength:100,sanitize:x=>x.replace(/^[.\\]+/,"")}],button:"create",onSubmit:({foldername:x})=>{At(x.trim()).then(()=>{a.showButton("move"),BeFunky.closeModal(w)})}},{formClass:"project-manager__folder-input"});BeFunky.openFormModal(w,b)}function O(w){l({selectedFolderId:w,selectedProjectIDs:[]})}function H(w){l({selectedFolderId:w,selectedProjectIDs:[],mobileView:"GALLERY"})}function se(w){w.stopPropagation(),c.handleTargetClick(w),g=w.currentTarget.parentElement.folderId||s.selectedFolderId}function Me(w){let b=Ko(w),x=BeFunky.createFormModalContainer("folder_title"),{teardown:G}=BeFunky.formModal(x,{title:"rename_folder",fields:[{name:"foldername",label:"folder_name",initialValue:b,maxLength:100,sanitize:q=>q.replace(/^[.\\]+/,"")}],button:"rename",onSubmit:({foldername:q})=>{dl(w,q.trim()).then(()=>{BeFunky.closeModal(x)})}},{formClass:"project-manager__folder-rename-input"});BeFunky.openFormModal(x,G)}function Re(w){if(!s.allProjects.find(b=>b.folderId===w)&&!s.searchTerm){De(w,!1);return}BeFunky.confirm("confirm_folder_delete_befunky",{onConfirm:()=>{De(w,!0)},onCancel:b=>{!b||De(w,!1)},confirmText:"delete",cancelText:"keep",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/folder-shredder.svg`,addCloseButton:!0})}function ye(){BeFunky.openModal(e,{onOpen:()=>{let w=BeFunky.isLoggedIn();if(l({isLoggedIn:w}),s.isLoggedIn){ge(),gn();return}l({isLoading:!1})},onClose:()=>{l({previousSearch:null})},onWindowResize:({availableWidth:w})=>{BeFunky.isWiderThanMobile()?l({galleryWidth:n+(w-t)}):l({galleryWidth:w-32*2})},size:"xxl",isFullWidthOnMobile:!0})}function He(w){return{id:w.id,getImageURL:b=>BeFunky.SavedProjectManager.getThumbURL(w,b),thumbWidth:w.width,thumbHeight:w.height,isTransparent:/\.png(\?|$)/.test(w.thumburl)}}function Ke(){!s.allProjects.length||!s.projectFolders.length||(window.BFN&&window.BFN.HelpClueManager&&BFN.HelpClueManager.show("project_manager",{renderOptions:{side:"left",top:"11.5rem",left:"16rem",zIndex:"1",container:()=>document.getElementById("project_manager_placeholder")}}),r=!0)}async function ge(){l({areProjectFoldersLoading:!0});let w=[];try{w=await BeFunky.ProjectFolderService.getFolders(),l({projectFolders:w})}catch(b){b!=="request_failed"&&(BeFunky.reportWarning(`Failed to fetch project folders: ${b}`,b),l({projectFolders:[]}))}l({areProjectFoldersLoading:!1}),w.length?a.showButton("move"):a.hideButton("move")}function fe(w,b){return BeFunky.ProjectFolderService.addProjectsToFolder(w,b).then(()=>{window.UIMessages&&UIMessages.display(b.length===1?"moved_project":"moved_projects"),s.allProjects.filter(x=>b.includes(x.id)).forEach(x=>{x.folderId=w}),l({allProjects:[...s.allProjects]})},x=>Tt(x,"Failed to add projects to folder",w,b))}function De(w,b){return BeFunky.ProjectFolderService.deleteFolder(w,b).then(()=>{let x=s.projectFolders.filter(ee=>ee.folderId!==w),G=b?s.allProjects.filter(ee=>ee.folderId!==w):s.allProjects.map(ee=>(ee.folderId===w&&(ee.folderId=0),ee)),q=s.allProjects.filter(ee=>ee.folderId===w);if(l({projectFolders:x,allProjects:G,selectedProjectIDs:[]}),s.selectedFolderId===w&&l({selectedFolderId:b?-1:0}),s.projectFolders.length===0&&a.hideButton("move"),b){let ee=document.querySelector("dashboard-projects");if(ee&&ee.fetchProjects(),!q.length)return;q.forEach(et=>{Qo(et.id)})}},x=>Tt(x,"Failed to delete folder",w,b))}function At(w){return BeFunky.ProjectFolderService.createFolder(w).then(({folderId:b,name:x})=>{let G={folderId:b,name:x};l({projectFolders:[...s.projectFolders,G]})},b=>Tt(b,"Failed to create folder",w))}function dl(w,b){return BeFunky.ProjectFolderService.renameFolder(w,b).then(({name:x})=>{s.projectFolders.find(G=>G.folderId===w).name=x,l({projectFolders:[...s.projectFolders]})},x=>Tt(x,"Failed to update folder name",w,b))}function pl(w,b){let x={project:w,filename:Ur(b)};return BeFunky.requestAPI("photo/projects/update",x,{showLoadScreen:!0}).then(G=>{if(G.data!=="success")throw"invalid_response";s.allProjects.find(q=>q.id===w).filename=b,l({allProjects:[...s.allProjects]})}).catch(G=>Tt(G,"Failed to project folder name",w,b))}function gl(w){return BeFunky.SavedProjectFetcher.deleteProject(w,!0).then(()=>{Qo(w),window.BFN&&BFN.DesignerTemplateManager&&BFN.DesignerTemplateManager.recentProjectsComponent&&BFN.DesignerTemplateManager.recentProjectsComponent.fetchProjects();let b=document.querySelector("dashboard-projects");b&&b.fetchProjects()}).catch(b=>Tt(b,"Failed to delete project",w))}function fl(w){return BeFunky.showLoadScreen(),Promise.all(w.map(b=>BeFunky.SavedProjectFetcher.deleteProject(b).then(()=>Qo(b),x=>Tt(x,"Failed to delete project",b)))).then(()=>{BeFunky.hideLoadScreen(),window.BFN&&BFN.DesignerTemplateManager&&BFN.DesignerTemplateManager.recentProjectsComponent&&BFN.DesignerTemplateManager.recentProjectsComponent.fetchProjects();let b=document.querySelector("dashboard-projects");b&&b.fetchProjects()})}function Tt(w,b,...x){w!=="request_failed"&&BeFunky.reportWarning(`${b}: ${w}`,...x),UIMessages.display(BeFunky.failureReason(w),2e3)}function gn(w=""){let b=w.trim();if(b===s.previousSearch)return;l({isLoading:!0,allProjects:[],searchTerm:b,sortMode:b?"RELEVANT":"MODIFIED",previousSearch:b,message:null,selectedProjectIDs:[]}),V("ALL_ORIENTATION")(),Ie("ALL_PROJECTS")(),(w?BeFunky.SavedProjectFetcher.searchProjects(Ur(w)):BeFunky.SavedProjectFetcher.getAllProjects()).then(q=>{let ee=hl(q);l({allProjects:ee,isLoading:!1})}).catch(q=>{l({isLoading:!1,allProjects:[]}),q!=="no_results"&&(BeFunky.logError(q),l({previousSearch:null,message:{isError:!0,text:BeFunky.failureReason(q),buttonText:"try_again",buttonAction:()=>gn(b)}}))})}function hl(w){let b=40*(BeFunky.isRetina()?2:1);return w.map(x=>{x.id=x.templateid;let G=x.date.replace(/-/g,"/"),q=x.modified.replace(/-/g,"/");return x.creationDate=new Date(G),x.modifiedDate=new Date(q),x.listViewThumbURL=BeFunky.addParamsToURL(x.thumburl,{width:b,height:b,fit:"crop",auto:"avif,webp"}),x.imageObject=He(x),x})}function ml(w){return s.allProjects.some(b=>b.filename===w)}function Yo(w){return s.allProjects.find(({id:x})=>x===w).filename}function Ko(w){return s.projectFolders.find(b=>b.folderId===w).name}function Jo(w){return w.slice().sort((b,x)=>b.name>x.name?1:-1)}function yl(){let w=0;return s.orientationMode!=="ALL_ORIENTATION"&&(w+=1),s.projectTypeMode!=="ALL_PROJECTS"&&(w+=1),s.sortMode!=="MODIFIED"&&(w+=1),w}function Mr(){let w=s.allProjects.filter(_l()).filter(wl()).filter(kl()),b=bl();return typeof b=="function"&&w.sort(b),w}function _l(){let w=s.orientationMode;return w==="HORIZONTAL"?b=>b.width>b.height:w==="VERTICAL"?b=>b.width<b.height:w==="SQUARE"?b=>b.width===b.height:()=>!0}function kl(){if(s.selectedFolderId===-1)return()=>!0;let w=s.selectedFolderId;return b=>b.folderId===w}function wl(){let w=s.projectTypeMode;if(w==="ALL_PROJECTS")return()=>!0;if(w==="EDITOR")return b=>b.project_type==="editor";if(w==="COLLAGE")return b=>b.project_type==="collage";if(w==="DESIGNER")return b=>b.project_type==="designer"}function bl(){let w=s.sortMode;if(w==="MODIFIED")return(b,x)=>{let G=b.modifiedDate;return x.modifiedDate-G};if(w==="CREATED")return(b,x)=>{let G=b.creationDate;return x.creationDate-G};if(w==="NAME")return(b,x)=>{let G=b.filename.toUpperCase(),q=x.filename.toUpperCase();return G<q?-1:G>q?1:0}}function Fl(){BeFunky.openLoginPanel("SIGNIN")}function Qo(w){let b=s.allProjects.filter(({id:x})=>x!==w);l({allProjects:b,selectedProjectIDs:[]}),b.length||(l({searchTerm:""}),V("ALL_ORIENTATION")(),Ie("ALL_PROJECTS")(),BeFunky.SavedProjectFetcher.projectData.allProjectsFetched=!1)}function Rr(w){let b=new Date(w.getTime()),x=b.getTimezoneOffset()/60*-1;b.setHours(b.getHours()+x);let G=BeFunky.LanguageManager.language.modal,q=b.toLocaleString(G,{year:"numeric",month:"numeric",day:"numeric",hour12:!0,hour:"2-digit",minute:"2-digit"});return G==="en"&&(q=q.replace(/-/g,"/").replace(","," at")),q}function Ur(w){return btoa(encodeURIComponent(w))}function vl(){return[{mainButton:{icon:"mosaic-icon",tooltip:"view",tooltipPosition:"above"},items:[{heading:"view"},{text:"thumbnails",mode:"THUMBNAIL",onClick:A("THUMBNAIL"),icon:"mosaic-icon"},{text:"list_items",mode:"LIST",onClick:A("LIST"),icon:"list-view-icon"}],selectedMode:"viewMode"},{mainButton:{icon:"modified-date-icon",tooltip:"sort_by",tooltipPosition:"above"},items:[{heading:"sort_by"},{text:"relevancy",mode:"RELEVANT",onClick:()=>W(),isVisible:()=>Boolean(s.searchTerm),icon:"relevancy-icon"},{text:"modified_date",mode:"MODIFIED",onClick:()=>K(),icon:"modified-date-icon"},{text:"creation_date",mode:"CREATED",onClick:()=>X(),icon:"creation-date-icon"},{text:"name",mode:"NAME",onClick:()=>ce(),icon:"capital-letter-icon"}],selectedMode:"sortMode"},{mainButton:{icon:"all-orientations-icon",tooltip:"orientation",tooltipPosition:"above"},items:[{heading:"orientation"},{text:"all_orientations",mode:"ALL_ORIENTATION",onClick:V("ALL_ORIENTATION"),icon:"all-orientations-icon"},{text:"horizontal",mode:"HORIZONTAL",onClick:V("HORIZONTAL"),icon:"horizontal-results-icon"},{text:"vertical",mode:"VERTICAL",onClick:V("VERTICAL"),icon:"vertical-results-icon"},{text:"square",mode:"SQUARE",onClick:V("SQUARE"),icon:"square-results-icon"}],selectedMode:"orientationMode"},{mainButton:{icon:"image-icon",tooltip:"project_type",tooltipPosition:"above"},items:[{heading:"project_type"},{text:"all_types",mode:"ALL_PROJECTS",onClick:Ie("ALL_PROJECTS"),icon:"all-projects-icon"},{text:"photo_editor",mode:"EDITOR",onClick:Ie("EDITOR"),icon:"image-icon"},{text:"collage_maker",mode:"COLLAGE",onClick:Ie("COLLAGE"),icon:"layouts-icon"},{text:"graphic_designer",mode:"DESIGNER",onClick:Ie("DESIGNER"),icon:"templates-icon"}],selectedMode:"projectTypeMode"}]}};var Fr=!1;if(typeof window!="undefined"){let e={get passive(){Fr=!0}};window.addEventListener("testPassive",null,e),window.removeEventListener("testPassive",null,e)}var Ds=typeof window!="undefined"&&window.navigator&&window.navigator.platform&&(/iP(ad|hone|od)/.test(window.navigator.platform)||window.navigator.platform==="MacIntel"&&window.navigator.maxTouchPoints>1),ln=[],Wo=!1,vr=-1,Wn,Hn,js=e=>ln.some(t=>!!(t.options.allowTouchMove&&t.options.allowTouchMove(e))),Ho=e=>{let t=e||window.event;return js(t.target)||t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)},Bd=e=>{if(Hn===void 0){let t=!!e&&e.reserveScrollBarGap===!0,n=window.innerWidth-document.documentElement.clientWidth;t&&n>0&&(Hn=document.body.style.paddingRight,document.body.style.paddingRight=`${n}px`)}Wn===void 0&&(Wn=document.body.style.overflow,document.body.style.overflow="hidden")},Sd=()=>{Hn!==void 0&&(document.body.style.paddingRight=Hn,Hn=void 0),Wn!==void 0&&(document.body.style.overflow=Wn,Wn=void 0)},Pd=e=>e?e.scrollHeight-e.scrollTop<=e.clientHeight:!1,Ld=(e,t)=>{let n=e.targetTouches[0].clientY-vr;return js(e.target)?!1:t&&t.scrollTop===0&&n>0||Pd(t)&&n<0?Ho(e):(e.stopPropagation(),!0)},Os=(e,t)=>{if(!e){console.error("disableBodyScroll unsuccessful - targetElement must be provided when calling disableBodyScroll on IOS devices.");return}if(ln.some(o=>o.targetElement===e))return;let n={targetElement:e,options:t||{}};ln=[...ln,n],Ds?(e.ontouchstart=o=>{o.targetTouches.length===1&&(vr=o.targetTouches[0].clientY)},e.ontouchmove=o=>{o.targetTouches.length===1&&Ld(o,e)},Wo||(document.addEventListener("touchmove",Ho,Fr?{passive:!1}:void 0),Wo=!0)):Bd(t)},Ns=()=>{Ds?(ln.forEach(e=>{e.targetElement.ontouchstart=null,e.targetElement.ontouchmove=null}),Wo&&(document.removeEventListener("touchmove",Ho,Fr?{passive:!1}:void 0),Wo=!1),vr=-1):Sd(),ln=[]};var Ze=Md(),We=[],be,Br={"extra-small":[320],small:[464],medium:[624],large:[944],xxl:[1600,1140]},Ct;Od();function qs(e,t={}){let{modalElement:n,modalID:o}=Id(e),i={closeOnClickOutside:!0,closeOnEscape:!0,destroyOnClose:!1,isCritical:!1,isDialog:!1,addLightThemeClass:!1,addAnchorBottomClass:!1,addCloseButton:!1,isFullWidthOnMobile:!1,bottomVeilBackgroundColor:void 0,onOpen:void 0,onClose:void 0,onWindowResize:void 0,onArrowClick:void 0,size:void 0};typeof t.size=="string"&&(Object.keys(Br).includes(t.size)?t.size=Br[t.size]:(BeFunky.throwError(`Invalid modal size: ${t.size} - ${BeFunky.getType(t.size)}`),t.size=void 0)),t=Object.assign({},i,t);let r=We.findIndex(({modalID:s})=>s===o),a=r!==-1,c=a?We[r]:function(){let{innerContainer:s,outerContainer:l}=$d(n);return{modalID:o,modalElement:n,isVisible:!0,innerContainer:s,outerContainer:l}}();if(Object.assign(c,t),a&&We.splice(r,1),c.isCritical)We.push(c);else{let s=We.findIndex(({isCritical:l})=>l);s===-1?We.push(c):We.splice(s,0,c)}c.lastOpened=Date.now(),Ud(c),Nd(c),c.outerContainer.toggleClass("light-theme",Boolean(c.addLightThemeClass)),c.outerContainer.toggleClass("modal-root__outer--anchor-bottom",Boolean(c.addAnchorBottomClass)),c.outerContainer.toggleClass("modal-root__outer--fullwidth-on-mobile",Boolean(c.isFullWidthOnMobile&&zs())),a?(c.outerContainer.removeClass("modal-root__outer--is-hidden"),c.isVisible=!0):(c.outerContainer.addClass("modal-root__outer--is-hidden"),Td(c.outerContainer),requestAnimationFrame(()=>{c.isVisible&&c.outerContainer.removeClass("modal-root__outer--is-hidden")}));let d=We.filter(({isVisible:s})=>s);Ws(d),be=d[d.length-1],Gs([c]),Ct=document.activeElement,Hs(),typeof c.onOpen=="function"&&c.onOpen(),requestAnimationFrame(()=>{d[d.length-1]===c&&Vs(c.outerContainer)})}function Vn(e,t=!0){let n=typeof e=="string"?e:e.id;if(!n)throw new Error("Missing modal ID");let o=We.findIndex(({modalID:a})=>a===n);if(o===-1){if(t)throw new Error(`Specified modal ${n} is not on screen`);return}let i=We[o];i.outerContainer.addClass("modal-root__outer--is-hidden"),i.isVisible=!1;let r=We.filter(({isVisible:a})=>a);Ws(r),be=r[r.length-1],Sr(i.destroyOnClose)&&(We.splice(o,1),xd(i.outerContainer)),be?be.modalElement.contains(Ct)&&Ct.offsetParent?Ct.focus():Vs(be.outerContainer):Ct&&Ct.offsetParent&&BeFunky.isFocusable(Ct)&&Ct.focus(),Hs(),typeof i.onClose=="function"&&i.onClose()}function Ws(e){e.forEach(({outerContainer:n},o)=>{n.setStyles({zIndex:o+1}),n.toggleClass("modal-root__outer--is-bottommost",o===0),n.toggleClass("modal-root__outer--is-topmost",o===e.length-1)});let t=e[0]?e[0].bottomVeilBackgroundColor:void 0;t?Ze.style.setProperty("--modal-bottom-veil-bg",t):Ze.style.setProperty("--modal-bottom-veil-bg","rgba(0, 0, 0, 0.8)")}function Cd(e,t,n){e?qs(t,n):Vn(t)}function Ed(e=void 0){let t=typeof e=="string"?We.find(({modalID:n})=>n===e):be;return t?Object.assign({},t):void 0}function Ad(e){let t=typeof e=="string"?We.find(({modalID:n})=>n===e):be;return Boolean(t&&t.isVisible)}(function(){document.addEventListener("keyup",t=>{if(t.key!=="Escape"||!be)return;let{modalID:n,closeOnEscape:o}=be;t.stopImmediatePropagation(),!!Sr(o)&&(Vn(n),BeFunky.reportUserAction(`User closed ${n} modal by pressing Escape`))})})();(function(){let t=!1;Ze.addEventListener(BeFunky.pointerdown,n=>{t=be.outerContainer!==n.target}),Ze.addEventListener("click",n=>{if(t||!be)return;let{outerContainer:o,closeOnClickOutside:i,modalID:r}=be;n.target===o&&(Date.now()-be.lastOpened<500||!Sr(i)||(Vn(r),BeFunky.reportUserAction(`User closed ${r} modal by clicking outside`)))})})();(function(){Ze.addEventListener("CLOSE",t=>{let n=t.target.closest(".modal-root__inner"),o=n.firstElementChild;if(be&&n!==be.innerContainer){BeFunky.throwError("CLOSE fired unexpectedly in non-topmost modal",o.id,be.modalElement.id);return}Vn(o)})})();(function(){window.addEventListener("resize",BeFunky.debounce(()=>Gs(We.slice()),100))})();function Td(e){Ze.appendChild(e)}function xd(e){Ze.removeChild(e)}function Hs(){Ze.toggleClass("modal-root--is-inactive",!be).toggleClass("modal-root--is-dialog",Boolean(be&&be.isDialog)),!BeFunky.isIOS&&(be?Os(Ze):Ns())}function $d(e){let t=document.createElement("div").setClass("modal-root__outer"),n=document.createElement("div").setClass("modal-root__inner");return t.appendChild(n),n.appendChild(e),{outerContainer:t,innerContainer:n}}function Id(e){if(e instanceof HTMLElement){if(!e.id)throw new Error("Modal elements must have unique IDs");return{modalElement:e,modalID:e.id}}if(typeof e=="string"){let t=document.getElementById(e);if(!t)throw new Error(`Unable to get modal element with id = ${e}`);return{modalElement:t,modalID:e}}throw new Error(`Invalid modal element or id: ${BeFunky.getType(e)}`)}function Sr(e){return typeof e=="function"&&(e=e()),!!e}function Md(){let e=document.createElement("div").setClass("modal-root modal-root--is-inactive");return e.id="modal_root",document.body.appendChild(e),e}function Rd(e){e!==Ze.parentElement&&e.appendChild(Ze)}function Vs(e){let t=e.querySelector(".focus-initially");if(t){let n=t.style.transition;t.setStyles({transition:"none"}),BeFunky.focus(t),t.setStyles({transition:n})}else BeFunky.temporarilyFocusDiv(e)}function Gs(e){e.filter(({isVisible:t,size:n,onWindowResize:o})=>t&&(n||typeof o=="function")).reverse().forEach(({onWindowResize:t,size:n,modalElement:o,outerContainer:i,isFullWidthOnMobile:r})=>{let a=Boolean(r&&zs());i.toggleClass("modal-root__outer--fullwidth-on-mobile",a);let c=a?0:16,d=window.innerWidth-c*2,s=window.innerHeight-c*2;if(n){let[l,u]=n,p=Math.min(d,l),f=u?Math.min(s,u):s;o.setStyles({width:`${p}px`,height:u?`${f}px`:""}),typeof t=="function"&&t({availableWidth:p,availableHeight:f});return}typeof t=="function"&&t({availableWidth:d,availableHeight:s})})}function Ud(e){let t=typeof e.onArrowClick=="function",n=Array.isArray(e.arrowButtons);t!==n&&(t?Dd(e):jd(e))}function Dd(e){let t=c=>{let d=document.createElement("div").setClass("modal-root__arrow-container"),s=document.createElement("button").setClass(`modal-root__arrow-button modal-root__arrow-button--${c} button button--icon button--grey-300`);return s.setAttribute("aria-label",BeFunky.LanguageManager.getString(c==="left"?"previous":"next","modal")),s.innerHTML=BeFunky.getSvgHtml("chevron-icon"),s.addEventListener("click",()=>e.onArrowClick(c)),d.appendChild(s),{container:d,button:s}},{button:n,container:o}=t("left"),{button:i,container:r}=t("right");e.arrowButtons=[n,i];let{outerContainer:a}=e;a.insertBefore(o,e.innerContainer),a.appendChild(r)}function jd(e){e.arrowButtons.map(t=>t.parentElement).forEach(t=>{e.outerContainer.removeChild(t)}),delete e.arrowButtons}function Od(){BeFunky.addArrowKeyHandler({condition:()=>be&&typeof be.onArrowClick=="function",callback:(e,t,n)=>{if(n.type!=="keyup"||t!=="left"&&t!=="right")return;let o=t==="left"?0:1;be.arrowButtons[o].disabled||be.onArrowClick(t)}})}function Nd(e){let t=e.addCloseButton===!0,n=!!e.closeButton;t!==n&&(t?qd(e):Wd(e))}function qd(e){let t=document.createElement("button").setClass("button button--icon button--transparent button--sm modal-root__close-button");t.setAttribute("aria-label","Close"),t.innerHTML=BeFunky.getSvgHtml("cancel-icon",{classes:"icon icon--18"}),t.addEventListener("click",()=>{t.dispatchEvent(new Event("CLOSE",{bubbles:!0}))}),e.closeButton=t,e.innerContainer.appendChild(t)}function Wd(e){e.innerContainer.removeChild(e.closeButton),delete e.closeButton}function zs(){return BeFunky.isMobile||!BeFunky.isWiderThanMobile()}BeFunky.openModal=qs;BeFunky.closeModal=Vn;BeFunky.toggleModal=Cd;BeFunky.getModal=Ed;BeFunky.isModalOpen=Ad;BeFunky.moveModalRoot=Rd;BeFunky.getModalRoot=()=>Ze;BeFunky.getModalSizes=()=>Br;var{elem:Hd,html:Et,modalLang:Vo,isTemplateResult:Vd,render:Gd}=BeFunky.lit;BeFunky.openDialog=({heading:e,body:t,buttons:n=[],imageUrl:o,figure:i,id:r,className:a="",modalOptions:{size:c,isDialog:d=!0,addCloseButton:s=!1,addLightThemeClass:l=!1,addAnchorBottomClass:u=!1,closeOnClickOutside:p=!1,isCritical:f=!1,isForm:g=!1,disableClose:m=!1,onClose:_=()=>{},bottomVeilBackgroundColor:y,isFullWidthOnMobile:h}={}})=>{let k=Boolean(i||o);c=c||(k?"medium":"small"),k&&c==="small"&&BeFunky.reportWarning("Small dialog used with image",t);let v=["dialog",k?"dialog--has-figure":"",o&&o.includes(".svg")?"dialog--has-illustration":"",a].filter(Boolean).join(" "),F=Hd`<div class=${v}></div>`;E(),BeFunky.LanguageManager.addLanguageUpdateListener(E);let T;r?(F.id=r,console.log("Opening dialog:",F.id)):(T=F.textContent.replace(/\s+/g," "),F.id=`dialog_${BeFunky.hash(T)}`,console.log("Opening dialog:",T.length>35?`${T.slice(0,35)}...`:T)),document.getElementById(F.id)&&BeFunky.throwError("Duplicate dialog already open",r||T);let L={onClose:()=>{_(),BeFunky.LanguageManager.removeLanguageUpdateListener(E)},destroyOnClose:!0,isCritical:f,size:c,isDialog:d,closeOnClickOutside:p,addCloseButton:s,addLightThemeClass:l,addAnchorBottomClass:u,bottomVeilBackgroundColor:y,isFullWidthOnMobile:h};return m&&(Object.assign(L,{onClose:()=>{BeFunky.throwError("User closed dialog which should never be closed",{content:F.textContent}),BeFunky.LanguageManager.removeLanguageUpdateListener(E)},closeOnEscape:!1}),F.addClass("dialog--disable-close")),g&&F.addClass("dialog--has-form"),BeFunky.openModal(F,L),M;function E(){Gd(I(),F)}function I(){return Et`
        ${i||zd(o,c)}
        <div class="dialog__body">
            ${e?Et`<h2 class="dialog__heading h4">${Vo(e)}</h2>`:""}
            ${Xs(t)}
            ${n.length?Et`
            <div class="dialog__footer">
                ${n.map(j=>Xd(j,M))}
            </div>
            `:""}
        </div>`}function M(){BeFunky.closeModal(F.id,!1)}};function zd(e,t){if(e){if(e.includes(".svg"))return Et`
            <div class="dialog__illustration">
                <div class="dialog__illustration-max-width">
                    <div class="dialog__illustration-image" style=${`background-image: url('${e}')`}>
                </div>
            </div>`;let n=BeFunky.getModalSizes()[t];if(n&&n[0]){let o=n[0];e=BeFunky.addParamsToURL(e,{width:Math.round(o*(BeFunky.isRetina()?1.5:1))})}return Et`<div class="dialog__image" style=${`background-image: url('${e}')`}></div>`}return""}function Xd({text:e,type:t,size:n="md",focusInitially:o=!1,href:i,style:r="",onClick:a},c){let s=(u=>u.reduce((p,f)=>p.concat(f),[]))(["button",`button--${n}`,"dialog__button",typeof t=="string"?`button--${t}`:"",Array.isArray(t)?t.map(u=>`button--${u}`):"",o?"focus-initially":""]).filter(Boolean);if(i){if(a)throw new Error("onClick not supported by links");return Et`<a href=${i} rel="noopener" target="_blank" class=${s.join(" ")} style=${r}>${Vo(e)}</a>`}return Et`<button @click=${l} class=${s.join(" ")} style=${r}>${Vo(e)}</button>`;function l(u){typeof a=="function"&&a(u),c()}}function Xs(e){return e?typeof e=="function"?Xs(e()):typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"?Et`<p>${Vo(e)}</p>`:e instanceof HTMLElement||Vd(e)?e:(BeFunky.logError("Invalid content passed to dialog",e),""):""}BeFunky.acknowledge=(e,{onAcknowledge:t,buttonText:n="ok_got_it",heading:o,isCritical:i=!1,disableClose:r=!1,size:a,focusButton:c=!0,imageUrl:d=""}={})=>{if(!((typeof e=="string"||Array.isArray(e))&&e.length||e instanceof HTMLElement||BeFunky.lit.isTemplateResult(e)||typeof e=="function"))throw new Error("message required");return BeFunky.openDialog({heading:o,body:e,imageUrl:d,buttons:[{text:n,type:"blue",focusInitially:c}],modalOptions:{onClose:t,isCritical:i,disableClose:r,size:a}})};BeFunky.confirm=(e,{onConfirm:t,onCancel:n=()=>{},confirmText:o="ok",cancelText:i="cancel",heading:r,isCritical:a=!1,size:c,imageUrl:d=void 0,focusConfirmButton:s=!0,className:l,addCloseButton:u=!1}={})=>{if(!((typeof e=="string"||Array.isArray(e))&&e.length||e instanceof HTMLElement||BeFunky.lit.isTemplateResult(e)||typeof e=="function"))throw new Error("message required");if(typeof t!="function")throw new Error("onConfirm callback required");let f=!1,g=!1,m=()=>{f?t():n(g)},_=[{text:i,type:"grey-300",onClick:()=>{g=!0}},{text:o,type:["blue","ellipsis"],onClick:()=>{f=!0},focusInitially:s}];return BeFunky.openDialog({heading:r,body:e,buttons:_,imageUrl:d,className:l,modalOptions:{isCritical:a,size:c,imageUrl:d,onClose:m,addCloseButton:u}})};var{html:Pr,elem:Yd,icon:Kd,modalLang:Go,render:Jd}=BeFunky.lit,zt={};function Qd({message:e,acceptButton:t,dismissButton:n="",position:o="top-center",onAccept:i=()=>{},onDismiss:r=()=>{},dismissDelay:a,classes:c=[]}){zt[o]&&Gn(zt[o]);let d=["toast",o?`toast--${o}`:"",...c].filter(Boolean).join(" "),s=Yd`<div class=${d}></div>`;s.reRender=()=>Jd(l(),s),s.reRender(),BeFunky.LanguageManager.addLanguageUpdateListener(s.reRender),zt[o]=s,document.body.appendChild(s),document.visibilityState==="visible"?u():document.addEventListener("visibilitychange",function g(){document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",g),u())});function l(){return Pr`
        <div class="toast__content">
            <p>${Go(e)}</p>
            <button class="button button--blue button--xs toast__button" @click=${p}>${Go(t)}</button>
            ${n?Pr`<button class="button button--grey-300 button--xs toast__button" @click=${f}>${Go(n)}</button>`:""}
        </div>
        ${n?"":Pr`
        <button class="button button--transparent button--icon button--xs toast__close" @click=${f} aria-label="${Go("dismiss",!0)}">
            ${Kd("cancel-icon","icon icon--14")}
        </button>
        `}
        `}function u(){requestAnimationFrame(()=>{requestAnimationFrame(()=>{s===zt[o]&&(s.addClass("toast--is-active"),typeof a=="number"&&setTimeout(()=>{Gn(s),r(!1)},a))})})}function p(){Gn(s),i()}function f(){Gn(s),r(!0)}return()=>Gn(s)}function Gn(e){let t=Object.entries(zt).find(([,o])=>e===o);if(!t)return;let n=t[0];zt[n]=void 0,e.addClass("toast--is-hidden"),BeFunky.LanguageManager.removeLanguageUpdateListener(e.reRender),setTimeout(()=>{requestAnimationFrame(()=>{e.parentElement.removeChild(e)})},75)}BeFunky.showToast=Qd;BeFunky.isToastActive=e=>Boolean(zt[e]);var Zd=getCookie("geo_country"),ep=["AT","BE","BG","HR","CY","CZ","DK","EE","FI","FR","DE","GR","HU","IE","IT","LV","LT","LU","MT","NL","PL","PT","RO","SK","SI","ES","SE","GB","GF","GP","MQ","ME","YT","RE","MF","GI","AX","PM","GL","BL","SX","AW","CW","WF","PF","NC","TF","AI","BM","IO","VG","KY","FK","MS","PN","SH","GS","TC","AD","LI","MC","SM","VA","JE","GG","GI","CH"];if(ep.includes(Zd)||BeFunky.testingFlags.includes("cookie_banner")){let e=getCookie("gdpr_cookie_consent");e==="yes"?Lr():e==="no"||BeFunky.LanguageManager.loadLanguage("en").catch(()=>{}).then(tp)}else Lr();function Lr(){BeFunky.isAppleAppStoreApp||BeFunky.loadScript(`${BeFunky.Params.globalAssetsPath}js/bfn_gaV31.js`),!BeFunky.Params.IS_LC&&!BeFunky.isAppleAppStoreApp&&BeFunky.loadScript(`${BeFunky.Params.globalAssetsPath}js/mix_panel.min${BeFunky.Params.mix_panel_js_version}.js`),!BeFunky.Params.IS_LC&&!BeFunky.isAppleAppStoreApp&&BeFunky.loadScript(`${BeFunky.Params.globalAssetsPath}js/sentry-7.3.0-tracing.min.js`).then(()=>window.onSentryLoad())}function tp(){BeFunky.showToast({message:["cookie_banner",{privacy_policy:BeFunky.toLinkHTML(`${BeFunky.Params.siteUrl}privacy/`,!0)}],acceptButton:"accept",dismissButton:"reject",position:"bottom-left",classes:["toast--cookie-banner"],onAccept:()=>{setCookie("gdpr_cookie_consent","yes",365),Lr()},onDismiss:()=>{setCookie("gdpr_cookie_consent","no",30)}})}var Ys=fn(ji()),Ks=[".modal-root__outer",".dropdown__list",".pmi__basic-settings",".pmi__advanced-settings",".site-nav__dropdown-content",".site-nav__popup-root",".focus-trap",".draggable-panel"].join(", "),Cr=[".focus-avoid",".popover:not(.active)",".image-manager__images",".tabs__button--active",".control-item-disabled",".autocomplete__item.button--selected:first-child"].join(", "),np=document.getElementById("bfn-app"),op=BeFunky.getModalRoot(),ip=document.getElementById("site_root"),cn=[np,op,ip].filter(Boolean);document.addEventListener("keydown",e=>{rp(e)});function rp(e){if(!(e.key!=="Tab"&&e.keyCode!==9)){if(!cn.some(t=>t.contains(e.target))){requestAnimationFrame(()=>{let t=document.activeElement;cn.some(n=>n.contains(t))&&BeFunky.handleNextFocus(t,0)});return}e.preventDefault(),!BeFunky.isPointerDown&&BeFunky.handleNextFocus(e.target,e.shiftKey?-1:1,{originalEvent:e})}}BeFunky.handleNextFocus=(e,t,{showOutline:n=!0,originalEvent:o}={})=>{let i=e.closestParent(s=>cn.includes(s)||s.matches(Ks));if(!i||cn.includes(i)&&i.id!=="site_root"||i.matches(Cr)){o&&o.preventDefault();return}let r=(0,Ys.default)(i);[...i.querySelectorAll(Cr)].forEach(s=>{r=r.filter(l=>!s.contains(l)||l===e)});let a=r.indexOf(e);if(r.length===0||r.length===1&&i===r[0]&&t!==0)return;a+=t;let c=a<0||a>r.length-1;if(c&&typeof i.exitFocusTrap=="function")return i.exitFocusTrap(t);c&&(a=a<0?r.length-1:0);let d=r[a];Er(d,t,n)};BeFunky.isFocusable=function(e,t){return t=t||e.closestParent(n=>cn.includes(n)||n.matches(Ks)),!(!t||cn.includes(t)&&t.id!=="site_root"||t.matches(Cr)||e.disabled)};function Er(e,t,n,o=!0){if(!e)return;if(typeof e.delegateFocus=="function")return Er(e.delegateFocus(t),t,n);if(!e.focus)return;n&&ap(e);let i=e===document.activeElement;i||e.focus(),o&&e.tagName.toLowerCase()==="input"&&!i&&e.select()}function ap(e){if(!e._isFocusOutlineVisible){if(e.hasClass("button")){yt(e,()=>e.addClass("button--focus"),()=>e.removeClass("button--focus"));return}if(e.hasClass("color-button")){yt(e,()=>e.addClass("color-button--focus"),()=>e.removeClass("color-button--focus"));return}if(e.nodeName==="A"&&yt(e,()=>e.addClass("link--focus"),()=>e.removeClass("link--focus")),e.hasClass("chip")){yt(e,()=>e.addClass("chip--focus"),()=>e.removeClass("chip--focus"));return}if(e.hasClass("pmi")){yt(e,()=>e.addClass("pmi--focus"),()=>e.removeClass("pmi--focus"));return}if(e.hasClass("gallery__item")){let t=e.closest("image-gallery");if(!t)return;yt(e,()=>{t.focusedItemId=e.imageRef.id},()=>{t.focusedItemId===e.imageRef.id&&(t.focusedItemId="")})}if(e.nodeName==="INPUT"){if(e.type==="checkbox"){let t=e.parentElement;if(t&&t.hasClass("checkbox")){yt(e,()=>t.addClass("checkbox--focus"),()=>t.removeClass("checkbox--focus"));return}let n=e.nextElementSibling;n&&n.hasClass("button--toggle")&&yt(e,()=>n.addClass("button--focus"),()=>n.removeClass("button--focus"));return}if(e.type==="radio"){let t=e.parentElement;if(!t)return;t.hasClass("radio-button")&&yt(e,()=>t.addClass("radio-button--focus-within"),()=>t.removeClass("radio-button--focus-within"))}}}}function yt(e,t,n){e._isFocusOutlineVisible=!0,t(),e.addEventListener("blur",function o(){e.removeEventListener("blur",o),e._isFocusOutlineVisible=!1,n()})}BeFunky.focus=function(e){Er(e,1,!0,!1)};BeFunky.temporarilyFocusDiv=function(e,t=!0){t&&e.setAttribute("tabindex","0"),e.focus(),t&&e.addEventListener("blur",function n(){e.removeEventListener("blur",n),e.removeAttribute("tabindex")})};if(window.prismicButtonActions.length){let{action:e,time:t}=window.prismicButtonActions[window.prismicButtonActions.length-1],n=Date.now()-t,o=BeFunky.isChrome?500:1e3;n<o?(console.log(`Handling Prismic button action "${e}" that occurred ${n}ms before befunky.core.js loaded or document was ready:`),Js(e)):BeFunky.logError(`Prismic button action "${e}" ignored b/c it occurred ${n}ms before befunky.core.js loaded or document was ready`)}window.onClickPrismicButton=function(e){Js(e)};function Js(e){let t={upgrade:()=>{BeFunky.openPricingModal()},register:()=>{BeFunky.openLoginPanel("REGISTER")},sign_in:()=>{BeFunky.openLoginPanel("SIGNIN")},sign_out:()=>{BeFunky.signOut()},pay:()=>{BeFunky.openPaymentPanel(ht())},get_started_header:()=>Qs("HEADER"),get_started:()=>Qs()};if(t[e])return t[e]();BeFunky.throwError(`Unhandled Prismic button action: "${e}" (${BeFunky.getType(e)})`)}function Qs(){let e=document.getElementById("get_started_modal");[...e.querySelectorAll("img")].forEach(t=>window.loadLazyImage(t)),BeFunky.openModal(e,{size:"large",addCloseButton:!0})}function sp(){let e=Array.from(document.querySelectorAll(".comparison")),t=BeFunky.isIOS||BeFunky.isAndroid,n=t?"touchmove":BeFunky.pointermove,o=window.innerHeight;e.forEach(i=>{let r=i.getBoundingClientRect(),a=i.querySelector(".comparison__image-before-container"),c=i.querySelector(".comparison__handle"),d=Date.now(),s=0,l=!1,u,p=!1,f=h=>{i.toggleClass("comparison--show-text",h)},g=BeFunky.debounce(h=>{let k=100*h/r.width;a.setStyles({width:`${k}%`})},300),m=h=>{let k=typeof h.pageX=="number"?h.pageX:h.touches[0].pageX;h.preventDefault&&r.height<o/2&&h.preventDefault();let v=0,F=r.width,T=Math.max(v,Math.min(F,k-r.x)),L=T-r.width/2,E=Math.abs(T-s);s=T;let I=Date.now(),M=I-d;d=I,E>50&&M>50?(l||(l=!0,cancelAnimationFrame(u),a.setStyles({transition:""}),c.setStyles({transition:""})),u=requestAnimationFrame(Y)):(l&&(l=!1,cancelAnimationFrame(u),a.setStyles({transition:"none"}),c.setStyles({transition:"none"})),Y());function Y(){a.setStyles({width:`${T}px`}),c.setStyles({transform:`translateX(${L}px)`}),g(T)}},_=h=>{p||(p=!0,m(h),f(!0),i.addEventListener(n,m))},y=h=>{!p||(p=!1,f(!1),i.removeEventListener(n,m),h.type===BeFunky.pointerout&&h.pageX&&(r.right<h.pageX||r.left>h.pageX)&&m(h))};t?(i.addEventListener("touchstart",_),i.addEventListener("touchend",y)):(i.addEventListener(BeFunky.pointerdown,_),i.addEventListener(BeFunky.pointerover,h=>{BeFunky&&BeFunky.isPointerDown&&_(h)}),i.addEventListener(BeFunky.pointerup,y),i.addEventListener(BeFunky.pointerout,y)),window.addEventListener("resize",BeFunky.debounce(()=>{r=i.getBoundingClientRect(),o=window.innerHeight;let h=parseFloat(a.style.width)/100*r.width;isNaN(h)||m({pageX:r.x+h})},300))})}sp();var{html:$e,lang:un,icon:Ar,useLayoutEffect:Zs,useEffect:lp,useMemo:cp,defineCustomElement:up,ifDefined:dp}=BeFunky.lit,zn=(...e)=>BeFunky.logFeature("image_gallery",...e);up("image-gallery",pp);function pp({onClickItem:e,selectedImageIDs:t,useSelectButton:n=!1,getItemTooltip:o,extendItemTemplate:i,addItemClass:r,rowHeight:a=300,imagePadding:c=0,gutterWidth:d=16,borderWidth:s=0,minItemWidth:l=40,isLoading:u=!1,images:p=[],emptyState:f=null,message:g=null,currentWidth:m=1e3,debug:_=!1,context:y="app",viewport:h,singleRow:k=!1,focusedItemId:v="",preserveOrder:F=!0,_longPressState:T=null,onLongPressItem:L,setupItemDragging:E,_setupItemDraggingRIC:I}){let M=this;Zs(()=>this.addClass("gallery"),[]),Zs(()=>this.setStyles({width:`${m}px`}),[m]),lp(()=>{I&&(cancelIdleCallback(I),M._setupItemDraggingRIC=void 0),typeof E=="function"&&(M._setupItemDraggingRIC=requestIdleCallback(()=>{[...M.querySelectorAll(".gallery__item")].forEach(S=>{S.imageRef&&E(S,S.imageRef)})}))},[E,t,p,a,m,l,d,k]);let j=cp(me,[p,a,m,l,d,k,F]),Y=P(j.map(S=>S.height));return zn("Render",M.className),Q();function Q(){return $e`
            ${z()}
            ${re()}
            ${he()}
            ${ue()}
        `}function z(){return p.length?$e`<div
            class="gallery__items"
            style=${`height: ${Y}px`}
            @keyup=${Fe}
            @click=${Pe}
            @pointerdown=${Be}
            @pointermove=${pe}
            @pointerup=${ke}
            @pointercancel=${ke}
        >
            ${j.map(ne)}
        </div>`:""}function ne(S,A){return $e`<div class="gallery__row" style=${`height: ${S.height}px`}>${R(S)?S.items.map(U=>Z(U,A)):""}</div>`}function Z(S,A){if(S.isBookend)return de(S);let{aspectRatio:U,flex:D,isTransparent:oe,isGraphic:le,imageRef:W,isLast:K}=S,X=Array.isArray(t),ce=X?t.includes(S.id):!1,V=i?i(W):"",Ie=["gallery__item",ce?"gallery__item--selected":"",X&&!n?"gallery__item--selectable":"",X&&n?"gallery__item--selectable-with-button":"",le?"gallery__item--graphic":"",U>1?"gallery__item--wide":"gallery__item--narrow",r?r(S.imageRef):"",v===S.id?"gallery__item--focused":"",V?"gallery__item--has-content":""].filter(Boolean).join(" "),ae=`flex: ${D}; margin: 0 ${K?0:`${d}px`} ${d}px 0;`;_&&S.color&&(ae+=`outline: 4px solid ${S.color};`),s&&(ae+=`border: ${s}px solid var(--border-color);`);let $=S.getImageURL?S.getImageURL(S.width,S.height):S.thumbURL;W.lastRenderedThumb={url:$,renderedWidth:S.width};let O=`url('${$}') no-repeat center`,H=le?"contain":"cover";oe&&!le&&(O+=`, url('${BeFunky.Params.globalImagesPath}app/checker_pattern.jpg') repeat`,H+=", auto");let se=`padding-bottom: ${100/U}%;`,Me="";if(c){let Re=`position: absolute; top: ${c}px; right: ${c}px; bottom: ${c}px; left: ${c}px; background: ${O}; background-size: ${H}`;Me=$e`<div style=${Re}></div>`}else se+=`background: ${O}; background-size: ${H}`;return $e`
        <div class=${Ie} style=${ae} .imageRef=${W} .isSelected=${ce} .renderedImageURL=${$} data-tooltip=${dp(o?o(S.id):void 0)} tabindex="0">
            <div class="gallery__placeholder" style=${se}>${Me}</div>
            ${le?"":$e`<div class="gallery__overlay"></div>`}
            ${X&&!n?$e`<div class="gallery__outline">${Ar("checkmark-icon",`icon ${ce?"icon-selected":"icon-deselected"}`)}</div>`:""}
            ${X&&n?$e`<div class="gallery__outline"><button class="button gallery__select-button">${Ar("checkmark-icon",`icon ${ce?"icon-selected":"icon-deselected"}`)}</button></div>`:""}
            ${_?$e`<div style="position: absolute; top: 31.8%; background: var(--secondary-000); color: black; padding: 0 4px;">${A} : ${S.imageIndex} : ${U.toFixed(3)}</div>`:""}
            ${V}
        </div>`}function de(S){let{aspectRatio:A}=S,U=`flex: ${A}; margin-bottom: ${d}px; ${s?`border: ${s}px solid transparent;`:""}`;return $e`<div class="gallery__item gallery__item--bookend" style=${U}></div>`}function re(){if(!g)return"";let{isError:S,text:A,buttonText:U,buttonAction:D}=g,oe=["gallery__message",S?"gallery__message--is-error":"",m<400?"gallery__message--narrow":""].filter(Boolean).join(" "),le=p.length?`margin-bottom: ${d}px`:"",W=`button ${S?"button--xs button--white-outline-notheme":"button--blue"}`;return $e`
        <div class=${oe} style=${le}>
            ${A?$e`<string>${un(A,y)}</string>`:""}
            ${U&&D?$e`<button @click=${D} class=${W}>${un(U,y)}</button>`:""}
        </div>`}function he(){if(!f||u||p.length)return"";let{icon:S,imageUrl:A,text:U,buttonText:D,buttonAction:oe,linkText:le,linkHref:W}=f,K=Math.round(Math.max(40,Math.min(96,m/10))/8)*8,X=["gallery__empty-state",m<400?"gallery__empty-state--narrow":""].filter(Boolean).join(" ");return $e`
        <div class=${X}>
            ${A?$e`<img src=${A} class="gallery__empty-state-image" alt="no results"/>`:""}
            ${S?Ar(S,"icon",{style:`width: ${K}px; height: ${K}px`}):""}
            ${U?$e`<p>${un(U,y)}</p>`:""}
            ${D&&oe?$e`<button @click=${oe} class="button button--blue">${un(D,y)}</button>`:""}
            ${le&&W?$e`<p><a href=${W} target="_blank" rel="noopener">${un(le,y)}</a></p>`:""}
        </div>`}function ue(){if(!u)return"";let S=["gallery__loading",p.length?"gallery__loading--below-images":"",m<400?"gallery__loading--narrow":""].filter(Boolean).join(" "),A=p.length?`margin-bottom: ${d}px`:"";return $e`
        <div class=${S} style=${A}>
            <div class="loading-spinner"></div> <string>${un("loading",y)}</string>
        </div>`}function Pe(S){if(M._longPressState&&M._longPressState.hasFired)return we();let A=S.target.closestParent(D=>D===this||D.imageRef);if(!A.imageRef)return;let U=n&&S.target.hasClass("gallery__select-button");e(A.imageRef,{isSelected:!A.isSelected,renderedImageURL:A.renderedImageURL,imageGalleryItem:A,wasSelectButtonClicked:U})}function Fe(S){if(S.key!=="Enter")return;let A=S.target;!A.imageRef||A.imageRef.id!==v||e(A.imageRef,{isSelected:!A.isSelected,renderedThumbUrl:A.renderedImageURL,imageGalleryItem:A,wasSelectButtonClicked:!1})}function Be(S){if(!L)return we();let A=S.target.closestParent(U=>U===this||U.imageRef);if(!A.imageRef)return we();M._longPressState={startX:S.pageX,startY:S.pageY,hasFired:!1,timeout:setTimeout(()=>{M.onLongPressItem&&(M._longPressState.hasFired=!0,M.onLongPressItem(A.imageRef,{isSelected:!A.isSelected,renderedThumbUrl:A.renderedImageURL,imageGalleryItem:A,wasSelectButtonClicked:!1}))},500)}}function pe(S){if(!M._longPressState||M._longPressState.hasFired)return;let A=M._longPressState.startX-S.pageX,U=M._longPressState.startY-S.pageY;if(Math.abs(A)>10||Math.abs(U)>10)return we()}function ke(){!M._longPressState||M._longPressState.hasFired||we()}function we(){!M._longPressState||(clearTimeout(M._longPressState.timeout),M._longPressState=null)}function me(){if(!p.length)return[];let S=p.map(($,O)=>{let H=Se($);return{id:$.id,aspectRatio:H,flex:H,groupID:F?$.groupID:1,imageIndex:O,indexInRow:-1,thumbURL:$.thumbURL,getImageURL:$.getImageURL,isTransparent:$.isTransparent,isGraphic:$.isGraphic,imageRef:$}}),A=S.slice();if(_){let $=A.map(O=>O.groupID).filter(Boolean).unique().reduce((O,H)=>(O[H]=C(80),O),{});A.forEach(O=>{O.color=$[O.groupID]})}let U=[],D;D=le();for(let $=0;$<A.length;$++){let O=A[$];if(D.items.length===0){W(O);continue}D.error=D.error||V(D.aspectRatios);let H=V([...D.aspectRatios,O.aspectRatio]);if(D.error>=H){W(O),D.error=H;continue}if(!window.disableSwap&&(K($)==="ADDED"&&$++,O=A[$],!O)||k)break;D=le(),W(O)}if(ae(),!k&&BeFunky.Params.isAdmin){let $=[];if(U.forEach(O=>{O.items.forEach((H,se)=>{se!==H.indexInRow&&BeFunky.logWarning("rows is incorrect",se,H.indexInRow),H.isBookend||$.push(H)})}),A.length!==S.length)BeFunky.logWarning("items does not match originalItems length",A.length,S.length);else if($.length!==A.length)BeFunky.logWarning("rows does not match items length",$.length,A.length);else if(!$.isIdenticalTo(A)){BeFunky.logWarning("rows does not match items");let O=$.findIndex((H,se)=>H!==A[se]);BeFunky.logWarning(O,$[O],A[O],$,A)}}let oe=0;return U.forEach($=>{$.height=ce($.aspectRatios)+d,$.rowTopOffset=oe,oe+=$.height;let O=P($.aspectRatios);$.items.forEach((H,se)=>{O<1&&(H.flex=H.aspectRatio/O),H.height=$.height-d,H.width=H.height*H.flex,H.isFirst=se===0,H.isLast=se===$.items.length-1})}),zn(U),U;function le(){let $={items:[],aspectRatios:[],error:0};return U.push($),$}function W($){$.indexInRow=D.items.length,D.items.push($),D.aspectRatios.push($.aspectRatio)}function K($){let O=A.slice($,$+10),H=X(D.items),se=X(O);if(!H.length||!se.length)return;let{error:Me,aspectRatios:Re}=D,ye={improvement:0,inRow:null,afterRow:null};H.forEach(ge=>{se.forEach(fe=>{if(ge.groupID!==fe.groupID||ge.aspectRatio===fe.aspectRatio)return;let De=Re.slice();De.splice(ge.indexInRow,1,fe.aspectRatio);let At=Me-V(De);At>1&&At>ye.improvement&&(ye.improvement=At,ye.inRow=ge,ye.afterRow=fe)})});let He=D.items[D.items.length-1];if(He.groupID&&se.forEach(ge=>{if(He.groupID!==ge.groupID)return;let fe=[...Re,ge.aspectRatio],De=Me-V(fe);De>1&&De>ye.improvement&&(ye.improvement=De,ye.inRow=null,ye.afterRow=ge)}),ye.improvement){let{inRow:ge,afterRow:fe}=ye;return ge?(zn(`Swapping in row #${U.length-1}`,ge.imageIndex,"<->",fe.imageIndex,ye),fe.indexInRow=ge.indexInRow,D.items.splice(ge.indexInRow,1,fe),D.aspectRatios.splice(ge.indexInRow,1,fe.aspectRatio),D.error=V(D.aspectRatios),Ee(A,ge,fe),"SWAPPED"):(zn(`Adding to row #${U.length-1}`,fe.imageIndex,ye),W(fe),A.splice(A.indexOf(fe),1),A.splice($,0,fe),"ADDED")}let Ke=U.length-1;for(;Ke>0&&Ie(Ke);)Ke--}function X($){return $.filter(O=>O.groupID).filter((O,H,se)=>!se.slice(0,H).find(Me=>Me.groupID===O.groupID&&Me.aspectRatio===O.aspectRatio))}function ce($){let O=$.length;if(!O)return 0;let H=m-d*(O-1)-s*O*2,se=P($);return H/se+s*2}function V($,O){let H=$.length;if(!H)return 0;let se=a,Me=m-d*(H-1)-s*H*2,Re=P($),ye=Re/$.length,He=Me/Re+s*2;if(!k){let ge=1.5,fe=2;Math.min(...$)>ge&&(se/=Math.min((ye+1)/2,fe)),$.length>1&&Math.max(...$)<1/ge&&(se*=Math.min((1/ye+1)/2,fe))}let Ke=Math.abs(se-He);return $.forEach((ge,fe)=>{if(O&&fe===H-1)return;let De=Me*ge/Re;De<l&&(Ke+=(l-De)**2)}),Ke}function Ie($){let O=U[$],H=U[$-1];if(H.items.length===1)return!1;let se=H.items[H.items.length-1],Me=[...O.aspectRatios,se.aspectRatio],Re=H.aspectRatios.slice();Re.splice(H.items.length-1,1);let ye=V(Me),He=V(Re),Ke=O.error-ye,ge=H.error-He,fe=Ke+ge;return fe<=10?!1:(zn(`Moving last item from row #${$} down to start of row #${$}`,{improvement:fe}),H.items.pop(),H.aspectRatios.pop(),H.error=He,O.items.unshift(se),O.aspectRatios.unshift(se.aspectRatio),O.error=ye,O.items.forEach((De,At)=>{De.indexInRow=At}),!0)}function ae(){let $=a,O=U[U.length-2];if(O){let ye=He=>He.reduce((Ke,ge)=>Ke+ge)/He.length;Math.abs(ye(O.aspectRatios)-ye(D.aspectRatios))<2&&($=Math.round(ce(O.aspectRatios)))}if(ce([...D.aspectRatios,0])<$)return;let se=D.aspectRatios.reduce((ye,He)=>ye+He,0),Me=D.aspectRatios.length+1,Re=(m-d*(Me-1)-s*Me*2)/($-s*2)-se;Re<0||k&&Re<1||W({isBookend:!0,aspectRatio:Re},Re)}}function Se({imageWidth:S,imageHeight:A,thumbWidth:U,thumbHeight:D}){return U/D||S/A||1}function Ee(S,A,U){let D=S.indexOf(A),oe=S.indexOf(U);S[D]=U,S[oe]=A}function C(S){return`#${B(S)}${B(S)}${B(S)}`}function B(S){return(Math.floor(Math.random()*(256-S))+S).toString(16)}function P(S){return S.reduce((A,U)=>A+U,0)}function R({rowTopOffset:S,height:A}){if(!h)return!0;let[U,D]=h,oe=S+A,le=1e3;return oe+le>=U&&oe-le<=D||S+le>=U&&S-le<=D||S-le<=U&&oe+le>=D}}BeFunky.draggableElement=(e,t,{fireMoveEvents:n=!1,eventDispatcher:o,dragScreen:i}={})=>function(){this.init=function(){this.dragging=!1,this.oncontextmenu=()=>!1,this.setStyles({touchAction:"none"}),this.addEventListener(BeFunky.pointerdown,this.handlePointerDown),this.pointerDownTarget=null,this.eventDispatcher=o||this,this.cancelSmoothScrolling=()=>{},this.debugQueue=[]},this.debug=r=>{this.debugQueue.push(r)},this.handlePointerDown=r=>{if(this.debug(`HPDown-${r.pointerId}`),this.setStyles({touchAction:"none"}),this.cancelSmoothScrolling(),r.button!==0)return;this.lastX=this.startX=r.pageX,this.lastY=this.startY=r.pageY,this.pointerDownTarget=r.target,typeof t=="function"?this.scrollContainer=t():this.scrollContainer=t,this.scrollDirection=null,this.startScrollTop=this.scrollContainer.scrollTop,this.startScrollLeft=this.scrollContainer.scrollLeft,this.lastScrollTime=Date.now(),this.scrollVelocity=0;let a=this.getBoundingClientRect();this.centerX=a.left+a.width/2,this.centerY=a.top+a.height/2,this.width=a.width,document.addEventListener(BeFunky.pointermove,this.handlePointerMove),document.addEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel),document.addEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel),document.addEventListener("contextmenu",this.handlePointerUpOrCancel)},this.handlePointerMove=r=>{if(this.dragging){if(n){let p=r.pointerType==="touch"?document.elementFromPoint(r.pageX,r.pageY):r.target;this.eventDispatcher.dispatchEvent(new CustomEvent("dragmoved",{detail:{dragTarget:p}}));return}throw console.log("Dragged item:",this.debugQueue?this.debugQueue.join(" "):"empty",this.className),new Error("pointermove should not be fired while dragging")}this.debugQueue[this.debugQueue.length-1]!=="HPMove"&&this.debug("HPMove");let a=r.pageX-this.lastX,c=r.pageY-this.lastY,d=Math.sqrt(Math.pow(a,2)+Math.pow(c,2)),s=Math.abs(c)/d,l=()=>{let p=5,f=this.width*1.75,g=this.scrollContainer.scrollTop,m=this.scrollContainer.scrollLeft,_=r.pageX-this.centerX+m-this.startScrollLeft,y=r.pageY-this.centerY+g-this.startScrollTop,h=Math.sqrt(_**2+y**2),k=r.pageX-this.startX+m-this.startScrollLeft,v=r.pageY-this.startY+g-this.startScrollTop,F=Math.sqrt(k**2+v**2);return!(h<p||F<p||h>f||_>0&&r.pageX<this.lastX||_<0&&r.pageX>this.lastX)},u=()=>{this.dragging=!0,this.eventDispatcher.dispatchEvent(new CustomEvent("dragstarted",{detail:{draggedElement:this}})),n||document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),this.debug("startDrag")};if(r.type==="mousemove"||r.pointerType==="mouse"){if(l())return u()}else{this.scrollDirection||(this.scrollDirection=this.scrollContainer.hasClass("horizontal-scroller")?"horizontal":"vertical");let p=this.scrollDirection==="vertical"&&s>=.5||this.scrollDirection==="horizontal"&&s<=.5,f=this.scrollDirection==="vertical"&&s>=.5&&c<0&&this.scrollContainer.scrollTop===0;if((!p||f)&&Math.abs(this.scrollVelocity)<.5&&l()&&d>1.5)return u();this.simulateScroll(this.scrollDirection==="vertical"?this.startScrollTop-this.scrollContainer.scrollTop-(r.pageY-this.startY):this.startScrollLeft-this.scrollContainer.scrollLeft-(r.pageX-this.startX))}this.lastX=r.pageX,this.lastY=r.pageY},this.simulateScroll=r=>{let a;if(this.scrollDirection==="vertical"){let{scrollTop:d}=this.scrollContainer;this.scrollContainer.scrollTop+=r,a=this.scrollContainer.scrollTop-d}else{let{scrollLeft:d}=this.scrollContainer;this.scrollContainer.scrollLeft+=r,a=this.scrollContainer.scrollLeft-d}let c=Date.now();return this.scrollVelocity=a?r/(c-this.lastScrollTime):0,this.lastScrollTime=c,a},this.handlePointerUpOrCancel=r=>{if(r.type==="pointerup"?this.debug(`HPUp-${r.pointerId}`):r.type==="pointercancel"?this.debug(`HPCancel-${r.pointerId}`):this.debug(`ContextMenu-${r.pointerId}`),document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel),document.removeEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel),document.removeEventListener("contextmenu",this.handlePointerUpOrCancel),this.pointerDownTarget=null,this.dragging){this.dragging=!1;let a=r.pointerType==="touch"?document.elementFromPoint(r.pageX,r.pageY):r.target,c;window.isAppOpen&&window.BFN&&BFN.Stage&&a===BFN.Stage.view&&(c=BFN.getCanvasCoordinates(r.pageX,r.pageY)),this.eventDispatcher.dispatchEvent(new CustomEvent("dragstopped",{detail:{dropTarget:a,canvasCoordinates:c}}))}else if(r.type==="pointerup"&&Math.abs(this.scrollVelocity)>.05){let a=()=>{if(Math.abs(this.scrollVelocity)>.05){let c=Date.now(),d=this.scrollVelocity*(c-this.lastScrollTime)/1.07;this.simulateScroll(d)&&(this.cancelSmoothScrolling=BeFunky.wait(["raf"],a))}};this.cancelSmoothScrolling=BeFunky.wait(["raf"],a)}},this.cancelDragging=()=>{this.debug("cancelDragging"),document.removeEventListener(BeFunky.pointermove,this.handlePointerMove),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel),document.removeEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel),document.removeEventListener("contextmenu",this.handlePointerUpOrCancel),this.pointerDownTarget=null,this.dragging&&(this.dragging=!1,this.eventDispatcher.dispatchEvent(new CustomEvent("dragstopped",{detail:{}}))),i.hide()},this._dragging=!1,Object.defineProperty(this,"dragging",{get(){return this._dragging},set(r){r=Boolean(r),r!==this._dragging&&(this._dragging=r,window.BFN&&BFN.appContainer&&BFN.appContainer.toggleClass("bfn--is-dragging",r))}}),this.init()}.bind(e)();BeFunky.dragScreen=e=>function(){this.addClass("drag-screen"),this.innerHTML="<img><div></div>",this.init=function(){this.active=!1,this.image=this.querySelector("img"),this.image.addClass("drag-screen__image"),this.nodeContainer=this.querySelector("div"),this.nodeContainer.setStyles({position:"absolute",left:"0",top:"0"}),this.image.onload=()=>{this.active&&this.addClass("drag-screen--active")},this.dragOffset={x:0,y:0},this.updatePositionThrottled=BeFunky.throttleRAF(this.updatePosition.bind(this))},this.show=function(t,n=.7){if(this.active||!t)return;this.active=!0,window.BFN&&window.isAppOpen&&(BFN.smoothPictureDisabled=!0),document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel,!0),document.addEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel,!0),document.addEventListener("contextmenu",this.handlePointerUpOrCancel,!0);let o=this.image.src;this.image.src=t,this.nodeContainer.innerHTML="",this.image.setStyles({width:BeFunky.isFirefox&&t.startsWith("data:image/svg+xml,")?"100px":""}),this.setStyles({opacity:n}),this.image.src===o&&this.addClass("drag-screen--active")},this.showNode=function(t,n=.7){this.active||!t||(this.active=!0,document.addEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.addEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel,!0),document.addEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel,!0),document.addEventListener("contextmenu",this.handlePointerUpOrCancel,!0),this.image.src="",this.image.setStyles({visibility:"hidden"}),this.nodeContainer.appendChild(t),this.setStyles({opacity:n}),this.addClass("drag-screen--active"))},this.hide=function(){this.nodeContainer.innerHTML="",this.image.setStyles({visibility:""}),!!this.active&&(this.active=!1,window.BFN&&window.isAppOpen&&(BFN.smoothPictureDisabled=!1),document.removeEventListener(BeFunky.pointermove,this.handlePointerMove,!0),document.removeEventListener(BeFunky.pointerup,this.handlePointerUpOrCancel,!0),document.removeEventListener(BeFunky.pointercancel,this.handlePointerUpOrCancel,!0),document.removeEventListener("contextmenu",this.handlePointerUpOrCancel,!0),this.setStyles({opacity:""}),this.removeClass("drag-screen--active"))},this.updatePosition=function(){let{x:t,y:n}=BeFunky.globalPointerCoords;t-=this.dragOffset.x,n-=this.dragOffset.y,this.setStyles({transform:`translate(${Math.round(t)}px, ${Math.round(n)}px)`})},this.handlePointerMove=()=>{this.updatePositionThrottled()},this.handlePointerUpOrCancel=()=>{this.hide()},this.init()}.bind(e)();var el=document.getElementById("explore");el&&gp.call(el);function gp(){this.init=function(){this.registerRoutes(),this.initPublicAPI(),this.initSearchForm(),this.initGallery()},this.initPublicAPI=function(){this.search=e=>{this.searchInput.value=e,this.loadSearchResults(e,1)},this.openImage=e=>{if(!e)return this.closeModal();let t=this.gallery.images.find(({id:n})=>n===`befunky_photo_${e}`);t?this.openModal(t):BeFunky.logError("Unable to open Explore image",{imageID:e})}},this.registerRoutes=function(){je("/explore/",()=>{this.search(""),this.openImage("")}),je("/explore/photos/",()=>{this.search(""),this.openImage("")}),je("/explore/photos/:keyword/",({keyword:e})=>{this.search(e),this.openImage("")}),je("/explore/gallery/:imageID/",({imageID:e})=>{this.openImage(e)})},this.initSearchForm=function(){this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.previousSearchQuery=null,this.previousSearchPage=-1,this.clearButton.addEventListener("click",()=>this.searchInput.focus()),this.searchForm.addEventListener("submit",this.handleSearch)},this.initGallery=function(){this.gallery=this.querySelector(".explore__gallery");let e=t=>(this.openModal(t),!1);this.gallery.rowHeight=200,this.gallery.currentWidth=this.getCurrentWidth(),this.gallery.singleRow=!1,this.gallery.onClickItem=e,this.gallery.context="site",this.gallery.borderWidth=1,window.addEventListener("resize",BeFunky.debounce(()=>this.handleGalleryResize(),300))},this.loadSearchResults=function(e,t=1){this.previousSearchQuery===e&&t<=this.previousSearchPage||(this.previousSearchQuery=e,this.previousSearchPage=t,ve(e?`/explore/photos/${encodeURIComponent(e)}/`:"/explore/"),t===1&&(this.gallery.images=[]),this.gallery.message="",this.gallery.isLoading=!0,this.toggleInteractivity(!1),fp(e,t,({error:n,images:o})=>{if(e!==this.previousSearchQuery)return;if(this.gallery.isLoading=!1,this.toggleInteractivity(!0),n){BeFunky.logError("Unable to fetch images",n),n==="no_results"?(this.gallery.message="",this.gallery.emptyState={imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/magnifying-glass-frown.svg`,text:BeFunky.LanguageManager.getStringReplacements("no_results_for",{query:`"<strong>${e}</strong>"`})}):(this.gallery.message={isError:!0,text:BeFunky.failureReason(n),buttonText:"try_again",buttonAction:()=>this.loadSearchResults(e,t)},this.gallery.emptyState="",this.previousSearchPage=this.previousSearchPage-1);return}if(this.gallery.images=[...this.gallery.images,...o],this.gallery.message="",o.length<100)return;let i=()=>this.loadSearchResults(e,t+1);this.gallery.message={buttonText:"load_more",buttonAction:i}}))},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearButton.disabled=!e},this.openModal=e=>{let t=this.previousSearchQuery?`/explore/photos/${this.previousSearchQuery}/`:"/explore/";BeFunky.openUserPhotoModal(e,this.gallery.images,t,!0)},this.closeModal=()=>{BeFunky.closeUserPhotoModal()},this.getCurrentWidth=()=>{return Math.min(1232,window.innerWidth)-e();function e(){return window.innerWidth>=768?96:window.innerWidth>=361?64:32}},this.handleSearch=e=>{e&&e.preventDefault();let t=this.searchInput.value.replace(/[+"<>^%]/gi," ").replace(/ {2,}/g," ").trim();this.searchInput.value=t,this.loadSearchResults(t)},this.handleGalleryResize=()=>{window.isAppOpen||(this.gallery.currentWidth=this.getCurrentWidth())},this.init()}function fp(e,t=1,n){let o={start:100*(t-1),end:100};e&&e.length>0&&(o.keyword=e),BeFunky.requestAPI("photo/explore/",o).then(i=>{if(!Array.isArray(i.data))throw"invalid_response";if(!i.data.length)return n({error:"no_results"});let r=i.data.map(s=>({id:`befunky_photo_${s.id}`,thumbWidth:200,thumbHeight:200,imageURL:a(s.url,880,500),getImageURL:l=>c(s.url,l),nick:s.nick,title:s.title,dateCreated:s.dateCreated,isTransparent:/\.png(\?|$)/.test(s.url)}));return n({images:r});function a(s,l,u){let p={auto:"avif,webp",width:d(l*(BeFunky.isRetina()?1.5:1)),height:d(u*(BeFunky.isRetina()?1.5:1)),fit:"bounds"};return BeFunky.addParamsToURL(s,p)}function c(s,l){let u={auto:"avif,webp",width:d(l*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(s,u)}function d(s){return Math.ceil(s/50)*50}})}var tl=document.getElementById("user_gallery");tl&&hp.call(tl);function hp(){this.init=function(){this.registerRoutes(),this.initPublicAPI(),this.setMetaData(),this.initGallery(),this.initResults()},this.setMetaData=function(){let e=/\/gallery\/([^/]+)/;this.userNickName=window.location.href.match(e)[1],document.querySelector(".user-gallery__username").textContent=this.userNickName},this.initPublicAPI=function(){this.openImage=e=>{if(!e)return this.closeModal();let t=this.gallery.images.find(({id:n})=>n===`befunky_photo_${e}`);t?this.openModal(t):BeFunky.logError("Unable to open Gallery image",{imageID:e})}},this.initGallery=function(){this.gallery=this.querySelector(".user-gallery__gallery");let e=t=>(this.openModal(t),!1);this.gallery.rowHeight=200,this.gallery.currentWidth=this.getCurrentWidth(),this.gallery.singleRow=!1,this.gallery.onClickItem=e,this.gallery.context="site",this.gallery.borderWidth=1,window.addEventListener("resize",BeFunky.debounce(()=>this.handleGalleryResize(),300))},this.initResults=function(){this.loadResults(1)},this.registerRoutes=function(){je("/gallery/:nick/",({nick:e})=>{this.openImage()}),je("/explore/gallery/:imageID/",({imageID:e})=>{this.openImage(e)})},this.loadResults=function(e=1){e<=this.previousSearchPage||(this.previousSearchPage=e,e===1&&(this.gallery.images=[]),this.gallery.message="",this.gallery.isLoading=!0,mp(this.userNickName,e,({error:t,images:n})=>{if(this.gallery.isLoading=!1,t){BeFunky.logError("Unable to fetch images",t),t==="no_results"?(this.gallery.message="",this.gallery.emptyState={imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/picture-frames.svg`,text:"no_photos"}):(this.gallery.message={isError:!0,text:BeFunky.failureReason(t),buttonText:"try_again",buttonAction:()=>this.loadResults(e)},this.gallery.emptyState="",this.previousSearchPage=this.previousSearchPage-1);return}if(this.gallery.images=[...this.gallery.images,...n],this.gallery.message="",n.length<100)return;let o=()=>this.loadResults(e+1);this.gallery.message={buttonText:"load_more",buttonAction:o}}))},this.openModal=e=>{BeFunky.openUserPhotoModal(e,this.gallery.images,`/gallery/${this.userNickName}/`,!0)},this.closeModal=()=>{BeFunky.closeUserPhotoModal()},this.getCurrentWidth=()=>{return Math.min(1232,window.innerWidth)-e();function e(){return window.innerWidth>=768?96:window.innerWidth>=361?64:32}},this.handleGalleryResize=()=>{window.isAppOpen||(this.gallery.currentWidth=this.getCurrentWidth())},this.init()}function mp(e,t=1,n){let o={start:100*(t-1),end:100,user_nick:e};BeFunky.requestAPI("photo/gallery",o).then(i=>{if(!Array.isArray(i.data))throw"invalid_response";if(!i.data.length)return n({error:"no_results"});let r=i.data.map(s=>({id:`befunky_photo_${s.id}`,thumbWidth:200,thumbHeight:200,imageURL:a(s.url,880,500),getImageURL:l=>c(s.url,l),nick:s.nick,title:s.title,dateCreated:s.dateCreated,isTransparent:/\.png(\?|$)/.test(s.url)}));return n({images:r});function a(s,l,u){let p={auto:"avif,webp",width:d(l*(BeFunky.isRetina()?1.5:1)),height:d(u*(BeFunky.isRetina()?1.5:1)),fit:"bounds"};return BeFunky.addParamsToURL(s,p)}function c(s,l){let u={auto:"avif,webp",width:d(l*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(s,u)}function d(s){return Math.ceil(s/50)*50}}).catch(i=>{if(i==="user_does_not_exist"){window.location.href=`${BeFunky.Params.siteUrl}404/`;return}n({error:i})})}var zo=window.deferredPromise(),{html:nl,siteLang:yp}=BeFunky.lit;BeFunky.myPhotosPage={openImage:e=>{zo.then(t=>{if(!t){BeFunky.throwError("MyPhotos page not available");return}BeFunky.myPhotosPage.openImage(e)})},selectFilter:e=>{zo.then(t=>{if(!t){BeFunky.throwError("MyPhotos page not available");return}BeFunky.myPhotosPage.selectFilter(e)})},isAvailable:!1};var ol=document.getElementById("my_photos");ol?_p.call(ol):zo.resolve(!1);function _p(){this.init=function(){this.initDefaultValues(),this.registerRoutes(),this.initPublicAPI(),this.initMenuItems(),this.initGallery(),this.initSearchForm()},this.initDefaultValues=function(){this.supportsTouch="ontouchstart"in document.documentElement||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},this.initPublicAPI=function(){BeFunky.myPhotosPage.isAvailable=!0,BeFunky.myPhotosPage.openImage=e=>{if(!e)return this.closeModal();let t=this.gallery.images.find(({id:n})=>n===`befunky_photo_${e}`);t?this.openModal(t):BeFunky.logError("Unable to open Gallery image",{imageID:e})},BeFunky.myPhotosPage.selectFilter=e=>{this.closeModal(),e!==this.previousFilter&&this.loadResults("",e)}},this.initMenuItems=function(){this.menuItems={editTitle:{domId:"edit_title_form",title:()=>"title",onClick:(e,t)=>{let n=vp("edit_title"),o=t.id.replace("befunky_photo_",""),i=`${o}${t.key}`,{teardown:r,setFormState:a}=Je(n,{title:"edit_title",fields:[{name:"title",label:"title",initialValue:t.title,maxLength:100,errorMessage:"photo_title_length",validate:c=>c.length>=1&&c.length<=100,sanitize:c=>c.replace(/[^a-zA-Z0-9-_\\\s]/g,"")}],button:"update_title",onSubmit:({title:c})=>{kp(n,i,c,({error:d,updatedTitle:s})=>{if(d){BeFunky.logError("Unable to set title on photo",d),a({submissionErrors:[BeFunky.failureReason(d)]});return}let l=this.gallery.images.find(({id:u})=>u===`befunky_photo_${o}`);l.title=s,BeFunky.closeModal(n)})}});Bp(n,r)}},openInApp:{title:()=>"editor",onClick:(e,t)=>{let n=BeFunky.addParamsToURL(t.imageURL,{io:"off"});BeFunky.editorExternalImage={behavior:"ask_user",getNewProjectThumbnail:()=>{let o={width:Math.ceil(258*(BeFunky.isRetina()?1.5:1)/50)*50,height:Math.ceil(144*(BeFunky.isRetina()?1.5:1)/50)*50,fit:"bounds"},i=BeFunky.addParamsToURL(n,o);return Promise.resolve({image:i})},loadImage:()=>{BFN.BfnService.ToJsUrlUploader(n,null,"befunky")}},ve("/create/")}},publicPrivate:{title:e=>e.isPublic===!0?"set_to_private":"set_to_public",onClick:(e,t)=>{e.target.parentElement.focus(),e.target.disabled=!0,wp(t,({error:n,isPublic:o,id:i})=>{if(e.target.disabled=!1,n){BeFunky.logError("Unable to change photo status",n);return}this.previousFilter==="public"||this.previousFilter==="private"?(this.gallery.images=this.gallery.images.filter(r=>r.id!==i),e.target.parentElement.blur()):this.reRenderGalleryPopup()})}},deleteImage:{title:()=>"trash",onClick:(e,t)=>{BeFunky.confirm("delete_this_photo",{onConfirm:()=>{bp(t,({error:n,id:o})=>{if(n){BeFunky.logError("Unable to delete photo",n);return}this.gallery.images=this.gallery.images.filter(i=>i.id!==o),document.activeElement.blur()})},focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/photo-project-shredder.svg`})}}}},this.initGallery=function(){this.gallery=this.querySelector(".my-photos__gallery");let e=t=>{this.openModal(t)};this.gallery.rowHeight=200,this.gallery.currentWidth=this.getCurrentWidth(),this.gallery.singleRow=!1,this.gallery.onClickItem=e,this.gallery.context="site",this.gallery.addItemClass=()=>"gallery__item--has-content",this.gallery.extendItemTemplate=t=>this.photoOptionsTemplate(t),this.gallery.borderWidth=1,window.addEventListener("resize",BeFunky.debounce(()=>this.handleGalleryResize(),300))},this.initSearchForm=function(){this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.validFilters=["all","public","private"],this.filterButtons=this.validFilters.reduce((e,t)=>{let n=document.getElementById(`my_photos_filter_${t}`);return e[t]=n,n.addEventListener("click",()=>this.loadResults("",t)),e},{}),this.previousSearchQuery=null,this.previousFilter=null,this.previousSearchPage=-1,this.clearButton.addEventListener("click",()=>{this.loadResults("",this.previousFilter),this.searchInput.focus()}),this.searchForm.addEventListener("submit",this.handleSearch)},this.registerRoutes=function(){je("/myphotos/",()=>{BeFunky.myPhotosPage.selectFilter("all")}),je("/myphotos/:filter/",({filter:e})=>{BeFunky.myPhotosPage.selectFilter(e)}),je("/explore/gallery/:imageID/",({imageID:e})=>{BeFunky.myPhotosPage.openImage(e)})},this.reRenderGalleryPopup=function(){this.gallery.extendItemTemplate=e=>this.photoOptionsTemplate(e)},this.loadResults=function(e,t,n=1){if(this.previousSearchQuery===e&&this.previousFilter===t&&n<=this.previousSearchPage)return;if(!this.validFilters.includes(t)){BeFunky.logError("Invalid MyPhotos filter",{filter:t});return}this.searchInput.value=e;let o=this.filterButtons[t];Object.values(this.filterButtons).forEach(r=>{r.parentElement.toggleClass("active",r===o)}),this.previousSearchQuery=e,this.previousFilter=t,this.previousSearchPage=n;let i=t==="all"?"/myphotos/":`/myphotos/${t}/`;i!==Bt()&&ve(i),n===1&&(this.gallery.images=[]),this.gallery.message="",this.gallery.isLoading=!0,this.toggleInteractivity(!1),Fp(e,t,n,({error:r,images:a})=>{if(e!==this.previousSearchQuery||t!==this.previousFilter)return;if(this.gallery.isLoading=!1,this.toggleInteractivity(!0),r){BeFunky.logError("Unable to fetch images",r),r==="no_results"?(this.gallery.message="",e?this.gallery.emptyState={text:["no_results_for",{query:`"<strong>${e}</strong>"`}],imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/magnifying-glass-frown.svg`}:this.gallery.emptyState={text:"no_befunky_photos",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/picture-frames.svg`}):(this.gallery.message={isError:!0,text:BeFunky.failureReason(r),buttonText:"try_again",buttonAction:()=>this.loadResults(e,t,n)},this.gallery.emptyState="",this.previousSearchPage=this.previousSearchPage-1);return}if(this.gallery.images=[...this.gallery.images,...a],this.gallery.message="",a.length<100)return;let c=()=>this.loadResults(e,t,n+1);this.gallery.message={buttonText:"load_more",buttonAction:c}})},this.photoOptionsTemplate=e=>{let t=["gallery__item-content","my-photos__edit-button",this.supportsTouch?"my-photos__edit-button--always-show":""].filter(Boolean).join(" ");return nl`
        <button class=${t} @click=${n}>
            <span class="my-photos__edit-ellipsis">
                <span></span><span></span><span></span>
            </span>
        </button>
        <div class="my-photos__edit-popup">
            <div class="my-photos__edit-popup-content" tabindex="0" @click=${o=>o.stopPropagation()}>
            ${Object.keys(this.menuItems).map((o,i)=>nl`
                <button class=${`button my-photos__edit-option my-photos__item-${i+1}`} @click=${r=>this.menuItems[o].onClick(r,e)}>
                    ${yp(this.menuItems[o].title(e))}
                </button>`)}
            </div>
        </div>
        `;function n(o){o.stopPropagation(),o.currentTarget.focus()}},this.toggleInteractivity=function(e){this.searchButton.disabled=!e,this.clearButton.disabled=!e,Object.values(this.filterButtons).forEach(t=>{t.disabled=!e})},this.openModal=e=>{let t=this.previousFilter==="all"?"/myphotos/":`/myphotos/${this.previousFilter}/`;BeFunky.openUserPhotoModal(e,this.gallery.images,t,!1)},this.closeModal=()=>{BeFunky.closeUserPhotoModal()},this.getCurrentWidth=()=>{return Math.min(1232,window.innerWidth)-e();function e(){return window.innerWidth>=768?96:window.innerWidth>=361?64:32}},this.handleSearch=e=>{e&&e.preventDefault();let t=this.searchInput.value.replace(/[+"<>^%]/gi," ").replace(/ {2,}/g," ").trim();this.searchInput.value=t,this.loadResults(t,"all")},this.handleGalleryResize=()=>{window.isAppOpen||(this.gallery.currentWidth=this.getCurrentWidth())},this.init(),window.initialUserStatus.then(()=>{if(!BeFunky.isLoggedIn()){window.location.href=`${BeFunky.Params.siteUrl}sign-in/?next=${encodeURIComponent(window.location.href)}`;return}zo.resolve(!0)})}function kp(e,t,n,o){let i=n.match(/#(\w+)/gi);i=i!=null?i.join().replace(/#/g,""):"";let r={imgId:t,title:n,tags:i};BeFunky.requestAPI("photo/update-image-info",r,{showLoadScreen:!0}).then(a=>{if(a.data!=="success"||a.message!=="1")throw"invalid_response";o({updatedTitle:a.title})}).catch(a=>{o({error:a})})}function wp(e,t){let{isPublic:n,key:o,id:i}=e;if((BeFunky.User.isMailVerified!=null?BeFunky.User.isMailVerified:BeFunky.Params.isMailVerified)||n){let c={imgId:i.replace("befunky_photo_","")+o,isPublic:n?"0":"1"};BeFunky.requestAPI("photo/update-image-info/",c).then(d=>{if(d.data!=="success"||d.message!=="1")throw"invalid_response";let s=!n;e.isPublic=s,t({isPublic:s,id:i})}).catch(d=>{t({error:d})})}else BeFunky.confirm("photos_public_verify_email",{confirmText:"send_verification_email",onConfirm:BeFunky.sendVerificationEmail,imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`}),t({error:"email_not_verified"})}function bp(e,t){let{id:n,key:o}=e,i={imgIds:`${n.replace("befunky_photo_","")+o}`};BeFunky.requestAPI("photo/delete-image/",i,{showLoadScreen:!0}).then(r=>{if(r.data!=="success"||r.message!=="1")throw"invalid_response";t({id:n})}).catch(r=>t({error:r}))}function Fp(e,t,n=1,o){let i={start:100*(n-1),end:100};e?i.keyword=e:i.type=t,BeFunky.requestAPI("photo/me/",i).then(r=>{if(!Array.isArray(r.data))throw"invalid_response";if(!r.data.length)throw"no_results";let a=r.data.map(l=>({id:`befunky_photo_${l.id}`,thumbWidth:200,thumbHeight:200,imageURL:c(l.url,880,500),getImageURL:u=>d(l.url,u),key:l.key,nick:l.nick,title:l.title,dateCreated:l.dateCreated,isPublic:l.isPublic===1,isTransparent:/\.png(\?|$)/.test(l.url)}));return o({images:a});function c(l,u,p){let f={auto:"avif,webp",width:s(u*(BeFunky.isRetina()?1.5:1)),height:s(p*(BeFunky.isRetina()?1.5:1)),fit:"bounds"};return BeFunky.addParamsToURL(l,f)}function d(l,u){let p={auto:"avif,webp",width:s(u*(BeFunky.isRetina()?1.5:1)),crop:"1:1"};return BeFunky.addParamsToURL(l,p)}function s(l){return Math.ceil(l/50)*50}}).catch(r=>{o({error:r})})}function vp(e){let t=document.createElement("div").setClass("modal form-modal");return t.id=`modal_form_${e}`,t}function Bp(e,t){BeFunky.openModal(e,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onClose:t})}var{html:ie,setupState:Sp,render:Tr,siteLang:N,elem:dn,icon:Pp}=BeFunky.lit,il=document.getElementById("my_account");il&&rl(il.querySelector(".my-account__inner"));function rl(e){let t={email:"",username:"",hasCancelledSubscription:!1,canResubscribe:!1,isLoading:!0,isEmailVerified:!1,isPayPalSubscriber:!1,isPayflowSubscriber:!1,isGooglePlaySubscriber:!1,isAppleAppStoreSubscriber:!1,isSocialUser:!0,isEmailSubscriber:!0,canChangeUsername:!0,canUpgrade:!1,monthlyCouponCode:"",billingCycle:"",nextBillingDate:"",packageName:"",paymentInfo:"",monthlyPriceIdForUpgradeToYearly:"",userPriceId:""},n=BeFunky.debounce(()=>Tr(a(),e),"raf"),[o,i]=Sp(t,n);BeFunky.LanguageManager.addLanguageUpdateListener(n);let r;BeFunky.isPlus()&&(r=de()),window.initialUserStatus.then(()=>{if(!BeFunky.isLoggedIn()){window.onbeforeunload=null,window.location.href=`${BeFunky.Params.siteUrl}sign-in/?next=${encodeURIComponent(window.location.href)}`;return}let C=window.latestUserData,B=C.isMailVerified==="1";i({email:C.email,username:C.user_name,isEmailVerified:B,canChangeUsername:C.can_change_user_name,isEmailSubscriber:C.is_subscribe_newsletter,isSocialUser:C.isSocialUser===1});let P=BeFunky.getUrlParameter("mv");P?B?Pe("email_already_verified"):ue(P):B||Y(),r||(r=BeFunky.isPlus()?de():Promise.reject("not_plus_user")),d(r).then(()=>{i({isLoading:!1})})}),BeFunky.updateMyAccountPageAfterUpgrade=function(){i({isLoading:!0}),d(de()).then(()=>i({isLoading:!1}))};function a(){let C=o.monthlyPriceIdForUpgradeToYearly&&!o.isPayPalSubscriber&&!o.isPayflowSubscriber&&!o.isGooglePlaySubscriber&&!o.isAppleAppStoreSubscriber,B=!o.hasCancelledSubscription&&!o.isAppleAppStoreSubscriber,P=BeFunky.isMac||BeFunky.isIOS||BeFunky.isAppleAppStoreApp?"itms-apps://apps.apple.com/account/subscriptions":"https://apps.apple.com/account/subscriptions",R=BeFunky.User.subscription_status==="trialing",S=BeFunky.getFreeTrialEnabled()?BeFunky.isAppleAppStoreApp?"upgrade_to_plus":"start_free_trial":BeFunky.isAppleAppStoreApp?"upgrade_to_plus":"upgrade";return ie`
        <div class="${`my-account__card ${o.isLoading?"my-account__card--loading":""}`}">

            <h2 class="my-account__heading">${N("profile")}</h2>
            <div class="my-account__row my-account__row--username">
                <span class="my-account__label">${N("username")}</span>
                <span class="my-account__data">${o.username}</span>
                ${o.canChangeUsername?ie`<button @click=${s} class="button button--link my-account__button">${N("change")}</button>`:""}
            </div>
            <div class="my-account__row my-account__row--email">
                <span class="my-account__label">${N("email")}</span>
                <span class="my-account__data">${o.email}</span>
                <button @click=${l} class="button button--link my-account__button">${N("change")}</button>
            </div>
            <div class="my-account__row my-account__row--password">
                <span class="my-account__label">${N("password")}</span>
                <span class="my-account__data">••••••••••••</span>
                <button @click=${u} class="button button--link my-account__button">${N("change")}</button>
            </div>
            <div class="my-account__row my-account__row--devices">
                <span class="my-account__label">${N("your_devices")}</span>
                <button @click=${y} class="button button--link my-account__button">${N("view")}</button>
            </div>
        </div>

        <div class="${`my-account__card ${o.isLoading?"my-account__card--loading":""}`}">
            <h2 class="my-account__heading">${N("subscription")}</h2>
            <div class="my-account__row subscription-row">
            ${o.hasCancelledSubscription?ie`
                <span>
                    <string>${N("cancelled_subscription")}</string>
                    <br>
                    <string>${N(["previous_plan",{next_billing_date:M(o.nextBillingDate)}])}</string>
                </span>
                ${o.canResubscribe?ie`<button @click=${g} class="button button--link my-account__button">${N("resubscribe")}</button>`:""}
            `:ie`
                <span class="my-account__label">${N("plan")}</span>
                <span class="my-account__data">BeFunky ${o.packageName} ${o.billingCycle} ${R?"- Trial":""}</span>
                ${o.canUpgrade?ie`<button @click=${p} class="button button--blue">${N(S)}</button>`:""}
                ${C?ie`<button @click=${f} class="button button--blue button--xs">${N("switch_to_annual")}</button>`:""}
            `}
            </div>

            ${o.packageName==="Plus"?ie`
                ${o.hasCancelledSubscription?"":ie`
                    <div class="my-account__row">
                        <span class="my-account__label">${N(R?"trial_end_date":"next_billing_date")}</span>
                        <span class="my-account__data">${M(o.nextBillingDate)}</span>
                    </div>
                `}
                ${o.isGooglePlaySubscriber?ie`
                    <div class="my-account__row">
                        <a href="https://play.google.com/store/account/subscriptions?package=com.befunky.pwato.tw" class="button button--link my-account__button" target="_blank" rel="noopener">${N("manage_play_subscription")}</a>
                    </div>
                `:ie`
                     ${o.isAppleAppStoreSubscriber?ie`
                         <div class="my-account__row">
                             <a href="${P}"
                                class="button button--link my-account__button" target="_blank"
                                rel="noopener">${N("manage_app_store_subscription")}</a>
                         </div>
                     `:ie`
                        <div class="my-account__row my-account__row--credit-card">
                            <span class="my-account__label">${N("billing_method")}</span>
                            <div class="my-account__data">${o.paymentInfo}</div>
                            ${o.isPayPalSubscriber?"":ie`
                            <button @click=${m} class="button button--link my-account__button">${N("change")}</button>
                            `}
                        </div>
                        <div class="my-account__row my-account__row--billing-history">
                            <span class="my-account__label">${N("billing_history")}</span>
                            <button @click=${_} class="button button--link my-account__button">${N("view")}</button>
                        </div>
                    `}
                `}
                <div class="my-account__row my-account__row--cancel-subscription">
                    ${B?ie`
                    <button @click=${k} class="button button--grey-outline button--md">${N("cancel_my_subscription")}</button>
                    `:""}
                </div>
            `:ie`
                    ${BeFunky.isStripeUser()?ie`
                        <div class="my-account__row my-account__row--billing-history">
                            <span class="my-account__label">${N("billing_history")}</span>
                            <button @click=${_} class="button button--link my-account__button">${N("view")}</button>
                        </div>
                    `:""}
                    ${BeFunky.isAppleAppStoreApp?ie`
                        <div class="my-account__row">
                            <button @click=${al} class="button button--link my-account__button">${N("restore_purchase")}</button>
                        </div>
                    `:""}
            `}
            </div>

            <div class="${`my-account__card ${o.isLoading?"my-account__card--loading":""}`}">
                <h2 class="my-account__heading">${N("email_notifications")}</h2>
                <div id="account_newsletter_subscription" class="my-account__row my-account__row--email-notifications">
                    <span>${N("email_notification_settings")}</span>
                    <button @click=${F} class="button button--link my-account__button">${N("change")}</button>
                </div>
            </div>

            <div class="${`my-account__card my-account__card--delete-account ${o.isLoading?"my-account__card--loading":""}`}">
                ${c()}
            </div>

        </div>
        `}function c(){let C=BeFunky.toLinkHTML("SUPPORT",!0),B=o.packageName==="Plus"&&!o.hasCancelledSubscription?ie`<button class="button button--link" style="padding: 0; display: inline" @click=${k}>${N("cancel_anytime")}</button>`:N("cancel_anytime");return o.isPayPalSubscriber?ie`
            <p>${N(["delete_account_contact_support",{contact_support:C}])}</p>
            <p>${N(["delete_account_info_1",{cancel_anytime:B}])}</p>
            <p>${N("delete_account_paypal")}</p>
            <a href=${Q()} class="button button--link my-account__button" target="_blank" rel="noopener">${N("open_paypal")}</a>
            `:o.isAppleAppStoreSubscriber&&!o.hasCancelledSubscription?ie`
            <p>${N(["delete_account_contact_support",{contact_support:C}])}</p>
            <p>${N("delete_account_app_store")}</p>
            <a href="https://apps.apple.com/account/subscriptions" class="button button--link my-account__button" target="_blank" rel="noopener">${N("open_app_store")}</a>
            `:o.isEmailVerified?ie`
            <p>${N(["delete_account_contact_support",{contact_support:C}])}</p>
            <p>${N(["delete_account_info_1",{cancel_anytime:B}])}</p>
            <p>${N("delete_account_info_2")}</p>
            <button @click=${L} class="button button--link my-account__button my-account__button--delete">${N("delete_account")}</button>
        `:ie`
            <p>${N(["delete_account_contact_support",{contact_support:C}])}</p>
            <p>${N(["delete_account_info_1",{cancel_anytime:B}])}</p>
            <p>${N("delete_account_verify_email")}</p>
            <button @click=${T} class="button button--link my-account__button">${N("send_verification_email")}</button>
            `}function d(C){return C.then(({data:B})=>{let P=B.PaymentPlatform==="paypal_subscr",R=B.PaymentPlatform==="payflow",S=B.PaymentPlatform==="google_play_store",A=B.PaymentPlatform==="apple_app_store",U=["monthly","monthly_premium_2017"];i({hasCancelledSubscription:B.iscancelled===1,canResubscribe:B.iscancelled===1&&!S&&!A,isPayPalSubscriber:P&&BeFunky.isPlus(),isPayflowSubscriber:R&&BeFunky.isPlus(),isGooglePlaySubscriber:S&&BeFunky.isPlus(),isAppleAppStoreSubscriber:A&&BeFunky.isPlus(),billingCycle:B.billingCycle||"",nextBillingDate:B.nextbillingdate_timestamp||"",packageName:B.packageName,monthlyPriceIdForUpgradeToYearly:B.billingCycle==="Monthly"&&!U.includes(B.price_id)?B.price_id:"",userPriceId:B.price_id||""});let D=P?`PayPal Account: ${B.SubscrEmai}`:ie`Card Number: ${B.last4} <br><string>${N("expiration_date")}</string> ${j(B.exp_month,B.exp_year)}`;i({paymentInfo:D}),window.location.href.includes("openThanks=1")&&BeFunky.openAfterUpgradeDialog();let oe=B.can_apply_coupon&&B.can_apply_coupon!==B.coupon_applied&&BeFunky.User.subscription_status!=="trialing"?B.can_apply_coupon:"";oe&&Z().then(le=>{le.includes(oe)||i({monthlyCouponCode:oe})})}).catch(B=>{BeFunky.isPlus()?B!=="user_not_plus"&&(B!=="request_failed"&&BeFunky.throwError("Unable to get customer data for Plus user",B),BeFunky.showNotification({message:["error_account_info",{contact_support:BeFunky.toLinkHTML("SUPPORT",!0)}],button:{text:"try_again",onClick:()=>window.location.reload()}})):i({packageName:"Free"})}).then(()=>{i({canUpgrade:!BeFunky.isPlus()})})}function s(){let C=E("username"),{teardown:B,setFormState:P}=Je(C,{title:"change_username",notification:"username_change_warning",fields:[{name:"username",label:"new_username",maxLength:100,errorMessage:"username_length",validate:R=>R.length>=4&&R.length<=100,sanitize:R=>R.replace(/[^a-zA-Z0-9_-]/g,"")}],button:"update_username",onSubmit:({username:R})=>{Fe(R).then(()=>{i({username:R,canChangeUsername:!1}),window.updateUserStatus(Object.assign(window.latestUserData,{user_name:R})),BeFunky.closeModal(C)}).catch(S=>{BeFunky.logError(`Unable to change username to "${R}"`,S),P({submissionErrors:[BeFunky.failureReason(S)]})})}});I(C,B)}function l(){let C=E("email"),{teardown:B,setFormState:P}=Je(C,{title:"change_email",fields:[{name:"email",label:"new_email",errorMessage:"error_invalid_email",validate:window.isEmailAddress,sanitize:R=>R.trim()},{name:"email_confirmed",label:"confirm_email",errorMessage:"error_email_mismatch",validate:(R,{email:S})=>R===S,sanitize:R=>R.trim()},{name:"password",label:"password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:R=>R.length>=6}],button:"update_email",onSubmit:({email:R,password:S})=>{Be(R,S).then(({requiresEmailVerification:A})=>{i({email:R,isEmailVerified:!A}),A&&window.setCookie("mailVerificationSend","",-1),window.updateUserStatus(Object.assign(window.latestUserData,{email:R})),BeFunky.closeModal(C)}).catch(A=>{BeFunky.logError(`Unable to change email to "${R}"`,A),P({submissionErrors:[BeFunky.failureReason(A)]})})}});I(C,B)}function u(){let C=E("password"),B={name:"current_password",label:"current_password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:A=>A.length>=6},P=[{name:"new_password",label:"new_password",type:"password",maxLength:100,errorMessage:"register_modal_password_error",validate:A=>A.length>=6},{name:"new_password_confirmed",label:"confirm_password",type:"password",maxLength:100,errorMessage:"error_password_mismatch",validate:(A,{new_password:U})=>A===U}],{teardown:R,setFormState:S}=Je(C,{title:"change_password",fields:o.isSocialUser?P:[B,...P],button:"change_password",onSubmit:({new_password:A,current_password:U})=>{pe(A,U).then(()=>{BeFunky.closeModal(C)}).catch(D=>{BeFunky.logError("Unable to change password",D),S({submissionErrors:[BeFunky.failureReason(D)]})})}});I(C,R)}function p(){BeFunky.openPricingModal()}function f(){BeFunky.promptUserToUpgradeToYearly(o.monthlyPriceIdForUpgradeToYearly)}function g(){BeFunky.requestAPI("transaction/re-subscribe",{},{showLoadScreen:!0}).then(C=>{if(C.data!=="success")throw"invalid_response";i({hasCancelledSubscription:!1}),window.updateUserStatus(Object.assign(window.latestUserData,{pl:"1"})),BeFunky.acknowledge("my_account_resubscribed")}).catch(C=>{BeFunky.logError("Unable to resubscribe user:",C)})}function m(){BeFunky.openPaymentPanel("year",o.isPayflowSubscriber?"update_from_payflow":"update")}function _(){BeFunky.withLoadScreen(Se()).then(C).catch(S=>{if(S==="no_invoices")return C([]);S!=="cancelled_by_user"&&BeFunky.throwError("Unable to fetch invoices",S)});function C(S){BeFunky.openModal(B(S),{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0})}function B(S){return dn`
                <div id="invoices" class="form-modal statement-panel modal">
                    <h3 class="h5">${N("billing_history")}</h3>
                    ${P(S)}
                </div>
            `}function P(S){return S.length?ie`
                <ul class="statement-panel__invoice-list">
                ${S.map(A=>ie`
                    <li class="statement-panel__list-item">
                        <span class="title">${M(A.date_timestamp)}</span>
                        <button class="button button--link" @click=${R(A)}>${N("view")}</button>
                    </li>
                `)}
                </ul>`:ie`<p>${N("no_receipts")}</p>`}function R(S){return()=>ne(Object.assign(S,{email:o.email}))}}function y(){Ee().then(C).catch(P=>{if(P==="no_invoices")return C([]);P!=="request_failed"&&BeFunky.reportWarning(`Unable to fetch devices: ${P}`,P)});function C(P){let R=B(P);BeFunky.openModal(R,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onWindowResize:({availableWidth:S})=>{R.style.setProperty("--scrollable-content-width",`${Math.min(404,S-32)}px`)}})}function B(P){let R=dn`<div id="devices" class="form-modal devices-panel modal"></div>`;return Tr(S(P),R),R;function S(){return P.length?ie`
                    <h3 class="h5">${N("your_devices")}</h3>
                    <ul class="devices-panel__list scrollable-content">
                    ${P.map(U=>ie`
                        <li class="devices-panel__device">
                            <div>
                                <h6 class="text-md">${U.device}</h6>
                                <div>${U.geo_data}</div>
                                <div>${U.date}</div>
                            </div>
                            ${U.is_you?ie`
                                <span style="color: var(--success-500);">${N("this_device")}</span>
                            `:ie`
                                <button class="button button--link" @click=${()=>A(U.id)}>${N("revoke_access")}</button>
                            `}
                        </li>
                    `)}
                    </ul>`:ie`<p>${N("no_signed_in_devices")}</p>`}function A(U){BeFunky.requestAPI("auth/devices",{device_key:U},{showLoadScreen:!0}).then(D=>{if(D.data!=="success")throw"invalid_response";P=P.filter(oe=>oe.id!==U),Tr(S(P),R)})}}}function h(){let{monthlyCouponCode:C}=o;BeFunky.confirm("keep_subscription_body",{heading:"keep_subscription_heading",confirmText:"keep_subscription",cancelText:"cancel_anyway",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/gift.jpg`,onConfirm:()=>{he(C).then(()=>{B(),BeFunky.acknowledge("keep_subscription_confirmation",{heading:"keep_subscription_thank_you",imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/peace.jpg`})}).catch(P=>{BeFunky.throwError(`Unable to apply coupon: ${P}`,P),BeFunky.acknowledge(BeFunky.failureReason(P))})},onCancel:P=>{!P||(B(),v())}});function B(){i({monthlyCouponCode:""}),Z().then(P=>{P.includes(C)||BeFunky.SettingsService.updateSetting("dismissed_messages",[...P,C])})}}function k(){if(o.monthlyCouponCode==="monthly_retention_30_percent_discount")return h();let C=()=>ie`
            <div>
                <p>${N(["cancellation_prompt",{next_billing_date:M(o.nextBillingDate)}])}</p>
                ${B()}
                ${o.isPayPalSubscriber?ie`<p>${N("cancel_via_paypal")}</p>`:""}
            </div>
        `;BeFunky.confirm(C,{heading:"thank_you_befunky_titlecase",confirmText:o.isPayPalSubscriber?"open_paypal":"cancel_subscription",cancelText:"dont_cancel_subscription",focusConfirmButton:!1,imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/gift.jpg`,onConfirm:v});function B(){if(BeFunky.usePlayStorePricing)return"";let P=o.userPriceId?BeFunky.Params.prices.find(D=>D.id===o.userPriceId):"";if(!P)return"";let{recurring:R}=P,S=zi()[R];if(P.unit_amount>=S.unit_amount)return"";let A=BeFunky.LanguageManager.language.site,U=[R==="month"?"cancellation_monthly_new_price":"cancellation_yearly_new_price",{user_price:Ye(P,A),current_price:Ye(S,A)}];return ie`<p>${N(U)}</p>`}}function v(){if(o.isPayPalSubscriber)return window.open(Q(),"_blank");re().then(()=>{i({hasCancelledSubscription:!0}),BeFunky.acknowledge(["my_account_unsubscribed",{my_account_link:`<a href="${BeFunky.Params.siteUrl}my-account/">${BeFunky.LanguageManager.getString("account")}</a>`,plan_expiration_date:M(o.nextBillingDate)}])}).catch(C=>{BeFunky.throwError("Unable to cancel subscription",C),BeFunky.acknowledge(BeFunky.failureReason(C))})}function F(){let C=P();BeFunky.openModal(C,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0});function B(R){R.preventDefault();let S=new FormData(R.target).get("email_opt_in")==="on";ke(S).then(()=>{BeFunky.closeModal(C),i({isEmailSubscriber:S})}).catch(A=>{BeFunky.throwError("Unable to update email subscription",A)})}function P(){return dn`
            <div id="email_notifications_modal" class="modal form-modal">
                <h3 class="h5 modal__heading">${N("email_notifications")}</h3>
                <p class="modal__sub-heading">${N("select_subscriptions")}</p>
                <form class="form-modal__form" @submit=${B}>
                    <div class="form-errors"></div>
                    <div class="checkbox" style="margin-bottom: 1.75rem">
                        <input type="checkbox" id="email_subscribe_newsletters" name="email_opt_in" .checked=${o.isEmailSubscriber}>
                        <label class="checkbox__label" for="email_subscribe_newsletters">
                            <span class="checkbox__box">
                                ${Pp("checkmark-icon","icon checkbox__icon")}
                            </span>
                            <string>
                                <span class="checkbox__heading">${N("newsletters")}</span>
                                <span class="checkbox__description">${N("newsletters_description")}</span>
                            </string>
                        </label>
                    </div>
                    <button class="button button--blue button--md" type="submit">${N("save_preferences")}</button>
                </form>
            </div>
            `}}function T(){xr()}function L(){let C=dn`
            <div>
                <p>${N(["delete_account_first_paragraph",{email:'<a href="mailto:support@befunky.com">support@befunky.com</a>'}])}</p>
                <p>${N("delete_account_second_paragraph")}</p>
                <p>${N("delete_account_thanks")}</p>
            </div>
        `;BeFunky.confirm(C,{heading:"sorry_to_see_you_go",confirmText:"yes_delete_account",imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/dog.jpg`,cancelText:"cancel",focusConfirmButton:!1,size:"medium",onConfirm:()=>{we().then(()=>{BeFunky.acknowledge(dn`<div>
                            <p>${N("delete_account_email_sent")}</p>
                            <p>${N("thank_you_befunky")}</p>
                        </div>`,{heading:"sorry_to_see_you_go",imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`})}).catch(B=>{BeFunky.acknowledge(BeFunky.failureReason(B)),BeFunky.throwError("Unable to send close account email",B)})}})}function E(C){let B=document.createElement("div").setClass("modal form-modal");return B.id=`modal_form_${C}`,B}function I(C,B){BeFunky.openModal(C,{addLightThemeClass:!0,addCloseButton:!0,size:"small",destroyOnClose:!0,onClose:B})}function M(C){return typeof C=="number"&&(C=new Date(C*1e3)),C instanceof Date?C.toLocaleDateString(BeFunky.LanguageManager.language.site,{day:"numeric",month:"long",year:"numeric"}):C}function j(C,B){return`${C<10?`0${C}`:C} / ${B}`}function Y(){BeFunky.showNotification({message:"please_verify_email",button:{text:"send_verification_email",onClick:xr},type:"warning"})}function Q(){return`https://www.paypal.com/cgi-bin/webscr?cmd=_subscr-find&alias=${encodeURIComponent("tekin2@befunky.com")}`}function z(C){let{date_timestamp:B,period_start_timestamp:P,period_end_timestamp:R,name:S,package_name:A,billing_cycle:U,charge:D,id:oe,last4:le,email:W}=C,K=700,X=Math.round(11/8.5*K),ce=`
            .invoice {
                position: relative;
                max-width: 100%;
                width: ${K}px;
                min-height: ${X}px;
                margin: 0 auto;
                background: var(--secondary-000);
                padding: 4rem;
            }
            .print-button {
                position: absolute;
                top: 2rem;
                right: 2rem;
            }
            @media print {
                .print-button { display: none; }
            }
        `,V=document.createElement("style");V.appendChild(document.createTextNode(ce));let Ie=document.createElement("style");Ie.appendChild(document.createTextNode([...document.getElementById("inline-fonts").sheet.cssRules].reduce(($,O)=>$+O.cssText.replace(/url\("\//g,`url("${BeFunky.Params.siteUrl}`),"")));let ae=[...document.head.querySelectorAll('link[rel="stylesheet"]')].filter($=>$.href.startsWith(BeFunky.Params.siteUrl)).map($=>$.cloneNode());return dn`
            <div class="invoice">
                ${ae}
                ${Ie}
                ${V}

                <img src="${BeFunky.Params.globalImagesPath}site/logo-dark1.svg" alt="BeFunky" style="margin: 0 auto; width: 320px; display: block;">
                <hr style="border-top: 1px solid #EDEDED; margin: 2rem 0">
                <h2>Invoice</h2>
                <p>
                    <strong>Date:</strong> ${M(B)}<br>
                    ${P===R?"":ie`<strong>Billing Period:</strong> ${M(P)} - ${M(R)}`}
                </p>

                <br>
                <h6>Billed To</h6>
                <p>
                    ${S}<br>
                    ${W}<br>
                    **** **** **** ${le}
                </p>

                <br>
                <h6>Invoice Number</h6>
                <p>${oe}</p>

                <br>
                <h6>Description</h6>
                <p>
                    Plan: BeFunky ${A} ${U}<br>
                    Charge: ${D}
                </p>

                <br>
                <p style="text-align: right"><strong>Total Amount Paid:</strong> ${D}</p>

                ${""}
                <button onclick="window.print()" class="button button--blue print-button">Print</button>
            </div>
        `}function ne(C){let B=z(C),P=`Invoice${BeFunky.randomString(10)}`;if(BeFunky.isAppleAppStoreApp)return B.id=P,BeFunky.openModal(B,{addCloseButton:!0,addLightThemeClass:!0,destroyOnClose:!0});let R=window.open("about:blank",P);BeFunky.isFirefox?(R.document.title=`BeFunky - ${M(C.date_timestamp)} Invoice`,R.document.write(B.outerHTML),R.document.close()):(R.document.title=`BeFunky - ${M(C.date_timestamp)} Invoice`,R.document.body.appendChild(B))}function Z(){return new Promise((C,B)=>{BeFunky.SettingsService.getUserSettings(({error:P,settings:R})=>{if(P)return B(P);C(R.dismissed_messages||[])})})}function de(){return BeFunky.requestAPI("transaction/customer")}function re(){return BeFunky.requestAPI("transaction/cancel-subscr",{plan_expiration_date:M(o.nextBillingDate)},{showLoadScreen:!0}).then(C=>{if(C.data!=="success")throw"invalid_response"})}function he(C){return BeFunky.requestAPI("transaction/apply-coupon",{coupon:C},{showLoadScreen:!0}).then(B=>{if(B.data!=="success")throw"invalid_response"})}function ue(C){return BeFunky.requestAPI("auth/verify-email",{mv:C},{showLoadScreen:!0}).then(B=>{if(B.data!=="success")throw"invalid_response";return Pe("email_successfully_verified")}).catch(B=>{if(B==="logged_out_reload_page")return window.location.reload();if(B==="already_verified")return Pe("email_already_verified");BeFunky.throwError("Unable to verify email:",B)})}function Pe(C){BeFunky.showNotification({message:C,type:"success"}),i({isEmailVerified:!0}),ve("/my-account/")}function Fe(C){return BeFunky.requestAPI("auth/update-username",{newName:C},{showLoadScreen:!0}).then(B=>{if(B.data!=="success")throw"invalid_response"})}function Be(C,B){let P={e:C,ea:C,paBa:btoa(encodeURIComponent(B))};return BeFunky.requestAPI("auth/update-email",P,{showLoadScreen:!0}).then(R=>{if(R.data!=="success")throw"invalid_response";return{requiresEmailVerification:R.social!=="1"}})}function pe(C,B){let P={npBa:btoa(encodeURIComponent(C)),npaBa:btoa(encodeURIComponent(C))};return B&&(P.opBa=btoa(encodeURIComponent(B))),BeFunky.requestAPI("auth/update-pwd",P,{showLoadScreen:!0}).then(R=>{if(R.data!=="success")throw"invalid_response"})}function ke(C){let B={em:"effects",is_:C?"0":"1"};return BeFunky.requestAPI("auth/update-email-pref",B,{showLoadScreen:!0}).then(P=>{if(P.data!=="success")throw"invalid_response"})}function we(){return BeFunky.requestAPI("auth/close-account-request",{},{showLoadScreen:!0}).then(C=>{if(C.data!=="success")throw"invalid_response"})}let me;function Se(){return me?Promise.resolve(me):BeFunky.requestAPI("transaction/invoices",{},{showLoadScreen:!0}).then(C=>{if(!Array.isArray(C.data))throw"invalid_response";return me=C.data,C.data})}function Ee(){return BeFunky.requestAPI("auth/devices",{},{showLoadScreen:!0}).then(C=>{if(!Array.isArray(C.data))throw"invalid_response";return C.data})}}function xr(){let e=!!window.getCookie("mailVerificationSend");if(BeFunky.Params.IS_LC&&(e=!0),e)return BeFunky.confirm("confirm_resend_verification_email",{onConfirm:t,confirmText:"resend_email"});t();function t(){BeFunky.requestAPI("auth/send-verify-email",{},{showLoadScreen:!0}).then(n=>{if(!n.userEmail)throw"invalid_response";BeFunky.acknowledge("verification_email_sent",{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/paper-plane.svg`})}).catch(n=>{BeFunky.logError("Unable to verify email",n),n==="not_user"?BeFunky.acknowledge("error_email_not_registered"):BeFunky.acknowledge(BeFunky.failureReason(n))})}}function al(){BeFunky.showLoadScreen(),nt(!1).then(({email:e,status:t}={})=>{BeFunky.UserManager.handleAppStoreUser(e,t,"restore-account",()=>{BeFunky.hideLoadScreen()})}).catch(()=>{BeFunky.hideLoadScreen(),BeFunky.isPlus()?BeFunky.showAndTrackAppStoreSubscriptionRestored():BeFunky.showAppStoreRestoreNotFound()})}var sl=!1;function Lp(e){if(sl)return;sl=!0;let t=100,n=200;BeFunky.waitUntil({condition:()=>BeFunky.isPlus(),onSuccess:()=>{try{window.bfn_mp.track("purchase_restored")}catch{}BeFunky.acknowledge("success_subscription_restored",{onAcknowledge:()=>{e&&e()}})},onTimeout:()=>{},interval:n,maxAttempts:t})}function Cp(e){let t=BeFunky.isLoggedIn()?"apple_appstore_prompt_no_restore_found":"apple_appstore_prompt_no_restore_found_not_signin";BeFunky.acknowledge(t,{onAcknowledge:()=>{e&&e()}})}BeFunky.sendVerificationEmail=xr;BeFunky.setupMyAccountPage=rl;BeFunky.handleRestorePurchase=al;BeFunky.showAndTrackAppStoreSubscriptionRestored=Lp;BeFunky.showAppStoreRestoreNotFound=Cp;var{html:ll,setupState:Ep,render:Ap,lang:Tp,elem:xp}=BeFunky.lit,cl=document.getElementById("close_account");cl&&$p(cl);function $p(e){let t={isLoading:!0},n=BeFunky.debounce(()=>Ap(a(),e),"raf"),[o,i]=Ep(t,n);BeFunky.LanguageManager.addLanguageUpdateListener(n);let r=BeFunky.getUrlParameter("q");window.initialUserStatus.then(()=>{if(!BeFunky.isLoggedIn()){window.location.href=`${BeFunky.Params.siteUrl}sign-in/?next=${encodeURIComponent(window.location.href)}`;return}u(r)});function a(){return o.isLoading?c():d()}function c(){return ll`
        <div class="section__no-grid">
            <div class="section__text section__text--centered">
                <div class="loading-spinner"></div>
            </div>
        </div>
        `}function d(){return ll`
        <div class="section__no-grid">
            <div class="section__text section__text--centered">
                <h1 class="close-account__heading h2">${p("permanently_close_account")}</h1>
                <p>${p("delete_your_account")}</p>
                <div class="close-account__buttons button-group">
                    <button id="close_account_no" class="button button--lg button--blue" @click=${s}>${p("no_close_account")}</button>
                    <button id="close_account_yes" class="button button--lg button--grey-300" @click=${l}>${p("yes_close_account")}</button>
                </div>
            </div>
        </div>
        `}function s(){BeFunky.acknowledge("thanks_for_staying",{onAcknowledge(){window.location.href=BeFunky.Params.siteUrl},imageUrl:`${BeFunky.Params.globalImagesPath}site/modals/leap-yay.jpg`})}function l(){f(r)}function u(h){let k={closeKey:h};BeFunky.requestAPI("auth/close-account-key-control",k).then(v=>{if(v.data!=="success")throw"invalid_response";i({isLoading:!1})}).catch(v=>{v!=="request_failed"&&(BeFunky.throwError("Unable to process close account",v),window.location.href=BeFunky.Params.siteUrl)})}function p(h){return Tp(h,"site")}function f(h){let k={closeKey:h};BeFunky.requestAPI("auth/close-account",k,{showLoadScreen:!0}).then(v=>{if(v.data!=="success")throw"invalid_response";BeFunky.showLoadScreen({message:"closing_account",progress:0}),setTimeout(_,2555)}).catch(v=>{BeFunky.throwError("Unable to close account",JSON.stringify({error:v})),y()})}let g=!1,m=0;function _(){g||(g=!0,BeFunky.requestAPI("auth/close-account-status",{}).then(h=>{g=!1;let k=parseInt(h.data.stepPercentageComplete)||0;if(k?m=k:m<100&&m++,BeFunky.showLoadScreen({message:"closing_account",progress:m}),parseInt(h.data.isFinished)===1){BeFunky.hideLoadScreen(),BeFunky.acknowledge("account_deleted",{onAcknowledge:()=>{BeFunky.signOut()}});return}setTimeout(BeFunky.updateAccountCloseStatus,100)}).catch(h=>{g=!1,BeFunky.hideLoadScreen(),BeFunky.throwError("Unable to get account close status",JSON.stringify({error:h})),y()}))}function y(){let h=xp`
        <div>
            <p>${p("error_close_account")}</p>
            <p>${p(["error_please_refresh",{contact_support:BeFunky.toLinkHTML("SUPPORT")}])}</p>
        </div>
        `;BeFunky.acknowledge(h)}}var{html:$r,setupState:Ip,render:Mp,lang:Rp}=BeFunky.lit,Up=document.getElementById("superstars");Up&&Dp(document.getElementById("superstars_gallery"));function Dp(e){let t={isLoading:!0,superStars:[]},n=BeFunky.debounce(()=>Mp(r(),e),"raf"),[o,i]=Ip(t,n);s();function r(){return o.isLoading?a():c()}function a(){return $r`
        <div class="section__inner">
            <div class="section__text section__text--centered">
                <div class="loading-spinner"></div>
            </div>
        </div>
        `}function c(){return $r`
        ${o.superStars.map(l=>$r`
            <section class="section__no-grid">
                <div class="superstar grid-item">
                    <div class="superstar__header">
                        <a href="/gallery/${l.username}/" class="superstar__thumbnail">
                            <img src="${BeFunky.Params.globalImagesPath}app/default-avatar.jpg" alt="${l.username}">
                        </a>
                        <h5><a href="/gallery/${l.username}/">${l.username}</a></h5>
                    </div>
                    <div class="superstar__images">
                        <div class="superstar__left-column">
                            <img src="${l.images[0].url}" alt="${l.images[0].title}" title="${l.images[0].title}" data-id="${l.images[0].id}">
                        </div>
                        <div class="superstar__right-column">
                            <img src="${l.images[1].thumb_url}" alt="${l.images[1].title}" title="${l.images[1].title}" data-id="${l.images[1].id}">
                            <img src="${l.images[2].thumb_url}" alt="${l.images[2].title}" title="${l.images[2].title}" data-id="${l.images[2].id}">
                        </div>
                    </div>
                </div>
            </section>`)}`}function d(l){return Rp(l,"site")}function s(){BeFunky.requestAPI("photo/superstars",{}).then(l=>{if(!Array.isArray(l.data))throw"invalid_request";let u=l.data;i({superStars:u,isLoading:!1})}).catch(l=>{l!=="request_failed"&&BeFunky.throwError("Unable to fetch Superstars",l)})}}var{html:Ir,setupState:jp,render:Op,lang:Np,elem:qp}=BeFunky.lit,Wp=document.getElementById("reset_password");Wp&&Hp(document.getElementById("password_reset_content"));function Hp(e){let t={linkIsValid:!0,hasBeenReset:!1,operationFailed:!1},n=BeFunky.debounce(()=>Op(d(),e),"raf"),[o,i]=jp(t,n);BeFunky.LanguageManager.addLanguageUpdateListener(n);let r=p();window.initialUserStatus.then(()=>{BeFunky.isLoggedIn()&&(window.location.href=`${BeFunky.Params.siteUrl}my-account/`)});let a=BeFunky.getUrlParameter("q"),c=/^[0-9a-f]{40}$/i;a.match(c)?f(a).catch(_=>{_==="invalid_key"?(i({linkIsValid:!1}),BeFunky.logWarning("Key is invalid")):_!=="request_failed"&&BeFunky.reportWarning(`Unable to validate reset pass key: ${_}`,{key:a})}):i({linkIsValid:!1});function d(){return o.hasBeenReset?u():o.linkIsValid?l():s()}function s(){let _=`${BeFunky.Params.siteUrl}sign-in/`,y=m(["reset_password_link_options",{send_new_link:BeFunky.toLinkHTML(`${_}?opn=fp`),sign_in:()=>`<a href="${_}">${BeFunky.LanguageManager.getString("sign_in").toLowerCase()}</a>`}]),h=m(["reset_password_support",{contact_support:BeFunky.toLinkHTML("SUPPORT")}]);return Ir`
            <h1 class="reset-password__heading h5">${m("reset_password_link_invalid")}</h1>
            <p>${y}</p>
            <p>${h}</p>
        `}function l(){return Ir`
            <h1 class="reset-password__heading h5">Reset Password</h1>
            ${r}
        `}function u(){return Ir`
         <h1 class="reset-password__heading text-xl" style="text-align: center">${m("password_updated")}</h1>
         <a href=${`${BeFunky.Params.siteUrl}sign-in/`} class="button button--blue button--lg" style="margin: 0 auto; display: inline-block;">${m("sign_in")}</a>
        `}function p(){let _=qp`<div></div>`,{setFormState:y}=Je(_,{title:"",fields:[{name:"pass",label:"new_password",maxLength:100,errorMessage:"register_modal_password_error",type:"password",validate:h=>h.length>=6},{name:"passAgain",label:"confirm_password",maxLength:100,errorMessage:"error_password_mismatch",type:"password",validate:(h,{pass:k})=>h===k}],button:"reset_password",onSubmit:({pass:h,passAgain:k})=>{g(a,h,k).then(()=>{i({hasBeenReset:!0})}).catch(v=>{v==="invalid_key"?i({linkIsValid:!1}):y({submissionErrors:[BeFunky.failureReason(v)]}),v!=="request_failed"&&BeFunky.throwError(`Unable to reset password: ${v}`,{key:a})})}},{formClass:"reset-password__form"});return _}function f(_){let y={qKey:_,validateKey:!0};return BeFunky.requestAPI("auth/reset-pass",y).then(h=>{if(h.data!=="success")throw"invalid_response"})}function g(_,y,h){let k={qKey:_,passBa:btoa(encodeURIComponent(y)),passAgainBa:btoa(encodeURIComponent(h))};return BeFunky.requestAPI("auth/reset-pass",k,{showLoadScreen:!0}).then(v=>{if(v.data!=="success")throw"invalid_response"})}function m(_){return Np(_,"site")}}var{html:Vp,useState:Xo,useLayoutEffect:Gp,useLanguageUpdate:zp,defineCustomElement:Xp}=BeFunky.lit;Xp("dashboard-projects",Yp);function Yp(){let e=this,[t,n]=Xo(!1),[o,i]=Xo([]),[r,a]=Xo(),[c,d]=Xo(Math.min(1136,window.innerWidth-96));return Gp(()=>{BeFunky.isLoggedIn()?l():a({text:"error_not_logged_in_projects",buttonText:"sign_in",buttonAction:()=>BeFunky.openLoginPanel("SIGNIN")}),window.addEventListener("resize",BeFunky.debounce(()=>_(!1),200));let y=BeFunky.isLoggedIn();window.onUserStatusChange(()=>{let h=BeFunky.isLoggedIn();!y&&h&&l(),y=h}),this.fetchProjects=l},[]),zp("site"),s();function s(){return Vp`
        <image-gallery
            .isLoading=${t}
            .images=${p()}
            .emptyState=${r}
            .rowHeight=${240}
            .currentWidth=${c}
            .singleRow=${!0}
            .onClickItem=${u}
            .borderWidth=${1}
        ></image-gallery>`}function l(){n(!0),BeFunky.SavedProjectFetcher.getFirst100Projects().then(y=>{i(y.slice(0,10))}).catch(y=>{i([]),a(y==="no_results"?{imageUrl:`${BeFunky.Params.globalImagesPath}illustrations/no-projects-dashboard.svg`,text:"no_saved_projects",linkText:"learn_more",linkHref:"https://support.befunky.com/hc/en-us/articles/360003279091-How-Do-I-Save-My-Project-So-I-Can-Edit-It-Later-"}:y==="not_logged_in"?{text:"error_not_logged_in_projects",buttonText:"sign_in",buttonAction:()=>BeFunky.openLoginPanel("SIGNIN")}:{text:BeFunky.failureReason(y),buttonText:"try_again",buttonAction:l})}).then(()=>{n(!1),_(!0)})}function u({id:y}){let h=o.find(k=>k.templateid===y);BeFunky.SavedProjectManager.openProjectFromOutsideOfApp(h)}function p(){return o.map(f)}function f(y){return{id:y.templateid,getImageURL:h=>g(y.thumburl,h*(BeFunky.isRetina()?1.5:1)),thumbWidth:y.width,thumbHeight:y.height,isTransparent:y.thumburl.includes(".png")}}function g(y,h){let k={auto:"avif,webp",width:m(h)};return BeFunky.addParamsToURL(y,k)}function m(y){return Math.ceil(y/50)*50}function _(y){let h=e.querySelector("image-gallery");if(!h){y&&requestAnimationFrame(()=>_(!1));return}let{width:k}=h.getBoundingClientRect();if(!k){y&&requestAnimationFrame(()=>_(!1));return}d(k)}}var{html:Xt,useState:pn,useEffect:Kp,useLanguageUpdate:Jp,siteLang:Qp,defineCustomElement:Zp}=BeFunky.lit;function eg(){let[e,t]=pn(!1),[n,o]=pn([]),[i,r]=pn(""),[a,c]=pn(1),[d,s]=pn(1),[l,u]=pn(void 0);this._hasInitialized||(this._hasInitialized=!0,je("/learn/search/:searchTerm/",j=>{r(j.searchTerm)}),je("/learn/search/",()=>{r("")}));let p=Jp("site"),f=document.querySelector("#blog_search h1"),g=document.querySelector(".search-box__input");return Kp(()=>{let j=i?BeFunky.LanguageManager.getStringReplacements("search_results_for",{query:i}):BeFunky.LanguageManager.getString("search");if(document.title=`${j} | Learn BeFunky`,f.textContent=j,g.value=i,!i)return t(!1);F(1)},[i,p]),m();function m(){return l?k():e&&n.length===0?_():i?n.length===0&&!e?y():v():h()}function _(){let j=369+128;return Xt`
        <div class="section__text section__text--centered" style="margin-bottom: 2rem; display: flex; flex-direction: row; align-items: center; justify-content: center; min-height: ${j}px">
            <div class="loading-spinner"></div>
        </div>
        `}function y(){return Xt`
        <div class="section__text section__text--centered">
            <p style="margin-bottom: 4rem">${Qp(["no_results_for",{query:`"${i}"`}])}</p>
        </div>
        `}function h(){return Xt`
        <div class="section__text section__text--centered"></div>
        `}function k(){return Xt`
        <div class="section__text section__text--centered">
            <p style="margin-bottom: 4rem">${BeFunky.failureReason(l)}</p>
        </div>
        `}function v(){return Xt`
        <div class="section section--bg-white">
            <div class="section__grid section__grid--cards">
                ${n.map(j=>{let Y=Xt([M(j.excerpt.rendered)]);return Xt`
                <a href="${BeFunky.Params.siteUrl}learn/${j.slug}/" class="section__grid-item grid-item grid-item--3 grid-item--link">
                    <figure class="grid-item__figure">
                        <img src="${T(j["featured-image"].file)}" class="grid-item__image" alt="${j["featured-image"].alt}">
                    </figure>
                    <div class="grid-item__text">
                        <h3 class="grid-item__heading h6">${I(j.title.rendered)}</h3>
                        ${Y}
                    </div>
                </a>`})}
            </div>
        </div>

        <div class="section__text section__text--centered blog__load-more-posts">
            <div class="section__buttons button-group">
                <button @click=${L} ?disabled="${e}"
                class="button button--grey-300 blog__view-more
                ${a>=d?"blog__view-more--hidden":""}
                ">View More</button>
            </div>
        </div>`}function F(j=1){t(!0),u(void 0);let Y=j===1;Y&&o([]),E(j).then(({response:Q,totalPageCount:z})=>{t(!1),c(j),o(Y?Q:[...n,...Q]),s(z)}).catch(Q=>{t(!1),u(Q),BeFunky.logError(`Error retrieving posts for ${i}`,Q)})}function T(j){let Y=BeFunky.Params.remoteImagesPath,[Q,z,ne]=j.split("/"),Z=`wp/wp-${Q}-${z}-${ne}`,de=Y+Z,re=BeFunky.isRetina()?540:360,he={auto:"avif,webp",width:re,crop:"16:9"};return BeFunky.addParamsToURL(de,he,!1)}function L(){F(a+1)}function E(j){return new Promise((Y,Q)=>{let ne=`${BeFunky.Params.IS_LC?"https://editors.befunky.com/":BeFunky.Params.siteUrl}wp-json/relevanssi/v1/search?keyword=${encodeURIComponent(i)}&per_page=12&page=${j}`,Z=BeFunky.request(ne,{},({error:de,response:re})=>{if(de==="No results")return Y({response:[],totalPageCount:0});if(de)return Q(de);if(!Array.isArray(re))return Q("invalid_response");let he=parseInt(Z.getResponseHeader("X-WP-TotalPages"));Y({response:re,totalPageCount:he})})})}function I(j){return new DOMParser().parseFromString(j,"text/html").documentElement.textContent}function M(j){let Y=65,Q=/<p>(.*?)<\/p>/,z=j.match(Q);if(!z)return"";let ne=z[1];if(ne.length>Y){let Z=ne.indexOf(" ",Y);return Z===-1?`<p>${ne.substring(0,65)} ...</p>
`:`<p>${ne.substring(0,Z)} ...</p>
`}return`<p>${ne} ...</p>
`}}Zp("blog-search-results",eg);var ul=document.getElementById("blog_search");ul&&tg.call(ul);function tg(){this.init=function(){this.initSearchForm()},this.initSearchForm=function(){this.searchForm=this.querySelector(".search-box"),this.searchInput=this.querySelector(".search-box__input"),this.clearButton=this.querySelector(".search-box__clear"),this.searchButton=this.querySelector(".search-box__submit"),this.searchAutocomplete=this.querySelector(".blog__search-autocomplete"),this.searchForm.addEventListener("submit",this.submitSearch),this.searchButton.addEventListener("click",this.submitSearch),this.clearButton.addEventListener("click",()=>setTimeout(()=>this.searchInput.focus(),0)),BeFunky.autocomplete(this.searchAutocomplete,{inputElement:this.searchInput,options:window.wordpressTagData.map(e=>({label:e.name,slug:e.slug})),onSelect:({slug:e,label:t})=>{e?ve(`/learn/tag/${encodeURIComponent(e)}`):ve(`/learn/search/${encodeURIComponent(t)}`)},generateItem:e=>({html:BeFunky.LanguageManager.getStringReplacements("search_for",{query:BeFunky.escapeHTML(e)}),index:0})})},this.submitSearch=e=>{e.preventDefault();let t=this.searchInput.value;!t||ve(`/learn/search/${encodeURIComponent(t)}`)},this.init()}window.rebuildGlobalVersion=7;})();
/*!
 * Fuse.js v3.6.1 - Lightweight fuzzy-search (http://fusejs.io)
 * 
 * Copyright (c) 2012-2017 Kirollos Risk (http://kiro.me)
 * All Rights Reserved. Apache Software License 2.0
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 */
/**
 * @license
 * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
/**
 * @license
 * Portions Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
//# sourceMappingURL=befunky.core.js.map
